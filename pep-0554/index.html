
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PEP 554 – Multiple Interpreters in the Stdlib &#8212; peps.python.org</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="PEP 555 – Context-local variables (contextvars)" href="../pep-0555/" />
    <link rel="prev" title="PEP 553 – Built-in breakpoint()" href="../pep-0553/" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pep-554-multiple-interpreters-in-the-stdlib">
<h1 class="page-title">PEP 554 – Multiple Interpreters in the Stdlib<a class="headerlink" href="#pep-554-multiple-interpreters-in-the-stdlib" title="Permalink to this headline">¶</a></h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd"><p>554</p>
</dd>
<dt class="field-even">Title</dt>
<dd class="field-even"><p>Multiple Interpreters in the Stdlib</p>
</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Eric Snow &lt;<a class="reference external" href="mailto:ericsnowcurrently&#37;&#52;&#48;gmail&#46;com?subject=PEP%20-1">ericsnowcurrently&#32;&#97;t&#32;gmail.com</a>&gt;</p>
</dd>
<dt class="field-even">BDFL-Delegate</dt>
<dd class="field-even"><p>Antoine Pitrou &lt;<a class="reference external" href="mailto:antoine&#37;&#52;&#48;python&#46;org?subject=PEP%20-1">antoine&#32;&#97;t&#32;python.org</a>&gt;</p>
</dd>
<dt class="field-odd">Status</dt>
<dd class="field-odd"><p>Draft</p>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>Standards Track</p>
</dd>
<dt class="field-odd">Created</dt>
<dd class="field-odd"><p>05-Sep-2017</p>
</dd>
<dt class="field-even">Python-Version</dt>
<dd class="field-even"><p>3.10</p>
</dd>
<dt class="field-odd">Post-History</dt>
<dd class="field-odd"><p>07-Sep-2017, 08-Sep-2017, 13-Sep-2017, 05-Dec-2017,
09-May-2018, 20-Apr-2020, 04-May-2020</p>
</dd>
</dl>
<hr class="docutils" />
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#abstract" id="id17">Abstract</a></p></li>
<li><p><a class="reference internal" href="#a-disclaimer-about-the-gil" id="id18">A Disclaimer about the GIL</a></p></li>
<li><p><a class="reference internal" href="#proposal" id="id19">Proposal</a></p>
<ul>
<li><p><a class="reference internal" href="#the-interpreters-module" id="id20">The “interpreters” Module</a></p></li>
<li><p><a class="reference internal" href="#api-summary-for-interpreters-module" id="id21">API summary for interpreters module</a></p></li>
<li><p><a class="reference internal" href="#help-for-extension-module-maintainers" id="id22">Help for Extension Module Maintainers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#examples" id="id23">Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#run-isolated-code" id="id24">Run isolated code</a></p></li>
<li><p><a class="reference internal" href="#run-in-a-thread" id="id25">Run in a thread</a></p></li>
<li><p><a class="reference internal" href="#pre-populate-an-interpreter" id="id26">Pre-populate an interpreter</a></p></li>
<li><p><a class="reference internal" href="#handling-an-exception" id="id27">Handling an exception</a></p></li>
<li><p><a class="reference internal" href="#re-raising-an-exception" id="id28">Re-raising an exception</a></p></li>
<li><p><a class="reference internal" href="#synchronize-using-a-channel" id="id29">Synchronize using a channel</a></p></li>
<li><p><a class="reference internal" href="#sharing-a-file-descriptor" id="id30">Sharing a file descriptor</a></p></li>
<li><p><a class="reference internal" href="#passing-objects-via-marshal" id="id31">Passing objects via marshal</a></p></li>
<li><p><a class="reference internal" href="#passing-objects-via-pickle" id="id32">Passing objects via pickle</a></p></li>
<li><p><a class="reference internal" href="#running-a-module" id="id33">Running a module</a></p></li>
<li><p><a class="reference internal" href="#running-as-script-including-zip-archives-directories" id="id34">Running as script (including zip archives &amp; directories)</a></p></li>
<li><p><a class="reference internal" href="#running-in-a-thread-pool-executor" id="id35">Running in a thread pool executor</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#rationale" id="id36">Rationale</a></p>
<ul>
<li><p><a class="reference internal" href="#concerns" id="id37">Concerns</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#about-subinterpreters" id="id38">About Subinterpreters</a></p>
<ul>
<li><p><a class="reference internal" href="#concurrency" id="id39">Concurrency</a></p></li>
<li><p><a class="reference internal" href="#shared-data" id="id40">Shared data</a></p></li>
<li><p><a class="reference internal" href="#interpreter-isolation" id="id41">Interpreter Isolation</a></p></li>
<li><p><a class="reference internal" href="#existing-usage" id="id42">Existing Usage</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#provisional-status" id="id43">Provisional Status</a></p></li>
<li><p><a class="reference internal" href="#alternate-python-implementations" id="id44">Alternate Python Implementations</a></p></li>
<li><p><a class="reference internal" href="#interpreters-module-api" id="id45">“interpreters” Module API</a></p>
<ul>
<li><p><a class="reference internal" href="#uncaught-exceptions" id="id46">Uncaught Exceptions</a></p></li>
<li><p><a class="reference internal" href="#api-for-sharing-data" id="id47">API for sharing data</a></p></li>
<li><p><a class="reference internal" href="#channel-lifespan" id="id48">Channel Lifespan</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#interpreter-isolated-mode" id="id49">Interpreter “Isolated” Mode</a></p></li>
<li><p><a class="reference internal" href="#documentation" id="id50">Documentation</a></p></li>
<li><p><a class="reference internal" href="#deferred-functionality" id="id51">Deferred Functionality</a></p>
<ul>
<li><p><a class="reference internal" href="#interpreter-call" id="id52">Interpreter.call()</a></p></li>
<li><p><a class="reference internal" href="#timeout-arg-to-recv-and-send" id="id53">timeout arg to recv() and send()</a></p></li>
<li><p><a class="reference internal" href="#interpreter-run-in-thread" id="id54">Interpreter.run_in_thread()</a></p></li>
<li><p><a class="reference internal" href="#synchronization-primitives" id="id55">Synchronization Primitives</a></p></li>
<li><p><a class="reference internal" href="#csp-library" id="id56">CSP Library</a></p></li>
<li><p><a class="reference internal" href="#syntactic-support" id="id57">Syntactic Support</a></p></li>
<li><p><a class="reference internal" href="#multiprocessing" id="id58">Multiprocessing</a></p></li>
<li><p><a class="reference internal" href="#c-extension-opt-in-opt-out" id="id59">C-extension opt-in/opt-out</a></p></li>
<li><p><a class="reference internal" href="#poisoning-channels" id="id60">Poisoning channels</a></p></li>
<li><p><a class="reference internal" href="#resetting-main" id="id61">Resetting __main__</a></p></li>
<li><p><a class="reference internal" href="#resetting-an-interpreter-s-state" id="id62">Resetting an interpreter’s state</a></p></li>
<li><p><a class="reference internal" href="#file-descriptors-and-sockets-in-channels" id="id63">File descriptors and sockets in channels</a></p></li>
<li><p><a class="reference internal" href="#integration-with-async" id="id64">Integration with async</a></p></li>
<li><p><a class="reference internal" href="#support-for-iteration" id="id65">Support for iteration</a></p></li>
<li><p><a class="reference internal" href="#channel-context-managers" id="id66">Channel context managers</a></p></li>
<li><p><a class="reference internal" href="#pipes-and-queues" id="id67">Pipes and Queues</a></p></li>
<li><p><a class="reference internal" href="#return-a-lock-from-send" id="id68">Return a lock from send()</a></p></li>
<li><p><a class="reference internal" href="#support-prioritization-in-channels" id="id69">Support prioritization in channels</a></p></li>
<li><p><a class="reference internal" href="#support-inheriting-settings-and-more" id="id70">Support inheriting settings (and more?)</a></p></li>
<li><p><a class="reference internal" href="#make-exceptions-shareable" id="id71">Make exceptions shareable</a></p></li>
<li><p><a class="reference internal" href="#make-runfailederror-cause-lazy" id="id72">Make RunFailedError.__cause__ lazy</a></p></li>
<li><p><a class="reference internal" href="#serialize-everything-through-channels" id="id73">Serialize everything through channels</a></p></li>
<li><p><a class="reference internal" href="#return-a-value-from-run" id="id74">Return a value from <code class="docutils literal notranslate"><span class="pre">run()</span></code></a></p></li>
<li><p><a class="reference internal" href="#add-a-tp-share-type-slot" id="id75">Add a “tp_share” type slot</a></p></li>
<li><p><a class="reference internal" href="#expose-which-interpreters-have-actually-used-a-channel-end" id="id76">Expose which interpreters have actually <em>used</em> a channel end.</a></p></li>
<li><p><a class="reference internal" href="#add-a-shareable-synchronization-primitive" id="id77">Add a shareable synchronization primitive</a></p></li>
<li><p><a class="reference internal" href="#propagate-systemexit-and-keyboardinterrupt-differently" id="id78">Propagate SystemExit and KeyboardInterrupt Differently</a></p></li>
<li><p><a class="reference internal" href="#add-an-explicit-release-and-close-to-channel-end-classes" id="id79">Add an explicit release() and close() to channel end classes</a></p></li>
<li><p><a class="reference internal" href="#add-sendchannel-send-buffer" id="id80">Add SendChannel.send_buffer()</a></p></li>
<li><p><a class="reference internal" href="#auto-run-in-a-thread" id="id81">Auto-run in a thread</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#rejected-ideas" id="id82">Rejected Ideas</a></p>
<ul>
<li><p><a class="reference internal" href="#explicit-channel-association" id="id83">Explicit channel association</a></p></li>
<li><p><a class="reference internal" href="#use-pipes-instead-of-channels" id="id84">Use pipes instead of channels</a></p></li>
<li><p><a class="reference internal" href="#use-queues-instead-of-channels" id="id85">Use queues instead of channels</a></p></li>
<li><p><a class="reference internal" href="#enumerate" id="id86">“enumerate”</a></p></li>
<li><p><a class="reference internal" href="#alternate-solutions-to-prevent-leaking-exceptions-across-interpreters" id="id87">Alternate solutions to prevent leaking exceptions across interpreters</a></p></li>
<li><p><a class="reference internal" href="#always-associate-each-new-interpreter-with-its-own-thread" id="id88">Always associate each new interpreter with its own thread</a></p></li>
<li><p><a class="reference internal" href="#only-associate-interpreters-upon-use" id="id89">Only associate interpreters upon use</a></p></li>
<li><p><a class="reference internal" href="#add-a-reraise-method-to-runfailederror" id="id90">Add a “reraise” method to RunFailedError</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation" id="id91">Implementation</a></p></li>
<li><p><a class="reference internal" href="#references" id="id92">References</a></p></li>
<li><p><a class="reference internal" href="#copyright" id="id93">Copyright</a></p></li>
</ul>
</div>
<section id="abstract">
<h2><a class="toc-backref" href="#id17">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>CPython has supported multiple interpreters in the same process (AKA
“subinterpreters”) since version 1.5 (1997).  The feature has been
available via the C-API. <a class="reference internal" href="#c-api" id="id1"><span>[c-api]</span></a>  Subinterpreters operate in
<a class="reference internal" href="#interpreter-isolation">relative isolation from one another</a>, which
facilitates novel alternative approaches to
<a class="reference internal" href="#concurrency">concurrency</a>.</p>
<p>This proposal introduces the stdlib <code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module.  The module
will be <a class="reference internal" href="#provisional-status">provisional</a>.  It exposes the basic
functionality of subinterpreters already provided by the C-API, along
with new (basic) functionality for sharing data between interpreters.</p>
</section>
<section id="a-disclaimer-about-the-gil">
<h2><a class="toc-backref" href="#id18">A Disclaimer about the GIL</a><a class="headerlink" href="#a-disclaimer-about-the-gil" title="Permalink to this headline">¶</a></h2>
<p>To avoid any confusion up front:  This PEP is unrelated to any efforts
to stop sharing the GIL between subinterpreters.  At most this proposal
will allow users to take advantage of any results of work on the GIL.
The position here is that exposing subinterpreters to Python code is
worth doing, even if they still share the GIL.</p>
</section>
<section id="proposal">
<h2><a class="toc-backref" href="#id19">Proposal</a><a class="headerlink" href="#proposal" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module will be added to the stdlib.  To help
authors of extension modules, a new page will be added to the
<a class="reference internal" href="#extension-docs">Extending Python</a> docs.  More information on both
is found in the immediately following sections.</p>
<section id="the-interpreters-module">
<h3><a class="toc-backref" href="#id20">The “interpreters” Module</a><a class="headerlink" href="#the-interpreters-module" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module will
provide a high-level interface to subinterpreters and wrap a new
low-level <code class="docutils literal notranslate"><span class="pre">_interpreters</span></code> (in the same way as the <code class="docutils literal notranslate"><span class="pre">threading</span></code>
module).  See the <a class="reference internal" href="#examples">Examples</a> section for concrete usage and use cases.</p>
<p>Along with exposing the existing (in CPython) subinterpreter support,
the module will also provide a mechanism for sharing data between
interpreters.  This mechanism centers around “channels”, which are
similar to queues and pipes.</p>
<p>Note that <em>objects</em> are not shared between interpreters since they are
tied to the interpreter in which they were created.  Instead, the
objects’ <em>data</em> is passed between interpreters.  See the <a class="reference internal" href="#shared-data">Shared data</a>
section for more details about sharing between interpreters.</p>
<p>At first only the following types will be supported for sharing:</p>
<ul class="simple">
<li><p>None</p></li>
<li><p>bytes</p></li>
<li><p>str</p></li>
<li><p>int</p></li>
<li><p><a class="reference external" href="pep-0554.html">PEP 554</a> channels</p></li>
</ul>
<p>Support for other basic types (e.g. bool, float, Ellipsis) will be added later.</p>
</section>
<section id="api-summary-for-interpreters-module">
<h3><a class="toc-backref" href="#id21">API summary for interpreters module</a><a class="headerlink" href="#api-summary-for-interpreters-module" title="Permalink to this headline">¶</a></h3>
<p>Here is a summary of the API for the <code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module.  For a
more in-depth explanation of the proposed classes and functions, see
the <a class="reference internal" href="#interpreters-module-api">“interpreters” Module API</a> section below.</p>
<p>For creating and using interpreters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 49%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>signature</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">list_all()</span> <span class="pre">-&gt;</span> <span class="pre">[Interpreter]</span></code></p></td>
<td><p>Get all existing interpreters.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">get_current()</span> <span class="pre">-&gt;</span> <span class="pre">Interpreter</span></code></p></td>
<td><p>Get the currently running interpreter.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">get_main()</span> <span class="pre">-&gt;</span> <span class="pre">Interpreter</span></code></p></td>
<td><p>Get the main interpreter.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">create(*,</span> <span class="pre">isolated=True)</span> <span class="pre">-&gt;</span> <span class="pre">Interpreter</span></code></p></td>
<td><p>Initialize a new (idle) Python interpreter.</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>signature</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">Interpreter(id)</span></code></p></td>
<td><p>A single interpreter.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.id</span></code></p></td>
<td><p>The interpreter’s ID (read-only).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.isolated</span></code></p></td>
<td><p>The interpreter’s mode (read-only).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.is_running()</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code></p></td>
<td><p>Is the interpreter currently executing code?</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.close()</span></code></p></td>
<td><p>Finalize and destroy the interpreter.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.run(src_str,</span> <span class="pre">/,</span> <span class="pre">*,</span> <span class="pre">channels=None)</span></code></p></td>
<td><div class="line-block">
<div class="line">Run the given source code in the interpreter.</div>
<div class="line">(This blocks the current thread until done.)</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 20%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>exception</p></th>
<th class="head"><p>base</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">RunFailedError</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code></p></td>
<td><p>Interpreter.run() resulted in an uncaught exception.</p></td>
</tr>
</tbody>
</table>
<p>For sharing data between interpreters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>signature</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">is_shareable(obj)</span> <span class="pre">-&gt;</span> <span class="pre">Bool</span></code></p></td>
<td><div class="line-block">
<div class="line">Can the object’s data be shared</div>
<div class="line">between interpreters?</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">create_channel()</span> <span class="pre">-&gt;</span> <span class="pre">(RecvChannel,</span> <span class="pre">SendChannel)</span></code></p></td>
<td><div class="line-block">
<div class="line">Create a new channel for passing</div>
<div class="line">data between interpreters.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">list_all_channels()</span> <span class="pre">-&gt;</span> <span class="pre">[(RecvChannel,</span> <span class="pre">SendChannel)]</span></code></p></td>
<td><p>Get all open channels.</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>signature</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">RecvChannel(id)</span></code></p></td>
<td><p>The receiving end of a channel.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.id</span></code></p></td>
<td><p>The channel’s unique ID.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.recv()</span> <span class="pre">-&gt;</span> <span class="pre">object</span></code></p></td>
<td><div class="line-block">
<div class="line">Get the next object from the channel,</div>
<div class="line">and wait if none have been sent.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.recv_nowait(default=None)</span> <span class="pre">-&gt;</span> <span class="pre">object</span></code></p></td>
<td><div class="line-block">
<div class="line">Like recv(), but return the default</div>
<div class="line">instead of waiting.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>signature</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">SendChannel(id)</span></code></p></td>
<td><p>The sending end of a channel.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.id</span></code></p></td>
<td><p>The channel’s unique ID.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.send(obj)</span></code></p></td>
<td><div class="line-block">
<div class="line">Send the object (i.e. its data) to the</div>
<div class="line">receiving end of the channel and wait.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.send_nowait(obj)</span></code></p></td>
<td><div class="line-block">
<div class="line">Like send(), but return False if not received.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 24%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>exception</p></th>
<th class="head"><p>base</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ChannelError</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Exception</span></code></p></td>
<td><p>The base class for channel-related exceptions.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ChannelNotFoundError</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ChannelError</span></code></p></td>
<td><p>The identified channel was not found.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ChannelEmptyError</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ChannelError</span></code></p></td>
<td><p>The channel was unexpectedly empty.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ChannelNotEmptyError</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ChannelError</span></code></p></td>
<td><p>The channel was unexpectedly not empty.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">NotReceivedError</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ChannelError</span></code></p></td>
<td><p>Nothing was waiting to receive a sent object.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="help-for-extension-module-maintainers">
<h3><a class="toc-backref" href="#id22">Help for Extension Module Maintainers</a><a class="headerlink" href="#help-for-extension-module-maintainers" title="Permalink to this headline">¶</a></h3>
<p>Many extension modules do not support use in subinterpreters yet.  The
maintainers and users of such extension modules will both benefit when
they are updated to support subinterpreters.  In the meantime users may
become confused by failures when using subinterpreters, which could
negatively impact extension maintainers.  See <a class="reference internal" href="#concerns">Concerns</a> below.</p>
<p>To mitigate that impact and accelerate compatibility, we will do the
following:</p>
<ul class="simple">
<li><p>be clear that extension modules are <em>not</em> required to support use in
subinterpreters</p></li>
<li><p>raise <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> when an incompatible (no <a class="reference external" href="pep-0489.html">PEP 489</a> support) module
is imported in a subinterpreter</p></li>
<li><p>provide resources (e.g. docs) to help maintainers reach compatibility</p></li>
<li><p>reach out to the maintainers of Cython and of the most used extension
modules (on PyPI) to get feedback and possibly provide assistance</p></li>
</ul>
</section>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#id23">Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<section id="run-isolated-code">
<h3><a class="toc-backref" href="#id24">Run isolated code</a><a class="headerlink" href="#run-isolated-code" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
<span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;print(&quot;during&quot;)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="run-in-a-thread">
<h3><a class="toc-backref" href="#id25">Run in a thread</a><a class="headerlink" href="#run-in-a-thread" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;print(&quot;during&quot;)&#39;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pre-populate-an-interpreter">
<h3><a class="toc-backref" href="#id26">Pre-populate an interpreter</a><a class="headerlink" href="#pre-populate-an-interpreter" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    import some_lib</span>
<span class="s2">    import an_expensive_module</span>
<span class="s2">    some_lib.set_up()</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">))</span>
<span class="n">wait_for_request</span><span class="p">()</span>
<span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    some_lib.handle_request()</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="handling-an-exception">
<h3><a class="toc-backref" href="#id27">Handling an exception</a><a class="headerlink" href="#handling-an-exception" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        raise KeyError</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">))</span>
<span class="k">except</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">RunFailedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;got the error from the subinterpreter: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="re-raising-an-exception">
<h3><a class="toc-backref" href="#id28">Re-raising an exception</a><a class="headerlink" href="#re-raising-an-exception" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            raise KeyError</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">RunFailedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">__cause__</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;got a KeyError from the subinterpreter&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this pattern is a candidate for later improvement.</p>
</section>
<section id="synchronize-using-a-channel">
<h3><a class="toc-backref" href="#id29">Synchronize using a channel</a><a class="headerlink" href="#synchronize-using-a-channel" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">r</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create_channel</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        reader.recv()</span>
<span class="s2">        print(&quot;during&quot;)</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">shared</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">reader</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="sharing-a-file-descriptor">
<h3><a class="toc-backref" href="#id30">Sharing a file descriptor</a><a class="headerlink" href="#sharing-a-file-descriptor" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">r1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create_channel</span><span class="p">()</span>
<span class="n">r2</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create_channel</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        fd = int.from_bytes(</span>
<span class="s2">                reader.recv(), &#39;big&#39;)</span>
<span class="s2">        for line in os.fdopen(fd):</span>
<span class="s2">            print(line)</span>
<span class="s2">        writer.send(b&#39;&#39;)</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span>
        <span class="n">shared</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">reader</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
            <span class="n">writer</span><span class="o">=</span><span class="n">s2</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;spamspamspam&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="passing-objects-via-marshal">
<h3><a class="toc-backref" href="#id31">Passing objects via marshal</a><a class="headerlink" href="#passing-objects-via-marshal" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">r</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create_channel</span><span class="p">()</span>
<span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    import marshal</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">shared</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">reader</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        data = reader.recv()</span>
<span class="s2">        while data:</span>
<span class="s2">            obj = marshal.loads(data)</span>
<span class="s2">            do_something(obj)</span>
<span class="s2">            data = reader.recv()</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">marshal</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="passing-objects-via-pickle">
<h3><a class="toc-backref" href="#id32">Passing objects via pickle</a><a class="headerlink" href="#passing-objects-via-pickle" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">r</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create_channel</span><span class="p">()</span>
<span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    import pickle</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">shared</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">reader</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        data = reader.recv()</span>
<span class="s2">        while data:</span>
<span class="s2">            obj = pickle.loads(data)</span>
<span class="s2">            do_something(obj)</span>
<span class="s2">            data = reader.recv()</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="running-a-module">
<h3><a class="toc-backref" href="#id33">Running a module</a><a class="headerlink" href="#running-a-module" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">main_module</span> <span class="o">=</span> <span class="n">mod_name</span>
<span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;import runpy; runpy.run_module(</span><span class="si">{</span><span class="n">main_module</span><span class="si">!r}</span><span class="s1">)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="running-as-script-including-zip-archives-directories">
<h3><a class="toc-backref" href="#id34">Running as script (including zip archives &amp; directories)</a><a class="headerlink" href="#running-as-script-including-zip-archives-directories" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">main_script</span> <span class="o">=</span> <span class="n">path_name</span>
<span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;import runpy; runpy.run_path(</span><span class="si">{</span><span class="n">main_script</span><span class="si">!r}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="running-in-a-thread-pool-executor">
<h3><a class="toc-backref" href="#id35">Running in a thread pool executor</a><a class="headerlink" href="#running-in-a-thread-pool-executor" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interps</span> <span class="o">=</span> <span class="p">[</span><span class="n">interpreters</span><span class="o">.</span><span class="n">create</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">interps</span><span class="p">))</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">interp</span> <span class="ow">in</span> <span class="n">interps</span><span class="p">:</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">,</span> <span class="s1">&#39;print(&quot;starting&quot;); print(&quot;stopping&quot;)&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#id36">Rationale</a><a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<p>Running code in multiple interpreters provides a useful level of
isolation within the same process.  This can be leveraged in a number
of ways.  Furthermore, subinterpreters provide a well-defined framework
in which such isolation may extended.</p>
<p>Nick Coghlan explained some of the benefits through a comparison with
multi-processing <a class="reference internal" href="#benefits" id="id2"><span>[benefits]</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="n">expect</span> <span class="n">that</span> <span class="n">communicating</span> <span class="n">between</span> <span class="n">subinterpreters</span> <span class="ow">is</span> <span class="n">going</span>
<span class="n">to</span> <span class="n">end</span> <span class="n">up</span> <span class="n">looking</span> <span class="n">an</span> <span class="n">awful</span> <span class="n">lot</span> <span class="n">like</span> <span class="n">communicating</span> <span class="n">between</span>
<span class="n">subprocesses</span> <span class="n">via</span> <span class="n">shared</span> <span class="n">memory</span><span class="o">.</span>

<span class="n">The</span> <span class="n">trade</span><span class="o">-</span><span class="n">off</span> <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">models</span> <span class="n">will</span> <span class="n">then</span> <span class="n">be</span> <span class="n">that</span> <span class="n">one</span> <span class="n">still</span>
<span class="n">just</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">a</span> <span class="n">single</span> <span class="n">process</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">point</span> <span class="n">of</span> <span class="n">view</span> <span class="n">of</span> <span class="n">the</span>
<span class="n">outside</span> <span class="n">world</span><span class="p">,</span> <span class="ow">and</span> <span class="n">hence</span> <span class="n">doesn</span><span class="s1">&#39;t place any extra demands on the</span>
<span class="n">underlying</span> <span class="n">OS</span> <span class="n">beyond</span> <span class="n">those</span> <span class="n">required</span> <span class="n">to</span> <span class="n">run</span> <span class="n">CPython</span> <span class="k">with</span> <span class="n">a</span> <span class="n">single</span>
<span class="n">interpreter</span><span class="p">,</span> <span class="k">while</span> <span class="n">the</span> <span class="n">other</span> <span class="n">gives</span> <span class="n">much</span> <span class="n">stricter</span> <span class="n">isolation</span>
<span class="p">(</span><span class="n">including</span> <span class="n">isolating</span> <span class="n">C</span> <span class="nb">globals</span> <span class="ow">in</span> <span class="n">extension</span> <span class="n">modules</span><span class="p">),</span> <span class="n">but</span> <span class="n">also</span>
<span class="n">demands</span> <span class="n">much</span> <span class="n">more</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">OS</span> <span class="n">when</span> <span class="n">it</span> <span class="n">comes</span> <span class="n">to</span> <span class="n">its</span> <span class="n">IPC</span>
<span class="n">capabilities</span><span class="o">.</span>

<span class="n">The</span> <span class="n">security</span> <span class="n">risk</span> <span class="n">profiles</span> <span class="n">of</span> <span class="n">the</span> <span class="n">two</span> <span class="n">approaches</span> <span class="n">will</span> <span class="n">also</span> <span class="n">be</span> <span class="n">quite</span>
<span class="n">different</span><span class="p">,</span> <span class="n">since</span> <span class="n">using</span> <span class="n">subinterpreters</span> <span class="n">won</span><span class="s1">&#39;t require deliberately</span>
<span class="n">poking</span> <span class="n">holes</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">process</span> <span class="n">isolation</span> <span class="n">that</span> <span class="n">operating</span> <span class="n">systems</span> <span class="n">give</span>
<span class="n">you</span> <span class="n">by</span> <span class="n">default</span><span class="o">.</span>
</pre></div>
</div>
<p>CPython has supported subinterpreters, with increasing levels of
support, since version 1.5.  While the feature has the potential
to be a powerful tool, subinterpreters have suffered from neglect
because they are not available directly from Python.  Exposing the
existing functionality in the stdlib will help reverse the situation.</p>
<p>This proposal is focused on enabling the fundamental capability of
multiple isolated interpreters in the same Python process.  This is a
new area for Python so there is relative uncertainly about the best
tools to provide as companions to subinterpreters.  Thus we minimize
the functionality we add in the proposal as much as possible.</p>
<section id="concerns">
<h3><a class="toc-backref" href="#id37">Concerns</a><a class="headerlink" href="#concerns" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>“subinterpreters are not worth the trouble”</p></li>
</ul>
<p>Some have argued that subinterpreters do not add sufficient benefit
to justify making them an official part of Python.  Adding features
to the language (or stdlib) has a cost in increasing the size of
the language.  So an addition must pay for itself.  In this case,
subinterpreters provide a novel concurrency model focused on isolated
threads of execution.  Furthermore, they provide an opportunity for
changes in CPython that will allow simultaneous use of multiple CPU
cores (currently prevented by the GIL).</p>
<p>Alternatives to subinterpreters include threading, async, and
multiprocessing.  Threading is limited by the GIL and async isn’t
the right solution for every problem (nor for every person).
Multiprocessing is likewise valuable in some but not all situations.
Direct IPC (rather than via the multiprocessing module) provides
similar benefits but with the same caveat.</p>
<p>Notably, subinterpreters are not intended as a replacement for any of
the above.  Certainly they overlap in some areas, but the benefits of
subinterpreters include isolation and (potentially) performance.  In
particular, subinterpreters provide a direct route to an alternate
concurrency model (e.g. CSP) which has found success elsewhere and
will appeal to some Python users.  That is the core value that the
<code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module will provide.</p>
<ul class="simple">
<li><p>“stdlib support for subinterpreters adds extra burden
on C extension authors”</p></li>
</ul>
<p>In the <a class="reference internal" href="#interpreter-isolation">Interpreter Isolation</a> section below we identify ways in
which isolation in CPython’s subinterpreters is incomplete.  Most
notable is extension modules that use C globals to store internal
state.  <a class="reference external" href="pep-3121.html">PEP 3121</a> and <a class="reference external" href="pep-0489.html">PEP 489</a> provide a solution for most of the
problem, but one still remains. <a class="reference internal" href="#petr-c-ext" id="id3"><span>[petr-c-ext]</span></a>  Until that is resolved
(see <a class="reference external" href="pep-0573.html">PEP 573</a>), C extension authors will face extra difficulty
to support subinterpreters.</p>
<p>Consequently, projects that publish extension modules may face an
increased maintenance burden as their users start using subinterpreters,
where their modules may break.  This situation is limited to modules
that use C globals (or use libraries that use C globals) to store
internal state.  For numpy, the reported-bug rate is one every 6
months. <a class="reference internal" href="#bug-rate" id="id4"><span>[bug-rate]</span></a></p>
<p>Ultimately this comes down to a question of how often it will be a
problem in practice: how many projects would be affected, how often
their users will be affected, what the additional maintenance burden
will be for projects, and what the overall benefit of subinterpreters
is to offset those costs.  The position of this PEP is that the actual
extra maintenance burden will be small and well below the threshold at
which subinterpreters are worth it.</p>
<ul class="simple">
<li><p>“creating a new concurrency API deserves much more thought and
experimentation, so the new module shouldn’t go into the stdlib
right away, if ever”</p></li>
</ul>
<p>Introducing an API for a new concurrency model, like happened with
asyncio, is an extremely large project that requires a lot of careful
consideration.  It is not something that can be done a simply as this
PEP proposes and likely deserves significant time on PyPI to mature.
(See <a class="reference external" href="nathaniel-asyncio">Nathaniel’s post</a> on python-dev.)</p>
<p>However, this PEP does not propose any new concurrency API.  At most
it exposes minimal tools (e.g. subinterpreters, channels) which may
be used to write code that follows patterns associated with (relatively)
new-to-Python <a class="reference internal" href="#concurrency">concurrency models</a>.  Those tools could
also be used as the basis for APIs for such concurrency models.
Again, this PEP does not propose any such API.</p>
<ul class="simple">
<li><p>“there is no point to exposing subinterpreters if they still share
the GIL”</p></li>
<li><p>“the effort to make the GIL per-interpreter is disruptive and risky”</p></li>
</ul>
<p>A common misconception is that this PEP also includes a promise that
subinterpreters will no longer share the GIL.  When that is clarified,
the next question is “what is the point?”.  This is already answered
at length in this PEP.  Just to be clear, the value lies in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">increase</span> <span class="n">exposure</span> <span class="n">of</span> <span class="n">the</span> <span class="n">existing</span> <span class="n">feature</span><span class="p">,</span> <span class="n">which</span> <span class="n">helps</span> <span class="n">improve</span>
  <span class="n">the</span> <span class="n">code</span> <span class="n">health</span> <span class="n">of</span> <span class="n">the</span> <span class="n">entire</span> <span class="n">CPython</span> <span class="n">runtime</span>
<span class="o">*</span> <span class="n">expose</span> <span class="n">the</span> <span class="p">(</span><span class="n">mostly</span><span class="p">)</span> <span class="n">isolated</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">subinterpreters</span>
<span class="o">*</span> <span class="n">preparation</span> <span class="k">for</span> <span class="n">per</span><span class="o">-</span><span class="n">interpreter</span> <span class="n">GIL</span>
<span class="o">*</span> <span class="n">encourage</span> <span class="n">experimentation</span>
</pre></div>
</div>
<ul class="simple">
<li><p>“data sharing can have a negative impact on cache performance
in multi-core scenarios”</p></li>
</ul>
<p>(See <a class="reference internal" href="#cache-line-ping-pong" id="id5"><span>[cache-line-ping-pong]</span></a>.)</p>
<p>This shouldn’t be a problem for now as we have no immediate plans
to actually share data between interpreters, instead focusing
on copying.</p>
</section>
</section>
<section id="about-subinterpreters">
<h2><a class="toc-backref" href="#id38">About Subinterpreters</a><a class="headerlink" href="#about-subinterpreters" title="Permalink to this headline">¶</a></h2>
<section id="concurrency">
<h3><a class="toc-backref" href="#id39">Concurrency</a><a class="headerlink" href="#concurrency" title="Permalink to this headline">¶</a></h3>
<p>Concurrency is a challenging area of software development.  Decades of
research and practice have led to a wide variety of concurrency models,
each with different goals.  Most center on correctness and usability.</p>
<p>One class of concurrency models focuses on isolated threads of
execution that interoperate through some message passing scheme.  A
notable example is <a class="reference internal" href="#communicating-sequential-processes">Communicating Sequential Processes</a> (CSP) (upon
which Go’s concurrency is roughly based).  The isolation inherent to
subinterpreters makes them well-suited to this approach.</p>
</section>
<section id="shared-data">
<h3><a class="toc-backref" href="#id40">Shared data</a><a class="headerlink" href="#shared-data" title="Permalink to this headline">¶</a></h3>
<p>Subinterpreters are inherently isolated (with caveats explained below),
in contrast to threads.  So the same communicate-via-shared-memory
approach doesn’t work.  Without an alternative, effective use of
concurrency via subinterpreters is significantly limited.</p>
<p>The key challenge here is that sharing objects between interpreters
faces complexity due to various constraints on object ownership,
visibility, and mutability.  At a conceptual level it’s easier to
reason about concurrency when objects only exist in one interpreter
at a time.  At a technical level, CPython’s current memory model
limits how Python <em>objects</em> may be shared safely between interpreters;
effectively objects are bound to the interpreter in which they were
created.  Furthermore, the complexity of <em>object</em> sharing increases as
subinterpreters become more isolated, e.g. after GIL removal.</p>
<p>Consequently,the mechanism for sharing needs to be carefully considered.
There are a number of valid solutions, several of which may be
appropriate to support in Python.  This proposal provides a single basic
solution: “channels”.  Ultimately, any other solution will look similar
to the proposed one, which will set the precedent.  Note that the
implementation of <code class="docutils literal notranslate"><span class="pre">Interpreter.run()</span></code> will be done in a way that
allows for multiple solutions to coexist, but doing so is not
technically a part of the proposal here.</p>
<p>Regarding the proposed solution, “channels”, it is a basic, opt-in data
sharing mechanism that draws inspiration from pipes, queues, and CSP’s
channels. <a class="reference internal" href="#fifo" id="id6"><span>[fifo]</span></a></p>
<p>As simply described earlier by the API summary,
channels have two operations: send and receive.  A key characteristic
of those operations is that channels transmit data derived from Python
objects rather than the objects themselves.  When objects are sent,
their data is extracted.  When the “object” is received in the other
interpreter, the data is converted back into an object owned by that
interpreter.</p>
<p>To make this work, the mutable shared state will be managed by the
Python runtime, not by any of the interpreters.  Initially we will
support only one type of objects for shared state: the channels provided
by <code class="docutils literal notranslate"><span class="pre">create_channel()</span></code>.  Channels, in turn, will carefully manage
passing objects between interpreters.</p>
<p>This approach, including keeping the API minimal, helps us avoid further
exposing any underlying complexity to Python users.  Along those same
lines, we will initially restrict the types that may be passed through
channels to the following:</p>
<ul class="simple">
<li><p>None</p></li>
<li><p>bytes</p></li>
<li><p>str</p></li>
<li><p>int</p></li>
<li><p>channels</p></li>
</ul>
<p>Limiting the initial shareable types is a practical matter, reducing
the potential complexity of the initial implementation.  There are a
number of strategies we may pursue in the future to expand supported
objects and object sharing strategies.</p>
</section>
<section id="interpreter-isolation">
<h3><a class="toc-backref" href="#id41">Interpreter Isolation</a><a class="headerlink" href="#interpreter-isolation" title="Permalink to this headline">¶</a></h3>
<p>CPython’s interpreters are intended to be strictly isolated from each
other.  Each interpreter has its own copy of all modules, classes,
functions, and variables.  The same applies to state in C, including in
extension modules.  The CPython C-API docs explain more. <a class="reference internal" href="#caveats" id="id7"><span>[caveats]</span></a></p>
<p>However, there are ways in which interpreters share some state.  First
of all, some process-global state remains shared:</p>
<ul class="simple">
<li><p>file descriptors</p></li>
<li><p>builtin types (e.g. dict, bytes)</p></li>
<li><p>singletons (e.g. None)</p></li>
<li><p>underlying static module data (e.g. functions) for
builtin/extension/frozen modules</p></li>
</ul>
<p>There are no plans to change this.</p>
<p>Second, some isolation is faulty due to bugs or implementations that did
not take subinterpreters into account.  This includes things like
extension modules that rely on C globals. <a class="reference internal" href="#cryptography" id="id8"><span>[cryptography]</span></a>  In these
cases bugs should be opened (some are already):</p>
<ul class="simple">
<li><p>readline module hook functions (<a class="reference external" href="http://bugs.python.org/issue4202">http://bugs.python.org/issue4202</a>)</p></li>
<li><p>memory leaks on re-init (<a class="reference external" href="http://bugs.python.org/issue21387">http://bugs.python.org/issue21387</a>)</p></li>
</ul>
<p>Finally, some potential isolation is missing due to the current design
of CPython.  Improvements are currently going on to address gaps in this
area:</p>
<ul class="simple">
<li><p>GC is not run per-interpreter <a class="reference internal" href="#global-gc" id="id9"><span>[global-gc]</span></a></p></li>
<li><p>at-exit handlers are not run per-interpreter <a class="reference internal" href="#global-atexit" id="id10"><span>[global-atexit]</span></a></p></li>
<li><p>extensions using the <code class="docutils literal notranslate"><span class="pre">PyGILState_*</span></code> API are incompatible <a class="reference internal" href="#gilstate" id="id11"><span>[gilstate]</span></a></p></li>
<li><p>interpreters share memory management (e.g. allocators, gc)</p></li>
<li><p>interpreters share the GIL</p></li>
</ul>
</section>
<section id="existing-usage">
<h3><a class="toc-backref" href="#id42">Existing Usage</a><a class="headerlink" href="#existing-usage" title="Permalink to this headline">¶</a></h3>
<p>Subinterpreters are not a widely used feature.  In fact, the only
documented cases of widespread usage are
<a class="reference external" href="https://github.com/GrahamDumpleton/mod_wsgi">mod_wsgi</a>,
<a class="reference external" href="https://github.com/ceph/ceph/pull/14971">OpenStack Ceph</a>, and
<a class="reference external" href="https://github.com/ninia/jep">JEP</a>.  On the one hand, these cases
provide confidence that existing subinterpreter support is relatively
stable.  On the other hand, there isn’t much of a sample size from which
to judge the utility of the feature.</p>
</section>
</section>
<section id="provisional-status">
<h2><a class="toc-backref" href="#id43">Provisional Status</a><a class="headerlink" href="#provisional-status" title="Permalink to this headline">¶</a></h2>
<p>The new <code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module will be added with “provisional” status
(see <a class="reference external" href="pep-0411.html">PEP 411</a>).  This allows Python users to experiment with the feature
and provide feedback while still allowing us to adjust to that feedback.
The module will be provisional in Python 3.9 and we will make a decision
before the 3.10 release whether to keep it provisional, graduate it, or
remove it.  This PEP will be updated accordingly.</p>
<p>While the module is provisional, any changes to the API (or to behavior)
do not need to be reflected here, nor get approval by the BDFL-delegate.
However, such changes will still need to go through the normal processes
(BPO for smaller changes and python-dev/PEP for substantial ones).</p>
</section>
<section id="alternate-python-implementations">
<h2><a class="toc-backref" href="#id44">Alternate Python Implementations</a><a class="headerlink" href="#alternate-python-implementations" title="Permalink to this headline">¶</a></h2>
<p>I’ve solicited feedback from various Python implementors about support
for subinterpreters.  Each has indicated that they would be able to
support subinterpreters (if they choose to) without a lot of
trouble.  Here are the projects I contacted:</p>
<ul class="simple">
<li><p>jython  (<a class="reference internal" href="#jython" id="id12"><span>[jython]</span></a>)</p></li>
<li><p>ironpython  (personal correspondence)</p></li>
<li><p>pypy  (personal correspondence)</p></li>
<li><p>micropython  (personal correspondence)</p></li>
</ul>
</section>
<section id="interpreters-module-api">
<span id="interpreters-interpreter"></span><span id="interpreters-create"></span><span id="interpreters-get-current"></span><span id="interpreters-list-all"></span><h2><a class="toc-backref" href="#id45">“interpreters” Module API</a><a class="headerlink" href="#interpreters-module-api" title="Permalink to this headline">¶</a></h2>
<p>The module provides the following functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>list_all() -&gt; [Interpreter]

   Return a list of all existing interpreters.

get_current() =&gt; Interpreter

   Return the currently running interpreter.

get_main() =&gt; Interpreter

   Return the main interpreter.  If the Python implementation
   has no concept of a main interpreter then return None.

create(*, isolated=True) -&gt; Interpreter

   Initialize a new Python interpreter and return it.  The
   interpreter will be created in the current thread and will remain
   idle until something is run in it.  The interpreter may be used
   in any thread and will run in whichever thread calls
   ``interp.run()``.  See &quot;Interpreter Isolated Mode&quot; below for
   an explanation of the &quot;isolated&quot; parameter.
</pre></div>
</div>
<p>The module also provides the following class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class Interpreter(id):

   id -&gt; int:

      The interpreter&#39;s ID. (read-only)

   isolated -&gt; bool:

      Whether or not the interpreter is operating in &quot;isolated&quot; mode.
      (read-only)

   is_running() -&gt; bool:

      Return whether or not the interpreter is currently executing
      code.  Calling this on the current interpreter will always
      return True.

   close():

      Finalize and destroy the interpreter.

      This may not be called on an already running interpreter.
      Doing so results in a RuntimeError.

   run(source_str, /, *, channels=None):

      Run the provided Python source code in the interpreter.  If
      the &quot;channels&quot; keyword argument is provided (and is a mapping
      of attribute names to channels) then it is added to the
      interpreter&#39;s execution namespace (the interpreter&#39;s
      &quot;__main__&quot; module).  If any of the values are not RecvChannel
      or SendChannel instances then ValueError gets raised.

      This may not be called on an already running interpreter.
      Doing so results in a RuntimeError.

      A &quot;run()&quot; call is similar to a function call.  Once it
      completes, the code that called &quot;run()&quot; continues executing
      (in the original interpreter).  Likewise, if there is any
      uncaught exception then it effectively (see below) propagates
      into the code where ``run()`` was called.  However, unlike
      function calls (but like threads), there is no return value.
      If any value is needed, pass it out via a channel.

      The big difference from functions is that &quot;run()&quot; executes
      the code in an entirely different interpreter, with entirely
      separate state.  The state of the current interpreter in the
      current OS thread is swapped out with the state of the target
      interpreter (the one that will execute the code).  When the
      target finishes executing, the original interpreter gets
      swapped back in and its execution resumes.

      So calling &quot;run()&quot; will effectively cause the current Python
      thread to pause.  Sometimes you won&#39;t want that pause, in
      which case you should make the &quot;run()&quot; call in another thread.
      To do so, add a function that calls &quot;run()&quot; and then run that
      function in a normal &quot;threading.Thread&quot;.

      Note that the interpreter&#39;s state is never reset, neither
      before &quot;run()&quot; executes the code nor after.  Thus the
      interpreter state is preserved between calls to &quot;run()&quot;.
      This includes &quot;sys.modules&quot;, the &quot;builtins&quot; module, and the
      internal state of C extension modules.

      Also note that &quot;run()&quot; executes in the namespace of the
      &quot;__main__&quot; module, just like scripts, the REPL, &quot;-m&quot;, and
      &quot;-c&quot;.  Just as the interpreter&#39;s state is not ever reset, the
      &quot;__main__&quot; module is never reset.  You can imagine
      concatenating the code from each &quot;run()&quot; call into one long
      script.  This is the same as how the REPL operates.

      Supported code: source text.
</pre></div>
</div>
<section id="uncaught-exceptions">
<h3><a class="toc-backref" href="#id46">Uncaught Exceptions</a><a class="headerlink" href="#uncaught-exceptions" title="Permalink to this headline">¶</a></h3>
<p>Regarding uncaught exceptions in <code class="docutils literal notranslate"><span class="pre">Interpreter.run()</span></code>, we noted that
they are “effectively” propagated into the code where <code class="docutils literal notranslate"><span class="pre">run()</span></code> was
called.  To prevent leaking exceptions (and tracebacks) between
interpreters, we create a surrogate of the exception and its traceback
(see <code class="docutils literal notranslate"><span class="pre">traceback.TracebackException</span></code>), set it to <code class="docutils literal notranslate"><span class="pre">__cause__</span></code> on a
new <code class="docutils literal notranslate"><span class="pre">RunFailedError</span></code>, and raise that.</p>
<p>Raising (a proxy of) the exception directly is problematic since it’s
harder to distinguish between an error in the <code class="docutils literal notranslate"><span class="pre">run()</span></code> call and an
uncaught exception from the subinterpreter.</p>
</section>
<section id="api-for-sharing-data">
<span id="interpreters-sendchannel"></span><span id="interpreters-recvchannel"></span><span id="interpreters-list-all-channels"></span><span id="interpreters-create-channel"></span><span id="interpreters-is-shareable"></span><h3><a class="toc-backref" href="#id47">API for sharing data</a><a class="headerlink" href="#api-for-sharing-data" title="Permalink to this headline">¶</a></h3>
<p>Subinterpreters are less useful without a mechanism for sharing data
between them.  Sharing actual Python objects between interpreters,
however, has enough potential problems that we are avoiding support
for that here.  Instead, only mimimum set of types will be supported.
Initially this will include <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>,
and channels.  Further types may be supported later.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module provides a function that users may call
to determine whether an object is shareable or not:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">is_shareable</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

   <span class="n">Return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">the</span> <span class="nb">object</span> <span class="n">may</span> <span class="n">be</span> <span class="n">shared</span> <span class="n">between</span> <span class="n">interpreters</span><span class="o">.</span>
   <span class="n">This</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">necessarily</span> <span class="n">mean</span> <span class="n">that</span> <span class="n">the</span> <span class="n">actual</span> <span class="n">objects</span> <span class="n">will</span> <span class="n">be</span>
   <span class="n">shared</span><span class="o">.</span>  <span class="n">Insead</span><span class="p">,</span> <span class="n">it</span> <span class="n">means</span> <span class="n">that</span> <span class="n">the</span> <span class="n">objects</span><span class="s1">&#39; underlying data will</span>
   <span class="n">be</span> <span class="n">shared</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">cross</span><span class="o">-</span><span class="n">interpreter</span> <span class="n">way</span><span class="p">,</span> <span class="n">whether</span> <span class="n">via</span> <span class="n">a</span> <span class="n">proxy</span><span class="p">,</span> <span class="n">a</span>
   <span class="n">copy</span><span class="p">,</span> <span class="ow">or</span> <span class="n">some</span> <span class="n">other</span> <span class="n">means</span><span class="o">.</span>
</pre></div>
</div>
<p>This proposal provides two ways to share such objects between
interpreters.</p>
<p>First, channels may be passed to <code class="docutils literal notranslate"><span class="pre">run()</span></code> via the <code class="docutils literal notranslate"><span class="pre">channels</span></code>
keyword argument, where they are effectively injected into the target
interpreter’s <code class="docutils literal notranslate"><span class="pre">__main__</span></code> module.  While passing arbitrary shareable
objects this way is possible, doing so is mainly intended for sharing
meta-objects (e.g. channels) between interpreters.  It is less useful
to pass other objects (like <code class="docutils literal notranslate"><span class="pre">bytes</span></code>) to <code class="docutils literal notranslate"><span class="pre">run</span></code> directly.</p>
<p>Second, the main mechanism for sharing objects (i.e. their data) between
interpreters is through channels.  A channel is a simplex FIFO similar
to a pipe.  The main difference is that channels can be associated with
zero or more interpreters on either end.  Like queues, which are also
many-to-many, channels are buffered (though they also offer methods
with unbuffered semantics).</p>
<p>Python objects are not shared between interpreters.  However, in some
cases data those objects wrap is actually shared and not just copied.
One example might be <a class="reference external" href="pep-3118.html">PEP 3118</a> buffers.  In those cases the object in the
original interpreter is kept alive until the shared data in the other
interpreter is no longer used.  Then object destruction can happen like
normal in the original interpreter, along with the previously shared
data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module provides the following functions related
to channels:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_channel</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">RecvChannel</span><span class="p">,</span> <span class="n">SendChannel</span><span class="p">):</span>

   <span class="n">Create</span> <span class="n">a</span> <span class="n">new</span> <span class="n">channel</span> <span class="ow">and</span> <span class="k">return</span> <span class="p">(</span><span class="n">recv</span><span class="p">,</span> <span class="n">send</span><span class="p">),</span> <span class="n">the</span> <span class="n">RecvChannel</span>
   <span class="ow">and</span> <span class="n">SendChannel</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="n">the</span> <span class="n">ends</span> <span class="n">of</span> <span class="n">the</span> <span class="n">channel</span><span class="o">.</span>

   <span class="n">Both</span> <span class="n">ends</span> <span class="n">of</span> <span class="n">the</span> <span class="n">channel</span> <span class="n">are</span> <span class="n">supported</span> <span class="s2">&quot;shared&quot;</span> <span class="n">objects</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span>
   <span class="n">may</span> <span class="n">be</span> <span class="n">safely</span> <span class="n">shared</span> <span class="n">by</span> <span class="n">different</span> <span class="n">interpreters</span><span class="o">.</span>  <span class="n">Thus</span> <span class="n">they</span>
   <span class="n">may</span> <span class="n">be</span> <span class="n">passed</span> <span class="k">as</span> <span class="n">keyword</span> <span class="n">arguments</span> <span class="n">to</span> <span class="s2">&quot;Interpreter.run()&quot;</span><span class="o">.</span>

<span class="n">list_all_channels</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[(</span><span class="n">RecvChannel</span><span class="p">,</span> <span class="n">SendChannel</span><span class="p">)]:</span>

   <span class="n">Return</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="nb">all</span> <span class="nb">open</span> <span class="n">channel</span><span class="o">-</span><span class="n">end</span> <span class="n">pairs</span><span class="o">.</span>
</pre></div>
</div>
<p>The module also provides the following channel-related classes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RecvChannel</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>

   <span class="n">The</span> <span class="n">receiving</span> <span class="n">end</span> <span class="n">of</span> <span class="n">a</span> <span class="n">channel</span><span class="o">.</span>  <span class="n">An</span> <span class="n">interpreter</span> <span class="n">may</span> <span class="n">use</span> <span class="n">this</span> <span class="n">to</span>
   <span class="n">receive</span> <span class="n">objects</span> <span class="kn">from</span> <span class="nn">another</span> <span class="n">interpreter</span><span class="o">.</span>  <span class="n">At</span> <span class="n">first</span> <span class="n">only</span> <span class="n">a</span> <span class="n">few</span>
   <span class="n">of</span> <span class="n">the</span> <span class="n">simple</span><span class="p">,</span> <span class="n">immutable</span> <span class="n">builtin</span> <span class="n">types</span> <span class="n">will</span> <span class="n">be</span> <span class="n">supported</span><span class="o">.</span>

   <span class="nb">id</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>

      <span class="n">The</span> <span class="n">channel</span><span class="s1">&#39;s unique ID.  This is shared with the &quot;send&quot; end.</span>

   <span class="n">recv</span><span class="p">():</span>

      <span class="n">Return</span> <span class="n">the</span> <span class="nb">next</span> <span class="nb">object</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">channel</span><span class="o">.</span>  <span class="n">If</span> <span class="n">none</span> <span class="n">have</span> <span class="n">been</span>
      <span class="n">sent</span> <span class="n">then</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">send</span><span class="o">.</span>

      <span class="n">At</span> <span class="n">the</span> <span class="n">least</span><span class="p">,</span> <span class="n">the</span> <span class="nb">object</span> <span class="n">will</span> <span class="n">be</span> <span class="n">equivalent</span> <span class="n">to</span> <span class="n">the</span> <span class="n">sent</span> <span class="nb">object</span><span class="o">.</span>
      <span class="n">That</span> <span class="n">will</span> <span class="n">almost</span> <span class="n">always</span> <span class="n">mean</span> <span class="n">the</span> <span class="n">same</span> <span class="nb">type</span> <span class="k">with</span> <span class="n">the</span> <span class="n">same</span> <span class="n">data</span><span class="p">,</span>
      <span class="n">though</span> <span class="n">it</span> <span class="n">could</span> <span class="n">also</span> <span class="n">be</span> <span class="n">a</span> <span class="n">compatible</span> <span class="n">proxy</span><span class="o">.</span>  <span class="n">Regardless</span><span class="p">,</span> <span class="n">it</span> <span class="n">may</span>
      <span class="n">use</span> <span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">that</span> <span class="n">data</span> <span class="ow">or</span> <span class="n">actually</span> <span class="n">share</span> <span class="n">the</span> <span class="n">data</span><span class="o">.</span>

   <span class="n">recv_nowait</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

      <span class="n">Return</span> <span class="n">the</span> <span class="nb">next</span> <span class="nb">object</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">channel</span><span class="o">.</span>  <span class="n">If</span> <span class="n">none</span> <span class="n">have</span> <span class="n">been</span>
      <span class="n">sent</span> <span class="n">then</span> <span class="k">return</span> <span class="n">the</span> <span class="n">default</span><span class="o">.</span>  <span class="n">Otherwise</span><span class="p">,</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">same</span>
      <span class="k">as</span> <span class="n">the</span> <span class="s2">&quot;recv()&quot;</span> <span class="n">method</span><span class="o">.</span>


<span class="k">class</span> <span class="nc">SendChannel</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>

   <span class="n">The</span> <span class="n">sending</span> <span class="n">end</span> <span class="n">of</span> <span class="n">a</span> <span class="n">channel</span><span class="o">.</span>  <span class="n">An</span> <span class="n">interpreter</span> <span class="n">may</span> <span class="n">use</span> <span class="n">this</span> <span class="n">to</span>
   <span class="n">send</span> <span class="n">objects</span> <span class="n">to</span> <span class="n">another</span> <span class="n">interpreter</span><span class="o">.</span>  <span class="n">At</span> <span class="n">first</span> <span class="n">only</span> <span class="n">a</span> <span class="n">few</span> <span class="n">of</span>
   <span class="n">the</span> <span class="n">simple</span><span class="p">,</span> <span class="n">immutable</span> <span class="n">builtin</span> <span class="n">types</span> <span class="n">will</span> <span class="n">be</span> <span class="n">supported</span><span class="o">.</span>

   <span class="nb">id</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>

      <span class="n">The</span> <span class="n">channel</span><span class="s1">&#39;s unique ID.  This is shared with the &quot;recv&quot; end.</span>

   <span class="n">send</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>

      <span class="n">Send</span> <span class="n">the</span> <span class="nb">object</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span> <span class="n">its</span> <span class="n">data</span><span class="p">)</span> <span class="n">to</span> <span class="n">the</span> <span class="s2">&quot;recv&quot;</span> <span class="n">end</span> <span class="n">of</span> <span class="n">the</span>
      <span class="n">channel</span><span class="o">.</span>  <span class="n">Wait</span> <span class="n">until</span> <span class="n">the</span> <span class="nb">object</span> <span class="ow">is</span> <span class="n">received</span><span class="o">.</span>  <span class="n">If</span> <span class="n">the</span> <span class="nb">object</span>
      <span class="ow">is</span> <span class="ow">not</span> <span class="n">shareable</span> <span class="n">then</span> <span class="ne">ValueError</span> <span class="ow">is</span> <span class="n">raised</span><span class="o">.</span>

   <span class="n">send_nowait</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>

      <span class="n">Send</span> <span class="n">the</span> <span class="nb">object</span> <span class="n">to</span> <span class="n">the</span> <span class="s2">&quot;recv&quot;</span> <span class="n">end</span> <span class="n">of</span> <span class="n">the</span> <span class="n">channel</span><span class="o">.</span>  <span class="n">This</span>
      <span class="n">behaves</span> <span class="n">the</span> <span class="n">same</span> <span class="k">as</span> <span class="s2">&quot;send()&quot;</span><span class="p">,</span> <span class="k">except</span> <span class="k">for</span> <span class="n">the</span> <span class="n">waiting</span> <span class="n">part</span><span class="o">.</span>
      <span class="n">If</span> <span class="n">no</span> <span class="n">interpreter</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">receiving</span> <span class="p">(</span><span class="n">waiting</span> <span class="n">on</span> <span class="n">the</span>
      <span class="n">other</span> <span class="n">end</span><span class="p">)</span> <span class="n">then</span> <span class="n">queue</span> <span class="n">the</span> <span class="nb">object</span> <span class="ow">and</span> <span class="k">return</span> <span class="kc">False</span><span class="o">.</span>  <span class="n">Otherwise</span>
      <span class="k">return</span> <span class="kc">True</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="channel-lifespan">
<h3><a class="toc-backref" href="#id48">Channel Lifespan</a><a class="headerlink" href="#channel-lifespan" title="Permalink to this headline">¶</a></h3>
<p>A channel is automatically closed and destoyed once there are no more
Python objects (e.g. <code class="docutils literal notranslate"><span class="pre">RecvChannel</span></code> and <code class="docutils literal notranslate"><span class="pre">SendChannel</span></code>) referring
to it.  So it is effectively triggered via garbage-collection of those
objects..</p>
</section>
</section>
<section id="interpreter-isolated-mode">
<span id="isolated-mode"></span><h2><a class="toc-backref" href="#id49">Interpreter “Isolated” Mode</a><a class="headerlink" href="#interpreter-isolated-mode" title="Permalink to this headline">¶</a></h2>
<p>By default, every new interpreter created by <code class="docutils literal notranslate"><span class="pre">interpreters.create()</span></code>
has specific restrictions on any code it runs.  This includes the
following:</p>
<ul class="simple">
<li><p>importing an extension module fails if it does not implement the
<a class="reference external" href="pep-0489.html">PEP 489</a> API</p></li>
<li><p>new threads are not allowed (including daemon threads)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">os.fork()</span></code> is not allowed (so no <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">os.exec*()</span></code>, AKA “fork+exec”, is not allowed (so no <code class="docutils literal notranslate"><span class="pre">subprocess</span></code>)</p></li>
</ul>
<p>This represents the full “isolated” mode of subinterpreters.  It is
applied when <code class="docutils literal notranslate"><span class="pre">interpreters.create()</span></code> is called with the “isolated”
keyword-only argument set to <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default).  If
<code class="docutils literal notranslate"><span class="pre">interpreters.create(isolated=False)</span></code> is called then none of those
restrictions is applied.</p>
<p>One advantage of this approach is that it allows extension maintainers
to check subinterpreter compatibility before they implement the <a class="reference external" href="pep-0489.html">PEP 489</a>
API.  Also note that <code class="docutils literal notranslate"><span class="pre">isolated=False</span></code> represents the historical
behavior when using the existing subinterpreters C-API, thus providing
backward compatibility.  For the existing C-API itself, the default
remains <code class="docutils literal notranslate"><span class="pre">isolated=False</span></code>.  The same is true for the “main” module, so
existing use of Python will not change.</p>
<p>We may choose to later loosen some of the above restrictions or provide
a way to enable/disable granular restrictions individually.  Regardless,
requiring <a class="reference external" href="pep-0489.html">PEP 489</a> support from extension modules will always be a
default restriction.</p>
</section>
<section id="documentation">
<h2><a class="toc-backref" href="#id50">Documentation</a><a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>The new stdlib docs page for the <code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module will include
the following:</p>
<ul class="simple">
<li><p>(at the top) a clear note that subinterpreter support in extension
modules is not required</p></li>
<li><p>some explanation about what subinterpreters are</p></li>
<li><p>brief examples of how to use subinterpreters and channels</p></li>
<li><p>a summary of the limitations of subinterpreters</p></li>
<li><p>(for extension maintainers) a link to the resources for ensuring
subinterpreter compatibility</p></li>
<li><p>much of the API information in this PEP</p></li>
</ul>
<p>A separate page will be added to the docs for resources to help
extension maintainers ensure their modules can be used safely in
subinterpreters, under <a class="reference external" href="extension-docs">Extending Python</a>.  The page
will include the following information:</p>
<ul class="simple">
<li><p>a summary about subinterpreters (similar to the same in the new
<code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module page and in the C-API docs)</p></li>
<li><p>an explanation of how extension modules can be impacted</p></li>
<li><p>how to implement <a class="reference external" href="pep-0489.html">PEP 489</a> support</p></li>
<li><p>how to move from global module state to per-interpreter</p></li>
<li><p>how to take advantage of <a class="reference external" href="pep-0384.html">PEP 384</a> (heap types), <a class="reference external" href="pep-3121.html">PEP 3121</a>
(module state), and <a class="reference external" href="pep-0573.html">PEP 573</a></p></li>
<li><p>strategies for dealing with 3rd party C libraries that keep their
own subinterpreter-incompatible global state</p></li>
</ul>
<p>Note that the documentation will play a large part in mitigating any
negative impact that the new <code class="docutils literal notranslate"><span class="pre">interpreters</span></code> module might have on
extension module maintainers.</p>
<p>Also, the <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> for incompatible extgension modules will have
a message that clearly says it is due to missing subinterpreter
compatibility and that extensions are not required to provide it.  This
will help set user expectations properly.</p>
</section>
<section id="deferred-functionality">
<h2><a class="toc-backref" href="#id51">Deferred Functionality</a><a class="headerlink" href="#deferred-functionality" title="Permalink to this headline">¶</a></h2>
<p>In the interest of keeping this proposal minimal, the following
functionality has been left out for future consideration.  Note that
this is not a judgement against any of said capability, but rather a
deferment.  That said, each is arguably valid.</p>
<section id="interpreter-call">
<h3><a class="toc-backref" href="#id52">Interpreter.call()</a><a class="headerlink" href="#interpreter-call" title="Permalink to this headline">¶</a></h3>
<p>It would be convenient to run existing functions in subinterpreters
directly.  <code class="docutils literal notranslate"><span class="pre">Interpreter.run()</span></code> could be adjusted to support this or
a <code class="docutils literal notranslate"><span class="pre">call()</span></code> method could be added:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Interpreter</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>This suffers from the same problem as sharing objects between
interpreters via queues.  The minimal solution (running a source string)
is sufficient for us to get the feature out where it can be explored.</p>
</section>
<section id="timeout-arg-to-recv-and-send">
<h3><a class="toc-backref" href="#id53">timeout arg to recv() and send()</a><a class="headerlink" href="#timeout-arg-to-recv-and-send" title="Permalink to this headline">¶</a></h3>
<p>Typically functions that have a <code class="docutils literal notranslate"><span class="pre">block</span></code> argument also have a
<code class="docutils literal notranslate"><span class="pre">timeout</span></code> argument.  It sometimes makes sense to do likewise for
functions that otherwise block, like the channel <code class="docutils literal notranslate"><span class="pre">recv()</span></code> and
<code class="docutils literal notranslate"><span class="pre">send()</span></code> methods.  We can add it later if needed.</p>
</section>
<section id="interpreter-run-in-thread">
<h3><a class="toc-backref" href="#id54">Interpreter.run_in_thread()</a><a class="headerlink" href="#interpreter-run-in-thread" title="Permalink to this headline">¶</a></h3>
<p>This method would make a <code class="docutils literal notranslate"><span class="pre">run()</span></code> call for you in a thread.  Doing this
using only <code class="docutils literal notranslate"><span class="pre">threading.Thread</span></code> and <code class="docutils literal notranslate"><span class="pre">run()</span></code> is relatively trivial so
we’ve left it out.</p>
</section>
<section id="synchronization-primitives">
<h3><a class="toc-backref" href="#id55">Synchronization Primitives</a><a class="headerlink" href="#synchronization-primitives" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">threading</span></code> module provides a number of synchronization primitives
for coordinating concurrent operations.  This is especially necessary
due to the shared-state nature of threading.  In contrast,
subinterpreters do not share state.  Data sharing is restricted to
channels, which do away with the need for explicit synchronization.  If
any sort of opt-in shared state support is added to subinterpreters in
the future, that same effort can introduce synchronization primitives
to meet that need.</p>
</section>
<section id="csp-library">
<h3><a class="toc-backref" href="#id56">CSP Library</a><a class="headerlink" href="#csp-library" title="Permalink to this headline">¶</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">csp</span></code> module would not be a large step away from the functionality
provided by this PEP.  However, adding such a module is outside the
minimalist goals of this proposal.</p>
</section>
<section id="syntactic-support">
<h3><a class="toc-backref" href="#id57">Syntactic Support</a><a class="headerlink" href="#syntactic-support" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Go</span></code> language provides a concurrency model based on CSP, so
it’s similar to the concurrency model that subinterpreters support.
However, <code class="docutils literal notranslate"><span class="pre">Go</span></code> also provides syntactic support, as well several builtin
concurrency primitives, to make concurrency a first-class feature.
Conceivably, similar syntactic (and builtin) support could be added to
Python using subinterpreters.  However, that is <em>way</em> outside the scope
of this PEP!</p>
</section>
<section id="multiprocessing">
<h3><a class="toc-backref" href="#id58">Multiprocessing</a><a class="headerlink" href="#multiprocessing" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> module could support subinterpreters in the same
way it supports threads and processes.  In fact, the module’s
maintainer, Davin Potts, has indicated this is a reasonable feature
request.  However, it is outside the narrow scope of this PEP.</p>
</section>
<section id="c-extension-opt-in-opt-out">
<h3><a class="toc-backref" href="#id59">C-extension opt-in/opt-out</a><a class="headerlink" href="#c-extension-opt-in-opt-out" title="Permalink to this headline">¶</a></h3>
<p>By using the <code class="docutils literal notranslate"><span class="pre">PyModuleDef_Slot</span></code> introduced by <a class="reference external" href="pep-0489.html">PEP 489</a>, we could easily
add a mechanism by which C-extension modules could opt out of support
for subinterpreters.  Then the import machinery, when operating in
a subinterpreter, would need to check the module for support.  It would
raise an ImportError if unsupported.</p>
<p>Alternately we could support opting in to subinterpreter support.
However, that would probably exclude many more modules (unnecessarily)
than the opt-out approach.  Also, note that <a class="reference external" href="pep-0489.html">PEP 489</a> defined that an
extension’s use of the PEP’s machinery implies support for
subinterpreters.</p>
<p>The scope of adding the ModuleDef slot and fixing up the import
machinery is non-trivial, but could be worth it.  It all depends on
how many extension modules break under subinterpreters.  Given that
there are relatively few cases we know of through mod_wsgi, we can
leave this for later.</p>
</section>
<section id="poisoning-channels">
<h3><a class="toc-backref" href="#id60">Poisoning channels</a><a class="headerlink" href="#poisoning-channels" title="Permalink to this headline">¶</a></h3>
<p>CSP has the concept of poisoning a channel.  Once a channel has been
poisoned, any <code class="docutils literal notranslate"><span class="pre">send()</span></code> or <code class="docutils literal notranslate"><span class="pre">recv()</span></code> call on it would raise a special
exception, effectively ending execution in the interpreter that tried
to use the poisoned channel.</p>
<p>This could be accomplished by adding a <code class="docutils literal notranslate"><span class="pre">poison()</span></code> method to both ends
of the channel.  The <code class="docutils literal notranslate"><span class="pre">close()</span></code> method can be used in this way
(mostly), but these semantics are relatively specialized and can wait.</p>
</section>
<section id="resetting-main">
<h3><a class="toc-backref" href="#id61">Resetting __main__</a><a class="headerlink" href="#resetting-main" title="Permalink to this headline">¶</a></h3>
<p>As proposed, every call to <code class="docutils literal notranslate"><span class="pre">Interpreter.run()</span></code> will execute in the
namespace of the interpreter’s existing <code class="docutils literal notranslate"><span class="pre">__main__</span></code> module.  This means
that data persists there between <code class="docutils literal notranslate"><span class="pre">run()</span></code> calls.  Sometimes this isn’t
desirable and you want to execute in a fresh <code class="docutils literal notranslate"><span class="pre">__main__</span></code>.  Also,
you don’t necessarily want to leak objects there that you aren’t using
any more.</p>
<p>Note that the following won’t work right because it will clear too much
(e.g. <code class="docutils literal notranslate"><span class="pre">__name__</span></code> and the other “__dunder__” attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;globals().clear()&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Possible solutions include:</p>
<ul class="simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">create()</span></code> arg to indicate resetting <code class="docutils literal notranslate"><span class="pre">__main__</span></code> after each
<code class="docutils literal notranslate"><span class="pre">run</span></code> call</p></li>
<li><p>an <code class="docutils literal notranslate"><span class="pre">Interpreter.reset_main</span></code> flag to support opting in or out
after the fact</p></li>
<li><p>an <code class="docutils literal notranslate"><span class="pre">Interpreter.reset_main()</span></code> method to opt in when desired</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">importlib.util.reset_globals()</span></code> <a class="reference internal" href="#reset-globals" id="id13"><span>[reset_globals]</span></a></p></li>
</ul>
<p>Also note that resetting <code class="docutils literal notranslate"><span class="pre">__main__</span></code> does nothing about state stored
in other modules.  So any solution would have to be clear about the
scope of what is being reset.  Conceivably we could invent a mechanism
by which any (or every) module could be reset, unlike <code class="docutils literal notranslate"><span class="pre">reload()</span></code>
which does not clear the module before loading into it.  Regardless,
since <code class="docutils literal notranslate"><span class="pre">__main__</span></code> is the execution namespace of the interpreter,
resetting it has a much more direct correlation to interpreters and
their dynamic state than does resetting other modules.  So a more
generic module reset mechanism may prove unnecessary.</p>
<p>This isn’t a critical feature initially.  It can wait until later
if desirable.</p>
</section>
<section id="resetting-an-interpreter-s-state">
<h3><a class="toc-backref" href="#id62">Resetting an interpreter’s state</a><a class="headerlink" href="#resetting-an-interpreter-s-state" title="Permalink to this headline">¶</a></h3>
<p>It may be nice to re-use an existing subinterpreter instead of
spinning up a new one.  Since an interpreter has substantially more
state than just the <code class="docutils literal notranslate"><span class="pre">__main__</span></code> module, it isn’t so easy to put an
interpreter back into a pristine/fresh state.  In fact, there <em>may</em>
be parts of the state that cannot be reset from Python code.</p>
<p>A possible solution is to add an <code class="docutils literal notranslate"><span class="pre">Interpreter.reset()</span></code> method.  This
would put the interpreter back into the state it was in when newly
created.  If called on a running interpreter it would fail (hence the
main interpreter could never be reset).  This would likely be more
efficient than creating a new subinterpreter, though that depends on
what optimizations will be made later to subinterpreter creation.</p>
<p>While this would potentially provide functionality that is not
otherwise available from Python code, it isn’t a fundamental
functionality.  So in the spirit of minimalism here, this can wait.
Regardless, I doubt it would be controversial to add it post-PEP.</p>
</section>
<section id="file-descriptors-and-sockets-in-channels">
<h3><a class="toc-backref" href="#id63">File descriptors and sockets in channels</a><a class="headerlink" href="#file-descriptors-and-sockets-in-channels" title="Permalink to this headline">¶</a></h3>
<p>Given that file descriptors and sockets are process-global resources,
support for passing them through channels is a reasonable idea.  They
would be a good candidate for the first effort at expanding the types
that channels support.  They aren’t strictly necessary for the initial
API.</p>
</section>
<section id="integration-with-async">
<h3><a class="toc-backref" href="#id64">Integration with async</a><a class="headerlink" href="#integration-with-async" title="Permalink to this headline">¶</a></h3>
<p>Per Antoine Pitrou <a class="reference internal" href="#async" id="id14"><span>[async]</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Has any thought been given to how FIFOs could integrate with async
code driven by an event loop (e.g. asyncio)?  I think the model of
executing several asyncio (or Tornado) applications each in their
own subinterpreter may prove quite interesting to reconcile multi-
core concurrency with ease of programming.  That would require the
FIFOs to be able to synchronize on something an event loop can wait
on (probably a file descriptor?).
</pre></div>
</div>
<p>A possible solution is to provide async implementations of the blocking
channel methods (<code class="docutils literal notranslate"><span class="pre">recv()</span></code>, and <code class="docutils literal notranslate"><span class="pre">send()</span></code>).  However,
the basic functionality of subinterpreters does not depend on async and
can be added later.</p>
<p>Alternately, “readiness callbacks” could be used to simplify use in
async scenarios.  This would mean adding an optional <code class="docutils literal notranslate"><span class="pre">callback</span></code>
(kw-only) parameter to the <code class="docutils literal notranslate"><span class="pre">recv_nowait()</span></code> and <code class="docutils literal notranslate"><span class="pre">send_nowait()</span></code>
channel methods.  The callback would be called once the object was sent
or received (respectively).</p>
<p>(Note that making channels buffered makes readiness callbacks less
important.)</p>
</section>
<section id="support-for-iteration">
<h3><a class="toc-backref" href="#id65">Support for iteration</a><a class="headerlink" href="#support-for-iteration" title="Permalink to this headline">¶</a></h3>
<p>Supporting iteration on <code class="docutils literal notranslate"><span class="pre">RecvChannel</span></code> (via <code class="docutils literal notranslate"><span class="pre">__iter__()</span></code> or
<code class="docutils literal notranslate"><span class="pre">_next__()</span></code>) may be useful.  A trivial implementation would use the
<code class="docutils literal notranslate"><span class="pre">recv()</span></code> method, similar to how files do iteration.  Since this isn’t
a fundamental capability and has a simple analog, adding iteration
support can wait until later.</p>
</section>
<section id="channel-context-managers">
<h3><a class="toc-backref" href="#id66">Channel context managers</a><a class="headerlink" href="#channel-context-managers" title="Permalink to this headline">¶</a></h3>
<p>Context manager support on <code class="docutils literal notranslate"><span class="pre">RecvChannel</span></code> and <code class="docutils literal notranslate"><span class="pre">SendChannel</span></code> may be
helpful.  The implementation would be simple, wrapping a call to
<code class="docutils literal notranslate"><span class="pre">close()</span></code> (or maybe <code class="docutils literal notranslate"><span class="pre">release()</span></code>) like files do.  As with iteration,
this can wait.</p>
</section>
<section id="pipes-and-queues">
<h3><a class="toc-backref" href="#id67">Pipes and Queues</a><a class="headerlink" href="#pipes-and-queues" title="Permalink to this headline">¶</a></h3>
<p>With the proposed object passing machanism of “channels”, other similar
basic types aren’t required to achieve the minimal useful functionality
of subinterpreters.  Such types include pipes (like unbuffered channels,
but one-to-one) and queues (like channels, but more generic).  See below
in <a class="reference internal" href="#rejected-ideas">Rejected Ideas</a> for more information.</p>
<p>Even though these types aren’t part of this proposal, they may still
be useful in the context of concurrency.  Adding them later is entirely
reasonable.  The could be trivially implemented as wrappers around
channels.  Alternatively they could be implemented for efficiency at the
same low level as channels.</p>
</section>
<section id="return-a-lock-from-send">
<h3><a class="toc-backref" href="#id68">Return a lock from send()</a><a class="headerlink" href="#return-a-lock-from-send" title="Permalink to this headline">¶</a></h3>
<p>When sending an object through a channel, you don’t have a way of knowing
when the object gets received on the other end.  One way to work around
this is to return a locked <code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code> from <code class="docutils literal notranslate"><span class="pre">SendChannel.send()</span></code>
that unlocks once the object is received.</p>
<p>Alternately, the proposed <code class="docutils literal notranslate"><span class="pre">SendChannel.send()</span></code> (blocking) and
<code class="docutils literal notranslate"><span class="pre">SendChannel.send_nowait()</span></code> provide an explicit distinction that is
less likely to confuse users.</p>
<p>Note that returning a lock would matter for buffered channels
(i.e. queues).  For unbuffered channels it is a non-issue.</p>
</section>
<section id="support-prioritization-in-channels">
<h3><a class="toc-backref" href="#id69">Support prioritization in channels</a><a class="headerlink" href="#support-prioritization-in-channels" title="Permalink to this headline">¶</a></h3>
<p>A simple example is <code class="docutils literal notranslate"><span class="pre">queue.PriorityQueue</span></code> in the stdlib.</p>
</section>
<section id="support-inheriting-settings-and-more">
<h3><a class="toc-backref" href="#id70">Support inheriting settings (and more?)</a><a class="headerlink" href="#support-inheriting-settings-and-more" title="Permalink to this headline">¶</a></h3>
<p>Folks might find it useful, when creating a new subinterpreter, to be
able to indicate that they would like some things “inherited” by the
new interpreter.  The mechanism could be a strict copy or it could be
copy-on-write.  The motivating example is with the warnings module
(e.g. copy the filters).</p>
<p>The feature isn’t critical, nor would it be widely useful, so it
can wait until there’s interest.  Notably, both suggested solutions
will require significant work, especially when it comes to complex
objects and most especially for mutable containers of mutable
complex objects.</p>
</section>
<section id="make-exceptions-shareable">
<h3><a class="toc-backref" href="#id71">Make exceptions shareable</a><a class="headerlink" href="#make-exceptions-shareable" title="Permalink to this headline">¶</a></h3>
<p>Exceptions are propagated out of <code class="docutils literal notranslate"><span class="pre">run()</span></code> calls, so it isn’t a big
leap to make them shareable in channels.  However, as noted elsewhere,
it isn’t essential or (particularly common) so we can wait on doing
that.</p>
</section>
<section id="make-runfailederror-cause-lazy">
<h3><a class="toc-backref" href="#id72">Make RunFailedError.__cause__ lazy</a><a class="headerlink" href="#make-runfailederror-cause-lazy" title="Permalink to this headline">¶</a></h3>
<p>An uncaught exception in a subinterpreter (from <code class="docutils literal notranslate"><span class="pre">run()</span></code>) is copied
to the calling interpreter and set as <code class="docutils literal notranslate"><span class="pre">__cause__</span></code> on a
<code class="docutils literal notranslate"><span class="pre">RunFailedError</span></code> which is then raised.  That copying part involves
some sort of deserialization in the calling interpreter, which can be
expensive (e.g. due to imports) yet is not always necessary.</p>
<p>So it may be useful to use an <code class="docutils literal notranslate"><span class="pre">ExceptionProxy</span></code> type to wrap the
serialized exception and only deserialize it when needed.  That could
be via <code class="docutils literal notranslate"><span class="pre">ExceptionProxy__getattribute__()</span></code> or perhaps through
<code class="docutils literal notranslate"><span class="pre">RunFailedError.resolve()</span></code> (which would raise the deserialized
exception and set <code class="docutils literal notranslate"><span class="pre">RunFailedError.__cause__</span></code> to the exception.</p>
<p>It may also make sense to have <code class="docutils literal notranslate"><span class="pre">RunFailedError.__cause__</span></code> be a
descriptor that does the lazy deserialization (and set <code class="docutils literal notranslate"><span class="pre">__cause__</span></code>)
on the <code class="docutils literal notranslate"><span class="pre">RunFailedError</span></code> instance.</p>
</section>
<section id="serialize-everything-through-channels">
<h3><a class="toc-backref" href="#id73">Serialize everything through channels</a><a class="headerlink" href="#serialize-everything-through-channels" title="Permalink to this headline">¶</a></h3>
<p>We could use pickle (or marshal) to serialize everything sent through
channels.  Doing this is potentially inefficient, but it may be a
matter of convenience in the end.  We can add it later, but trying to
remove it later would be significantly more painful.</p>
</section>
<section id="return-a-value-from-run">
<h3><a class="toc-backref" href="#id74">Return a value from <code class="docutils literal notranslate"><span class="pre">run()</span></code></a><a class="headerlink" href="#return-a-value-from-run" title="Permalink to this headline">¶</a></h3>
<p>Currently <code class="docutils literal notranslate"><span class="pre">run()</span></code> always returns None.  One idea is to return the
return value from whatever the subinterpreter ran.  However, for now
it doesn’t make sense.  The only thing folks can run is a string of
code (i.e. a script).  This is equivalent to <code class="docutils literal notranslate"><span class="pre">PyRun_StringFlags()</span></code>,
<code class="docutils literal notranslate"><span class="pre">exec()</span></code>, or a module body.  None of those “return” anything.  We can
revisit this once <code class="docutils literal notranslate"><span class="pre">run()</span></code> supports functions, etc.</p>
</section>
<section id="add-a-tp-share-type-slot">
<h3><a class="toc-backref" href="#id75">Add a “tp_share” type slot</a><a class="headerlink" href="#add-a-tp-share-type-slot" title="Permalink to this headline">¶</a></h3>
<p>This would replace the current global registry for shareable types.</p>
</section>
<section id="expose-which-interpreters-have-actually-used-a-channel-end">
<h3><a class="toc-backref" href="#id76">Expose which interpreters have actually <em>used</em> a channel end.</a><a class="headerlink" href="#expose-which-interpreters-have-actually-used-a-channel-end" title="Permalink to this headline">¶</a></h3>
<p>Currently we associate interpreters upon access to a channel.  We would
keep a separate association list for “upon use” and expose that.</p>
</section>
<section id="add-a-shareable-synchronization-primitive">
<h3><a class="toc-backref" href="#id77">Add a shareable synchronization primitive</a><a class="headerlink" href="#add-a-shareable-synchronization-primitive" title="Permalink to this headline">¶</a></h3>
<p>This would be <code class="docutils literal notranslate"><span class="pre">_threading.Lock</span></code> (or something like it) where
interpreters would actually share the underlying mutex.  This would
provide much better efficiency than blocking channel ops.  The main
concern is that locks and channels don’t mix well (as learned in Go).</p>
<p>Note that the same functionality as a lock can be achieved by passing
some sort of “token” object through a channel.  “send()” would be
equivalent to releasing the lock and “recv()” to acquiring the lock.</p>
<p>We can add this later if it proves desirable without much trouble.</p>
</section>
<section id="propagate-systemexit-and-keyboardinterrupt-differently">
<h3><a class="toc-backref" href="#id78">Propagate SystemExit and KeyboardInterrupt Differently</a><a class="headerlink" href="#propagate-systemexit-and-keyboardinterrupt-differently" title="Permalink to this headline">¶</a></h3>
<p>The exception types that inherit from <code class="docutils literal notranslate"><span class="pre">BaseException</span></code> (aside from
<code class="docutils literal notranslate"><span class="pre">Exception</span></code>) are usually treated specially.  These types are:
<code class="docutils literal notranslate"><span class="pre">KeyboardInterrupt</span></code>, <code class="docutils literal notranslate"><span class="pre">SystemExit</span></code>, and <code class="docutils literal notranslate"><span class="pre">GeneratorExit</span></code>.  It may
make sense to treat them specially when it comes to propagation from
<code class="docutils literal notranslate"><span class="pre">run()</span></code>.  Here are some options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">propagate</span> <span class="n">like</span> <span class="n">normal</span> <span class="n">via</span> <span class="n">RunFailedError</span>
<span class="o">*</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">propagate</span> <span class="p">(</span><span class="n">handle</span> <span class="n">them</span> <span class="n">somehow</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">subinterpreter</span><span class="p">)</span>
<span class="o">*</span> <span class="n">propagate</span> <span class="n">them</span> <span class="n">directly</span> <span class="p">(</span><span class="n">avoid</span> <span class="n">RunFailedError</span><span class="p">)</span>
<span class="o">*</span> <span class="n">propagate</span> <span class="n">them</span> <span class="n">directly</span> <span class="p">(</span><span class="nb">set</span> <span class="n">RunFailedError</span> <span class="k">as</span> <span class="n">__cause__</span><span class="p">)</span>
</pre></div>
</div>
<p>We aren’t going to worry about handling them differently.  Threads
already ignore <code class="docutils literal notranslate"><span class="pre">SystemExit</span></code>, so for now we will follow that pattern.</p>
</section>
<section id="add-an-explicit-release-and-close-to-channel-end-classes">
<h3><a class="toc-backref" href="#id79">Add an explicit release() and close() to channel end classes</a><a class="headerlink" href="#add-an-explicit-release-and-close-to-channel-end-classes" title="Permalink to this headline">¶</a></h3>
<p>It can be convenient to have an explicit way to close a channel against
further global use.  Likewise it could be useful to have an explicit
way to release one of the channel ends relative to the current
interpreter.  Among other reasons, such a mechanism is useful for
communicating overall state between interpreters without the extra
boilerplate that passing objects through a channel directly would
require.</p>
<p>The challenge is getting automatic release/close right without making
it hard to understand.  This is especially true when dealing with a
non-empty channel.  We should be able to get by without release/close
for now.</p>
</section>
<section id="add-sendchannel-send-buffer">
<h3><a class="toc-backref" href="#id80">Add SendChannel.send_buffer()</a><a class="headerlink" href="#add-sendchannel-send-buffer" title="Permalink to this headline">¶</a></h3>
<p>This method would allow no-copy sending of an object through a channel
if it supports the <a class="reference external" href="pep-3118.html">PEP 3118</a> buffer protocol (e.g. memoryview).</p>
<p>Support for this is not fundamental to channels and can be added on
later without much disruption.</p>
</section>
<section id="auto-run-in-a-thread">
<h3><a class="toc-backref" href="#id81">Auto-run in a thread</a><a class="headerlink" href="#auto-run-in-a-thread" title="Permalink to this headline">¶</a></h3>
<p>The PEP proposes a hard separation between subinterpreters and threads:
if you want to run in a thread you must create the thread yourself and
call <code class="docutils literal notranslate"><span class="pre">run()</span></code> in it.  However, it might be convenient if <code class="docutils literal notranslate"><span class="pre">run()</span></code>
could do that for you, meaning there would be less boilerplate.</p>
<p>Furthermore, we anticipate that users will want to run in a thread much
more often than not.  So it would make sense to make this the default
behavior.  We would add a kw-only param “threaded” (default <code class="docutils literal notranslate"><span class="pre">True</span></code>)
to <code class="docutils literal notranslate"><span class="pre">run()</span></code> to allow the run-in-the-current-thread operation.</p>
</section>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#id82">Rejected Ideas</a><a class="headerlink" href="#rejected-ideas" title="Permalink to this headline">¶</a></h2>
<section id="explicit-channel-association">
<h3><a class="toc-backref" href="#id83">Explicit channel association</a><a class="headerlink" href="#explicit-channel-association" title="Permalink to this headline">¶</a></h3>
<p>Interpreters are implicitly associated with channels upon <code class="docutils literal notranslate"><span class="pre">recv()</span></code> and
<code class="docutils literal notranslate"><span class="pre">send()</span></code> calls.  They are de-associated with <code class="docutils literal notranslate"><span class="pre">release()</span></code> calls.  The
alternative would be explicit methods.  It would be either
<code class="docutils literal notranslate"><span class="pre">add_channel()</span></code> and <code class="docutils literal notranslate"><span class="pre">remove_channel()</span></code> methods on <code class="docutils literal notranslate"><span class="pre">Interpreter</span></code>
objects or something similar on channel objects.</p>
<p>In practice, this level of management shouldn’t be necessary for users.
So adding more explicit support would only add clutter to the API.</p>
</section>
<section id="use-pipes-instead-of-channels">
<h3><a class="toc-backref" href="#id84">Use pipes instead of channels</a><a class="headerlink" href="#use-pipes-instead-of-channels" title="Permalink to this headline">¶</a></h3>
<p>A pipe would be a simplex FIFO between exactly two interpreters.  For
most use cases this would be sufficient.  It could potentially simplify
the implementation as well.  However, it isn’t a big step to supporting
a many-to-many simplex FIFO via channels.  Also, with pipes the API
ends up being slightly more complicated, requiring naming the pipes.</p>
</section>
<section id="use-queues-instead-of-channels">
<h3><a class="toc-backref" href="#id85">Use queues instead of channels</a><a class="headerlink" href="#use-queues-instead-of-channels" title="Permalink to this headline">¶</a></h3>
<p>Queues and buffered channels are almost the same thing.  The main
difference is that channels have a stronger relationship with context
(i.e. the associated interpreter).</p>
<p>The name “Channel” was used instead of “Queue” to avoid confusion with
the stdlib <code class="docutils literal notranslate"><span class="pre">queue.Queue</span></code>.</p>
</section>
<section id="enumerate">
<h3><a class="toc-backref" href="#id86">“enumerate”</a><a class="headerlink" href="#enumerate" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">list_all()</span></code> function provides the list of all interpreters.
In the threading module, which partly inspired the proposed API, the
function is called <code class="docutils literal notranslate"><span class="pre">enumerate()</span></code>.  The name is different here to
avoid confusing Python users that are not already familiar with the
threading API.  For them “enumerate” is rather unclear, whereas
“list_all” is clear.</p>
</section>
<section id="alternate-solutions-to-prevent-leaking-exceptions-across-interpreters">
<h3><a class="toc-backref" href="#id87">Alternate solutions to prevent leaking exceptions across interpreters</a><a class="headerlink" href="#alternate-solutions-to-prevent-leaking-exceptions-across-interpreters" title="Permalink to this headline">¶</a></h3>
<p>In function calls, uncaught exceptions propagate to the calling frame.
The same approach could be taken with <code class="docutils literal notranslate"><span class="pre">run()</span></code>.  However, this would
mean that exception objects would leak across the inter-interpreter
boundary.  Likewise, the frames in the traceback would potentially leak.</p>
<p>While that might not be a problem currently, it would be a problem once
interpreters get better isolation relative to memory management (which
is necessary to stop sharing the GIL between interpreters).  We’ve
resolved the semantics of how the exceptions propagate by raising a
<code class="docutils literal notranslate"><span class="pre">RunFailedError</span></code> instead, for which <code class="docutils literal notranslate"><span class="pre">__cause__</span></code> wraps a safe proxy
for the original exception and traceback.</p>
<p>Rejected possible solutions:</p>
<ul class="simple">
<li><p>reproduce the exception and traceback in the original interpreter
and raise that.</p></li>
<li><p>raise a subclass of RunFailedError that proxies the original
exception and traceback.</p></li>
<li><p>raise RuntimeError instead of RunFailedError</p></li>
<li><p>convert at the boundary (a la <code class="docutils literal notranslate"><span class="pre">subprocess.CalledProcessError</span></code>)
(requires a cross-interpreter representation)</p></li>
<li><p>support customization via <code class="docutils literal notranslate"><span class="pre">Interpreter.excepthook</span></code>
(requires a cross-interpreter representation)</p></li>
<li><p>wrap in a proxy at the boundary (including with support for
something like <code class="docutils literal notranslate"><span class="pre">err.raise()</span></code> to propagate the traceback).</p></li>
<li><p>return the exception (or its proxy) from <code class="docutils literal notranslate"><span class="pre">run()</span></code> instead of
raising it</p></li>
<li><p>return a result object (like <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> does) <a class="reference internal" href="#result-object" id="id15"><span>[result-object]</span></a>
(unnecessary complexity?)</p></li>
<li><p>throw the exception away and expect users to deal with unhandled
exceptions explicitly in the script they pass to <code class="docutils literal notranslate"><span class="pre">run()</span></code>
(they can pass error info out via channels); with threads you have
to do something similar</p></li>
</ul>
</section>
<section id="always-associate-each-new-interpreter-with-its-own-thread">
<h3><a class="toc-backref" href="#id88">Always associate each new interpreter with its own thread</a><a class="headerlink" href="#always-associate-each-new-interpreter-with-its-own-thread" title="Permalink to this headline">¶</a></h3>
<p>As implemented in the C-API, a subinterpreter is not inherently tied to
any thread.  Furthermore, it will run in any existing thread, whether
created by Python or not.  You only have to activate one of its thread
states (<code class="docutils literal notranslate"><span class="pre">PyThreadState</span></code>) in the thread first.  This means that the
same thread may run more than one interpreter (though obviously
not at the same time).</p>
<p>The proposed module maintains this behavior.  Subinterpreters are not
tied to threads.  Only calls to <code class="docutils literal notranslate"><span class="pre">Interpreter.run()</span></code> are.  However,
one of the key objectives of this PEP is to provide a more human-
centric concurrency model.  With that in mind, from a conceptual
standpoint the module <em>might</em> be easier to understand if each
subinterpreter were associated with its own thread.</p>
<p>That would mean <code class="docutils literal notranslate"><span class="pre">interpreters.create()</span></code> would create a new thread
and <code class="docutils literal notranslate"><span class="pre">Interpreter.run()</span></code> would only execute in that thread (and
nothing else would).  The benefit is that users would not have to
wrap <code class="docutils literal notranslate"><span class="pre">Interpreter.run()</span></code> calls in a new <code class="docutils literal notranslate"><span class="pre">threading.Thread</span></code>.  Nor
would they be in a position to accidentally pause the current
interpreter (in the current thread) while their subinterpreter
executes.</p>
<p>The idea is rejected because the benefit is small and the cost is high.
The difference from the capability in the C-API would be potentially
confusing.  The implicit creation of threads is magical.  The early
creation of threads is potentially wasteful.  The inability to run
arbitrary interpreters in an existing thread would prevent some valid
use cases, frustrating users.  Tying interpreters to threads would
require extra runtime modifications.  It would also make the module’s
implementation overly complicated.  Finally, it might not even make
the module easier to understand.</p>
</section>
<section id="only-associate-interpreters-upon-use">
<h3><a class="toc-backref" href="#id89">Only associate interpreters upon use</a><a class="headerlink" href="#only-associate-interpreters-upon-use" title="Permalink to this headline">¶</a></h3>
<p>Associate interpreters with channel ends only once <code class="docutils literal notranslate"><span class="pre">recv()</span></code>,
<code class="docutils literal notranslate"><span class="pre">send()</span></code>, etc. are called.</p>
<p>Doing this is potentially confusing and also can lead to unexpected
races where a channel is auto-closed before it can be used in the
original (creating) interpreter.</p>
</section>
<section id="add-a-reraise-method-to-runfailederror">
<h3><a class="toc-backref" href="#id90">Add a “reraise” method to RunFailedError</a><a class="headerlink" href="#add-a-reraise-method-to-runfailederror" title="Permalink to this headline">¶</a></h3>
<p>While having <code class="docutils literal notranslate"><span class="pre">__cause__</span></code> set on <code class="docutils literal notranslate"><span class="pre">RunFailedError</span></code> helps produce a
more useful traceback, it’s less helpful when handling the original
error.  To help facilitate this, we could add
<code class="docutils literal notranslate"><span class="pre">RunFailedError.reraise()</span></code>.  This method would enable the following
pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">RunFailedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">exc</span><span class="o">.</span><span class="n">reraise</span><span class="p">()</span>
<span class="k">except</span> <span class="n">MyException</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This would be made even simpler if there existed a <code class="docutils literal notranslate"><span class="pre">__reraise__</span></code>
protocol.</p>
<p>All that said, this is completely unnecessary.  Using <code class="docutils literal notranslate"><span class="pre">__cause__</span></code>
is good enough:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">RunFailedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">__cause__</span>
<span class="k">except</span> <span class="n">MyException</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Note that in extreme cases it may require a little extra boilerplate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">interp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">RunFailedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">__cause__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">__cause__</span>
        <span class="k">raise</span>  <span class="c1"># re-raise</span>
<span class="k">except</span> <span class="n">MyException</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="implementation">
<h2><a class="toc-backref" href="#id91">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>The implementation of the PEP has 4 parts:</p>
<ul class="simple">
<li><p>the high-level module described in this PEP (mostly a light wrapper
around a low-level C extension</p></li>
<li><p>the low-level C extension module</p></li>
<li><p>additions to the (“private”) C=API needed by the low-level module</p></li>
<li><p>secondary fixes/changes in the CPython runtime that facilitate
the low-level module (among other benefits)</p></li>
</ul>
<p>These are at various levels of completion, with more done the lower
you go:</p>
<ul class="simple">
<li><p>the high-level module has been, at best, roughly implemented.
However, fully implementing it will be almost trivial.</p></li>
<li><p>the low-level module is mostly complete.  The bulk of the
implementation was merged into master in December 2018 as the
“_xxsubinterpreters” module (for the sake of testing subinterpreter
functionality).  Only 3 parts of the implementation remain:
“send_wait()”, “send_buffer()”, and exception propagation.  All three
have been mostly finished, but were blocked by work related to ceval.
That blocker is basically resolved now and finishing the low-level
will not require extensive work.</p></li>
<li><p>all necessary C-API work has been finished</p></li>
<li><p>all anticipated work in the runtime has been finished</p></li>
</ul>
<p>The implementation effort for <a class="reference external" href="pep-0554.html">PEP 554</a> is being tracked as part of
a larger project aimed at improving multi-core support in CPython.
<a class="reference internal" href="#multi-core-project" id="id16"><span>[multi-core-project]</span></a></p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id92">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="citation">
<dt class="label" id="c-api"><span class="brackets"><a class="fn-backref" href="#id1">c-api</a></span></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/c-api/init.html#sub-interpreter-support">https://docs.python.org/3/c-api/init.html#sub-interpreter-support</a></p>
</dd>
</dl>
<span class="target" id="communicating-sequential-processes"></span><dl class="citation">
<dt class="label" id="csp"><span class="brackets">CSP</span></dt>
<dd><p><a class="reference external" href="https://en.wikipedia.org/wiki/Communicating_sequential_processes">https://en.wikipedia.org/wiki/Communicating_sequential_processes</a>
<a class="reference external" href="https://github.com/futurecore/python-csp">https://github.com/futurecore/python-csp</a></p>
</dd>
<dt class="label" id="fifo"><span class="brackets"><a class="fn-backref" href="#id6">fifo</a></span></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Pipe">https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Pipe</a>
<a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Queue">https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Queue</a>
<a class="reference external" href="https://docs.python.org/3/library/queue.html#module-queue">https://docs.python.org/3/library/queue.html#module-queue</a>
<a class="reference external" href="http://stackless.readthedocs.io/en/2.7-slp/library/stackless/channels.html">http://stackless.readthedocs.io/en/2.7-slp/library/stackless/channels.html</a>
<a class="reference external" href="https://golang.org/doc/effective_go.html#sharing">https://golang.org/doc/effective_go.html#sharing</a>
<a class="reference external" href="http://www.jtolds.com/writing/2016/03/go-channels-are-bad-and-you-should-feel-bad/">http://www.jtolds.com/writing/2016/03/go-channels-are-bad-and-you-should-feel-bad/</a></p>
</dd>
<dt class="label" id="caveats"><span class="brackets"><a class="fn-backref" href="#id7">caveats</a></span></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/c-api/init.html#bugs-and-caveats">https://docs.python.org/3/c-api/init.html#bugs-and-caveats</a></p>
</dd>
<dt class="label" id="petr-c-ext"><span class="brackets"><a class="fn-backref" href="#id3">petr-c-ext</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/import-sig/2016-June/001062.html">https://mail.python.org/pipermail/import-sig/2016-June/001062.html</a>
<a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2016-April/039748.html">https://mail.python.org/pipermail/python-ideas/2016-April/039748.html</a></p>
</dd>
<dt class="label" id="cryptography"><span class="brackets"><a class="fn-backref" href="#id8">cryptography</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/pyca/cryptography/issues/2299">https://github.com/pyca/cryptography/issues/2299</a></p>
</dd>
<dt class="label" id="global-gc"><span class="brackets"><a class="fn-backref" href="#id9">global-gc</a></span></dt>
<dd><p><a class="reference external" href="http://bugs.python.org/issue24554">http://bugs.python.org/issue24554</a></p>
</dd>
<dt class="label" id="gilstate"><span class="brackets"><a class="fn-backref" href="#id11">gilstate</a></span></dt>
<dd><p><a class="reference external" href="https://bugs.python.org/issue10915">https://bugs.python.org/issue10915</a>
<a class="reference external" href="http://bugs.python.org/issue15751">http://bugs.python.org/issue15751</a></p>
</dd>
<dt class="label" id="global-atexit"><span class="brackets"><a class="fn-backref" href="#id10">global-atexit</a></span></dt>
<dd><p><a class="reference external" href="https://bugs.python.org/issue6531">https://bugs.python.org/issue6531</a></p>
</dd>
<dt class="label" id="mp-conn"><span class="brackets">mp-conn</span></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#connection-objects">https://docs.python.org/3/library/multiprocessing.html#connection-objects</a></p>
</dd>
<dt class="label" id="bug-rate"><span class="brackets"><a class="fn-backref" href="#id4">bug-rate</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-September/047094.html">https://mail.python.org/pipermail/python-ideas/2017-September/047094.html</a></p>
</dd>
<dt class="label" id="benefits"><span class="brackets"><a class="fn-backref" href="#id2">benefits</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-September/047122.html">https://mail.python.org/pipermail/python-ideas/2017-September/047122.html</a></p>
</dd>
<dt class="label" id="main-thread"><span class="brackets">main-thread</span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-September/047144.html">https://mail.python.org/pipermail/python-ideas/2017-September/047144.html</a>
<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-September/149566.html">https://mail.python.org/pipermail/python-dev/2017-September/149566.html</a></p>
</dd>
<dt class="label" id="reset-globals"><span class="brackets"><a class="fn-backref" href="#id13">reset_globals</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-September/149545.html">https://mail.python.org/pipermail/python-dev/2017-September/149545.html</a></p>
</dd>
<dt class="label" id="async"><span class="brackets"><a class="fn-backref" href="#id14">async</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-September/149420.html">https://mail.python.org/pipermail/python-dev/2017-September/149420.html</a>
<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-September/149585.html">https://mail.python.org/pipermail/python-dev/2017-September/149585.html</a></p>
</dd>
<dt class="label" id="result-object"><span class="brackets"><a class="fn-backref" href="#id15">result-object</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-September/149562.html">https://mail.python.org/pipermail/python-dev/2017-September/149562.html</a></p>
</dd>
<dt class="label" id="jython"><span class="brackets"><a class="fn-backref" href="#id12">jython</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-May/045771.html">https://mail.python.org/pipermail/python-ideas/2017-May/045771.html</a></p>
</dd>
<dt class="label" id="multi-core-project"><span class="brackets"><a class="fn-backref" href="#id16">multi-core-project</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/ericsnowcurrently/multi-core-python">https://github.com/ericsnowcurrently/multi-core-python</a></p>
</dd>
<dt class="label" id="cache-line-ping-pong"><span class="brackets"><a class="fn-backref" href="#id5">cache-line-ping-pong</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/archives/list/python-dev&#64;python.org/message/3HVRFWHDMWPNR367GXBILZ4JJAUQ2STZ/">https://mail.python.org/archives/list/python-dev&#64;python.org/message/3HVRFWHDMWPNR367GXBILZ4JJAUQ2STZ/</a></p>
</dd>
<dt class="label" id="nathaniel-asyncio"><span class="brackets">nathaniel-asyncio</span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/archives/list/python-dev&#64;python.org/message/TUEAZNZHVJGGLL4OFD32OW6JJDKM6FAS/">https://mail.python.org/archives/list/python-dev&#64;python.org/message/TUEAZNZHVJGGLL4OFD32OW6JJDKM6FAS/</a></p>
</dd>
<dt class="label" id="extension-docs"><span class="brackets">extension-docs</span></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/extending/index.html">https://docs.python.org/3/extending/index.html</a></p>
</dd>
</dl>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#id93">Copyright</a><a class="headerlink" href="#copyright" title="Permalink to this headline">¶</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<span>Source: <a class="reference external" href="https://github.com/python/peps/blob/master/pep-0554.rst">https://github.com/python/peps/blob/master/pep-0554.rst</a></span><div class="zero-height line"><br /></div>
<span>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/master/pep-0554.rst">2021-06-28T11:16:08Z</a></span>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../contents/">PEPs</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">PEP Table of Contents (needed for Sphinx):</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pep-0000/">PEP 0 – Index of Python Enhancement Proposals (PEPs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0001/">PEP 1 – PEP Purpose and Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0002/">PEP 2 – Procedure for Adding New Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0003/">PEP 3 – Guidelines for Handling Bug Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0004/">PEP 4 – Deprecation of Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0005/">PEP 5 – Guidelines for Language Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0006/">PEP 6 – Bug Fix Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0007/">PEP 7 – Style Guide for C Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0008/">PEP 8 – Style Guide for Python Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0009/">PEP 9 – Sample Plaintext PEP Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0010/">PEP 10 – Voting Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0011/">PEP 11 – Removing support for little used platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0012/">PEP 12 – Sample reStructuredText PEP Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0013/">PEP 13 – Python Language Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0020/">PEP 20 – The Zen of Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0042/">PEP 42 – Feature Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0100/">PEP 100 – Python Unicode Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0101/">PEP 101 – Doing Python Releases 101</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0102/">PEP 102 – Doing Python Micro Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0103/">PEP 103 – Collecting information about git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0160/">PEP 160 – Python 1.6 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0200/">PEP 200 – Python 2.0 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0201/">PEP 201 – Lockstep Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0202/">PEP 202 – List Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0203/">PEP 203 – Augmented Assignments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0204/">PEP 204 – Range Literals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0205/">PEP 205 – Weak References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0206/">PEP 206 – Python Advanced Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0207/">PEP 207 – Rich Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0208/">PEP 208 – Reworking the Coercion Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0209/">PEP 209 – Multi-dimensional Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0210/">PEP 210 – Decoupling the Interpreter Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0211/">PEP 211 – Adding A New Outer Product Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0212/">PEP 212 – Loop Counter Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0213/">PEP 213 – Attribute Access Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0214/">PEP 214 – Extended Print Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0215/">PEP 215 – String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0216/">PEP 216 – Docstring Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0217/">PEP 217 – Display Hook for Interactive Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0218/">PEP 218 – Adding a Built-In Set Object Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0219/">PEP 219 – Stackless Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0220/">PEP 220 – Coroutines, Generators, Continuations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0221/">PEP 221 – Import As</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0222/">PEP 222 – Web Library Enhancements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0223/">PEP 223 – Change the Meaning of ``\x`` Escapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0224/">PEP 224 – Attribute Docstrings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0225/">PEP 225 – Elementwise/Objectwise Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0226/">PEP 226 – Python 2.1 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0227/">PEP 227 – Statically Nested Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0228/">PEP 228 – Reworking Python’s Numeric Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0229/">PEP 229 – Using Distutils to Build Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0230/">PEP 230 – Warning Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0231/">PEP 231 – __findattr__()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0232/">PEP 232 – Function Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0233/">PEP 233 – Python Online Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0234/">PEP 234 – Iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0235/">PEP 235 – Import on Case-Insensitive Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0236/">PEP 236 – Back to the __future__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0237/">PEP 237 – Unifying Long Integers and Integers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0238/">PEP 238 – Changing the Division Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0239/">PEP 239 – Adding a Rational Type to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0240/">PEP 240 – Adding a Rational Literal to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0241/">PEP 241 – Metadata for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0242/">PEP 242 – Numeric Kinds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0243/">PEP 243 – Module Repository Upload Mechanism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0244/">PEP 244 – The ``directive`` statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0245/">PEP 245 – Python Interface Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0246/">PEP 246 – Object Adaptation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0247/">PEP 247 – API for Cryptographic Hash Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0248/">PEP 248 – Python Database API Specification v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0249/">PEP 249 – Python Database API Specification v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0250/">PEP 250 – Using site-packages on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0251/">PEP 251 – Python 2.2 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0252/">PEP 252 – Making Types Look More Like Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0253/">PEP 253 – Subtyping Built-in Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0254/">PEP 254 – Making Classes Look More Like Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0255/">PEP 255 – Simple Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0256/">PEP 256 – Docstring Processing System Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0257/">PEP 257 – Docstring Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0258/">PEP 258 – Docutils Design Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0259/">PEP 259 – Omit printing newline after newline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0260/">PEP 260 – Simplify xrange()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0261/">PEP 261 – Support for “wide” Unicode characters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0262/">PEP 262 – A Database of Installed Python Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0263/">PEP 263 – Defining Python Source Code Encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0264/">PEP 264 – Future statements in simulated shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0265/">PEP 265 – Sorting Dictionaries by Value</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0266/">PEP 266 – Optimizing Global Variable/Attribute Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0267/">PEP 267 – Optimized Access to Module Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0268/">PEP 268 – Extended HTTP functionality and WebDAV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0269/">PEP 269 – Pgen Module for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0270/">PEP 270 – uniq method for list objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0271/">PEP 271 – Prefixing sys.path by command line option</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0272/">PEP 272 – API for Block Encryption Algorithms v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0273/">PEP 273 – Import Modules from Zip Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0274/">PEP 274 – Dict Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0275/">PEP 275 – Switching on Multiple Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0276/">PEP 276 – Simple Iterator for ints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0277/">PEP 277 – Unicode file name support for Windows NT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0278/">PEP 278 – Universal Newline Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0279/">PEP 279 – The enumerate() built-in function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0280/">PEP 280 – Optimizing access to globals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0281/">PEP 281 – Loop Counter Iteration with range and xrange</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0282/">PEP 282 – A Logging System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0283/">PEP 283 – Python 2.3 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0284/">PEP 284 – Integer for-loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0285/">PEP 285 – Adding a bool type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0286/">PEP 286 – Enhanced Argument Tuples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0287/">PEP 287 – reStructuredText Docstring Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0288/">PEP 288 – Generators Attributes and Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0289/">PEP 289 – Generator Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0290/">PEP 290 – Code Migration and Modernization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0291/">PEP 291 – Backward Compatibility for the Python 2 Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0292/">PEP 292 – Simpler String Substitutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0293/">PEP 293 – Codec Error Handling Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0294/">PEP 294 – Type Names in the types Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0295/">PEP 295 – Interpretation of multiline string constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0296/">PEP 296 – Adding a bytes Object Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0297/">PEP 297 – Support for System Upgrades</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0298/">PEP 298 – The Locked Buffer Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0299/">PEP 299 – Special __main__() function in modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0301/">PEP 301 – Package Index and Metadata for Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0302/">PEP 302 – New Import Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0303/">PEP 303 – Extend divmod() for Multiple Divisors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0304/">PEP 304 – Controlling Generation of Bytecode Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0305/">PEP 305 – CSV File API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0306/">PEP 306 – How to Change Python’s Grammar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0307/">PEP 307 – Extensions to the pickle protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0308/">PEP 308 – Conditional Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0309/">PEP 309 – Partial Function Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0310/">PEP 310 – Reliable Acquisition/Release Pairs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0311/">PEP 311 – Simplified Global Interpreter Lock Acquisition for Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0312/">PEP 312 – Simple Implicit Lambda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0313/">PEP 313 – Adding Roman Numeral Literals to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0314/">PEP 314 – Metadata for Python Software Packages v1.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0315/">PEP 315 – Enhanced While Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0316/">PEP 316 – Programming by Contract for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0317/">PEP 317 – Eliminate Implicit Exception Instantiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0318/">PEP 318 – Decorators for Functions and Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0319/">PEP 319 – Python Synchronize/Asynchronize Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0320/">PEP 320 – Python 2.4 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0321/">PEP 321 – Date/Time Parsing and Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0322/">PEP 322 – Reverse Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0323/">PEP 323 – Copyable Iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0324/">PEP 324 – subprocess - New process module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0325/">PEP 325 – Resource-Release Support for Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0326/">PEP 326 – A Case for Top and Bottom Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0327/">PEP 327 – Decimal Data Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0328/">PEP 328 – Imports: Multi-Line and Absolute/Relative</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0329/">PEP 329 – Treating Builtins as Constants in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0330/">PEP 330 – Python Bytecode Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0331/">PEP 331 – Locale-Independent Float/String Conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0332/">PEP 332 – Byte vectors and String/Unicode Unification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0333/">PEP 333 – Python Web Server Gateway Interface v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0334/">PEP 334 – Simple Coroutines via SuspendIteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0335/">PEP 335 – Overloadable Boolean Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0336/">PEP 336 – Make None Callable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0337/">PEP 337 – Logging Usage in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0338/">PEP 338 – Executing modules as scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0339/">PEP 339 – Design of the CPython Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0340/">PEP 340 – Anonymous Block Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0341/">PEP 341 – Unifying try-except and try-finally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0342/">PEP 342 – Coroutines via Enhanced Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0343/">PEP 343 – The “with” Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0344/">PEP 344 – Exception Chaining and Embedded Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0345/">PEP 345 – Metadata for Python Software Packages 1.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0346/">PEP 346 – User Defined (“``with``”) Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0347/">PEP 347 – Migrating the Python CVS to Subversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0348/">PEP 348 – Exception Reorganization for Python 3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0349/">PEP 349 – Allow str() to return unicode strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0350/">PEP 350 – Codetags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0351/">PEP 351 – The freeze protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0352/">PEP 352 – Required Superclass for Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0353/">PEP 353 – Using ssize_t as the index type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0354/">PEP 354 – Enumerations in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0355/">PEP 355 – Path - Object oriented filesystem paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0356/">PEP 356 – Python 2.5 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0357/">PEP 357 – Allowing Any Object to be Used for Slicing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0358/">PEP 358 – The “bytes” Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0359/">PEP 359 – The “make” Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0360/">PEP 360 – Externally Maintained Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0361/">PEP 361 – Python 2.6 and 3.0 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0362/">PEP 362 – Function Signature Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0363/">PEP 363 – Syntax For Dynamic Attribute Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0364/">PEP 364 – Transitioning to the Py3K Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0365/">PEP 365 – Adding the pkg_resources module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0366/">PEP 366 – Main module explicit relative imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0367/">PEP 367 – New Super</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0368/">PEP 368 – Standard image protocol and class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0369/">PEP 369 – Post import hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0370/">PEP 370 – Per user site-packages directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0371/">PEP 371 – Addition of the multiprocessing package to the standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0372/">PEP 372 – Adding an ordered dictionary to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0373/">PEP 373 – Python 2.7 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0374/">PEP 374 – Choosing a distributed VCS for the Python project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0375/">PEP 375 – Python 3.1 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0376/">PEP 376 – Database of Installed Python Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0377/">PEP 377 – Allow __enter__() methods to skip the statement body</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0378/">PEP 378 – Format Specifier for Thousands Separator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0379/">PEP 379 – Adding an Assignment Expression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0380/">PEP 380 – Syntax for Delegating to a Subgenerator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0381/">PEP 381 – Mirroring infrastructure for PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0382/">PEP 382 – Namespace Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0383/">PEP 383 – Non-decodable Bytes in System Character Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0384/">PEP 384 – Defining a Stable ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0385/">PEP 385 – Migrating from Subversion to Mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0386/">PEP 386 – Changing the version comparison module in Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0387/">PEP 387 – Backwards Compatibility Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0389/">PEP 389 – argparse - New Command Line Parsing Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0390/">PEP 390 – Static metadata for Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0391/">PEP 391 – Dictionary-Based Configuration For Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0392/">PEP 392 – Python 3.2 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0393/">PEP 393 – Flexible String Representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0394/">PEP 394 – The “python” Command on Unix-Like Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0395/">PEP 395 – Qualified Names for Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0396/">PEP 396 – Module Version Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0397/">PEP 397 – Python launcher for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0398/">PEP 398 – Python 3.3 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0399/">PEP 399 – Pure Python/C Accelerator Module Compatibility Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0400/">PEP 400 – Deprecate codecs.StreamReader and codecs.StreamWriter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0401/">PEP 401 – BDFL Retirement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0402/">PEP 402 – Simplified Package Layout and Partitioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0403/">PEP 403 – General purpose decorator clause (aka “&#64;in” clause)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0404/">PEP 404 – Python 2.8 Un-release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0405/">PEP 405 – Python Virtual Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0406/">PEP 406 – Improved Encapsulation of Import State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0407/">PEP 407 – New release cycle and introducing long-term support versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0408/">PEP 408 – Standard library __preview__ package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0409/">PEP 409 – Suppressing exception context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0410/">PEP 410 – Use decimal.Decimal type for timestamps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0411/">PEP 411 – Provisional packages in the Python standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0412/">PEP 412 – Key-Sharing Dictionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0413/">PEP 413 – Faster evolution of the Python Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0414/">PEP 414 – Explicit Unicode Literal for Python 3.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0415/">PEP 415 – Implement context suppression with exception attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0416/">PEP 416 – Add a frozendict builtin type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0417/">PEP 417 – Including mock in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0418/">PEP 418 – Add monotonic time, performance counter, and process time functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0419/">PEP 419 – Protecting cleanup statements from interruptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0420/">PEP 420 – Implicit Namespace Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0421/">PEP 421 – Adding sys.implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0422/">PEP 422 – Simpler customisation of class creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0423/">PEP 423 – Naming conventions and recipes related to packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0424/">PEP 424 – A method for exposing a length hint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0425/">PEP 425 – Compatibility Tags for Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0426/">PEP 426 – Metadata for Python Software Packages 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0427/">PEP 427 – The Wheel Binary Package Format 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0428/">PEP 428 – The pathlib module – object-oriented filesystem paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0429/">PEP 429 – Python 3.4 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0430/">PEP 430 – Migrating to Python 3 as the default online documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0431/">PEP 431 – Time zone support improvements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0432/">PEP 432 – Restructuring the CPython startup sequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0433/">PEP 433 – Easier suppression of file descriptor inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0434/">PEP 434 – IDLE Enhancement Exception for All Branches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0435/">PEP 435 – Adding an Enum type to the Python standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0436/">PEP 436 – The Argument Clinic DSL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0437/">PEP 437 – A DSL for specifying signatures, annotations and argument converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0438/">PEP 438 – Transitioning to release-file hosting on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0439/">PEP 439 – Inclusion of implicit pip bootstrap in Python installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0440/">PEP 440 – Version Identification and Dependency Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0441/">PEP 441 – Improving Python ZIP Application Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0442/">PEP 442 – Safe object finalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0443/">PEP 443 – Single-dispatch generic functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0444/">PEP 444 – Python Web3 Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0445/">PEP 445 – Add new APIs to customize Python memory allocators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0446/">PEP 446 – Make newly created file descriptors non-inheritable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0447/">PEP 447 – Add __getdescriptor__ method to metaclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0448/">PEP 448 – Additional Unpacking Generalizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0449/">PEP 449 – Removal of the PyPI Mirror Auto Discovery and Naming Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0450/">PEP 450 – Adding A Statistics Module To The Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0451/">PEP 451 – A ModuleSpec Type for the Import System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0452/">PEP 452 – API for Cryptographic Hash Functions v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0453/">PEP 453 – Explicit bootstrapping of pip in Python installations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0454/">PEP 454 – Add a new tracemalloc module to trace Python memory allocations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0455/">PEP 455 – Adding a key-transforming dictionary to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0456/">PEP 456 – Secure and interchangeable hash algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0457/">PEP 457 – Notation For Positional-Only Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0458/">PEP 458 – Secure PyPI downloads with signed repository metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0459/">PEP 459 – Standard Metadata Extensions for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0460/">PEP 460 – Add binary interpolation and formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0461/">PEP 461 – Adding % formatting to bytes and bytearray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0462/">PEP 462 – Core development workflow automation for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0463/">PEP 463 – Exception-catching expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0464/">PEP 464 – Removal of the PyPI Mirror Authenticity API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0465/">PEP 465 – A dedicated infix operator for matrix multiplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0466/">PEP 466 – Network Security Enhancements for Python 2.7.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0467/">PEP 467 – Minor API improvements for binary sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0468/">PEP 468 – Preserving the order of \*\*kwargs in a function.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0469/">PEP 469 – Migration of dict iteration code to Python 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0470/">PEP 470 – Removing External Hosting Support on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0471/">PEP 471 – os.scandir() function – a better and faster directory iterator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0472/">PEP 472 – Support for indexing with keyword arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0473/">PEP 473 – Adding structured data to built-in exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0474/">PEP 474 – Creating forge.python.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0475/">PEP 475 – Retry system calls failing with EINTR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0476/">PEP 476 – Enabling certificate verification by default for stdlib http clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0477/">PEP 477 – Backport ensurepip (PEP 453) to Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0478/">PEP 478 – Python 3.5 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0479/">PEP 479 – Change StopIteration handling inside generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0480/">PEP 480 – Surviving a Compromise of PyPI: End-to-end signing of packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0481/">PEP 481 – Migrate CPython to Git, Github, and Phabricator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0482/">PEP 482 – Literature Overview for Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0483/">PEP 483 – The Theory of Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0484/">PEP 484 – Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0485/">PEP 485 – A Function for testing approximate equality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0486/">PEP 486 – Make the Python Launcher aware of virtual environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0487/">PEP 487 – Simpler customisation of class creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0488/">PEP 488 – Elimination of PYO files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0489/">PEP 489 – Multi-phase extension module initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0490/">PEP 490 – Chain exceptions at C level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0491/">PEP 491 – The Wheel Binary Package Format 1.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0492/">PEP 492 – Coroutines with async and await syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0493/">PEP 493 – HTTPS verification migration tools for Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0494/">PEP 494 – Python 3.6 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0495/">PEP 495 – Local Time Disambiguation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0496/">PEP 496 – Environment Markers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0497/">PEP 497 – A standard mechanism for backward compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0498/">PEP 498 – Literal String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0499/">PEP 499 – ``python -m foo`` should bind ``sys.modules[‘foo’]`` in addition to ``sys.modules[‘__main__’]``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0500/">PEP 500 – A protocol for delegating datetime methods to their
tzinfo implementations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0501/">PEP 501 – General purpose string interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0502/">PEP 502 – String Interpolation - Extended Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0503/">PEP 503 – Simple Repository API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0504/">PEP 504 – Using the System RNG by default</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0505/">PEP 505 – None-aware operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0506/">PEP 506 – Adding A Secrets Module To The Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0507/">PEP 507 – Migrate CPython to Git and GitLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0508/">PEP 508 – Dependency specification for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0509/">PEP 509 – Add a private version to dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0510/">PEP 510 – Specialize functions with guards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0511/">PEP 511 – API for code transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0512/">PEP 512 – Migrating from hg.python.org to GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0513/">PEP 513 – A Platform Tag for Portable Linux Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0514/">PEP 514 – Python registration in the Windows registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0515/">PEP 515 – Underscores in Numeric Literals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0516/">PEP 516 – Build system abstraction for pip/conda etc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0517/">PEP 517 – A build-system independent format for source trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0518/">PEP 518 – Specifying Minimum Build System Requirements for Python Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0519/">PEP 519 – Adding a file system path protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0520/">PEP 520 – Preserving Class Attribute Definition Order</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0521/">PEP 521 – Managing global context via ‘with’ blocks in generators and coroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0522/">PEP 522 – Allow BlockingIOError in security sensitive APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0523/">PEP 523 – Adding a frame evaluation API to CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0524/">PEP 524 – Make os.urandom() blocking on Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0525/">PEP 525 – Asynchronous Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0526/">PEP 526 – Syntax for Variable Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0527/">PEP 527 – Removing Un(der)used file types/extensions on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0528/">PEP 528 – Change Windows console encoding to UTF-8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0529/">PEP 529 – Change Windows filesystem encoding to UTF-8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0530/">PEP 530 – Asynchronous Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0531/">PEP 531 – Existence checking operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0532/">PEP 532 – A circuit breaking protocol and binary operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0533/">PEP 533 – Deterministic cleanup for iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0534/">PEP 534 – Improved Errors for Missing Standard Library Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0535/">PEP 535 – Rich comparison chaining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0536/">PEP 536 – Final Grammar for Literal String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0537/">PEP 537 – Python 3.7 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0538/">PEP 538 – Coercing the legacy C locale to a UTF-8 based locale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0539/">PEP 539 – A New C-API for Thread-Local Storage in CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0540/">PEP 540 – Add a new UTF-8 Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0541/">PEP 541 – Package Index Name Retention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0542/">PEP 542 – Dot Notation Assignment In Function Header</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0543/">PEP 543 – A Unified TLS API for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0544/">PEP 544 – Protocols: Structural subtyping (static duck typing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0545/">PEP 545 – Python Documentation Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0546/">PEP 546 – Backport ssl.MemoryBIO and ssl.SSLObject to Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0547/">PEP 547 – Running extension modules using the -m option</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0548/">PEP 548 – More Flexible Loop Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0549/">PEP 549 – Instance Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0550/">PEP 550 – Execution Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0551/">PEP 551 – Security transparency in the Python runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0552/">PEP 552 – Deterministic pycs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0553/">PEP 553 – Built-in breakpoint()</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PEP 554 – Multiple Interpreters in the Stdlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0555/">PEP 555 – Context-local variables (contextvars)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0556/">PEP 556 – Threaded garbage collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0557/">PEP 557 – Data Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0558/">PEP 558 – Defined semantics for locals()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0559/">PEP 559 – Built-in noop()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0560/">PEP 560 – Core support for typing module and generic types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0561/">PEP 561 – Distributing and Packaging Type Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0562/">PEP 562 – Module __getattr__ and __dir__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0563/">PEP 563 – Postponed Evaluation of Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0564/">PEP 564 – Add new time functions with nanosecond resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0565/">PEP 565 – Show DeprecationWarning in __main__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0566/">PEP 566 – Metadata for Python Software Packages 2.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0567/">PEP 567 – Context Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0568/">PEP 568 – Generator-sensitivity for Context Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0569/">PEP 569 – Python 3.8 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0570/">PEP 570 – Python Positional-Only Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0571/">PEP 571 – The manylinux2010 Platform Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0572/">PEP 572 – Assignment Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0573/">PEP 573 – Module State Access from C Extension Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0574/">PEP 574 – Pickle protocol 5 with out-of-band data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0575/">PEP 575 – Unifying function/method classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0576/">PEP 576 – Rationalize Built-in function classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0577/">PEP 577 – Augmented Assignment Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0578/">PEP 578 – Python Runtime Audit Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0579/">PEP 579 – Refactoring C functions and methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0580/">PEP 580 – The C call protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0581/">PEP 581 – Using GitHub Issues for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0582/">PEP 582 – Python local packages directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0583/">PEP 583 – A Concurrency Memory Model for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0584/">PEP 584 – Add Union Operators To dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0585/">PEP 585 – Type Hinting Generics In Standard Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0586/">PEP 586 – Literal Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0587/">PEP 587 – Python Initialization Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0588/">PEP 588 – GitHub Issues Migration Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0589/">PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0590/">PEP 590 – Vectorcall: a fast calling protocol for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0591/">PEP 591 – Adding a final qualifier to typing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0592/">PEP 592 – Adding “Yank” Support to the Simple API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0593/">PEP 593 – Flexible function and variable annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0594/">PEP 594 – Removing dead batteries from the standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0595/">PEP 595 – Improving bugs.python.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0596/">PEP 596 – Python 3.9 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0597/">PEP 597 – Add optional EncodingWarning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0598/">PEP 598 – Introducing incremental feature releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0599/">PEP 599 – The manylinux2014 Platform Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0600/">PEP 600 – Future ‘manylinux’ Platform Tags for Portable Linux Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0601/">PEP 601 – Forbid return/break/continue breaking out of finally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0602/">PEP 602 – Annual Release Cycle for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0603/">PEP 603 – Adding a frozenmap type to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0604/">PEP 604 – Allow writing union types as ``X | Y``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0605/">PEP 605 – A rolling feature release stream for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0606/">PEP 606 – Python Compatibility Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0607/">PEP 607 – Reducing CPython’s Feature Delivery Latency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0608/">PEP 608 – Coordinated Python release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0609/">PEP 609 – PyPA Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0610/">PEP 610 – Recording the Direct URL Origin of installed distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0611/">PEP 611 – The one million limit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0612/">PEP 612 – Parameter Specification Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0613/">PEP 613 – Explicit Type Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0614/">PEP 614 – Relaxing Grammar Restrictions On Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0615/">PEP 615 – Support for the IANA Time Zone Database in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0616/">PEP 616 – String methods to remove prefixes and suffixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0617/">PEP 617 – New PEG parser for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0618/">PEP 618 – Add Optional Length-Checking To zip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0619/">PEP 619 – Python 3.10 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0620/">PEP 620 – Hide implementation details from the C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0621/">PEP 621 – Storing project metadata in pyproject.toml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0622/">PEP 622 – Structural Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0623/">PEP 623 – Remove wstr from Unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0624/">PEP 624 – Remove Py_UNICODE encoder APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0625/">PEP 625 – File name of a Source Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0626/">PEP 626 – Precise line numbers for debugging and other tools.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0627/">PEP 627 – Recording installed projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0628/">PEP 628 – Add ``math.tau``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0629/">PEP 629 – Versioning PyPI’s Simple API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0630/">PEP 630 – Isolating Extension Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0631/">PEP 631 – Dependency specification in pyproject.toml based on PEP 508</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0632/">PEP 632 – Deprecate distutils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0633/">PEP 633 – Dependency specification in pyproject.toml using an exploded TOML table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0634/">PEP 634 – Structural Pattern Matching: Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0635/">PEP 635 – Structural Pattern Matching: Motivation and Rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0636/">PEP 636 – Structural Pattern Matching: Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0637/">PEP 637 – Support for indexing with keyword arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0638/">PEP 638 – Syntactic Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0639/">PEP 639 – Metadata for Python Software Packages 2.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0640/">PEP 640 – Unused variable syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0641/">PEP 641 – Using an underscore in the version portion of Python 3.10 compatibility tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0642/">PEP 642 – Explicit Pattern Syntax for Structural Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0643/">PEP 643 – Metadata for Package Source Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0644/">PEP 644 – Require OpenSSL 1.1.1 or newer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0645/">PEP 645 – Allow writing optional types as ``x?``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0646/">PEP 646 – Variadic Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0647/">PEP 647 – User-Defined Type Guards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0648/">PEP 648 – Extensible customizations of the interpreter at startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0649/">PEP 649 – Deferred Evaluation Of Annotations Using Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0650/">PEP 650 – Specifying Installer Requirements for Python Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0651/">PEP 651 – Robust Stack Overflow Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0652/">PEP 652 – Maintaining the Stable ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0653/">PEP 653 – Precise Semantics for Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0654/">PEP 654 – Exception Groups and except*</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0655/">PEP 655 – Marking individual TypedDict items as required or potentially-missing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0656/">PEP 656 – Platform Tag for Linux Distributions Using Musl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0657/">PEP 657 – Include Fine Grained Error Locations in Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0658/">PEP 658 – Serve Distribution Metadata in the Simple Repository API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0659/">PEP 659 – Specializing Adaptive Interpreter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0660/">PEP 660 – Editable installs for pyproject.toml based builds (wheel based)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0661/">PEP 661 – Sentinel Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0662/">PEP 662 – Editable installs via virtual wheels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0666/">PEP 666 – Reject Foolish Indentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0754/">PEP 754 – IEEE 754 Floating Point Special Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0801/">PEP 801 – Reserved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3000/">PEP 3000 – Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3001/">PEP 3001 – Procedure for reviewing and improving standard library modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3002/">PEP 3002 – Procedure for Backwards-Incompatible Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3003/">PEP 3003 – Python Language Moratorium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3099/">PEP 3099 – Things that will Not Change in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3100/">PEP 3100 – Miscellaneous Python 3.0 Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3101/">PEP 3101 – Advanced String Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3102/">PEP 3102 – Keyword-Only Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3103/">PEP 3103 – A Switch/Case Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3104/">PEP 3104 – Access to Names in Outer Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3105/">PEP 3105 – Make print a function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3106/">PEP 3106 – Revamping dict.keys(), .values() and .items()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3107/">PEP 3107 – Function Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3108/">PEP 3108 – Standard Library Reorganization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3109/">PEP 3109 – Raising Exceptions in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3110/">PEP 3110 – Catching Exceptions in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3111/">PEP 3111 – Simple input built-in in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3112/">PEP 3112 – Bytes literals in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3113/">PEP 3113 – Removal of Tuple Parameter Unpacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3114/">PEP 3114 – Renaming iterator.next() to iterator.__next__()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3115/">PEP 3115 – Metaclasses in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3116/">PEP 3116 – New I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3117/">PEP 3117 – Postfix type declarations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3118/">PEP 3118 – Revising the buffer protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3119/">PEP 3119 – Introducing Abstract Base Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3120/">PEP 3120 – Using UTF-8 as the default source encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3121/">PEP 3121 – Extension Module Initialization and Finalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3122/">PEP 3122 – Delineation of the main module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3123/">PEP 3123 – Making PyObject_HEAD conform to standard C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3124/">PEP 3124 – Overloading, Generic Functions, Interfaces, and Adaptation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3125/">PEP 3125 – Remove Backslash Continuation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3126/">PEP 3126 – Remove Implicit String Concatenation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3127/">PEP 3127 – Integer Literal Support and Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3128/">PEP 3128 – BList: A Faster List-like Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3129/">PEP 3129 – Class Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3130/">PEP 3130 – Access to Current Module/Class/Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3131/">PEP 3131 – Supporting Non-ASCII Identifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3132/">PEP 3132 – Extended Iterable Unpacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3133/">PEP 3133 – Introducing Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3134/">PEP 3134 – Exception Chaining and Embedded Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3135/">PEP 3135 – New Super</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3136/">PEP 3136 – Labeled break and continue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3137/">PEP 3137 – Immutable Bytes and Mutable Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3138/">PEP 3138 – String representation in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3139/">PEP 3139 – Cleaning out sys and the “interpreter” module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3140/">PEP 3140 – str(container) should call str(item), not repr(item)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3141/">PEP 3141 – A Type Hierarchy for Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3142/">PEP 3142 – Add a “while” clause to generator expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3143/">PEP 3143 – Standard daemon process library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3144/">PEP 3144 – IP Address Manipulation Library for the Python Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3145/">PEP 3145 – Asynchronous I/O For subprocess.Popen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3146/">PEP 3146 – Merging Unladen Swallow into CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3147/">PEP 3147 – PYC Repository Directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3148/">PEP 3148 – futures - execute computations asynchronously</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3149/">PEP 3149 – ABI version tagged .so files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3150/">PEP 3150 – Statement local namespaces (aka “given” clause)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3151/">PEP 3151 – Reworking the OS and IO exception hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3152/">PEP 3152 – Cofunctions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3153/">PEP 3153 – Asynchronous IO support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3154/">PEP 3154 – Pickle protocol version 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3155/">PEP 3155 – Qualified name for classes and functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3156/">PEP 3156 – Asynchronous IO Support Rebooted: the “asyncio” Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3333/">PEP 3333 – Python Web Server Gateway Interface v1.0.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8000/">PEP 8000 – Python Language Governance Proposal Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8001/">PEP 8001 – Python Governance Voting Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8002/">PEP 8002 – Open Source Governance Survey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8010/">PEP 8010 – The Technical Leader Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8011/">PEP 8011 – Python Governance Model Lead by Trio of Pythonistas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8012/">PEP 8012 – The Community Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8013/">PEP 8013 – The External Council Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8014/">PEP 8014 – The Commons Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8015/">PEP 8015 – Organization of the Python community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8016/">PEP 8016 – The Steering Council Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8100/">PEP 8100 – January 2019 steering council election</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8101/">PEP 8101 – 2020 Term steering council election</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8102/">PEP 8102 – 2021 Term steering council election</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../contents/">Documentation overview</a><ul>
      <li>Previous: <a href="../pep-0553/" title="previous chapter">PEP 553 – Built-in breakpoint()</a></li>
      <li>Next: <a href="../pep-0555/" title="next chapter">PEP 555 – Context-local variables (contextvars)</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/pep-0554.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>