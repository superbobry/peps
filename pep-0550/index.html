
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PEP 550 – Execution Context &#8212; peps.python.org</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="PEP 551 – Security transparency in the Python runtime" href="../pep-0551/" />
    <link rel="prev" title="PEP 549 – Instance Descriptors" href="../pep-0549/" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pep-550-execution-context">
<h1 class="page-title">PEP 550 – Execution Context<a class="headerlink" href="#pep-550-execution-context" title="Permalink to this headline">¶</a></h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd"><p>550</p>
</dd>
<dt class="field-even">Title</dt>
<dd class="field-even"><p>Execution Context</p>
</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Yury Selivanov &lt;<a class="reference external" href="mailto:yury&#37;&#52;&#48;edgedb&#46;com?subject=PEP%20-1">yury&#32;&#97;t&#32;edgedb.com</a>&gt;,
Elvis Pranskevichus &lt;<a class="reference external" href="mailto:elvis&#37;&#52;&#48;edgedb&#46;com?subject=PEP%20-1">elvis&#32;&#97;t&#32;edgedb.com</a>&gt;</p>
</dd>
<dt class="field-even">Status</dt>
<dd class="field-even"><p>Withdrawn</p>
</dd>
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>Standards Track</p>
</dd>
<dt class="field-even">Created</dt>
<dd class="field-even"><p>11-Aug-2017</p>
</dd>
<dt class="field-odd">Python-Version</dt>
<dd class="field-odd"><p>3.7</p>
</dd>
<dt class="field-even">Post-History</dt>
<dd class="field-even"><p>11-Aug-2017, 15-Aug-2017, 18-Aug-2017, 25-Aug-2017,
01-Sep-2017</p>
</dd>
</dl>
<hr class="docutils" />
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#abstract" id="id64">Abstract</a></p></li>
<li><p><a class="reference internal" href="#pep-status" id="id65">PEP Status</a></p></li>
<li><p><a class="reference internal" href="#rationale" id="id66">Rationale</a></p></li>
<li><p><a class="reference internal" href="#goals" id="id67">Goals</a></p></li>
<li><p><a class="reference internal" href="#high-level-specification" id="id68">High-Level Specification</a></p>
<ul>
<li><p><a class="reference internal" href="#regular-single-threaded-code" id="id69">Regular Single-threaded Code</a></p></li>
<li><p><a class="reference internal" href="#multithreaded-code" id="id70">Multithreaded Code</a></p></li>
<li><p><a class="reference internal" href="#generators" id="id71">Generators</a></p></li>
<li><p><a class="reference internal" href="#coroutines-and-asynchronous-tasks" id="id72">Coroutines and Asynchronous Tasks</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#detailed-specification" id="id73">Detailed Specification</a></p>
<ul>
<li><p><a class="reference internal" href="#id5" id="id74">Generators</a></p></li>
<li><p><a class="reference internal" href="#contextlib-contextmanager" id="id75">contextlib.contextmanager</a></p></li>
<li><p><a class="reference internal" href="#enumerating-context-vars" id="id76">Enumerating context vars</a></p></li>
<li><p><a class="reference internal" href="#coroutines" id="id77">coroutines</a></p></li>
<li><p><a class="reference internal" href="#asynchronous-generators" id="id78">Asynchronous Generators</a></p></li>
<li><p><a class="reference internal" href="#asyncio" id="id79">asyncio</a></p></li>
<li><p><a class="reference internal" href="#generators-transformed-into-iterators" id="id80">Generators Transformed into Iterators</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation" id="id81">Implementation</a></p>
<ul>
<li><p><a class="reference internal" href="#logical-context" id="id82">Logical Context</a></p></li>
<li><p><a class="reference internal" href="#context-variables" id="id83">Context Variables</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-considerations" id="id84">Performance Considerations</a></p></li>
<li><p><a class="reference internal" href="#summary-of-the-new-apis" id="id85">Summary of the New APIs</a></p>
<ul>
<li><p><a class="reference internal" href="#python" id="id86">Python</a></p></li>
<li><p><a class="reference internal" href="#c-api" id="id87">C API</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#design-considerations" id="id88">Design Considerations</a></p>
<ul>
<li><p><a class="reference internal" href="#should-yield-from-leak-context-changes" id="id89">Should “yield from” leak context changes?</a></p></li>
<li><p><a class="reference internal" href="#should-pythreadstate-getdict-use-the-execution-context" id="id90">Should <code class="docutils literal notranslate"><span class="pre">PyThreadState_GetDict()</span></code> use the execution context?</a></p></li>
<li><p><a class="reference internal" href="#pep-521" id="id91">PEP 521</a></p></li>
<li><p><a class="reference internal" href="#can-execution-context-be-implemented-without-modifying-cpython" id="id92">Can Execution Context be implemented without modifying CPython?</a></p></li>
<li><p><a class="reference internal" href="#should-we-update-sys-displayhook-and-other-apis-to-use-ec" id="id93">Should we update sys.displayhook and other APIs to use EC?</a></p></li>
<li><p><a class="reference internal" href="#greenlets" id="id94">Greenlets</a></p></li>
<li><p><a class="reference internal" href="#context-manager-as-the-interface-for-modifications" id="id95">Context manager as the interface for modifications</a></p></li>
<li><p><a class="reference internal" href="#setting-and-restoring-context-variables" id="id96">Setting and restoring context variables</a></p></li>
<li><p><a class="reference internal" href="#alternative-designs-for-contextvar-api" id="id97">Alternative Designs for ContextVar API</a></p>
<ul>
<li><p><a class="reference internal" href="#logical-context-with-stacked-values" id="id98">Logical Context with stacked values</a></p></li>
<li><p><a class="reference internal" href="#contextvar-set-reset" id="id99">ContextVar “set/reset”</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#backwards-compatibility" id="id100">Backwards Compatibility</a></p></li>
<li><p><a class="reference internal" href="#rejected-ideas" id="id101">Rejected Ideas</a></p>
<ul>
<li><p><a class="reference internal" href="#replication-of-threading-local-interface" id="id102">Replication of threading.local() interface</a></p></li>
<li><p><a class="reference internal" href="#coroutines-not-leaking-context-changes-by-default" id="id103">Coroutines not leaking context changes by default</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#appendix-hamt-performance-analysis" id="id104">Appendix: HAMT Performance Analysis</a></p></li>
<li><p><a class="reference internal" href="#acknowledgments" id="id105">Acknowledgments</a></p></li>
<li><p><a class="reference internal" href="#version-history" id="id106">Version History</a></p></li>
<li><p><a class="reference internal" href="#references" id="id107">References</a></p></li>
<li><p><a class="reference internal" href="#copyright" id="id108">Copyright</a></p></li>
</ul>
</div>
<section id="abstract">
<h2><a class="toc-backref" href="#id64">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>This PEP adds a new generic mechanism of ensuring consistent access
to non-local state in the context of out-of-order execution, such
as in Python generators and coroutines.</p>
<p>Thread-local storage, such as <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code>, is inadequate for
programs that execute concurrently in the same OS thread.  This PEP
proposes a solution to this problem.</p>
</section>
<section id="pep-status">
<h2><a class="toc-backref" href="#id65">PEP Status</a><a class="headerlink" href="#pep-status" title="Permalink to this headline">¶</a></h2>
<p>Due to its breadth and the lack of general consensus on some aspects, this
PEP has been withdrawn and superseded by a simpler <span class="target" id="index-0"></span><a class="pep reference external" href="pep-0567.html"><strong>PEP 567</strong></a>, which has
been accepted and included in Python 3.7.</p>
<p><span class="target" id="index-1"></span><a class="pep reference external" href="pep-0567.html"><strong>PEP 567</strong></a> implements the same core idea, but limits the ContextVar support
to asynchronous tasks while leaving the generator behavior untouched.
The latter may be revisited in a future PEP.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#id66">Rationale</a><a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<p>Prior to the advent of asynchronous programming in Python, programs
used OS threads to achieve concurrency.  The need for thread-specific
state was solved by <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code> and its C-API equivalent,
<code class="docutils literal notranslate"><span class="pre">PyThreadState_GetDict()</span></code>.</p>
<p>A few examples of where Thread-local storage (TLS) is commonly
relied upon:</p>
<ul class="simple">
<li><p>Context managers like decimal contexts, <code class="docutils literal notranslate"><span class="pre">numpy.errstate</span></code>,
and <code class="docutils literal notranslate"><span class="pre">warnings.catch_warnings</span></code>.</p></li>
<li><p>Request-related data, such as security tokens and request
data in web applications, language context for <code class="docutils literal notranslate"><span class="pre">gettext</span></code> etc.</p></li>
<li><p>Profiling, tracing, and logging in large code bases.</p></li>
</ul>
<p>Unfortunately, TLS does not work well for programs which execute
concurrently in a single thread.  A Python generator is the simplest
example of a concurrent program.  Consider the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fractions</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="k">yield</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">g1</span> <span class="o">=</span> <span class="n">fractions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">g2</span> <span class="o">=</span> <span class="n">fractions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">))</span>
</pre></div>
</div>
<p>The intuitively expected value of <code class="docutils literal notranslate"><span class="pre">items</span></code> is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.33&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.666667&#39;</span><span class="p">)),</span>
 <span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.11&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.222222&#39;</span><span class="p">))]</span>
</pre></div>
</div>
<p>Rather surprisingly, the actual result is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.33&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.666667&#39;</span><span class="p">)),</span>
 <span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.111111&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.222222&#39;</span><span class="p">))]</span>
</pre></div>
</div>
<p>This is because implicit Decimal context is stored as a thread-local,
so concurrent iteration of the <code class="docutils literal notranslate"><span class="pre">fractions()</span></code> generator would
corrupt the state.  For Decimal, specifically, the only current
workaround is to use explicit context method calls for all arithmetic
operations <a class="footnote-reference brackets" href="#id56" id="id1">28</a>.  Arguably, this defeats the usefulness of overloaded
operators and makes even simple formulas hard to read and write.</p>
<p>Coroutines are another class of Python code where TLS unreliability
is a significant issue.</p>
<p>The inadequacy of TLS in asynchronous code has lead to the
proliferation of ad-hoc solutions, which are limited in scope and
do not support all required use cases.</p>
<p>The current status quo is that any library (including the standard
library), which relies on TLS, is likely to be broken when used in
asynchronous code or with generators (see <a class="footnote-reference brackets" href="#id31" id="id2">3</a> as an example issue.)</p>
<p>Some languages, that support coroutines or generators, recommend
passing the context manually as an argument to every function, see
<a class="footnote-reference brackets" href="#id29" id="id3">1</a> for an example.  This approach, however, has limited use for
Python, where there is a large ecosystem that was built to work with
a TLS-like context.  Furthermore, libraries like <code class="docutils literal notranslate"><span class="pre">decimal</span></code> or
<code class="docutils literal notranslate"><span class="pre">numpy</span></code> rely on context implicitly in overloaded operator
implementations.</p>
<p>The .NET runtime, which has support for async/await, has a generic
solution for this problem, called <code class="docutils literal notranslate"><span class="pre">ExecutionContext</span></code> (see <a class="footnote-reference brackets" href="#id30" id="id4">2</a>).</p>
</section>
<section id="goals">
<h2><a class="toc-backref" href="#id67">Goals</a><a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<p>The goal of this PEP is to provide a more reliable
<code class="docutils literal notranslate"><span class="pre">threading.local()</span></code> alternative, which:</p>
<ul class="simple">
<li><p>provides the mechanism and the API to fix non-local state issues
with coroutines and generators;</p></li>
<li><p>implements TLS-like semantics for synchronous code, so that
users like <code class="docutils literal notranslate"><span class="pre">decimal</span></code> and <code class="docutils literal notranslate"><span class="pre">numpy</span></code> can switch to the new
mechanism with minimal risk of breaking backwards compatibility;</p></li>
<li><p>has no or negligible performance impact on the existing code or
the code that will be using the new mechanism, including
C extensions.</p></li>
</ul>
</section>
<section id="high-level-specification">
<h2><a class="toc-backref" href="#id68">High-Level Specification</a><a class="headerlink" href="#high-level-specification" title="Permalink to this headline">¶</a></h2>
<p>The full specification of this PEP is broken down into three parts:</p>
<ul class="simple">
<li><p>High-Level Specification (this section): the description of the
overall solution.  We show how it applies to generators and
coroutines in user code, without delving into implementation
details.</p></li>
<li><p>Detailed Specification: the complete description of new concepts,
APIs, and related changes to the standard library.</p></li>
<li><p>Implementation Details: the description and analysis of data
structures and algorithms used to implement this PEP, as well as
the necessary changes to CPython.</p></li>
</ul>
<p>For the purpose of this section, we define <em>execution context</em> as an
opaque container of non-local state that allows consistent access to
its contents in the concurrent execution environment.</p>
<p>A <em>context variable</em> is an object representing a value in the
execution context.  A call to <code class="docutils literal notranslate"><span class="pre">contextvars.ContextVar(name)</span></code>
creates a new context variable object.  A context variable object has
three methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get()</span></code>: returns the value of the variable in the current
execution context;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set(value)</span></code>: sets the value of the variable in the current
execution context;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete()</span></code>: can be used for restoring variable state, it’s
purpose and semantics are explained in
<a class="reference internal" href="#setting-and-restoring-context-variables">Setting and restoring context variables</a>.</p></li>
</ul>
<section id="regular-single-threaded-code">
<h3><a class="toc-backref" href="#id69">Regular Single-threaded Code</a><a class="headerlink" href="#regular-single-threaded-code" title="Permalink to this headline">¶</a></h3>
<p>In regular, single-threaded code that doesn’t involve generators or
coroutines, context variables behave like globals:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sub</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;main&#39;</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;sub&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>
    <span class="n">sub</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;sub&#39;</span>
</pre></div>
</div>
</section>
<section id="multithreaded-code">
<h3><a class="toc-backref" href="#id70">Multithreaded Code</a><a class="headerlink" href="#multithreaded-code" title="Permalink to this headline">¶</a></h3>
<p>In multithreaded code, context variables behave like thread locals:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sub</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="c1"># The execution context is empty</span>
                              <span class="c1"># for each new thread.</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;sub&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>

    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">sub</span><span class="p">)</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;main&#39;</span>
</pre></div>
</div>
</section>
<section id="generators">
<h3><a class="toc-backref" href="#id71">Generators</a><a class="headerlink" href="#generators" title="Permalink to this headline">¶</a></h3>
<p>Unlike regular function calls, generators can cooperatively yield
their control of execution to the caller.  Furthermore, a generator
does not control <em>where</em> the execution would continue after it yields.
It may be resumed from an arbitrary code location.</p>
<p>For these reasons, the least surprising behaviour of generators is
as follows:</p>
<ul class="simple">
<li><p>changes to context variables are always local and are not visible
in the outer context, but are visible to the code called by the
generator;</p></li>
<li><p>once set in the generator, the context variable is guaranteed not
to change between iterations;</p></li>
<li><p>changes to context variables in outer context (where the generator
is being iterated) are visible to the generator, unless these
variables were also modified inside the generator.</p></li>
</ul>
<p>Let’s review:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var1</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var1&#39;</span><span class="p">)</span>
<span class="n">var2</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var2&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
    <span class="n">var1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;gen&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">var1</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;gen&#39;</span>
    <span class="k">assert</span> <span class="n">var2</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;main&#39;</span>
    <span class="k">yield</span> <span class="mi">1</span>

    <span class="c1"># Modification to var1 in main() is shielded by</span>
    <span class="c1"># gen()&#39;s local modification.</span>
    <span class="k">assert</span> <span class="n">var1</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;gen&#39;</span>

    <span class="c1"># But modifications to var2 are visible</span>
    <span class="k">assert</span> <span class="n">var2</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;main modified&#39;</span>
    <span class="k">yield</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>

    <span class="n">var1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>
    <span class="n">var2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="c1"># Modification of var1 in gen() is not visible.</span>
    <span class="k">assert</span> <span class="n">var1</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;main&#39;</span>

    <span class="n">var1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main modified&#39;</span><span class="p">)</span>
    <span class="n">var2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main modified&#39;</span><span class="p">)</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, let’s revisit the decimal precision example from the <a class="reference internal" href="#rationale">Rationale</a>
section, and see how the execution context can improve the situation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">decimal</span>

<span class="c1"># create a new context var</span>
<span class="n">decimal_ctx</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;decimal context&#39;</span><span class="p">)</span>

<span class="c1"># Pre-PEP 550 Decimal relies on TLS for its context.</span>
<span class="c1"># For illustration purposes, we monkey-patch the decimal</span>
<span class="c1"># context functions to use the execution context.</span>
<span class="c1"># A real working fix would need to properly update the</span>
<span class="c1"># C implementation as well.</span>
<span class="k">def</span> <span class="nf">patched_setcontext</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">decimal_ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">patched_getcontext</span><span class="p">():</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">decimal_ctx</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ctx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
        <span class="n">decimal_ctx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ctx</span>

<span class="n">decimal</span><span class="o">.</span><span class="n">setcontext</span> <span class="o">=</span> <span class="n">patched_setcontext</span>
<span class="n">decimal</span><span class="o">.</span><span class="n">getcontext</span> <span class="o">=</span> <span class="n">patched_getcontext</span>

<span class="k">def</span> <span class="nf">fractions</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="k">yield</span> <span class="n">MyDecimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">MyDecimal</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">MyDecimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">MyDecimal</span><span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">g1</span> <span class="o">=</span> <span class="n">fractions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">g2</span> <span class="o">=</span> <span class="n">fractions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">))</span>
</pre></div>
</div>
<p>The value of <code class="docutils literal notranslate"><span class="pre">items</span></code> is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.33&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.666667&#39;</span><span class="p">)),</span>
 <span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.11&#39;</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.222222&#39;</span><span class="p">))]</span>
</pre></div>
</div>
<p>which matches the expected result.</p>
</section>
<section id="coroutines-and-asynchronous-tasks">
<h3><a class="toc-backref" href="#id72">Coroutines and Asynchronous Tasks</a><a class="headerlink" href="#coroutines-and-asynchronous-tasks" title="Permalink to this headline">¶</a></h3>
<p>Like generators, coroutines can yield and regain control.  The major
difference from generators is that coroutines do not yield to the
immediate caller.  Instead, the entire coroutine call stack
(coroutines chained by <code class="docutils literal notranslate"><span class="pre">await</span></code>) switches to another coroutine call
stack.  In this regard, <code class="docutils literal notranslate"><span class="pre">await</span></code>-ing on a coroutine is conceptually
similar to a regular function call, and a coroutine chain
(or a “task”, e.g. an <code class="docutils literal notranslate"><span class="pre">asyncio.Task</span></code>) is conceptually similar to a
thread.</p>
<p>From this similarity we conclude that context variables in coroutines
should behave like “task locals”:</p>
<ul class="simple">
<li><p>changes to context variables in a coroutine are visible to the
coroutine that awaits on it;</p></li>
<li><p>changes to context variables made in the caller prior to awaiting
are visible to the awaited coroutine;</p></li>
<li><p>changes to context variables made in one task are not visible in
other tasks;</p></li>
<li><p>tasks spawned by other tasks inherit the execution context from the
parent task, but any changes to context variables made in the
parent task <em>after</em> the child task was spawned are <em>not</em> visible.</p></li>
</ul>
<p>The last point shows behaviour that is different from OS threads.
OS threads do not inherit the execution context by default.
There are two reasons for this: <em>common usage intent</em> and backwards
compatibility.</p>
<p>The main reason for why tasks inherit the context, and threads do
not, is the common usage intent.  Tasks are often used for relatively
short-running operations which are logically tied to the code that
spawned the task (like running a coroutine with a timeout in
asyncio).  OS threads, on the other hand, are normally used for
long-running, logically separate code.</p>
<p>With respect to backwards compatibility, we want the execution context
to behave like <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code>.  This is so that libraries can
start using the execution context in place of TLS with a lesser risk
of breaking compatibility with existing code.</p>
<p>Let’s review a few examples to illustrate the semantics we have just
defined.</p>
<p>Context variable propagation in a single task:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">sub</span><span class="p">()</span>
    <span class="c1"># The effect of sub() is visible.</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;sub&#39;</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">sub</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;main&#39;</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;sub&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;sub&#39;</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>Context variable propagation between tasks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">sub</span><span class="p">())</span>  <span class="c1"># schedules asynchronous execution</span>
                             <span class="c1"># of sub().</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;main&#39;</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main changed&#39;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">sub</span><span class="p">():</span>
    <span class="c1"># Sleeping will make sub() run after</span>
    <span class="c1"># &quot;var&quot; is modified in main().</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># The value of &quot;var&quot; is inherited from main(), but any</span>
    <span class="c1"># changes to &quot;var&quot; made in main() after the task</span>
    <span class="c1"># was created are *not* visible.</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;main&#39;</span>

    <span class="c1"># This change is local to sub() and will not be visible</span>
    <span class="c1"># to other tasks, including main().</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;sub&#39;</span><span class="p">)</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>As shown above, changes to the execution context are local to the
task, and tasks get a snapshot of the execution context at the point
of creation.</p>
<p>There is one narrow edge case when this can lead to surprising
behaviour.  Consider the following example where we modify the
context variable in a nested coroutine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">var_value</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">var_value</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>

    <span class="c1"># waiting for sub() directly</span>
    <span class="k">await</span> <span class="n">sub</span><span class="p">(</span><span class="s1">&#39;sub-1&#39;</span><span class="p">)</span>

    <span class="c1"># var change is visible</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;sub-1&#39;</span>

    <span class="c1"># waiting for sub() with a timeout;</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;sub-2&#39;</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># wait_for() creates an implicit task, which isolates</span>
    <span class="c1"># context changes, which means that the below assertion</span>
    <span class="c1"># will fail.</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;sub-2&#39;</span>  <span class="c1">#  AssertionError!</span>
</pre></div>
</div>
<p>However, relying on context changes leaking to the caller is
ultimately a bad pattern.  For this reason, the behaviour shown in
the above example is not considered a major issue and can be
addressed with proper documentation.</p>
</section>
</section>
<section id="detailed-specification">
<h2><a class="toc-backref" href="#id73">Detailed Specification</a><a class="headerlink" href="#detailed-specification" title="Permalink to this headline">¶</a></h2>
<p>Conceptually, an <em>execution context</em> (EC) is a stack of logical
contexts.  There is always exactly one active EC per Python thread.</p>
<p>A <em>logical context</em> (LC) is a mapping of context variables to their
values in that particular LC.</p>
<p>A <em>context variable</em> is an object representing a value in the
execution context.  A new context variable object is created by
calling <code class="docutils literal notranslate"><span class="pre">contextvars.ContextVar(name:</span> <span class="pre">str)</span></code>.  The value of the
required <code class="docutils literal notranslate"><span class="pre">name</span></code> argument is not used by the EC machinery, but may
be used for debugging and introspection.</p>
<p>The context variable object has the following methods and attributes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the value passed to <code class="docutils literal notranslate"><span class="pre">ContextVar()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get(*,</span> <span class="pre">topmost=False,</span> <span class="pre">default=None)</span></code>, if <em>topmost</em> is <code class="docutils literal notranslate"><span class="pre">False</span></code>
(the default), traverses the execution context top-to-bottom, until
the variable value is found.  If <em>topmost</em> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, returns
the value of the variable in the topmost logical context.
If the variable value was not found, returns the value of <em>default</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set(value)</span></code>: sets the value of the variable in the topmost
logical context.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete()</span></code>: removes the variable from the topmost logical context.
Useful when restoring the logical context to the state prior to the
<code class="docutils literal notranslate"><span class="pre">set()</span></code> call, for example, in a context manager, see
<a class="reference internal" href="#setting-and-restoring-context-variables">Setting and restoring context variables</a> for more information.</p></li>
</ul>
<section id="id5">
<h3><a class="toc-backref" href="#id74">Generators</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>When created, each generator object has an empty logical context
object stored in its <code class="docutils literal notranslate"><span class="pre">__logical_context__</span></code> attribute.  This logical
context is pushed onto the execution context at the beginning of each
generator iteration and popped at the end:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var1</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var1&#39;</span><span class="p">)</span>
<span class="n">var2</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var2&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
    <span class="n">var1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;var1-gen&#39;</span><span class="p">)</span>
    <span class="n">var2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;var2-gen&#39;</span><span class="p">)</span>

    <span class="c1"># EC = [</span>
    <span class="c1">#     outer_LC(),</span>
    <span class="c1">#     gen_LC({var1: &#39;var1-gen&#39;, var2: &#39;var2-gen&#39;})</span>
    <span class="c1"># ]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">nested_gen</span><span class="p">()</span>  <span class="c1"># nested_gen_LC is created</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="c1"># EC = [</span>
    <span class="c1">#     outer_LC(),</span>
    <span class="c1">#     gen_LC({var1: &#39;var1-gen&#39;, var2: &#39;var2-gen&#39;})</span>
    <span class="c1"># ]</span>

    <span class="n">var1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;var1-gen-mod&#39;</span><span class="p">)</span>
    <span class="n">var2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;var2-gen-mod&#39;</span><span class="p">)</span>
    <span class="c1"># EC = [</span>
    <span class="c1">#     outer_LC(),</span>
    <span class="c1">#     gen_LC({var1: &#39;var1-gen-mod&#39;, var2: &#39;var2-gen-mod&#39;})</span>
    <span class="c1"># ]</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">nested_gen</span><span class="p">():</span>
    <span class="c1"># EC = [</span>
    <span class="c1">#     outer_LC(),</span>
    <span class="c1">#     gen_LC({var1: &#39;var1-gen&#39;, var2: &#39;var2-gen&#39;}),</span>
    <span class="c1">#     nested_gen_LC()</span>
    <span class="c1"># ]</span>
    <span class="k">assert</span> <span class="n">var1</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;var1-gen&#39;</span>
    <span class="k">assert</span> <span class="n">var2</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;var2-gen&#39;</span>

    <span class="n">var1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;var1-nested-gen&#39;</span><span class="p">)</span>
    <span class="c1"># EC = [</span>
    <span class="c1">#     outer_LC(),</span>
    <span class="c1">#     gen_LC({var1: &#39;var1-gen&#39;, var2: &#39;var2-gen&#39;}),</span>
    <span class="c1">#     nested_gen_LC({var1: &#39;var1-nested-gen&#39;})</span>
    <span class="c1"># ]</span>
    <span class="k">yield</span>

    <span class="c1"># EC = [</span>
    <span class="c1">#     outer_LC(),</span>
    <span class="c1">#     gen_LC({var1: &#39;var1-gen-mod&#39;, var2: &#39;var2-gen-mod&#39;}),</span>
    <span class="c1">#     nested_gen_LC({var1: &#39;var1-nested-gen&#39;})</span>
    <span class="c1"># ]</span>
    <span class="k">assert</span> <span class="n">var1</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;var1-nested-gen&#39;</span>
    <span class="k">assert</span> <span class="n">var2</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;var2-gen-mod&#39;</span>

    <span class="k">yield</span>

<span class="c1"># EC = [outer_LC()]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>  <span class="c1"># gen_LC is created for the generator object `g`</span>
<span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

<span class="c1"># EC = [outer_LC()]</span>
</pre></div>
</div>
<p>The snippet above shows the state of the execution context stack
throughout the generator lifespan.</p>
</section>
<section id="contextlib-contextmanager">
<h3><a class="toc-backref" href="#id75">contextlib.contextmanager</a><a class="headerlink" href="#contextlib-contextmanager" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">contextlib.contextmanager()</span></code> decorator can be used to turn
a generator into a context manager.  A context manager that
temporarily modifies the value of a context variable could be defined
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">var_context</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">original_value</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">original_value</span><span class="p">)</span>
</pre></div>
</div>
<p>Unfortunately, this would not work straight away, as the modification
to the <code class="docutils literal notranslate"><span class="pre">var</span></code> variable is contained to the <code class="docutils literal notranslate"><span class="pre">var_context()</span></code>
generator, and therefore will not be visible inside the <code class="docutils literal notranslate"><span class="pre">with</span></code>
block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="c1"># EC = [{}, {}]</span>

    <span class="k">with</span> <span class="n">var_context</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># EC becomes [{}, {}, {var: 10}] in the</span>
        <span class="c1"># *precision_context()* generator,</span>
        <span class="c1"># but here the EC is still [{}, {}]</span>

        <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">10</span>  <span class="c1"># AssertionError!</span>
</pre></div>
</div>
<p>The way to fix this is to set the generator’s <code class="docutils literal notranslate"><span class="pre">__logical_context__</span></code>
attribute to <code class="docutils literal notranslate"><span class="pre">None</span></code>.  This will cause the generator to avoid
modifying the execution context stack.</p>
<p>We modify the <code class="docutils literal notranslate"><span class="pre">contextlib.contextmanager()</span></code> decorator to
set <code class="docutils literal notranslate"><span class="pre">genobj.__logical_context__</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> to produce
well-behaved context managers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="c1"># EC = [{}, {}]</span>

    <span class="k">with</span> <span class="n">var_context</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># EC = [{}, {var: 10}]</span>
        <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">10</span>

    <span class="c1"># EC becomes [{}, {var: None}]</span>
</pre></div>
</div>
</section>
<section id="enumerating-context-vars">
<h3><a class="toc-backref" href="#id76">Enumerating context vars</a><a class="headerlink" href="#enumerating-context-vars" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ExecutionContext.vars()</span></code> method returns a list of
<code class="docutils literal notranslate"><span class="pre">ContextVar</span></code> objects, that have values in the execution context.
This method is mostly useful for introspection and logging.</p>
</section>
<section id="coroutines">
<h3><a class="toc-backref" href="#id77">coroutines</a><a class="headerlink" href="#coroutines" title="Permalink to this headline">¶</a></h3>
<p>In CPython, coroutines share the implementation with generators.
The difference is that in coroutines <code class="docutils literal notranslate"><span class="pre">__logical_context__</span></code> defaults
to <code class="docutils literal notranslate"><span class="pre">None</span></code>.  This affects both the <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> coroutines and the
old-style generator-based coroutines (generators decorated with
<code class="docutils literal notranslate"><span class="pre">&#64;types.coroutine</span></code>).</p>
</section>
<section id="asynchronous-generators">
<h3><a class="toc-backref" href="#id78">Asynchronous Generators</a><a class="headerlink" href="#asynchronous-generators" title="Permalink to this headline">¶</a></h3>
<p>The execution context semantics in asynchronous generators does not
differ from that of regular generators.</p>
</section>
<section id="asyncio">
<h3><a class="toc-backref" href="#id79">asyncio</a><a class="headerlink" href="#asyncio" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">asyncio</span></code> uses <code class="docutils literal notranslate"><span class="pre">Loop.call_soon</span></code>, <code class="docutils literal notranslate"><span class="pre">Loop.call_later</span></code>,
and <code class="docutils literal notranslate"><span class="pre">Loop.call_at</span></code> to schedule the asynchronous execution of a
function.  <code class="docutils literal notranslate"><span class="pre">asyncio.Task</span></code> uses <code class="docutils literal notranslate"><span class="pre">call_soon()</span></code> to run the
wrapped coroutine.</p>
<p>We modify <code class="docutils literal notranslate"><span class="pre">Loop.call_{at,later,soon}</span></code> to accept the new
optional <em>execution_context</em> keyword argument, which defaults to
the copy of the current execution context:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">call_soon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">execution_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">execution_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">execution_context</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">get_execution_context</span><span class="p">()</span>

    <span class="c1"># ... some time later</span>

    <span class="n">contextvars</span><span class="o">.</span><span class="n">run_with_execution_context</span><span class="p">(</span>
        <span class="n">execution_context</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">contextvars.get_execution_context()</span></code> function returns a
shallow copy of the current execution context.  By shallow copy here
we mean such a new execution context that:</p>
<ul class="simple">
<li><p>lookups in the copy provide the same results as in the original
execution context, and</p></li>
<li><p>any changes in the original execution context do not affect the
copy, and</p></li>
<li><p>any changes to the copy do not affect the original execution
context.</p></li>
</ul>
<p>Either of the following satisfy the copy requirements:</p>
<ul class="simple">
<li><p>a new stack with shallow copies of logical contexts;</p></li>
<li><p>a new stack with one squashed logical context.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">contextvars.run_with_execution_context(ec,</span> <span class="pre">func,</span> <span class="pre">*args,</span>
<span class="pre">**kwargs)</span></code> function runs <code class="docutils literal notranslate"><span class="pre">func(*args,</span> <span class="pre">**kwargs)</span></code> with <em>ec</em> as the
execution context.  The function performs the following steps:</p>
<ol class="arabic simple">
<li><p>Set <em>ec</em> as the current execution context stack in the current
thread.</p></li>
<li><p>Push an empty logical context onto the stack.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">func(*args,</span> <span class="pre">**kwargs)</span></code>.</p></li>
<li><p>Pop the logical context from the stack.</p></li>
<li><p>Restore the original execution context stack.</p></li>
<li><p>Return or raise the <code class="docutils literal notranslate"><span class="pre">func()</span></code> result.</p></li>
</ol>
<p>These steps ensure that <em>ec</em> cannot be modified by <em>func</em>,
which makes <code class="docutils literal notranslate"><span class="pre">run_with_execution_context()</span></code> idempotent.</p>
<p><code class="docutils literal notranslate"><span class="pre">asyncio.Task</span></code> is modified as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Task</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="c1"># Get the current execution context snapshot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exec_context</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">get_execution_context</span><span class="p">()</span>

        <span class="c1"># Create an empty Logical Context that will be</span>
        <span class="c1"># used by coroutines run in the task.</span>
        <span class="n">coro</span><span class="o">.</span><span class="n">__logical_context__</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">LogicalContext</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">,</span>
            <span class="n">execution_context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exec_context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">,</span>
            <span class="n">execution_context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exec_context</span><span class="p">)</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="generators-transformed-into-iterators">
<h3><a class="toc-backref" href="#id80">Generators Transformed into Iterators</a><a class="headerlink" href="#generators-transformed-into-iterators" title="Permalink to this headline">¶</a></h3>
<p>Any Python generator can be represented as an equivalent iterator.
Compilers like Cython rely on this axiom.  With respect to the
execution context, such iterator should behave the same way as the
generator it represents.</p>
<p>This means that there needs to be a Python API to create new logical
contexts and run code with a given logical context.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">contextvars.LogicalContext()</span></code> function creates a new empty
logical context.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">contextvars.run_with_logical_context(lc,</span> <span class="pre">func,</span> <span class="pre">*args,</span>
<span class="pre">**kwargs)</span></code> function can be used to run functions in the specified
logical context.  The <em>lc</em> can be modified as a result of the call.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">contextvars.run_with_logical_context()</span></code> function performs the
following steps:</p>
<ol class="arabic simple">
<li><p>Push <em>lc</em> onto the current execution context stack.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">func(*args,</span> <span class="pre">**kwargs)</span></code>.</p></li>
<li><p>Pop <em>lc</em> from the execution context stack.</p></li>
<li><p>Return or raise the <code class="docutils literal notranslate"><span class="pre">func()</span></code> result.</p></li>
</ol>
<p>By using <code class="docutils literal notranslate"><span class="pre">LogicalContext()</span></code> and <code class="docutils literal notranslate"><span class="pre">run_with_logical_context()</span></code>,
we can replicate the generator behaviour like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Generator</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logical_context</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">LogicalContext</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">run_with_logical_context</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logical_context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_impl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_next_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Actual __next__ implementation.</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Let’s see how this pattern can be applied to an example generator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new context variable</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gen_series</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="n">i</span>

<span class="c1"># gen_series is equivalent to the following iterator:</span>

<span class="k">class</span> <span class="nc">CompiledGenSeries</span><span class="p">:</span>

    <span class="c1"># This class is what the `gen_series()` generator can</span>
    <span class="c1"># be transformed to by a compiler like Cython.</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="c1"># Create a new empty logical context,</span>
        <span class="c1"># like the generators do.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logical_context</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">LogicalContext</span><span class="p">()</span>

        <span class="c1"># Initialize the generator in its LC.</span>
        <span class="c1"># Otherwise `var.set(10)` in the `_init` method</span>
        <span class="c1"># would leak.</span>
        <span class="n">contextvars</span><span class="o">.</span><span class="n">run_with_logical_context</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logical_context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Run the actual implementation of __next__ in our LC.</span>
        <span class="k">return</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">run_with_logical_context</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logical_context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_impl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_next_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>For hand-written iterators such approach to context management is
normally not necessary, and it is easier to set and restore
context variables directly in <code class="docutils literal notranslate"><span class="pre">__next__</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyIterator</span><span class="p">:</span>

    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">old_val</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>
            <span class="c1"># ...</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">old_val</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="implementation">
<h2><a class="toc-backref" href="#id81">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>Execution context is implemented as an immutable linked list of
logical contexts, where each logical context is an immutable weak key
mapping.  A pointer to the currently active execution context is
stored in the OS thread state:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                  <span class="o">+-----------------+</span>
                  <span class="o">|</span>                 <span class="o">|</span>     <span class="n">ec</span>
                  <span class="o">|</span>  <span class="n">PyThreadState</span>  <span class="o">+-------------+</span>
                  <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
                  <span class="o">+-----------------+</span>             <span class="o">|</span>
                                                  <span class="o">|</span>
<span class="n">ec_node</span>             <span class="n">ec_node</span>             <span class="n">ec_node</span>   <span class="n">v</span>
<span class="o">+------+------+</span>     <span class="o">+------+------+</span>     <span class="o">+------+------+</span>
<span class="o">|</span> <span class="n">NULL</span> <span class="o">|</span>  <span class="n">lc</span>  <span class="o">|&lt;----|</span> <span class="n">prev</span> <span class="o">|</span>  <span class="n">lc</span>  <span class="o">|&lt;----|</span> <span class="n">prev</span> <span class="o">|</span>  <span class="n">lc</span>  <span class="o">|</span>
<span class="o">+------+--+---+</span>     <span class="o">+------+--+---+</span>     <span class="o">+------+--+---+</span>
          <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
<span class="n">LC</span>        <span class="n">v</span>         <span class="n">LC</span>        <span class="n">v</span>         <span class="n">LC</span>        <span class="n">v</span>
<span class="o">+-------------+</span>     <span class="o">+-------------+</span>     <span class="o">+-------------+</span>
<span class="o">|</span> <span class="n">var1</span><span class="p">:</span> <span class="n">obj1</span>  <span class="o">|</span>     <span class="o">|</span>    <span class="n">EMPTY</span>    <span class="o">|</span>     <span class="o">|</span> <span class="n">var1</span><span class="p">:</span> <span class="n">obj4</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">var2</span><span class="p">:</span> <span class="n">obj2</span>  <span class="o">|</span>     <span class="o">+-------------+</span>     <span class="o">+-------------+</span>
<span class="o">|</span> <span class="n">var3</span><span class="p">:</span> <span class="n">obj3</span>  <span class="o">|</span>
<span class="o">+-------------+</span>
</pre></div>
</div>
<p>The choice of the immutable list of immutable mappings as a
fundamental data structure is motivated by the need to efficiently
implement <code class="docutils literal notranslate"><span class="pre">contextvars.get_execution_context()</span></code>, which is to be
frequently used by asynchronous tasks and callbacks.  When the EC is
immutable, <code class="docutils literal notranslate"><span class="pre">get_execution_context()</span></code> can simply copy the current
execution context <em>by reference</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_execution_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">PyThreadState_Get</span><span class="p">()</span><span class="o">.</span><span class="n">ec</span>
</pre></div>
</div>
<p>Let’s review all possible context modification scenarios:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ContextVariable.set()</span></code> method is called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ContextVar_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="c1"># See a more complete set() definition</span>
    <span class="c1"># in the `Context Variables` section.</span>

    <span class="n">tstate</span> <span class="o">=</span> <span class="n">PyThreadState_Get</span><span class="p">()</span>
    <span class="n">top_ec_node</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span>
    <span class="n">top_lc</span> <span class="o">=</span> <span class="n">top_ec_node</span><span class="o">.</span><span class="n">lc</span>
    <span class="n">new_top_lc</span> <span class="o">=</span> <span class="n">top_lc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">ec_node</span><span class="p">(</span>
        <span class="n">prev</span><span class="o">=</span><span class="n">top_ec_node</span><span class="o">.</span><span class="n">prev</span><span class="p">,</span>
        <span class="n">lc</span><span class="o">=</span><span class="n">new_top_lc</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">contextvars.run_with_logical_context()</span></code> is called, in which
case the passed logical context object is appended to the execution
context:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_with_logical_context</span><span class="p">(</span><span class="n">lc</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tstate</span> <span class="o">=</span> <span class="n">PyThreadState_Get</span><span class="p">()</span>

    <span class="n">old_top_ec_node</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span>
    <span class="n">new_top_ec_node</span> <span class="o">=</span> <span class="n">ec_node</span><span class="p">(</span><span class="n">prev</span><span class="o">=</span><span class="n">old_top_ec_node</span><span class="p">,</span> <span class="n">lc</span><span class="o">=</span><span class="n">lc</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">new_top_ec_node</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">old_top_ec_node</span>
</pre></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">contextvars.run_with_execution_context()</span></code> is called, in which
case the current execution context is set to the passed execution
context with a new empty logical context appended to it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_with_execution_context</span><span class="p">(</span><span class="n">ec</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tstate</span> <span class="o">=</span> <span class="n">PyThreadState_Get</span><span class="p">()</span>

    <span class="n">old_top_ec_node</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span>
    <span class="n">new_lc</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">LogicalContext</span><span class="p">()</span>
    <span class="n">new_top_ec_node</span> <span class="o">=</span> <span class="n">ec_node</span><span class="p">(</span><span class="n">prev</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span> <span class="n">lc</span><span class="o">=</span><span class="n">new_lc</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">new_top_ec_node</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">old_top_ec_node</span>
</pre></div>
</div>
</li>
<li><p>Either <code class="docutils literal notranslate"><span class="pre">genobj.send()</span></code>, <code class="docutils literal notranslate"><span class="pre">genobj.throw()</span></code>, <code class="docutils literal notranslate"><span class="pre">genobj.close()</span></code>
are called on a <code class="docutils literal notranslate"><span class="pre">genobj</span></code> generator, in which case the logical
context recorded in <code class="docutils literal notranslate"><span class="pre">genobj</span></code> is pushed onto the stack:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PyGen_New</span><span class="p">(</span><span class="n">PyGenObject</span> <span class="o">*</span><span class="n">gen</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gen</span><span class="o">.</span><span class="n">gi_code</span><span class="o">.</span><span class="n">co_flags</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">CO_COROUTINE</span> <span class="o">|</span> <span class="n">CO_ITERABLE_COROUTINE</span><span class="p">)):</span>
        <span class="c1"># gen is an &#39;async def&#39; coroutine, or a generator</span>
        <span class="c1"># decorated with @types.coroutine.</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">__logical_context__</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Non-coroutine generator</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">__logical_context__</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">LogicalContext</span><span class="p">()</span>

<span class="n">gen_send</span><span class="p">(</span><span class="n">PyGenObject</span> <span class="o">*</span><span class="n">gen</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="n">tstate</span> <span class="o">=</span> <span class="n">PyThreadState_Get</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">gen</span><span class="o">.</span><span class="n">__logical_context__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">old_top_ec_node</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span>
        <span class="n">new_top_ec_node</span> <span class="o">=</span> <span class="n">ec_node</span><span class="p">(</span>
            <span class="n">prev</span><span class="o">=</span><span class="n">old_top_ec_node</span><span class="p">,</span>
            <span class="n">lc</span><span class="o">=</span><span class="n">gen</span><span class="o">.</span><span class="n">__logical_context__</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">new_top_ec_node</span>
            <span class="k">return</span> <span class="n">_gen_send_impl</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">gen</span><span class="o">.</span><span class="n">__logical_context__</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span><span class="o">.</span><span class="n">lc</span>
            <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">old_top_ec_node</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_gen_send_impl</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Coroutines and asynchronous generators share the implementation
with generators, and the above changes apply to them as well.</p></li>
</ul>
<p>In certain scenarios the EC may need to be squashed to limit the
size of the chain.  For example, consider the following corner case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">repeat</span><span class="p">(</span><span class="n">coro</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">coro</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">repeat</span><span class="p">(</span><span class="n">coro</span><span class="p">,</span> <span class="n">delay</span><span class="p">))</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">ping</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ping&#39;</span><span class="p">)</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">repeat</span><span class="p">(</span><span class="n">ping</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>
</pre></div>
</div>
<p>In the above code, the EC chain will grow as long as <code class="docutils literal notranslate"><span class="pre">repeat()</span></code> is
called. Each new task will call
<code class="docutils literal notranslate"><span class="pre">contextvars.run_with_execution_context()</span></code>, which will append a new
logical context to the chain.  To prevent unbounded growth,
<code class="docutils literal notranslate"><span class="pre">contextvars.get_execution_context()</span></code> checks if the chain
is longer than a predetermined maximum, and if it is, squashes the
chain into a single LC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_execution_context</span><span class="p">():</span>
    <span class="n">tstate</span> <span class="o">=</span> <span class="n">PyThreadState_Get</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec_len</span> <span class="o">&gt;</span> <span class="n">EC_LEN_MAX</span><span class="p">:</span>
        <span class="n">squashed_lc</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">LogicalContext</span><span class="p">()</span>

        <span class="n">ec_node</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span>
        <span class="k">while</span> <span class="n">ec_node</span><span class="p">:</span>
            <span class="c1"># The LC.merge() method does not replace</span>
            <span class="c1"># existing keys.</span>
            <span class="n">squashed_lc</span> <span class="o">=</span> <span class="n">squashed_lc</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ec_node</span><span class="o">.</span><span class="n">lc</span><span class="p">)</span>
            <span class="n">ec_node</span> <span class="o">=</span> <span class="n">ec_node</span><span class="o">.</span><span class="n">prev</span>

        <span class="k">return</span> <span class="n">ec_node</span><span class="p">(</span><span class="n">prev</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span> <span class="n">lc</span><span class="o">=</span><span class="n">squashed_lc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span>
</pre></div>
</div>
<section id="logical-context">
<h3><a class="toc-backref" href="#id82">Logical Context</a><a class="headerlink" href="#logical-context" title="Permalink to this headline">¶</a></h3>
<p>Logical context is an immutable weak key mapping which has the
following properties with respect to garbage collection:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ContextVar</span></code> objects are strongly-referenced only from the
application code, not from any of the execution context machinery
or values they point to.  This means that there are no reference
cycles that could extend their lifespan longer than necessary, or
prevent their collection by the GC.</p></li>
<li><p>Values put in the execution context are guaranteed to be kept
alive while there is a <code class="docutils literal notranslate"><span class="pre">ContextVar</span></code> key referencing them in
the thread.</p></li>
<li><p>If a <code class="docutils literal notranslate"><span class="pre">ContextVar</span></code> is garbage collected, all of its values will
be removed from all contexts, allowing them to be GCed if needed.</p></li>
<li><p>If an OS thread has ended its execution, its thread state will be
cleaned up along with its execution context, cleaning
up all values bound to all context variables in the thread.</p></li>
</ul>
<p>As discussed earlier, we need <code class="docutils literal notranslate"><span class="pre">contextvars.get_execution_context()</span></code>
to be consistently fast regardless of the size of the execution
context, so logical context is necessarily an immutable mapping.</p>
<p>Choosing <code class="docutils literal notranslate"><span class="pre">dict</span></code> for the underlying implementation is suboptimal,
because <code class="docutils literal notranslate"><span class="pre">LC.set()</span></code> will cause <code class="docutils literal notranslate"><span class="pre">dict.copy()</span></code>, which is an O(N)
operation, where <em>N</em> is the number of items in the LC.</p>
<p><code class="docutils literal notranslate"><span class="pre">get_execution_context()</span></code>, when squashing the EC, is an O(M)
operation, where <em>M</em> is the total number of context variable values
in the EC.</p>
<p>So, instead of <code class="docutils literal notranslate"><span class="pre">dict</span></code>, we choose Hash Array Mapped Trie (HAMT)
as the underlying implementation of logical contexts.  (Scala and
Clojure use HAMT to implement high performance immutable collections
<a class="footnote-reference brackets" href="#id33" id="id6">5</a>, <a class="footnote-reference brackets" href="#id34" id="id7">6</a>.)</p>
<p>With HAMT <code class="docutils literal notranslate"><span class="pre">.set()</span></code> becomes an O(log N) operation, and
<code class="docutils literal notranslate"><span class="pre">get_execution_context()</span></code> squashing is more efficient on average due
to structural sharing in HAMT.</p>
<p>See <a class="reference internal" href="#appendix-hamt-performance-analysis">Appendix: HAMT Performance Analysis</a> for a more elaborate
analysis of HAMT performance compared to <code class="docutils literal notranslate"><span class="pre">dict</span></code>.</p>
</section>
<section id="context-variables">
<h3><a class="toc-backref" href="#id83">Context Variables</a><a class="headerlink" href="#context-variables" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ContextVar.get()</span></code> and <code class="docutils literal notranslate"><span class="pre">ContextVar.set()</span></code> methods are
implemented as follows (in pseudo-code):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ContextVar</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">topmost</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">tstate</span> <span class="o">=</span> <span class="n">PyThreadState_Get</span><span class="p">()</span>

        <span class="n">ec_node</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span>
        <span class="k">while</span> <span class="n">ec_node</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">ec_node</span><span class="o">.</span><span class="n">lc</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ec_node</span><span class="o">.</span><span class="n">lc</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">topmost</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">ec_node</span> <span class="o">=</span> <span class="n">ec_node</span><span class="o">.</span><span class="n">prev</span>

        <span class="k">return</span> <span class="n">default</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">tstate</span> <span class="o">=</span> <span class="n">PyThreadState_Get</span><span class="p">()</span>
        <span class="n">top_ec_node</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span>

        <span class="k">if</span> <span class="n">top_ec_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">top_lc</span> <span class="o">=</span> <span class="n">top_ec_node</span><span class="o">.</span><span class="n">lc</span>
            <span class="n">new_top_lc</span> <span class="o">=</span> <span class="n">top_lc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">ec_node</span><span class="p">(</span>
                <span class="n">prev</span><span class="o">=</span><span class="n">top_ec_node</span><span class="o">.</span><span class="n">prev</span><span class="p">,</span>
                <span class="n">lc</span><span class="o">=</span><span class="n">new_top_lc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># First ContextVar.set() in this OS thread.</span>
            <span class="n">top_lc</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">LogicalContext</span><span class="p">()</span>
            <span class="n">new_top_lc</span> <span class="o">=</span> <span class="n">top_lc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">ec_node</span><span class="p">(</span>
                <span class="n">prev</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span>
                <span class="n">lc</span><span class="o">=</span><span class="n">new_top_lc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tstate</span> <span class="o">=</span> <span class="n">PyThreadState_Get</span><span class="p">()</span>
        <span class="n">top_ec_node</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span>

        <span class="k">if</span> <span class="n">top_ec_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">LookupError</span>

        <span class="n">top_lc</span> <span class="o">=</span> <span class="n">top_ec_node</span><span class="o">.</span><span class="n">lc</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_lc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">LookupError</span>

        <span class="n">new_top_lc</span> <span class="o">=</span> <span class="n">top_lc</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">tstate</span><span class="o">.</span><span class="n">ec</span> <span class="o">=</span> <span class="n">ec_node</span><span class="p">(</span>
            <span class="n">prev</span><span class="o">=</span><span class="n">top_ec_node</span><span class="o">.</span><span class="n">prev</span><span class="p">,</span>
            <span class="n">lc</span><span class="o">=</span><span class="n">new_top_lc</span><span class="p">)</span>
</pre></div>
</div>
<p>For efficient access in performance-sensitive code paths, such as in
<code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">decimal</span></code>, we cache lookups in <code class="docutils literal notranslate"><span class="pre">ContextVar.get()</span></code>,
making it an O(1) operation when the cache is hit.  The cache key is
composed from the following:</p>
<ul class="simple">
<li><p>The new <code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">PyThreadState-&gt;unique_id</span></code>, which is a globally
unique thread state identifier.  It is computed from the new
<code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">PyInterpreterState-&gt;ts_counter</span></code>, which is incremented
whenever a new thread state is created.</p></li>
<li><p>The new <code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">PyThreadState-&gt;stack_version</span></code>, which is a
thread-specific counter, which is incremented whenever a non-empty
logical context is pushed onto the stack or popped from the stack.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">ContextVar-&gt;version</span></code> counter, which is incremented
whenever the context variable value is changed in any logical
context in any OS thread.</p></li>
</ul>
<p>The cache is then implemented as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ContextVar</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="o">...</span>  <span class="c1"># implementation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">topmost</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">topmost</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_uncached</span><span class="p">(</span>
                <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="n">topmost</span><span class="o">=</span><span class="n">topmost</span><span class="p">)</span>

        <span class="n">tstate</span> <span class="o">=</span> <span class="n">PyThreadState_Get</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_tstate_id</span> <span class="o">==</span> <span class="n">tstate</span><span class="o">.</span><span class="n">unique_id</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_stack_ver</span> <span class="o">==</span> <span class="n">tstate</span><span class="o">.</span><span class="n">stack_version</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_version</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_uncached</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># borrowed ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_tstate_id</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">unique_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_stack_version</span> <span class="o">=</span> <span class="n">tstate</span><span class="o">.</span><span class="n">stack_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span>

        <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">last_value</span></code> is a borrowed reference.  We assume that
if the version checks are fine, the value object will be alive.
This allows the values of context variables to be properly garbage
collected.</p>
<p>This generic caching approach is similar to what the current C
implementation of <code class="docutils literal notranslate"><span class="pre">decimal</span></code> does to cache the current decimal
context, and has similar performance characteristics.</p>
</section>
</section>
<section id="performance-considerations">
<h2><a class="toc-backref" href="#id84">Performance Considerations</a><a class="headerlink" href="#performance-considerations" title="Permalink to this headline">¶</a></h2>
<p>Tests of the reference implementation based on the prior
revisions of this PEP have shown 1-2% slowdown on generator
microbenchmarks and no noticeable difference in macrobenchmarks.</p>
<p>The performance of non-generator and non-async code is not
affected by this PEP.</p>
</section>
<section id="summary-of-the-new-apis">
<h2><a class="toc-backref" href="#id85">Summary of the New APIs</a><a class="headerlink" href="#summary-of-the-new-apis" title="Permalink to this headline">¶</a></h2>
<section id="python">
<h3><a class="toc-backref" href="#id86">Python</a><a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>The following new Python APIs are introduced by this PEP:</p>
<ol class="arabic simple">
<li><p>The new <code class="docutils literal notranslate"><span class="pre">contextvars.ContextVar(name:</span> <span class="pre">str='...')</span></code> class,
instances of which have the following:</p>
<ul class="simple">
<li><p>the read-only <code class="docutils literal notranslate"><span class="pre">.name</span></code> attribute,</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">.get()</span></code> method, which returns the value of the variable
in the current execution context;</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">.set()</span></code> method, which sets the value of the variable in
the current logical context;</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">.delete()</span></code> method, which removes the value of the variable
from the current logical context.</p></li>
</ul>
</li>
<li><p>The new <code class="docutils literal notranslate"><span class="pre">contextvars.ExecutionContext()</span></code> class, which represents
an execution context.</p></li>
<li><p>The new <code class="docutils literal notranslate"><span class="pre">contextvars.LogicalContext()</span></code> class, which represents
a logical context.</p></li>
<li><p>The new <code class="docutils literal notranslate"><span class="pre">contextvars.get_execution_context()</span></code> function, which
returns an <code class="docutils literal notranslate"><span class="pre">ExecutionContext</span></code> instance representing a copy of
the current execution context.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">contextvars.run_with_execution_context(ec:</span> <span class="pre">ExecutionContext,</span>
<span class="pre">func,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code> function, which runs <em>func</em> with the
provided execution context.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">contextvars.run_with_logical_context(lc:</span> <span class="pre">LogicalContext,</span>
<span class="pre">func,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code> function, which runs <em>func</em> with the
provided logical context on top of the current execution context.</p></li>
</ol>
</section>
<section id="c-api">
<h3><a class="toc-backref" href="#id87">C API</a><a class="headerlink" href="#c-api" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyContextVar</span> <span class="pre">*</span> <span class="pre">PyContext_NewVar(char</span> <span class="pre">*desc)</span></code>: create a
<code class="docutils literal notranslate"><span class="pre">PyContextVar</span></code> object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyObject</span> <span class="pre">*</span> <span class="pre">PyContext_GetValue(PyContextVar</span> <span class="pre">*,</span> <span class="pre">int</span> <span class="pre">topmost)</span></code>:
return the value of the variable in the current execution context.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">PyContext_SetValue(PyContextVar</span> <span class="pre">*,</span> <span class="pre">PyObject</span> <span class="pre">*)</span></code>: set
the value of the variable in the current logical context.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">PyContext_DelValue(PyContextVar</span> <span class="pre">*)</span></code>: delete the value of
the variable from the current logical context.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyLogicalContext</span> <span class="pre">*</span> <span class="pre">PyLogicalContext_New()</span></code>: create a new empty
<code class="docutils literal notranslate"><span class="pre">PyLogicalContext</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyExecutionContext</span> <span class="pre">*</span> <span class="pre">PyExecutionContext_New()</span></code>: create a new
empty <code class="docutils literal notranslate"><span class="pre">PyExecutionContext</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyExecutionContext</span> <span class="pre">*</span> <span class="pre">PyExecutionContext_Get()</span></code>: return the
current execution context.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">PyContext_SetCurrent(</span>
<span class="pre">PyExecutionContext</span> <span class="pre">*,</span> <span class="pre">PyLogicalContext</span> <span class="pre">*)</span></code>: set the
passed EC object as the current execution context for the active
thread state, and/or set the passed LC object as the current
logical context.</p></li>
</ol>
</section>
</section>
<section id="design-considerations">
<h2><a class="toc-backref" href="#id88">Design Considerations</a><a class="headerlink" href="#design-considerations" title="Permalink to this headline">¶</a></h2>
<section id="should-yield-from-leak-context-changes">
<h3><a class="toc-backref" href="#id89">Should “yield from” leak context changes?</a><a class="headerlink" href="#should-yield-from-leak-context-changes" title="Permalink to this headline">¶</a></h3>
<p>No.  It may be argued that <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> is semantically
equivalent to calling a function, and should leak context changes.
However, it is not possible to satisfy the following at the same time:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">next(gen)</span></code> <em>does not</em> leak context changes made in <code class="docutils literal notranslate"><span class="pre">gen</span></code>, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span> <span class="pre">gen</span></code> <em>leaks</em> context changes made in <code class="docutils literal notranslate"><span class="pre">gen</span></code>.</p></li>
</ul>
<p>The reason is that <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> can be used with a partially
iterated generator, which already has local context changes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;gen&#39;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">i</span>

<span class="k">def</span> <span class="nf">outer_gen</span><span class="p">():</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;outer_gen&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>

    <span class="k">yield</span> <span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="c1"># Changes not visible during partial iteration,</span>
    <span class="c1"># the goal of this PEP:</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;outer_gen&#39;</span>

    <span class="k">yield from</span> <span class="n">g</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;outer_gen&#39;</span>  <span class="c1"># or &#39;gen&#39;?</span>
</pre></div>
</div>
<p>Another example would be refactoring of an explicit <code class="docutils literal notranslate"><span class="pre">for..in</span> <span class="pre">yield</span></code>
construct to a <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> expression.  Consider the following
code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">outer_gen</span><span class="p">():</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;outer_gen&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">i</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;outer_gen&#39;</span>
</pre></div>
</div>
<p>which we want to refactor to use <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">outer_gen</span><span class="p">():</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;outer_gen&#39;</span><span class="p">)</span>

    <span class="k">yield from</span> <span class="n">gen</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;outer_gen&#39;</span>  <span class="c1"># or &#39;gen&#39;?</span>
</pre></div>
</div>
<p>The above examples illustrate that it is unsafe to refactor
generator code using <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> when it can leak context changes.</p>
<p>Thus, the only well-defined and consistent behaviour is to
<strong>always</strong> isolate context changes in generators, regardless of
how they are being iterated.</p>
</section>
<section id="should-pythreadstate-getdict-use-the-execution-context">
<h3><a class="toc-backref" href="#id90">Should <code class="docutils literal notranslate"><span class="pre">PyThreadState_GetDict()</span></code> use the execution context?</a><a class="headerlink" href="#should-pythreadstate-getdict-use-the-execution-context" title="Permalink to this headline">¶</a></h3>
<p>No. <code class="docutils literal notranslate"><span class="pre">PyThreadState_GetDict</span></code> is based on TLS, and changing its
semantics will break backwards compatibility.</p>
</section>
<section id="pep-521">
<h3><a class="reference external" href="pep-0521.html">PEP 521</a><a class="headerlink" href="#pep-521" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="index-2"></span><a class="pep reference external" href="pep-0521.html"><strong>PEP 521</strong></a> proposes an alternative solution to the problem, which
extends the context manager protocol with two new methods:
<code class="docutils literal notranslate"><span class="pre">__suspend__()</span></code> and <code class="docutils literal notranslate"><span class="pre">__resume__()</span></code>.  Similarly, the asynchronous
context manager protocol is also extended with <code class="docutils literal notranslate"><span class="pre">__asuspend__()</span></code> and
<code class="docutils literal notranslate"><span class="pre">__aresume__()</span></code>.</p>
<p>This allows implementing context managers that manage non-local state,
which behave correctly in generators and coroutines.</p>
<p>For example, consider the following context manager, which uses
execution state:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Context</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;something&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">err</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_x</span><span class="p">)</span>
</pre></div>
</div>
<p>An equivalent implementation with <a class="reference external" href="pep-0521.html">PEP 521</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">local</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Context</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_x</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">local</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">local</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;something&#39;</span>

    <span class="k">def</span> <span class="nf">__suspend__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">local</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_x</span>

    <span class="k">def</span> <span class="nf">__resume__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">local</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;something&#39;</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">err</span><span class="p">):</span>
        <span class="n">local</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_x</span>
</pre></div>
</div>
<p>The downside of this approach is the addition of significant new
complexity to the context manager protocol and the interpreter
implementation.  This approach is also likely to negatively impact
the performance of generators and coroutines.</p>
<p>Additionally, the solution in <span class="target" id="index-3"></span><a class="pep reference external" href="pep-0521.html"><strong>PEP 521</strong></a> is limited to context
managers, and does not provide any mechanism to propagate state in
asynchronous tasks and callbacks.</p>
</section>
<section id="can-execution-context-be-implemented-without-modifying-cpython">
<h3><a class="toc-backref" href="#id92">Can Execution Context be implemented without modifying CPython?</a><a class="headerlink" href="#can-execution-context-be-implemented-without-modifying-cpython" title="Permalink to this headline">¶</a></h3>
<p>No.</p>
<p>It is true that the concept of “task-locals” can be implemented
for coroutines in libraries (see, for example, <a class="footnote-reference brackets" href="#id57" id="id8">29</a> and <a class="footnote-reference brackets" href="#id58" id="id9">30</a>).
On the other hand, generators are managed by the Python interpreter
directly, and so their context must also be managed by the
interpreter.</p>
<p>Furthermore, execution context cannot be implemented in a third-party
module at all, otherwise the standard library, including <code class="docutils literal notranslate"><span class="pre">decimal</span></code>
would not be able to rely on it.</p>
</section>
<section id="should-we-update-sys-displayhook-and-other-apis-to-use-ec">
<h3><a class="toc-backref" href="#id93">Should we update sys.displayhook and other APIs to use EC?</a><a class="headerlink" href="#should-we-update-sys-displayhook-and-other-apis-to-use-ec" title="Permalink to this headline">¶</a></h3>
<p>APIs like redirecting stdout by overwriting <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code>, or
specifying new exception display hooks by overwriting the
<code class="docutils literal notranslate"><span class="pre">sys.displayhook</span></code> function are affecting the whole Python process
<strong>by design</strong>.  Their users assume that the effect of changing
them will be visible across OS threads.  Therefore, we cannot
just make these APIs to use the new Execution Context.</p>
<p>That said we think it is possible to design new APIs that will
be context aware, but that is outside of the scope of this PEP.</p>
</section>
<section id="greenlets">
<h3><a class="toc-backref" href="#id94">Greenlets</a><a class="headerlink" href="#greenlets" title="Permalink to this headline">¶</a></h3>
<p>Greenlet is an alternative implementation of cooperative
scheduling for Python.  Although greenlet package is not part of
CPython, popular frameworks like gevent rely on it, and it is
important that greenlet can be modified to support execution
contexts.</p>
<p>Conceptually, the behaviour of greenlets is very similar to that of
generators, which means that similar changes around greenlet entry
and exit can be done to add support for execution context.  This
PEP provides the necessary C APIs to do that.</p>
</section>
<section id="context-manager-as-the-interface-for-modifications">
<h3><a class="toc-backref" href="#id95">Context manager as the interface for modifications</a><a class="headerlink" href="#context-manager-as-the-interface-for-modifications" title="Permalink to this headline">¶</a></h3>
<p>This PEP concentrates on the low-level mechanics and the minimal
API that enables fundamental operations with execution context.</p>
<p>For developer convenience, a high-level context manager interface
may be added to the <code class="docutils literal notranslate"><span class="pre">contextvars</span></code> module.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">set_var</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</section>
<section id="setting-and-restoring-context-variables">
<h3><a class="toc-backref" href="#id96">Setting and restoring context variables</a><a class="headerlink" href="#setting-and-restoring-context-variables" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ContextVar.delete()</span></code> method removes the context variable from
the topmost logical context.</p>
<p>If the variable is not found in the topmost logical context, a
<code class="docutils literal notranslate"><span class="pre">LookupError</span></code> is raised, similarly to <code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">var</span></code> raising
<code class="docutils literal notranslate"><span class="pre">NameError</span></code> when <code class="docutils literal notranslate"><span class="pre">var</span></code> is not in scope.</p>
<p>This method is useful when there is a (rare) need to correctly restore
the state of a logical context, such as when a nested generator
wants to modify the logical context <em>temporarily</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">some_var_context_manager</span><span class="p">(</span><span class="s1">&#39;gen&#39;</span><span class="p">):</span>
        <span class="c1"># EC = [{var: &#39;main&#39;}, {var: &#39;gen&#39;}]</span>
        <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;gen&#39;</span>
        <span class="k">yield</span>

    <span class="c1"># EC = [{var: &#39;main modified&#39;}, {}]</span>
    <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;main modified&#39;</span>
    <span class="k">yield</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;main modified&#39;</span><span class="p">)</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
<p>The above example would work correctly only if there is a way to
delete <code class="docutils literal notranslate"><span class="pre">var</span></code> from the logical context in <code class="docutils literal notranslate"><span class="pre">gen()</span></code>.  Setting it
to a “previous value” in <code class="docutils literal notranslate"><span class="pre">__exit__()</span></code> would mask changes made
in <code class="docutils literal notranslate"><span class="pre">main()</span></code> between the iterations.</p>
</section>
<section id="alternative-designs-for-contextvar-api">
<h3><a class="toc-backref" href="#id97">Alternative Designs for ContextVar API</a><a class="headerlink" href="#alternative-designs-for-contextvar-api" title="Permalink to this headline">¶</a></h3>
<section id="logical-context-with-stacked-values">
<h4><a class="toc-backref" href="#id98">Logical Context with stacked values</a><a class="headerlink" href="#logical-context-with-stacked-values" title="Permalink to this headline">¶</a></h4>
<p>By the design presented in this PEP, logical context is a simple
<code class="docutils literal notranslate"><span class="pre">LC({ContextVar:</span> <span class="pre">value,</span> <span class="pre">...})</span></code> mapping.  An alternative
representation is to store a stack of values for each context
variable: <code class="docutils literal notranslate"><span class="pre">LC({ContextVar:</span> <span class="pre">[val1,</span> <span class="pre">val2,</span> <span class="pre">...],</span> <span class="pre">...})</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ContextVar</span></code> methods would then be:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get(*,</span> <span class="pre">default=None)</span></code> – traverses the stack
of logical contexts, and returns the top value from the
first non-empty logical context;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">push(val)</span></code> – pushes <em>val</em> onto the stack of values in the
current logical context;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pop()</span></code> – pops the top value from the stack of values in
the current logical context.</p></li>
</ul>
<p>Compared to the single-value design with the <code class="docutils literal notranslate"><span class="pre">set()</span></code> and
<code class="docutils literal notranslate"><span class="pre">delete()</span></code> methods, the stack-based approach allows for a simpler
implementation of the set/restore pattern.  However, the mental
burden of this approach is considered to be higher, since there
would be <em>two</em> stacks to consider: a stack of LCs and a stack of
values in each LC.</p>
<p>(This idea was suggested by Nathaniel Smith.)</p>
</section>
<section id="contextvar-set-reset">
<h4><a class="toc-backref" href="#id99">ContextVar “set/reset”</a><a class="headerlink" href="#contextvar-set-reset" title="Permalink to this headline">¶</a></h4>
<p>Yet another approach is to return a special object from
<code class="docutils literal notranslate"><span class="pre">ContextVar.set()</span></code>, which would represent the modification of
the context variable in the current logical context:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">)</span>

    <span class="c1"># ... perform work</span>

    <span class="n">mod</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>  <span class="c1"># Reset the value of var to the original value</span>
                 <span class="c1"># or remove it from the context.</span>
</pre></div>
</div>
<p>The critical flaw in this approach is that it becomes possible to
pass context var “modification objects” into code running in a
different execution context, which leads to undefined side effects.</p>
</section>
</section>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#id100">Backwards Compatibility</a><a class="headerlink" href="#backwards-compatibility" title="Permalink to this headline">¶</a></h2>
<p>This proposal preserves 100% backwards compatibility.</p>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#id101">Rejected Ideas</a><a class="headerlink" href="#rejected-ideas" title="Permalink to this headline">¶</a></h2>
<section id="replication-of-threading-local-interface">
<h3><a class="toc-backref" href="#id102">Replication of threading.local() interface</a><a class="headerlink" href="#replication-of-threading-local-interface" title="Permalink to this headline">¶</a></h3>
<p>Choosing the <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code>-like interface for context
variables was considered and rejected for the following reasons:</p>
<ul>
<li><p>A survey of the standard library and Django has shown that the
vast majority of <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code> uses involve a single
attribute, which indicates that the namespace approach is not
as helpful in the field.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">__getattr__()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">.get()</span></code> for value lookup
does not provide any way to specify the depth of the lookup
(i.e. search only the top logical context).</p></li>
<li><p>Single-value <code class="docutils literal notranslate"><span class="pre">ContextVar</span></code> is easier to reason about in terms
of visibility.  Suppose <code class="docutils literal notranslate"><span class="pre">ContextVar()</span></code> is a namespace,
and the consider the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;ns&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
    <span class="n">ns</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">yield</span>
    <span class="k">assert</span> <span class="n">ns</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span> <span class="c1"># ??</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ns</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ns</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="c1"># should not see the ns.a modification in gen()</span>
    <span class="k">assert</span> <span class="n">ns</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="c1"># but should gen() see the ns.b modification made here?</span>
    <span class="n">ns</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
    <span class="k">yield</span>
</pre></div>
</div>
<p>The above example demonstrates that reasoning about the visibility
of different attributes of the same context var is not trivial.</p>
</li>
<li><p>Single-value <code class="docutils literal notranslate"><span class="pre">ContextVar</span></code> allows straightforward implementation
of the lookup cache;</p></li>
<li><p>Single-value <code class="docutils literal notranslate"><span class="pre">ContextVar</span></code> interface allows the C-API to be
simple and essentially the same as the Python API.</p></li>
</ul>
<p>See also the mailing list discussion: <a class="footnote-reference brackets" href="#id54" id="id10">26</a>, <a class="footnote-reference brackets" href="#id55" id="id11">27</a>.</p>
</section>
<section id="coroutines-not-leaking-context-changes-by-default">
<h3><a class="toc-backref" href="#id103">Coroutines not leaking context changes by default</a><a class="headerlink" href="#coroutines-not-leaking-context-changes-by-default" title="Permalink to this headline">¶</a></h3>
<p>In V4 (<a class="reference internal" href="#version-history">Version History</a>) of this PEP, coroutines were considered to
behave exactly like generators with respect to the execution context:
changes in awaited coroutines were not visible in the outer coroutine.</p>
<p>This idea was rejected on the grounds that is breaks the semantic
similarity of the task and thread models, and, more specifically,
makes it impossible to reliably implement asynchronous context
managers that modify context vars, since <code class="docutils literal notranslate"><span class="pre">__aenter__</span></code> is a
coroutine.</p>
</section>
</section>
<section id="appendix-hamt-performance-analysis">
<h2><a class="toc-backref" href="#id104">Appendix: HAMT Performance Analysis</a><a class="headerlink" href="#appendix-hamt-performance-analysis" title="Permalink to this headline">¶</a></h2>
<figure class="align-center" id="id62">
<a class="reference internal image-reference" href="../_images/pep-0550-hamt_vs_dict-v2.png"><img alt="../_images/pep-0550-hamt_vs_dict-v2.png" src="../_images/pep-0550-hamt_vs_dict-v2.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Figure 1.  Benchmark code can be found here: <a class="footnote-reference brackets" href="#id37" id="id12">9</a>.</span><a class="headerlink" href="#id62" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The above chart demonstrates that:</p>
<ul class="simple">
<li><p>HAMT displays near O(1) performance for all benchmarked
dictionary sizes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dict.copy()</span></code> becomes very slow around 100 items.</p></li>
</ul>
<figure class="align-center" id="id63">
<a class="reference internal image-reference" href="../_images/pep-0550-lookup_hamt.png"><img alt="../_images/pep-0550-lookup_hamt.png" src="../_images/pep-0550-lookup_hamt.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.  Benchmark code can be found here: <a class="footnote-reference brackets" href="#id38" id="id13">10</a>.</span><a class="headerlink" href="#id63" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Figure 2 compares the lookup costs of <code class="docutils literal notranslate"><span class="pre">dict</span></code> versus a HAMT-based
immutable mapping.  HAMT lookup time is 30-40% slower than Python dict
lookups on average, which is a very good result, considering that the
latter is very well optimized.</p>
<p>There is research <a class="footnote-reference brackets" href="#id36" id="id14">8</a> showing that there are further possible
improvements to the performance of HAMT.</p>
<p>The reference implementation of HAMT for CPython can be found here:
<a class="footnote-reference brackets" href="#id35" id="id15">7</a>.</p>
</section>
<section id="acknowledgments">
<h2><a class="toc-backref" href="#id105">Acknowledgments</a><a class="headerlink" href="#acknowledgments" title="Permalink to this headline">¶</a></h2>
<p>Thanks to Victor Petrovykh for countless discussions around the topic
and PEP proofreading and edits.</p>
<p>Thanks to Nathaniel Smith for proposing the <code class="docutils literal notranslate"><span class="pre">ContextVar</span></code> design
<a class="footnote-reference brackets" href="#id45" id="id16">17</a> <a class="footnote-reference brackets" href="#id46" id="id17">18</a>, for pushing the PEP towards a more complete design, and
coming up with the idea of having a stack of contexts in the thread
state.</p>
<p>Thanks to Nick Coghlan for numerous suggestions and ideas on the
mailing list, and for coming up with a case that cause the complete
rewrite of the initial PEP version <a class="footnote-reference brackets" href="#id47" id="id18">19</a>.</p>
</section>
<section id="version-history">
<h2><a class="toc-backref" href="#id106">Version History</a><a class="headerlink" href="#version-history" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Initial revision, posted on 11-Aug-2017 <a class="footnote-reference brackets" href="#id48" id="id19">20</a>.</p></li>
<li><p>V2 posted on 15-Aug-2017 <a class="footnote-reference brackets" href="#id49" id="id20">21</a>.</p>
<p>The fundamental limitation that caused a complete redesign of the
first version was that it was not possible to implement an iterator
that would interact with the EC in the same way as generators
(see <a class="footnote-reference brackets" href="#id47" id="id21">19</a>.)</p>
<p>Version 2 was a complete rewrite, introducing new terminology
(Local Context, Execution Context, Context Item) and new APIs.</p>
</li>
<li><p>V3 posted on 18-Aug-2017 <a class="footnote-reference brackets" href="#id50" id="id22">22</a>.</p>
<p>Updates:</p>
<ul class="simple">
<li><p>Local Context was renamed to Logical Context.  The term “local”
was ambiguous and conflicted with local name scopes.</p></li>
<li><p>Context Item was renamed to Context Key, see the thread with Nick
Coghlan, Stefan Krah, and Yury Selivanov <a class="footnote-reference brackets" href="#id51" id="id23">23</a> for details.</p></li>
<li><p>Context Item get cache design was adjusted, per Nathaniel Smith’s
idea in <a class="footnote-reference brackets" href="#id53" id="id24">25</a>.</p></li>
<li><p>Coroutines are created without a Logical Context; ceval loop
no longer needs to special case the <code class="docutils literal notranslate"><span class="pre">await</span></code> expression
(proposed by Nick Coghlan in <a class="footnote-reference brackets" href="#id52" id="id25">24</a>.)</p></li>
</ul>
</li>
<li><p>V4 posted on 25-Aug-2017 <a class="footnote-reference brackets" href="#id59" id="id26">31</a>.</p>
<ul class="simple">
<li><p>The specification section has been completely rewritten.</p></li>
<li><p>Coroutines now have their own Logical Context.  This means
there is no difference between coroutines, generators, and
asynchronous generators w.r.t. interaction with the Execution
Context.</p></li>
<li><p>Context Key renamed to Context Var.</p></li>
<li><p>Removed the distinction between generators and coroutines with
respect to logical context isolation.</p></li>
</ul>
</li>
<li><p>V5 posted on 01-Sep-2017: the current version.</p>
<ul>
<li><p>Coroutines have no logical context by default (a revert to the V3
semantics).  Read about the motivation in the
<a class="reference internal" href="#coroutines-not-leaking-context-changes-by-default">Coroutines not leaking context changes by default</a> section.</p>
<p>The <a class="reference internal" href="#high-level-specification">High-Level Specification</a> section was also updated
(specifically Generators and Coroutines subsections).</p>
</li>
<li><p>All APIs have been placed to the <code class="docutils literal notranslate"><span class="pre">contextvars</span></code> module, and
the factory functions were changed to class constructors
(<code class="docutils literal notranslate"><span class="pre">ContextVar</span></code>, <code class="docutils literal notranslate"><span class="pre">ExecutionContext</span></code>, and <code class="docutils literal notranslate"><span class="pre">LogicalContext</span></code>).
Thanks to Nick for the idea <a class="footnote-reference brackets" href="#id61" id="id27">33</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ContextVar.lookup()</span></code> got renamed back to <code class="docutils literal notranslate"><span class="pre">ContextVar.get()</span></code>
and gained the <code class="docutils literal notranslate"><span class="pre">topmost</span></code> and <code class="docutils literal notranslate"><span class="pre">default</span></code> keyword arguments.
Added <code class="docutils literal notranslate"><span class="pre">ContextVar.delete()</span></code>.</p>
<p>See Guido’s comment in <a class="footnote-reference brackets" href="#id60" id="id28">32</a>.</p>
</li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">ExecutionContext.vars()</span></code> method.  Read about it in
the <a class="reference internal" href="#enumerating-context-vars">Enumerating context vars</a> section.</p></li>
<li><p>Fixed <code class="docutils literal notranslate"><span class="pre">ContextVar.get()</span></code> cache bug (thanks Nathaniel!).</p></li>
<li><p>New <a class="reference internal" href="#rejected-ideas">Rejected Ideas</a>,
<a class="reference internal" href="#should-yield-from-leak-context-changes">Should “yield from” leak context changes?</a>,
<a class="reference internal" href="#alternative-designs-for-contextvar-api">Alternative Designs for ContextVar API</a>,
<a class="reference internal" href="#setting-and-restoring-context-variables">Setting and restoring context variables</a>, and
<a class="reference internal" href="#context-manager-as-the-interface-for-modifications">Context manager as the interface for modifications</a> sections.</p></li>
</ul>
</li>
</ol>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id107">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id29"><span class="brackets"><a class="fn-backref" href="#id3">1</a></span></dt>
<dd><p><a class="reference external" href="https://blog.golang.org/context">https://blog.golang.org/context</a></p>
</dd>
<dt class="label" id="id30"><span class="brackets"><a class="fn-backref" href="#id4">2</a></span></dt>
<dd><p><a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.threading.executioncontext.aspx">https://msdn.microsoft.com/en-us/library/system.threading.executioncontext.aspx</a></p>
</dd>
<dt class="label" id="id31"><span class="brackets"><a class="fn-backref" href="#id2">3</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/numpy/numpy/issues/9444">https://github.com/numpy/numpy/issues/9444</a></p>
</dd>
<dt class="label" id="id32"><span class="brackets">4</span></dt>
<dd><p><a class="reference external" href="http://bugs.python.org/issue31179">http://bugs.python.org/issue31179</a></p>
</dd>
<dt class="label" id="id33"><span class="brackets"><a class="fn-backref" href="#id6">5</a></span></dt>
<dd><p><a class="reference external" href="https://en.wikipedia.org/wiki/Hash_array_mapped_trie">https://en.wikipedia.org/wiki/Hash_array_mapped_trie</a></p>
</dd>
<dt class="label" id="id34"><span class="brackets"><a class="fn-backref" href="#id7">6</a></span></dt>
<dd><p><a class="reference external" href="http://blog.higher-order.net/2010/08/16/assoc-and-clojures-persistenthashmap-part-ii.html">http://blog.higher-order.net/2010/08/16/assoc-and-clojures-persistenthashmap-part-ii.html</a></p>
</dd>
<dt class="label" id="id35"><span class="brackets"><a class="fn-backref" href="#id15">7</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/1st1/cpython/tree/hamt">https://github.com/1st1/cpython/tree/hamt</a></p>
</dd>
<dt class="label" id="id36"><span class="brackets"><a class="fn-backref" href="#id14">8</a></span></dt>
<dd><p><a class="reference external" href="https://michael.steindorfer.name/publications/oopsla15.pdf">https://michael.steindorfer.name/publications/oopsla15.pdf</a></p>
</dd>
<dt class="label" id="id37"><span class="brackets"><a class="fn-backref" href="#id12">9</a></span></dt>
<dd><p><a class="reference external" href="https://gist.github.com/1st1/9004813d5576c96529527d44c5457dcd">https://gist.github.com/1st1/9004813d5576c96529527d44c5457dcd</a></p>
</dd>
<dt class="label" id="id38"><span class="brackets"><a class="fn-backref" href="#id13">10</a></span></dt>
<dd><p><a class="reference external" href="https://gist.github.com/1st1/dbe27f2e14c30cce6f0b5fddfc8c437e">https://gist.github.com/1st1/dbe27f2e14c30cce6f0b5fddfc8c437e</a></p>
</dd>
<dt class="label" id="id39"><span class="brackets">11</span></dt>
<dd><p><a class="reference external" href="https://github.com/1st1/cpython/tree/pep550">https://github.com/1st1/cpython/tree/pep550</a></p>
</dd>
<dt class="label" id="id40"><span class="brackets">12</span></dt>
<dd><p><a class="reference external" href="https://www.python.org/dev/peps/pep-0492/#async-await">https://www.python.org/dev/peps/pep-0492/#async-await</a></p>
</dd>
<dt class="label" id="id41"><span class="brackets">13</span></dt>
<dd><p><a class="reference external" href="https://github.com/MagicStack/uvloop/blob/master/examples/bench/echoserver.py">https://github.com/MagicStack/uvloop/blob/master/examples/bench/echoserver.py</a></p>
</dd>
<dt class="label" id="id42"><span class="brackets">14</span></dt>
<dd><p><a class="reference external" href="https://github.com/MagicStack/pgbench">https://github.com/MagicStack/pgbench</a></p>
</dd>
<dt class="label" id="id43"><span class="brackets">15</span></dt>
<dd><p><a class="reference external" href="https://github.com/python/performance">https://github.com/python/performance</a></p>
</dd>
<dt class="label" id="id44"><span class="brackets">16</span></dt>
<dd><p><a class="reference external" href="https://gist.github.com/1st1/6b7a614643f91ead3edf37c4451a6b4c">https://gist.github.com/1st1/6b7a614643f91ead3edf37c4451a6b4c</a></p>
</dd>
<dt class="label" id="id45"><span class="brackets"><a class="fn-backref" href="#id16">17</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-August/046752.html">https://mail.python.org/pipermail/python-ideas/2017-August/046752.html</a></p>
</dd>
<dt class="label" id="id46"><span class="brackets"><a class="fn-backref" href="#id17">18</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-August/046772.html">https://mail.python.org/pipermail/python-ideas/2017-August/046772.html</a></p>
</dd>
<dt class="label" id="id47"><span class="brackets">19</span><span class="fn-backref">(<a href="#id18">1</a>,<a href="#id21">2</a>)</span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-August/046775.html">https://mail.python.org/pipermail/python-ideas/2017-August/046775.html</a></p>
</dd>
<dt class="label" id="id48"><span class="brackets"><a class="fn-backref" href="#id19">20</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/python/peps/blob/e8a06c9a790f39451d9e99e203b13b3ad73a1d01/pep-0550.rst">https://github.com/python/peps/blob/e8a06c9a790f39451d9e99e203b13b3ad73a1d01/pep-0550.rst</a></p>
</dd>
<dt class="label" id="id49"><span class="brackets"><a class="fn-backref" href="#id20">21</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/python/peps/blob/e3aa3b2b4e4e9967d28a10827eed1e9e5960c175/pep-0550.rst">https://github.com/python/peps/blob/e3aa3b2b4e4e9967d28a10827eed1e9e5960c175/pep-0550.rst</a></p>
</dd>
<dt class="label" id="id50"><span class="brackets"><a class="fn-backref" href="#id22">22</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/python/peps/blob/287ed87bb475a7da657f950b353c71c1248f67e7/pep-0550.rst">https://github.com/python/peps/blob/287ed87bb475a7da657f950b353c71c1248f67e7/pep-0550.rst</a></p>
</dd>
<dt class="label" id="id51"><span class="brackets"><a class="fn-backref" href="#id23">23</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-August/046801.html">https://mail.python.org/pipermail/python-ideas/2017-August/046801.html</a></p>
</dd>
<dt class="label" id="id52"><span class="brackets"><a class="fn-backref" href="#id25">24</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-August/046790.html">https://mail.python.org/pipermail/python-ideas/2017-August/046790.html</a></p>
</dd>
<dt class="label" id="id53"><span class="brackets"><a class="fn-backref" href="#id24">25</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-August/046786.html">https://mail.python.org/pipermail/python-ideas/2017-August/046786.html</a></p>
</dd>
<dt class="label" id="id54"><span class="brackets"><a class="fn-backref" href="#id10">26</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-August/046888.html">https://mail.python.org/pipermail/python-ideas/2017-August/046888.html</a></p>
</dd>
<dt class="label" id="id55"><span class="brackets"><a class="fn-backref" href="#id11">27</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2017-August/046889.html">https://mail.python.org/pipermail/python-ideas/2017-August/046889.html</a></p>
</dd>
<dt class="label" id="id56"><span class="brackets"><a class="fn-backref" href="#id1">28</a></span></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/library/decimal.html#decimal.Context.abs">https://docs.python.org/3/library/decimal.html#decimal.Context.abs</a></p>
</dd>
<dt class="label" id="id57"><span class="brackets"><a class="fn-backref" href="#id8">29</a></span></dt>
<dd><p><a class="reference external" href="https://curio.readthedocs.io/en/latest/reference.html#task-local-storage">https://curio.readthedocs.io/en/latest/reference.html#task-local-storage</a></p>
</dd>
<dt class="label" id="id58"><span class="brackets"><a class="fn-backref" href="#id9">30</a></span></dt>
<dd><p><a class="reference external" href="https://docs.atlassian.com/aiolocals/latest/usage.html">https://docs.atlassian.com/aiolocals/latest/usage.html</a></p>
</dd>
<dt class="label" id="id59"><span class="brackets"><a class="fn-backref" href="#id26">31</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/python/peps/blob/1b8728ded7cde9df0f9a24268574907fafec6d5e/pep-0550.rst">https://github.com/python/peps/blob/1b8728ded7cde9df0f9a24268574907fafec6d5e/pep-0550.rst</a></p>
</dd>
<dt class="label" id="id60"><span class="brackets"><a class="fn-backref" href="#id28">32</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-August/149020.html">https://mail.python.org/pipermail/python-dev/2017-August/149020.html</a></p>
</dd>
<dt class="label" id="id61"><span class="brackets"><a class="fn-backref" href="#id27">33</a></span></dt>
<dd><p><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-August/149043.html">https://mail.python.org/pipermail/python-dev/2017-August/149043.html</a></p>
</dd>
</dl>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#id108">Copyright</a><a class="headerlink" href="#copyright" title="Permalink to this headline">¶</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<span>Source: <a class="reference external" href="https://github.com/python/peps/blob/master/pep-0550.rst">https://github.com/python/peps/blob/master/pep-0550.rst</a></span><div class="zero-height line"><br /></div>
<span>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/master/pep-0550.rst">2021-06-28T11:16:08Z</a></span>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../contents/">PEPs</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">PEP Table of Contents (needed for Sphinx):</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pep-0000/">PEP 0 – Index of Python Enhancement Proposals (PEPs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0001/">PEP 1 – PEP Purpose and Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0002/">PEP 2 – Procedure for Adding New Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0003/">PEP 3 – Guidelines for Handling Bug Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0004/">PEP 4 – Deprecation of Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0005/">PEP 5 – Guidelines for Language Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0006/">PEP 6 – Bug Fix Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0007/">PEP 7 – Style Guide for C Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0008/">PEP 8 – Style Guide for Python Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0009/">PEP 9 – Sample Plaintext PEP Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0010/">PEP 10 – Voting Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0011/">PEP 11 – Removing support for little used platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0012/">PEP 12 – Sample reStructuredText PEP Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0013/">PEP 13 – Python Language Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0020/">PEP 20 – The Zen of Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0042/">PEP 42 – Feature Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0100/">PEP 100 – Python Unicode Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0101/">PEP 101 – Doing Python Releases 101</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0102/">PEP 102 – Doing Python Micro Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0103/">PEP 103 – Collecting information about git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0160/">PEP 160 – Python 1.6 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0200/">PEP 200 – Python 2.0 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0201/">PEP 201 – Lockstep Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0202/">PEP 202 – List Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0203/">PEP 203 – Augmented Assignments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0204/">PEP 204 – Range Literals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0205/">PEP 205 – Weak References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0206/">PEP 206 – Python Advanced Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0207/">PEP 207 – Rich Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0208/">PEP 208 – Reworking the Coercion Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0209/">PEP 209 – Multi-dimensional Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0210/">PEP 210 – Decoupling the Interpreter Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0211/">PEP 211 – Adding A New Outer Product Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0212/">PEP 212 – Loop Counter Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0213/">PEP 213 – Attribute Access Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0214/">PEP 214 – Extended Print Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0215/">PEP 215 – String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0216/">PEP 216 – Docstring Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0217/">PEP 217 – Display Hook for Interactive Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0218/">PEP 218 – Adding a Built-In Set Object Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0219/">PEP 219 – Stackless Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0220/">PEP 220 – Coroutines, Generators, Continuations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0221/">PEP 221 – Import As</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0222/">PEP 222 – Web Library Enhancements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0223/">PEP 223 – Change the Meaning of ``\x`` Escapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0224/">PEP 224 – Attribute Docstrings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0225/">PEP 225 – Elementwise/Objectwise Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0226/">PEP 226 – Python 2.1 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0227/">PEP 227 – Statically Nested Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0228/">PEP 228 – Reworking Python’s Numeric Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0229/">PEP 229 – Using Distutils to Build Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0230/">PEP 230 – Warning Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0231/">PEP 231 – __findattr__()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0232/">PEP 232 – Function Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0233/">PEP 233 – Python Online Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0234/">PEP 234 – Iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0235/">PEP 235 – Import on Case-Insensitive Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0236/">PEP 236 – Back to the __future__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0237/">PEP 237 – Unifying Long Integers and Integers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0238/">PEP 238 – Changing the Division Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0239/">PEP 239 – Adding a Rational Type to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0240/">PEP 240 – Adding a Rational Literal to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0241/">PEP 241 – Metadata for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0242/">PEP 242 – Numeric Kinds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0243/">PEP 243 – Module Repository Upload Mechanism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0244/">PEP 244 – The ``directive`` statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0245/">PEP 245 – Python Interface Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0246/">PEP 246 – Object Adaptation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0247/">PEP 247 – API for Cryptographic Hash Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0248/">PEP 248 – Python Database API Specification v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0249/">PEP 249 – Python Database API Specification v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0250/">PEP 250 – Using site-packages on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0251/">PEP 251 – Python 2.2 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0252/">PEP 252 – Making Types Look More Like Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0253/">PEP 253 – Subtyping Built-in Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0254/">PEP 254 – Making Classes Look More Like Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0255/">PEP 255 – Simple Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0256/">PEP 256 – Docstring Processing System Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0257/">PEP 257 – Docstring Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0258/">PEP 258 – Docutils Design Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0259/">PEP 259 – Omit printing newline after newline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0260/">PEP 260 – Simplify xrange()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0261/">PEP 261 – Support for “wide” Unicode characters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0262/">PEP 262 – A Database of Installed Python Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0263/">PEP 263 – Defining Python Source Code Encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0264/">PEP 264 – Future statements in simulated shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0265/">PEP 265 – Sorting Dictionaries by Value</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0266/">PEP 266 – Optimizing Global Variable/Attribute Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0267/">PEP 267 – Optimized Access to Module Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0268/">PEP 268 – Extended HTTP functionality and WebDAV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0269/">PEP 269 – Pgen Module for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0270/">PEP 270 – uniq method for list objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0271/">PEP 271 – Prefixing sys.path by command line option</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0272/">PEP 272 – API for Block Encryption Algorithms v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0273/">PEP 273 – Import Modules from Zip Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0274/">PEP 274 – Dict Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0275/">PEP 275 – Switching on Multiple Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0276/">PEP 276 – Simple Iterator for ints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0277/">PEP 277 – Unicode file name support for Windows NT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0278/">PEP 278 – Universal Newline Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0279/">PEP 279 – The enumerate() built-in function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0280/">PEP 280 – Optimizing access to globals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0281/">PEP 281 – Loop Counter Iteration with range and xrange</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0282/">PEP 282 – A Logging System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0283/">PEP 283 – Python 2.3 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0284/">PEP 284 – Integer for-loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0285/">PEP 285 – Adding a bool type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0286/">PEP 286 – Enhanced Argument Tuples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0287/">PEP 287 – reStructuredText Docstring Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0288/">PEP 288 – Generators Attributes and Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0289/">PEP 289 – Generator Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0290/">PEP 290 – Code Migration and Modernization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0291/">PEP 291 – Backward Compatibility for the Python 2 Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0292/">PEP 292 – Simpler String Substitutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0293/">PEP 293 – Codec Error Handling Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0294/">PEP 294 – Type Names in the types Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0295/">PEP 295 – Interpretation of multiline string constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0296/">PEP 296 – Adding a bytes Object Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0297/">PEP 297 – Support for System Upgrades</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0298/">PEP 298 – The Locked Buffer Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0299/">PEP 299 – Special __main__() function in modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0301/">PEP 301 – Package Index and Metadata for Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0302/">PEP 302 – New Import Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0303/">PEP 303 – Extend divmod() for Multiple Divisors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0304/">PEP 304 – Controlling Generation of Bytecode Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0305/">PEP 305 – CSV File API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0306/">PEP 306 – How to Change Python’s Grammar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0307/">PEP 307 – Extensions to the pickle protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0308/">PEP 308 – Conditional Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0309/">PEP 309 – Partial Function Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0310/">PEP 310 – Reliable Acquisition/Release Pairs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0311/">PEP 311 – Simplified Global Interpreter Lock Acquisition for Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0312/">PEP 312 – Simple Implicit Lambda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0313/">PEP 313 – Adding Roman Numeral Literals to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0314/">PEP 314 – Metadata for Python Software Packages v1.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0315/">PEP 315 – Enhanced While Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0316/">PEP 316 – Programming by Contract for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0317/">PEP 317 – Eliminate Implicit Exception Instantiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0318/">PEP 318 – Decorators for Functions and Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0319/">PEP 319 – Python Synchronize/Asynchronize Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0320/">PEP 320 – Python 2.4 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0321/">PEP 321 – Date/Time Parsing and Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0322/">PEP 322 – Reverse Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0323/">PEP 323 – Copyable Iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0324/">PEP 324 – subprocess - New process module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0325/">PEP 325 – Resource-Release Support for Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0326/">PEP 326 – A Case for Top and Bottom Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0327/">PEP 327 – Decimal Data Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0328/">PEP 328 – Imports: Multi-Line and Absolute/Relative</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0329/">PEP 329 – Treating Builtins as Constants in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0330/">PEP 330 – Python Bytecode Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0331/">PEP 331 – Locale-Independent Float/String Conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0332/">PEP 332 – Byte vectors and String/Unicode Unification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0333/">PEP 333 – Python Web Server Gateway Interface v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0334/">PEP 334 – Simple Coroutines via SuspendIteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0335/">PEP 335 – Overloadable Boolean Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0336/">PEP 336 – Make None Callable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0337/">PEP 337 – Logging Usage in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0338/">PEP 338 – Executing modules as scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0339/">PEP 339 – Design of the CPython Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0340/">PEP 340 – Anonymous Block Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0341/">PEP 341 – Unifying try-except and try-finally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0342/">PEP 342 – Coroutines via Enhanced Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0343/">PEP 343 – The “with” Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0344/">PEP 344 – Exception Chaining and Embedded Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0345/">PEP 345 – Metadata for Python Software Packages 1.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0346/">PEP 346 – User Defined (“``with``”) Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0347/">PEP 347 – Migrating the Python CVS to Subversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0348/">PEP 348 – Exception Reorganization for Python 3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0349/">PEP 349 – Allow str() to return unicode strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0350/">PEP 350 – Codetags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0351/">PEP 351 – The freeze protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0352/">PEP 352 – Required Superclass for Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0353/">PEP 353 – Using ssize_t as the index type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0354/">PEP 354 – Enumerations in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0355/">PEP 355 – Path - Object oriented filesystem paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0356/">PEP 356 – Python 2.5 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0357/">PEP 357 – Allowing Any Object to be Used for Slicing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0358/">PEP 358 – The “bytes” Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0359/">PEP 359 – The “make” Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0360/">PEP 360 – Externally Maintained Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0361/">PEP 361 – Python 2.6 and 3.0 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0362/">PEP 362 – Function Signature Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0363/">PEP 363 – Syntax For Dynamic Attribute Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0364/">PEP 364 – Transitioning to the Py3K Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0365/">PEP 365 – Adding the pkg_resources module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0366/">PEP 366 – Main module explicit relative imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0367/">PEP 367 – New Super</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0368/">PEP 368 – Standard image protocol and class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0369/">PEP 369 – Post import hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0370/">PEP 370 – Per user site-packages directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0371/">PEP 371 – Addition of the multiprocessing package to the standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0372/">PEP 372 – Adding an ordered dictionary to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0373/">PEP 373 – Python 2.7 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0374/">PEP 374 – Choosing a distributed VCS for the Python project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0375/">PEP 375 – Python 3.1 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0376/">PEP 376 – Database of Installed Python Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0377/">PEP 377 – Allow __enter__() methods to skip the statement body</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0378/">PEP 378 – Format Specifier for Thousands Separator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0379/">PEP 379 – Adding an Assignment Expression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0380/">PEP 380 – Syntax for Delegating to a Subgenerator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0381/">PEP 381 – Mirroring infrastructure for PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0382/">PEP 382 – Namespace Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0383/">PEP 383 – Non-decodable Bytes in System Character Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0384/">PEP 384 – Defining a Stable ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0385/">PEP 385 – Migrating from Subversion to Mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0386/">PEP 386 – Changing the version comparison module in Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0387/">PEP 387 – Backwards Compatibility Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0389/">PEP 389 – argparse - New Command Line Parsing Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0390/">PEP 390 – Static metadata for Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0391/">PEP 391 – Dictionary-Based Configuration For Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0392/">PEP 392 – Python 3.2 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0393/">PEP 393 – Flexible String Representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0394/">PEP 394 – The “python” Command on Unix-Like Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0395/">PEP 395 – Qualified Names for Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0396/">PEP 396 – Module Version Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0397/">PEP 397 – Python launcher for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0398/">PEP 398 – Python 3.3 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0399/">PEP 399 – Pure Python/C Accelerator Module Compatibility Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0400/">PEP 400 – Deprecate codecs.StreamReader and codecs.StreamWriter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0401/">PEP 401 – BDFL Retirement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0402/">PEP 402 – Simplified Package Layout and Partitioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0403/">PEP 403 – General purpose decorator clause (aka “&#64;in” clause)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0404/">PEP 404 – Python 2.8 Un-release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0405/">PEP 405 – Python Virtual Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0406/">PEP 406 – Improved Encapsulation of Import State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0407/">PEP 407 – New release cycle and introducing long-term support versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0408/">PEP 408 – Standard library __preview__ package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0409/">PEP 409 – Suppressing exception context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0410/">PEP 410 – Use decimal.Decimal type for timestamps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0411/">PEP 411 – Provisional packages in the Python standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0412/">PEP 412 – Key-Sharing Dictionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0413/">PEP 413 – Faster evolution of the Python Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0414/">PEP 414 – Explicit Unicode Literal for Python 3.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0415/">PEP 415 – Implement context suppression with exception attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0416/">PEP 416 – Add a frozendict builtin type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0417/">PEP 417 – Including mock in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0418/">PEP 418 – Add monotonic time, performance counter, and process time functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0419/">PEP 419 – Protecting cleanup statements from interruptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0420/">PEP 420 – Implicit Namespace Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0421/">PEP 421 – Adding sys.implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0422/">PEP 422 – Simpler customisation of class creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0423/">PEP 423 – Naming conventions and recipes related to packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0424/">PEP 424 – A method for exposing a length hint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0425/">PEP 425 – Compatibility Tags for Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0426/">PEP 426 – Metadata for Python Software Packages 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0427/">PEP 427 – The Wheel Binary Package Format 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0428/">PEP 428 – The pathlib module – object-oriented filesystem paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0429/">PEP 429 – Python 3.4 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0430/">PEP 430 – Migrating to Python 3 as the default online documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0431/">PEP 431 – Time zone support improvements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0432/">PEP 432 – Restructuring the CPython startup sequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0433/">PEP 433 – Easier suppression of file descriptor inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0434/">PEP 434 – IDLE Enhancement Exception for All Branches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0435/">PEP 435 – Adding an Enum type to the Python standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0436/">PEP 436 – The Argument Clinic DSL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0437/">PEP 437 – A DSL for specifying signatures, annotations and argument converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0438/">PEP 438 – Transitioning to release-file hosting on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0439/">PEP 439 – Inclusion of implicit pip bootstrap in Python installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0440/">PEP 440 – Version Identification and Dependency Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0441/">PEP 441 – Improving Python ZIP Application Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0442/">PEP 442 – Safe object finalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0443/">PEP 443 – Single-dispatch generic functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0444/">PEP 444 – Python Web3 Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0445/">PEP 445 – Add new APIs to customize Python memory allocators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0446/">PEP 446 – Make newly created file descriptors non-inheritable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0447/">PEP 447 – Add __getdescriptor__ method to metaclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0448/">PEP 448 – Additional Unpacking Generalizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0449/">PEP 449 – Removal of the PyPI Mirror Auto Discovery and Naming Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0450/">PEP 450 – Adding A Statistics Module To The Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0451/">PEP 451 – A ModuleSpec Type for the Import System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0452/">PEP 452 – API for Cryptographic Hash Functions v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0453/">PEP 453 – Explicit bootstrapping of pip in Python installations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0454/">PEP 454 – Add a new tracemalloc module to trace Python memory allocations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0455/">PEP 455 – Adding a key-transforming dictionary to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0456/">PEP 456 – Secure and interchangeable hash algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0457/">PEP 457 – Notation For Positional-Only Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0458/">PEP 458 – Secure PyPI downloads with signed repository metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0459/">PEP 459 – Standard Metadata Extensions for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0460/">PEP 460 – Add binary interpolation and formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0461/">PEP 461 – Adding % formatting to bytes and bytearray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0462/">PEP 462 – Core development workflow automation for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0463/">PEP 463 – Exception-catching expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0464/">PEP 464 – Removal of the PyPI Mirror Authenticity API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0465/">PEP 465 – A dedicated infix operator for matrix multiplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0466/">PEP 466 – Network Security Enhancements for Python 2.7.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0467/">PEP 467 – Minor API improvements for binary sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0468/">PEP 468 – Preserving the order of \*\*kwargs in a function.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0469/">PEP 469 – Migration of dict iteration code to Python 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0470/">PEP 470 – Removing External Hosting Support on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0471/">PEP 471 – os.scandir() function – a better and faster directory iterator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0472/">PEP 472 – Support for indexing with keyword arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0473/">PEP 473 – Adding structured data to built-in exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0474/">PEP 474 – Creating forge.python.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0475/">PEP 475 – Retry system calls failing with EINTR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0476/">PEP 476 – Enabling certificate verification by default for stdlib http clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0477/">PEP 477 – Backport ensurepip (PEP 453) to Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0478/">PEP 478 – Python 3.5 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0479/">PEP 479 – Change StopIteration handling inside generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0480/">PEP 480 – Surviving a Compromise of PyPI: End-to-end signing of packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0481/">PEP 481 – Migrate CPython to Git, Github, and Phabricator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0482/">PEP 482 – Literature Overview for Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0483/">PEP 483 – The Theory of Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0484/">PEP 484 – Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0485/">PEP 485 – A Function for testing approximate equality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0486/">PEP 486 – Make the Python Launcher aware of virtual environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0487/">PEP 487 – Simpler customisation of class creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0488/">PEP 488 – Elimination of PYO files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0489/">PEP 489 – Multi-phase extension module initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0490/">PEP 490 – Chain exceptions at C level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0491/">PEP 491 – The Wheel Binary Package Format 1.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0492/">PEP 492 – Coroutines with async and await syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0493/">PEP 493 – HTTPS verification migration tools for Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0494/">PEP 494 – Python 3.6 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0495/">PEP 495 – Local Time Disambiguation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0496/">PEP 496 – Environment Markers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0497/">PEP 497 – A standard mechanism for backward compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0498/">PEP 498 – Literal String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0499/">PEP 499 – ``python -m foo`` should bind ``sys.modules[‘foo’]`` in addition to ``sys.modules[‘__main__’]``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0500/">PEP 500 – A protocol for delegating datetime methods to their
tzinfo implementations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0501/">PEP 501 – General purpose string interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0502/">PEP 502 – String Interpolation - Extended Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0503/">PEP 503 – Simple Repository API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0504/">PEP 504 – Using the System RNG by default</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0505/">PEP 505 – None-aware operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0506/">PEP 506 – Adding A Secrets Module To The Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0507/">PEP 507 – Migrate CPython to Git and GitLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0508/">PEP 508 – Dependency specification for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0509/">PEP 509 – Add a private version to dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0510/">PEP 510 – Specialize functions with guards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0511/">PEP 511 – API for code transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0512/">PEP 512 – Migrating from hg.python.org to GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0513/">PEP 513 – A Platform Tag for Portable Linux Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0514/">PEP 514 – Python registration in the Windows registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0515/">PEP 515 – Underscores in Numeric Literals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0516/">PEP 516 – Build system abstraction for pip/conda etc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0517/">PEP 517 – A build-system independent format for source trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0518/">PEP 518 – Specifying Minimum Build System Requirements for Python Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0519/">PEP 519 – Adding a file system path protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0520/">PEP 520 – Preserving Class Attribute Definition Order</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0521/">PEP 521 – Managing global context via ‘with’ blocks in generators and coroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0522/">PEP 522 – Allow BlockingIOError in security sensitive APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0523/">PEP 523 – Adding a frame evaluation API to CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0524/">PEP 524 – Make os.urandom() blocking on Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0525/">PEP 525 – Asynchronous Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0526/">PEP 526 – Syntax for Variable Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0527/">PEP 527 – Removing Un(der)used file types/extensions on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0528/">PEP 528 – Change Windows console encoding to UTF-8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0529/">PEP 529 – Change Windows filesystem encoding to UTF-8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0530/">PEP 530 – Asynchronous Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0531/">PEP 531 – Existence checking operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0532/">PEP 532 – A circuit breaking protocol and binary operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0533/">PEP 533 – Deterministic cleanup for iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0534/">PEP 534 – Improved Errors for Missing Standard Library Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0535/">PEP 535 – Rich comparison chaining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0536/">PEP 536 – Final Grammar for Literal String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0537/">PEP 537 – Python 3.7 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0538/">PEP 538 – Coercing the legacy C locale to a UTF-8 based locale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0539/">PEP 539 – A New C-API for Thread-Local Storage in CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0540/">PEP 540 – Add a new UTF-8 Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0541/">PEP 541 – Package Index Name Retention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0542/">PEP 542 – Dot Notation Assignment In Function Header</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0543/">PEP 543 – A Unified TLS API for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0544/">PEP 544 – Protocols: Structural subtyping (static duck typing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0545/">PEP 545 – Python Documentation Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0546/">PEP 546 – Backport ssl.MemoryBIO and ssl.SSLObject to Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0547/">PEP 547 – Running extension modules using the -m option</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0548/">PEP 548 – More Flexible Loop Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0549/">PEP 549 – Instance Descriptors</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PEP 550 – Execution Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0551/">PEP 551 – Security transparency in the Python runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0552/">PEP 552 – Deterministic pycs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0553/">PEP 553 – Built-in breakpoint()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0554/">PEP 554 – Multiple Interpreters in the Stdlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0555/">PEP 555 – Context-local variables (contextvars)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0556/">PEP 556 – Threaded garbage collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0557/">PEP 557 – Data Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0558/">PEP 558 – Defined semantics for locals()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0559/">PEP 559 – Built-in noop()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0560/">PEP 560 – Core support for typing module and generic types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0561/">PEP 561 – Distributing and Packaging Type Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0562/">PEP 562 – Module __getattr__ and __dir__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0563/">PEP 563 – Postponed Evaluation of Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0564/">PEP 564 – Add new time functions with nanosecond resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0565/">PEP 565 – Show DeprecationWarning in __main__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0566/">PEP 566 – Metadata for Python Software Packages 2.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0567/">PEP 567 – Context Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0568/">PEP 568 – Generator-sensitivity for Context Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0569/">PEP 569 – Python 3.8 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0570/">PEP 570 – Python Positional-Only Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0571/">PEP 571 – The manylinux2010 Platform Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0572/">PEP 572 – Assignment Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0573/">PEP 573 – Module State Access from C Extension Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0574/">PEP 574 – Pickle protocol 5 with out-of-band data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0575/">PEP 575 – Unifying function/method classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0576/">PEP 576 – Rationalize Built-in function classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0577/">PEP 577 – Augmented Assignment Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0578/">PEP 578 – Python Runtime Audit Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0579/">PEP 579 – Refactoring C functions and methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0580/">PEP 580 – The C call protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0581/">PEP 581 – Using GitHub Issues for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0582/">PEP 582 – Python local packages directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0583/">PEP 583 – A Concurrency Memory Model for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0584/">PEP 584 – Add Union Operators To dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0585/">PEP 585 – Type Hinting Generics In Standard Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0586/">PEP 586 – Literal Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0587/">PEP 587 – Python Initialization Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0588/">PEP 588 – GitHub Issues Migration Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0589/">PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0590/">PEP 590 – Vectorcall: a fast calling protocol for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0591/">PEP 591 – Adding a final qualifier to typing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0592/">PEP 592 – Adding “Yank” Support to the Simple API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0593/">PEP 593 – Flexible function and variable annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0594/">PEP 594 – Removing dead batteries from the standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0595/">PEP 595 – Improving bugs.python.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0596/">PEP 596 – Python 3.9 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0597/">PEP 597 – Add optional EncodingWarning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0598/">PEP 598 – Introducing incremental feature releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0599/">PEP 599 – The manylinux2014 Platform Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0600/">PEP 600 – Future ‘manylinux’ Platform Tags for Portable Linux Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0601/">PEP 601 – Forbid return/break/continue breaking out of finally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0602/">PEP 602 – Annual Release Cycle for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0603/">PEP 603 – Adding a frozenmap type to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0604/">PEP 604 – Allow writing union types as ``X | Y``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0605/">PEP 605 – A rolling feature release stream for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0606/">PEP 606 – Python Compatibility Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0607/">PEP 607 – Reducing CPython’s Feature Delivery Latency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0608/">PEP 608 – Coordinated Python release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0609/">PEP 609 – PyPA Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0610/">PEP 610 – Recording the Direct URL Origin of installed distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0611/">PEP 611 – The one million limit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0612/">PEP 612 – Parameter Specification Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0613/">PEP 613 – Explicit Type Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0614/">PEP 614 – Relaxing Grammar Restrictions On Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0615/">PEP 615 – Support for the IANA Time Zone Database in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0616/">PEP 616 – String methods to remove prefixes and suffixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0617/">PEP 617 – New PEG parser for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0618/">PEP 618 – Add Optional Length-Checking To zip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0619/">PEP 619 – Python 3.10 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0620/">PEP 620 – Hide implementation details from the C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0621/">PEP 621 – Storing project metadata in pyproject.toml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0622/">PEP 622 – Structural Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0623/">PEP 623 – Remove wstr from Unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0624/">PEP 624 – Remove Py_UNICODE encoder APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0625/">PEP 625 – File name of a Source Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0626/">PEP 626 – Precise line numbers for debugging and other tools.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0627/">PEP 627 – Recording installed projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0628/">PEP 628 – Add ``math.tau``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0629/">PEP 629 – Versioning PyPI’s Simple API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0630/">PEP 630 – Isolating Extension Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0631/">PEP 631 – Dependency specification in pyproject.toml based on PEP 508</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0632/">PEP 632 – Deprecate distutils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0633/">PEP 633 – Dependency specification in pyproject.toml using an exploded TOML table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0634/">PEP 634 – Structural Pattern Matching: Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0635/">PEP 635 – Structural Pattern Matching: Motivation and Rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0636/">PEP 636 – Structural Pattern Matching: Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0637/">PEP 637 – Support for indexing with keyword arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0638/">PEP 638 – Syntactic Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0639/">PEP 639 – Metadata for Python Software Packages 2.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0640/">PEP 640 – Unused variable syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0641/">PEP 641 – Using an underscore in the version portion of Python 3.10 compatibility tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0642/">PEP 642 – Explicit Pattern Syntax for Structural Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0643/">PEP 643 – Metadata for Package Source Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0644/">PEP 644 – Require OpenSSL 1.1.1 or newer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0645/">PEP 645 – Allow writing optional types as ``x?``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0646/">PEP 646 – Variadic Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0647/">PEP 647 – User-Defined Type Guards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0648/">PEP 648 – Extensible customizations of the interpreter at startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0649/">PEP 649 – Deferred Evaluation Of Annotations Using Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0650/">PEP 650 – Specifying Installer Requirements for Python Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0651/">PEP 651 – Robust Stack Overflow Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0652/">PEP 652 – Maintaining the Stable ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0653/">PEP 653 – Precise Semantics for Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0654/">PEP 654 – Exception Groups and except*</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0655/">PEP 655 – Marking individual TypedDict items as required or potentially-missing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0656/">PEP 656 – Platform Tag for Linux Distributions Using Musl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0657/">PEP 657 – Include Fine Grained Error Locations in Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0658/">PEP 658 – Serve Distribution Metadata in the Simple Repository API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0659/">PEP 659 – Specializing Adaptive Interpreter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0660/">PEP 660 – Editable installs for pyproject.toml based builds (wheel based)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0661/">PEP 661 – Sentinel Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0662/">PEP 662 – Editable installs via virtual wheels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0666/">PEP 666 – Reject Foolish Indentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0754/">PEP 754 – IEEE 754 Floating Point Special Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0801/">PEP 801 – Reserved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3000/">PEP 3000 – Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3001/">PEP 3001 – Procedure for reviewing and improving standard library modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3002/">PEP 3002 – Procedure for Backwards-Incompatible Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3003/">PEP 3003 – Python Language Moratorium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3099/">PEP 3099 – Things that will Not Change in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3100/">PEP 3100 – Miscellaneous Python 3.0 Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3101/">PEP 3101 – Advanced String Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3102/">PEP 3102 – Keyword-Only Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3103/">PEP 3103 – A Switch/Case Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3104/">PEP 3104 – Access to Names in Outer Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3105/">PEP 3105 – Make print a function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3106/">PEP 3106 – Revamping dict.keys(), .values() and .items()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3107/">PEP 3107 – Function Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3108/">PEP 3108 – Standard Library Reorganization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3109/">PEP 3109 – Raising Exceptions in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3110/">PEP 3110 – Catching Exceptions in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3111/">PEP 3111 – Simple input built-in in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3112/">PEP 3112 – Bytes literals in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3113/">PEP 3113 – Removal of Tuple Parameter Unpacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3114/">PEP 3114 – Renaming iterator.next() to iterator.__next__()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3115/">PEP 3115 – Metaclasses in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3116/">PEP 3116 – New I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3117/">PEP 3117 – Postfix type declarations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3118/">PEP 3118 – Revising the buffer protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3119/">PEP 3119 – Introducing Abstract Base Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3120/">PEP 3120 – Using UTF-8 as the default source encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3121/">PEP 3121 – Extension Module Initialization and Finalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3122/">PEP 3122 – Delineation of the main module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3123/">PEP 3123 – Making PyObject_HEAD conform to standard C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3124/">PEP 3124 – Overloading, Generic Functions, Interfaces, and Adaptation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3125/">PEP 3125 – Remove Backslash Continuation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3126/">PEP 3126 – Remove Implicit String Concatenation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3127/">PEP 3127 – Integer Literal Support and Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3128/">PEP 3128 – BList: A Faster List-like Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3129/">PEP 3129 – Class Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3130/">PEP 3130 – Access to Current Module/Class/Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3131/">PEP 3131 – Supporting Non-ASCII Identifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3132/">PEP 3132 – Extended Iterable Unpacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3133/">PEP 3133 – Introducing Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3134/">PEP 3134 – Exception Chaining and Embedded Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3135/">PEP 3135 – New Super</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3136/">PEP 3136 – Labeled break and continue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3137/">PEP 3137 – Immutable Bytes and Mutable Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3138/">PEP 3138 – String representation in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3139/">PEP 3139 – Cleaning out sys and the “interpreter” module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3140/">PEP 3140 – str(container) should call str(item), not repr(item)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3141/">PEP 3141 – A Type Hierarchy for Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3142/">PEP 3142 – Add a “while” clause to generator expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3143/">PEP 3143 – Standard daemon process library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3144/">PEP 3144 – IP Address Manipulation Library for the Python Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3145/">PEP 3145 – Asynchronous I/O For subprocess.Popen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3146/">PEP 3146 – Merging Unladen Swallow into CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3147/">PEP 3147 – PYC Repository Directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3148/">PEP 3148 – futures - execute computations asynchronously</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3149/">PEP 3149 – ABI version tagged .so files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3150/">PEP 3150 – Statement local namespaces (aka “given” clause)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3151/">PEP 3151 – Reworking the OS and IO exception hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3152/">PEP 3152 – Cofunctions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3153/">PEP 3153 – Asynchronous IO support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3154/">PEP 3154 – Pickle protocol version 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3155/">PEP 3155 – Qualified name for classes and functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3156/">PEP 3156 – Asynchronous IO Support Rebooted: the “asyncio” Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3333/">PEP 3333 – Python Web Server Gateway Interface v1.0.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8000/">PEP 8000 – Python Language Governance Proposal Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8001/">PEP 8001 – Python Governance Voting Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8002/">PEP 8002 – Open Source Governance Survey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8010/">PEP 8010 – The Technical Leader Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8011/">PEP 8011 – Python Governance Model Lead by Trio of Pythonistas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8012/">PEP 8012 – The Community Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8013/">PEP 8013 – The External Council Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8014/">PEP 8014 – The Commons Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8015/">PEP 8015 – Organization of the Python community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8016/">PEP 8016 – The Steering Council Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8100/">PEP 8100 – January 2019 steering council election</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8101/">PEP 8101 – 2020 Term steering council election</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8102/">PEP 8102 – 2021 Term steering council election</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../contents/">Documentation overview</a><ul>
      <li>Previous: <a href="../pep-0549/" title="previous chapter">PEP 549 – Instance Descriptors</a></li>
      <li>Next: <a href="../pep-0551/" title="next chapter">PEP 551 – Security transparency in the Python runtime</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/pep-0550.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>