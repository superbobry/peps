
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PEP 538 – Coercing the legacy C locale to a UTF-8 based locale &#8212; peps.python.org</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="PEP 539 – A New C-API for Thread-Local Storage in CPython" href="../pep-0539/" />
    <link rel="prev" title="PEP 537 – Python 3.7 Release Schedule" href="../pep-0537/" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pep-538-coercing-the-legacy-c-locale-to-a-utf-8-based-locale">
<h1 class="page-title">PEP 538 – Coercing the legacy C locale to a UTF-8 based locale<a class="headerlink" href="#pep-538-coercing-the-legacy-c-locale-to-a-utf-8-based-locale" title="Permalink to this headline">¶</a></h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd"><p>538</p>
</dd>
<dt class="field-even">Title</dt>
<dd class="field-even"><p>Coercing the legacy C locale to a UTF-8 based locale</p>
</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Nick Coghlan &lt;<a class="reference external" href="mailto:ncoghlan&#37;&#52;&#48;gmail&#46;com?subject=PEP%20-1">ncoghlan&#32;&#97;t&#32;gmail.com</a>&gt;</p>
</dd>
<dt class="field-even">BDFL-Delegate</dt>
<dd class="field-even"><p>INADA Naoki</p>
</dd>
<dt class="field-odd">Status</dt>
<dd class="field-odd"><p>Final</p>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>Standards Track</p>
</dd>
<dt class="field-odd">Created</dt>
<dd class="field-odd"><p>28-Dec-2016</p>
</dd>
<dt class="field-even">Python-Version</dt>
<dd class="field-even"><p>3.7</p>
</dd>
<dt class="field-odd">Post-History</dt>
<dd class="field-odd"><p>03-Jan-2017 (linux-sig),
07-Jan-2017 (python-ideas),
05-Mar-2017 (python-dev),
09-May-2017 (python-dev)</p>
</dd>
<dt class="field-even">Resolution</dt>
<dd class="field-even"><p><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-May/148035.html">https://mail.python.org/pipermail/python-dev/2017-May/148035.html</a></p>
</dd>
</dl>
<hr class="docutils" />
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#abstract" id="id23">Abstract</a></p></li>
<li><p><a class="reference internal" href="#implementation-notes" id="id24">Implementation Notes</a></p></li>
<li><p><a class="reference internal" href="#background" id="id25">Background</a></p></li>
<li><p><a class="reference internal" href="#relationship-with-other-peps" id="id26">Relationship with other PEPs</a></p></li>
<li><p><a class="reference internal" href="#motivation" id="id27">Motivation</a></p></li>
<li><p><a class="reference internal" href="#design-principles" id="id28">Design Principles</a></p></li>
<li><p><a class="reference internal" href="#specification" id="id29">Specification</a></p>
<ul>
<li><p><a class="reference internal" href="#legacy-c-locale-coercion-in-the-standalone-python-interpreter-binary" id="id30">Legacy C locale coercion in the standalone Python interpreter binary</a></p></li>
<li><p><a class="reference internal" href="#legacy-c-locale-warning-during-runtime-initialization" id="id31">Legacy C locale warning during runtime initialization</a></p></li>
<li><p><a class="reference internal" href="#new-build-time-configuration-options" id="id32">New build-time configuration options</a></p></li>
<li><p><a class="reference internal" href="#changes-to-the-default-error-handling-on-the-standard-streams" id="id33">Changes to the default error handling on the standard streams</a></p></li>
<li><p><a class="reference internal" href="#changes-to-locale-settings-on-android" id="id34">Changes to locale settings on Android</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#platform-support-changes" id="id35">Platform Support Changes</a></p></li>
<li><p><a class="reference internal" href="#rationale" id="id36">Rationale</a></p>
<ul>
<li><p><a class="reference internal" href="#improving-the-handling-of-the-c-locale" id="id37">Improving the handling of the C locale</a></p></li>
<li><p><a class="reference internal" href="#defaulting-to-surrogateescape-error-handling-on-the-standard-io-streams" id="id38">Defaulting to “surrogateescape” error handling on the standard IO streams</a></p></li>
<li><p><a class="reference internal" href="#avoiding-setting-pythonioencoding-during-utf-8-locale-coercion" id="id39">Avoiding setting PYTHONIOENCODING during UTF-8 locale coercion</a></p></li>
<li><p><a class="reference internal" href="#dropping-official-support-for-ascii-based-text-handling-in-the-legacy-c-locale" id="id40">Dropping official support for ASCII based text handling in the legacy C locale</a></p></li>
<li><p><a class="reference internal" href="#providing-implicit-locale-coercion-only-when-running-standalone" id="id41">Providing implicit locale coercion only when running standalone</a></p></li>
<li><p><a class="reference internal" href="#allowing-restoration-of-the-legacy-behaviour" id="id42">Allowing restoration of the legacy behaviour</a></p></li>
<li><p><a class="reference internal" href="#querying-lc-ctype-for-c-locale-detection" id="id43">Querying LC_CTYPE for C locale detection</a></p></li>
<li><p><a class="reference internal" href="#explicitly-setting-lc-ctype-for-utf-8-locale-coercion" id="id44">Explicitly setting LC_CTYPE for UTF-8 locale coercion</a></p></li>
<li><p><a class="reference internal" href="#avoiding-setting-lang-for-utf-8-locale-coercion" id="id45">Avoiding setting LANG for UTF-8 locale coercion</a></p></li>
<li><p><a class="reference internal" href="#avoiding-setting-lc-all-for-utf-8-locale-coercion" id="id46">Avoiding setting LC_ALL for UTF-8 locale coercion</a></p></li>
<li><p><a class="reference internal" href="#skipping-locale-coercion-if-lc-all-is-set-in-the-current-environment" id="id47">Skipping locale coercion if LC_ALL is set in the current environment</a></p></li>
<li><p><a class="reference internal" href="#considering-locale-coercion-independently-of-utf-8-mode" id="id48">Considering locale coercion independently of “UTF-8 mode”</a></p></li>
<li><p><a class="reference internal" href="#enabling-c-locale-coercion-and-warnings-on-mac-os-x-ios-and-android" id="id49">Enabling C locale coercion and warnings on Mac OS X, iOS and Android</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation" id="id50">Implementation</a></p></li>
<li><p><a class="reference internal" href="#backporting-to-earlier-python-3-releases" id="id51">Backporting to earlier Python 3 releases</a></p>
<ul>
<li><p><a class="reference internal" href="#backporting-to-python-3-6-x" id="id52">Backporting to Python 3.6.x</a></p></li>
<li><p><a class="reference internal" href="#backporting-to-other-3-x-releases" id="id53">Backporting to other 3.x releases</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#acknowledgements" id="id54">Acknowledgements</a></p></li>
<li><p><a class="reference internal" href="#references" id="id55">References</a></p></li>
<li><p><a class="reference internal" href="#copyright" id="id56">Copyright</a></p></li>
</ul>
</div>
<section id="abstract">
<h2><a class="toc-backref" href="#id23">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>An ongoing challenge with Python 3 on *nix systems is the conflict between
needing to use the configured locale encoding by default for consistency with
other locale-aware components in the same process or subprocesses,
and the fact that the standard C locale (as defined in POSIX:2001) typically
implies a default text encoding of ASCII, which is entirely inadequate for the
development of networked services and client applications in a multilingual
world.</p>
<p><a class="reference external" href="pep-0540.html">PEP 540</a> proposes a change to CPython’s handling of the legacy C locale such
that CPython will assume the use of UTF-8 in such environments, rather than
persisting with the demonstrably problematic assumption of ASCII as an
appropriate encoding for communicating with operating system interfaces.
This is a good approach for cases where network encoding interoperability
is a more important concern than local encoding interoperability.</p>
<p>However, it comes at the cost of making CPython’s encoding assumptions diverge
from those of other locale-aware components in the same process, as well as
those of components running in subprocesses that share the same environment.</p>
<p>This can cause interoperability problems with some extension modules (such as
GNU readline’s command line history editing), as well as with components
running in subprocesses (such as older Python runtimes).</p>
<p>It also requires non-trivial changes to the internals of how CPython itself
works, rather than relying primarily on existing configuration settings that
are supported by Python versions prior to Python 3.7.</p>
<p>Accordingly, this PEP proposes that independently of the UTF-8 mode proposed
in <a class="reference external" href="pep-0540.html">PEP 540</a>, the way the CPython implementation handles the default C locale be
changed to be roughly equivalent to the following existing configuration
settings (supported since Python 3.1):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LC_CTYPE</span><span class="o">=</span><span class="n">C</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="n">PYTHONIOENCODING</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span><span class="n">surrogateescape</span>
</pre></div>
</div>
<p>The exact target locale for coercion will be chosen from a predefined list at
runtime based on the actually available locales.</p>
<p>The reinterpreted locale settings will be written back to the environment so
they’re visible to other components in the same process and in subprocesses,
but the changed <code class="docutils literal notranslate"><span class="pre">PYTHONIOENCODING</span></code> default will be made implicit in order to
avoid causing compatibility problems with Python 2 subprocesses that don’t
provide the <code class="docutils literal notranslate"><span class="pre">surrogateescape</span></code> error handler.</p>
<p>The new legacy locale coercion behavior can be disabled either by setting
<code class="docutils literal notranslate"><span class="pre">LC_ALL</span></code> (which may still lead to a Unicode compatibility warning) or by
setting the new <code class="docutils literal notranslate"><span class="pre">PYTHONCOERCECLOCALE</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>With this change, any *nix platform that does <em>not</em> offer at least one of the
<code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code>, <code class="docutils literal notranslate"><span class="pre">C.utf8</span></code> or <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> locales as part of its standard
configuration would only be considered a fully supported platform for CPython
3.7+ deployments when a suitable locale other than the default <code class="docutils literal notranslate"><span class="pre">C</span></code> locale is
configured explicitly (e.g. <code class="docutils literal notranslate"><span class="pre">en_AU.UTF-8</span></code>, <code class="docutils literal notranslate"><span class="pre">zh_CN.gb18030</span></code>). If <a class="reference external" href="pep-0540.html">PEP 540</a> is
accepted in addition to this PEP, then pure Python modules would also be
supported when using the proposed <code class="docutils literal notranslate"><span class="pre">PYTHONUTF8</span></code> mode, but expectations for
full Unicode compatibility in extension modules would continue to be limited
to the platforms covered by this PEP.</p>
<p>As it only reflects a change in default settings rather than a fundamentally
new capability, redistributors (such as Linux distributions) with a narrower
target audience than the upstream CPython development team may also choose to
opt in to this locale coercion behaviour for the Python 3.6.x series by
applying the necessary changes as a downstream patch.</p>
</section>
<section id="implementation-notes">
<h2><a class="toc-backref" href="#id24">Implementation Notes</a><a class="headerlink" href="#implementation-notes" title="Permalink to this headline">¶</a></h2>
<p>Attempting to implement the PEP as originally accepted showed that the
proposal to emit locale coercion and compatibility warnings by default
simply wasn’t practical (there were too many cases where previously working
code failed <em>because of the warnings</em>, rather than because of latent locale
handling defects in the affected code).</p>
<p>As a result, the <code class="docutils literal notranslate"><span class="pre">PY_WARN_ON_C_LOCALE</span></code> config flag was removed, and replaced
with a runtime <code class="docutils literal notranslate"><span class="pre">PYTHONCOERCECLOCALE=warn</span></code> environment variable setting
that allows developers and system integrators to opt-in to receiving locale
coercion and compatibility warnings, without emitting them by default.</p>
<p>The output examples in the PEP itself have also been updated to remove
the warnings and make them easier to read.</p>
</section>
<section id="background">
<h2><a class="toc-backref" href="#id25">Background</a><a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>While the CPython interpreter is starting up, it may need to convert from
the <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*</span></code> format to the <code class="docutils literal notranslate"><span class="pre">wchar_t</span> <span class="pre">*</span></code> format, or from one of those formats
to <code class="docutils literal notranslate"><span class="pre">PyUnicodeObject</span> <span class="pre">*</span></code>, in a way that’s consistent with the locale settings
of the overall system. It handles these cases by relying on the operating
system to do the conversion and then ensuring that the text encoding name
reported by <code class="docutils literal notranslate"><span class="pre">sys.getfilesystemencoding()</span></code> matches the encoding used during
this early bootstrapping process.</p>
<p>On Windows, the limitations of the <code class="docutils literal notranslate"><span class="pre">mbcs</span></code> format used by default in these
conversions proved sufficiently problematic that <a class="reference external" href="pep-0528.html">PEP 528</a> and <a class="reference external" href="pep-0529.html">PEP 529</a> were
implemented to bypass the operating system supplied interfaces for binary data
handling and force the use of UTF-8 instead.</p>
<p>On Mac OS X, iOS, and Android, many components, including CPython, already
assume the use of UTF-8 as the system encoding, regardless of the locale
setting. However, this isn’t the case for all components, and the discrepancy
can cause problems in some situations (for example, when using the GNU readline
module [<a class="reference internal" href="#id16">16</a>]).</p>
<p>On non-Apple and non-Android *nix systems, these operations are handled using
the C locale system in glibc, which has the following characteristics [<a class="reference internal" href="#id4">4</a>]:</p>
<ul class="simple">
<li><p>by default, all processes start in the <code class="docutils literal notranslate"><span class="pre">C</span></code> locale, which uses <code class="docutils literal notranslate"><span class="pre">ASCII</span></code>
for these conversions. This is almost never what anyone doing multilingual
text processing actually wants (including CPython and C/C++ GUI frameworks).</p></li>
<li><p>calling <code class="docutils literal notranslate"><span class="pre">setlocale(LC_ALL,</span> <span class="pre">&quot;&quot;)</span></code> reconfigures the active locale based on
the locale categories configured in the current process environment</p></li>
<li><p>if the locale requested by the current environment is unknown, or no specific
locale is configured, then the default <code class="docutils literal notranslate"><span class="pre">C</span></code> locale will remain active</p></li>
</ul>
<p>The specific locale category that covers the APIs that CPython depends on is
<code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code>, which applies to “classification and conversion of characters,
and to multibyte and wide characters” [<a class="reference internal" href="#id5">5</a>]. Accordingly, CPython includes the
following key calls to <code class="docutils literal notranslate"><span class="pre">setlocale</span></code>:</p>
<ul class="simple">
<li><p>in the main <code class="docutils literal notranslate"><span class="pre">python</span></code> binary, CPython calls <code class="docutils literal notranslate"><span class="pre">setlocale(LC_ALL,</span> <span class="pre">&quot;&quot;)</span></code> to
configure the entire C locale subsystem according to the process environment.
It does this prior to making any calls into the shared CPython library</p></li>
<li><p>in <code class="docutils literal notranslate"><span class="pre">Py_Initialize</span></code>, CPython calls <code class="docutils literal notranslate"><span class="pre">setlocale(LC_CTYPE,</span> <span class="pre">&quot;&quot;)</span></code>, such that
the configured locale settings for that category <em>always</em> match those set in
the environment. It does this unconditionally, and it <em>doesn’t</em> revert the
process state change in <code class="docutils literal notranslate"><span class="pre">Py_Finalize</span></code></p></li>
</ul>
<p>(This summary of the locale handling omits several technical details related
to exactly where and when the text encoding declared as part of the locale
settings is used - see <a class="reference external" href="pep-0540.html">PEP 540</a> for further discussion, as these particular
details matter more when decoupling CPython from the declared C locale than
they do when overriding the locale with one based on UTF-8)</p>
<p>These calls are usually sufficient to provide sensible behaviour, but they can
still fail in the following cases:</p>
<ul class="simple">
<li><p>SSH environment forwarding means that SSH clients may sometimes forward
client locale settings to servers that don’t have that locale installed. This
leads to CPython running in the default ASCII-based C locale</p></li>
<li><p>some process environments (such as Linux containers) may not have any
explicit locale configured at all. As with unknown locales, this leads to
CPython running in the default ASCII-based C locale</p></li>
<li><p>on Android, rather than configuring the locale based on environment variables,
the empty locale <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> is treated as specifically requesting the <code class="docutils literal notranslate"><span class="pre">&quot;C&quot;</span></code>
locale</p></li>
</ul>
<p>The simplest way to deal with this problem for currently released versions of
CPython is to explicitly set a more sensible locale when launching the
application. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LC_CTYPE</span><span class="o">=</span><span class="n">C</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="n">python3</span> <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code> locale is a full locale definition that uses <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> for the
<code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> category, and the same settings as the <code class="docutils literal notranslate"><span class="pre">C</span></code> locale for all other
categories (including <code class="docutils literal notranslate"><span class="pre">LC_COLLATE</span></code>). It is offered by a number of Linux
distributions (including Debian, Ubuntu, Fedora, Alpine and Android) as an
alternative to the ASCII-based C locale. Some other platforms (such as
<code class="docutils literal notranslate"><span class="pre">HP-UX</span></code>) offer an equivalent locale definition under the name <code class="docutils literal notranslate"><span class="pre">C.utf8</span></code>.</p>
<p>Mac OS X and other *BSD systems have taken a different approach: instead of
offering a <code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code> locale, they offer a partial <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> locale that only
defines the <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> category. On such systems, the preferred
environmental locale adjustment is to set <code class="docutils literal notranslate"><span class="pre">LC_CTYPE=UTF-8</span></code> rather than to set
<code class="docutils literal notranslate"><span class="pre">LC_ALL</span></code> or <code class="docutils literal notranslate"><span class="pre">LANG</span></code>. [<a class="reference internal" href="#id17">17</a>]</p>
<p>In the specific case of Docker containers and similar technologies, the
appropriate locale setting can be specified directly in the container image
definition.</p>
<p>Another common failure case is developers specifying <code class="docutils literal notranslate"><span class="pre">LANG=C</span></code> in order to
see otherwise translated user interface messages in English, rather than the
more narrowly scoped <code class="docutils literal notranslate"><span class="pre">LC_MESSAGES=C</span></code> or <code class="docutils literal notranslate"><span class="pre">LANGUAGE=en</span></code>.</p>
</section>
<section id="relationship-with-other-peps">
<h2><a class="toc-backref" href="#id26">Relationship with other PEPs</a><a class="headerlink" href="#relationship-with-other-peps" title="Permalink to this headline">¶</a></h2>
<p>This PEP shares a common problem statement with <a class="reference external" href="pep-0540.html">PEP 540</a> (improving Python 3’s
behaviour in the default C locale), but diverges markedly in the proposed
solution:</p>
<ul class="simple">
<li><p><a class="reference external" href="pep-0540.html">PEP 540</a> proposes to entirely decouple CPython’s default text encoding from
the C locale system in that case, allowing text handling inconsistencies to
arise between CPython and other locale-aware components running in the same
process and in subprocesses. This approach aims to make CPython behave less
like a locale-aware application, and more like locale-independent language
runtimes like those for Go, Node.js (V8), and Rust</p></li>
<li><p>this PEP proposes to override the legacy C locale with a more recently
defined locale that uses UTF-8 as its default text encoding. This means that
the text encoding override will apply not only to CPython, but also to any
locale-aware extension modules loaded into the current process, as well as to
locale-aware applications invoked in subprocesses that inherit their
environment from the parent process. This approach aims to retain CPython’s
traditional strong support for integration with other locale-aware components
while also actively helping to push forward the adoption and standardisation
of the C.UTF-8 locale as a Unicode-aware replacement for the legacy C locale
in the wider C/C++ ecosystem</p></li>
</ul>
<p>After reviewing both PEPs, it became clear that they didn’t actually conflict
at a technical level, and the proposal in <a class="reference external" href="pep-0540.html">PEP 540</a> offered a superior option in
cases where no suitable locale was available, as well as offering a better
reference behaviour for platforms where the notion of a “locale encoding”
doesn’t make sense (for example, embedded systems running MicroPython rather
than the CPython reference interpreter).</p>
<p>Meanwhile, this PEP offered improved compatibility with other locale-aware
components, and an approach more amenable to being backported to Python 3.6
by downstream redistributors.</p>
<p>As a result, this PEP was amended to refer to <a class="reference external" href="pep-0540.html">PEP 540</a> as a complementary
solution that offered improved behaviour when none of the standard UTF-8 based
locales were available, as well as extending the changes in the default
settings to APIs that aren’t currently independently configurable (such as
the default encoding and error handler for <code class="docutils literal notranslate"><span class="pre">open()</span></code>).</p>
<p>The availability of <a class="reference external" href="pep-0540.html">PEP 540</a> also meant that the <code class="docutils literal notranslate"><span class="pre">LC_CTYPE=en_US.UTF-8</span></code> legacy
fallback was removed from the list of UTF-8 locales tried as a coercion target,
with the expectation being that CPython will instead rely solely on the
proposed PYTHONUTF8 mode in such cases.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#id27">Motivation</a><a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>While Linux container technologies like Docker, Kubernetes, and OpenShift are
best known for their use in web service development, the related container
formats and execution models are also being adopted for Linux command line
application development. Technologies like Gnome Flatpak [<a class="reference internal" href="#id7">7</a>] and
Ubuntu Snappy [<a class="reference internal" href="#id8">8</a>] further aim to bring these same techniques to Linux GUI
application development.</p>
<p>When using Python 3 for application development in these contexts, it isn’t
uncommon to see text encoding related errors akin to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run --rm fedora:25 python3 -c &#39;print(&quot;ℙƴ☂ℌøἤ&quot;)&#39;
Unable to decode the command from the command line:
UnicodeEncodeError: &#39;utf-8&#39; codec can&#39;t encode character &#39;\udce2&#39; in position 7: surrogates not allowed
$ docker run --rm ncoghlan/debian-python python3 -c &#39;print(&quot;ℙƴ☂ℌøἤ&quot;)&#39;
Unable to decode the command from the command line:
UnicodeEncodeError: &#39;utf-8&#39; codec can&#39;t encode character &#39;\udce2&#39; in position 7: surrogates not allowed
</pre></div>
</div>
<p>Even though the same command is likely to work fine when run locally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 -c &#39;print(&quot;ℙƴ☂ℌøἤ&quot;)&#39;
ℙƴ☂ℌøἤ
</pre></div>
</div>
<p>The source of the problem can be seen by instead running the <code class="docutils literal notranslate"><span class="pre">locale</span></code> command
in the three environments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ locale | grep -E &#39;LC_ALL|LC_CTYPE|LANG&#39;
LANG=en_AU.UTF-8
LC_CTYPE=&quot;en_AU.UTF-8&quot;
LC_ALL=
$ docker run --rm fedora:25 locale | grep -E &#39;LC_ALL|LC_CTYPE|LANG&#39;
LANG=
LC_CTYPE=&quot;POSIX&quot;
LC_ALL=
$ docker run --rm ncoghlan/debian-python locale | grep -E &#39;LC_ALL|LC_CTYPE|LANG&#39;
LANG=
LANGUAGE=
LC_CTYPE=&quot;POSIX&quot;
LC_ALL=
</pre></div>
</div>
<p>In this particular example, we can see that the host system locale is set to
“en_AU.UTF-8”, so CPython uses UTF-8 as the default text encoding. By contrast,
the base Docker images for Fedora and Debian don’t have any specific locale
set, so they use the POSIX locale by default, which is an alias for the
ASCII-based default C locale.</p>
<p>The simplest way to get Python 3 (regardless of the exact version) to behave
sensibly in Fedora and Debian based containers is to run it in the <code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code>
locale that both distros provide:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run --rm -e LC_CTYPE=C.UTF-8 fedora:25 python3 -c &#39;print(&quot;ℙƴ☂ℌøἤ&quot;)&#39;
ℙƴ☂ℌøἤ
$ docker run --rm -e LC_CTYPE=C.UTF-8 ncoghlan/debian-python python3 -c &#39;print(&quot;ℙƴ☂ℌøἤ&quot;)&#39;
ℙƴ☂ℌøἤ

$ docker run --rm -e LC_CTYPE=C.UTF-8 fedora:25 locale | grep -E &#39;LC_ALL|LC_CTYPE|LANG&#39;
LANG=
LC_CTYPE=C.UTF-8
LC_ALL=
$ docker run --rm -e LC_CTYPE=C.UTF-8 ncoghlan/debian-python locale | grep -E &#39;LC_ALL|LC_CTYPE|LANG&#39;
LANG=
LANGUAGE=
LC_CTYPE=C.UTF-8
LC_ALL=
</pre></div>
</div>
<p>The Alpine Linux based Python images provided by Docker, Inc. already use the
C.UTF-8 locale by default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run --rm python:3 python3 -c &#39;print(&quot;ℙƴ☂ℌøἤ&quot;)&#39;
ℙƴ☂ℌøἤ
$ docker run --rm python:3 locale | grep -E &#39;LC_ALL|LC_CTYPE|LANG&#39;
LANG=C.UTF-8
LANGUAGE=
LC_CTYPE=&quot;C.UTF-8&quot;
LC_ALL=
</pre></div>
</div>
<p>Similarly, for custom container images (i.e. those adding additional content on
top of a base distro image), a more suitable locale can be set in the image
definition so everything just works by default. However, it would provide a much
nicer and more consistent user experience if CPython were able to just deal
with this problem automatically rather than relying on redistributors or end
users to handle it through system configuration changes.</p>
<p>While the glibc developers are working towards making the C.UTF-8 locale
universally available for use by glibc based applications like CPython [<a class="reference internal" href="#id6">6</a>],
this unfortunately doesn’t help on platforms that ship older versions of glibc
without that feature, and also don’t provide C.UTF-8 (or an equivalent) as an
on-disk locale the way Debian and Fedora do. These platforms are considered
out of scope for this PEP - see <a class="reference external" href="pep-0540.html">PEP 540</a> for further discussion of possible
options for improving CPython’s default behaviour in such environments.</p>
</section>
<section id="design-principles">
<h2><a class="toc-backref" href="#id28">Design Principles</a><a class="headerlink" href="#design-principles" title="Permalink to this headline">¶</a></h2>
<p>The above motivation leads to the following core design principles for the
proposed solution:</p>
<ul class="simple">
<li><p>if a locale other than the default C locale is explicitly configured, we’ll
continue to respect it</p></li>
<li><p>as far as is feasible, any changes made will use <em>existing</em> configuration
options</p></li>
<li><p>Python’s runtime behaviour in potential coercion target locales should be
identical regardless of whether the locale was set explicitly in the
environment or implicitly as a locale coercion target</p></li>
<li><p>for Python 3.7, if we’re changing the locale setting without an explicit
config option, we’ll emit a warning on stderr that we’re doing so rather
than silently changing the process configuration. This will alert application
and system integrators to the change, even if they don’t closely follow the
PEP process or Python release announcements. However, to minimize the chance
of introducing new problems for end users, we’ll do this <em>without</em> using the
warnings system, so even running with <code class="docutils literal notranslate"><span class="pre">-Werror</span></code> won’t turn it into a runtime
exception. (Note: these warnings ended up being silenced by default. See the
Implementation Note above for more details)</p></li>
<li><p>for Python 3.7, any changed defaults will offer some form of explicit “off”
switch at build time, runtime, or both</p></li>
</ul>
<p>Minimizing the negative impact on systems currently correctly configured to
use GB-18030 or another partially ASCII compatible universal encoding leads to
the following design principle:</p>
<ul class="simple">
<li><p>if a UTF-8 based Linux container is run on a host that is explicitly
configured to use a non-UTF-8 encoding, and tries to exchange locally
encoded data with that host rather than exchanging explicitly UTF-8 encoded
data, CPython will endeavour to correctly round-trip host provided data that
is concatenated or split solely at common ASCII compatible code points, but
may otherwise emit nonsensical results.</p></li>
</ul>
<p>Minimizing the negative impact on systems and programs correctly configured to
use an explicit locale category like <code class="docutils literal notranslate"><span class="pre">LC_TIME</span></code>, <code class="docutils literal notranslate"><span class="pre">LC_MONETARY</span></code> or
<code class="docutils literal notranslate"><span class="pre">LC_NUMERIC</span></code> while otherwise running in the legacy C locale gives the
following design principles:</p>
<ul class="simple">
<li><p>don’t make any environmental changes that would alter any existing settings
for locale categories other than <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> (most notably: don’t set
<code class="docutils literal notranslate"><span class="pre">LC_ALL</span></code> or <code class="docutils literal notranslate"><span class="pre">LANG</span></code>)</p></li>
</ul>
<p>Finally, maintaining compatibility with running arbitrary subprocesses in
orchestration use cases leads to the following design principle:</p>
<ul class="simple">
<li><p>don’t make any Python-specific environmental changes that might be
incompatible with any still supported version of CPython (including
CPython 2.7)</p></li>
</ul>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#id29">Specification</a><a class="headerlink" href="#specification" title="Permalink to this headline">¶</a></h2>
<p>To better handle the cases where CPython would otherwise end up attempting
to operate in the <code class="docutils literal notranslate"><span class="pre">C</span></code> locale, this PEP proposes that CPython automatically
attempt to coerce the legacy <code class="docutils literal notranslate"><span class="pre">C</span></code> locale to a UTF-8 based locale for the
<code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> category when it is run as a standalone command line application.</p>
<p>It further proposes to emit a warning on stderr if the legacy <code class="docutils literal notranslate"><span class="pre">C</span></code> locale
is in effect for the <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> category at the point where the language
runtime itself is initialized,
and the explicit environmental flag to disable locale coercion is not set, in
order to warn system and application integrators that they’re running CPython
in an unsupported configuration.</p>
<p>In addition to these general changes, some additional Android-specific changes
are proposed to handle the differences in the behaviour of <code class="docutils literal notranslate"><span class="pre">setlocale</span></code> on that
platform.</p>
<section id="legacy-c-locale-coercion-in-the-standalone-python-interpreter-binary">
<h3><a class="toc-backref" href="#id30">Legacy C locale coercion in the standalone Python interpreter binary</a><a class="headerlink" href="#legacy-c-locale-coercion-in-the-standalone-python-interpreter-binary" title="Permalink to this headline">¶</a></h3>
<p>When run as a standalone application, CPython has the opportunity to
reconfigure the C locale before any locale dependent operations are executed
in the process.</p>
<p>This means that it can change the locale settings not only for the CPython
runtime, but also for any other locale-aware components running in the current
process (e.g. as part of extension modules), as well as in subprocesses that
inherit their environment from the current process.</p>
<p>After calling <code class="docutils literal notranslate"><span class="pre">setlocale(LC_ALL,</span> <span class="pre">&quot;&quot;)</span></code> to initialize the locale settings in
the current process, the main interpreter binary will be updated to include
the following call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">ctype_loc</span> <span class="o">=</span> <span class="n">setlocale</span><span class="p">(</span><span class="n">LC_CTYPE</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
</pre></div>
</div>
<p>This cryptic invocation is the API that C provides to query the current locale
setting without changing it. Given that query, it is possible to check for
exactly the <code class="docutils literal notranslate"><span class="pre">C</span></code> locale with <code class="docutils literal notranslate"><span class="pre">strcmp</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctype_loc</span> <span class="o">!=</span> <span class="n">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">ctype_loc</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="c1"># true only in the C locale</span>
</pre></div>
</div>
<p>This call also returns <code class="docutils literal notranslate"><span class="pre">&quot;C&quot;</span></code> when either no particular locale is set, or the
nominal locale is set to an alias for the <code class="docutils literal notranslate"><span class="pre">C</span></code> locale (such as <code class="docutils literal notranslate"><span class="pre">POSIX</span></code>).</p>
<p>Given this information, CPython can then attempt to coerce the locale to one
that uses UTF-8 rather than ASCII as the default encoding.</p>
<p>Three such locales will be tried:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code> (available at least in Debian, Ubuntu, Alpine, and Fedora 25+, and
expected to be available by default in a future version of glibc)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C.utf8</span></code> (available at least in HP-UX)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> (available in at least some *BSD variants, including Mac OS X)</p></li>
</ul>
<p>The coercion will be implemented by setting the <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> environment
variable to the candidate locale name, such that future calls to
<code class="docutils literal notranslate"><span class="pre">setlocale()</span></code> will see it, as will other components looking for those
settings (such as GUI development frameworks and Python’s own <code class="docutils literal notranslate"><span class="pre">locale</span></code>
module).</p>
<p>To allow for better cross-platform binary portability and to adjust
automatically to future changes in locale availability, these checks will be
implemented at runtime on all platforms other than Windows, rather than
attempting to determine which locales to try at compile time.</p>
<p>When this locale coercion is activated, the following warning will be
printed on stderr, with the warning containing whichever locale was
successfully configured:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Python</span> <span class="n">detected</span> <span class="n">LC_CTYPE</span><span class="o">=</span><span class="n">C</span><span class="p">:</span> <span class="n">LC_CTYPE</span> <span class="n">coerced</span> <span class="n">to</span> <span class="n">C</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="p">(</span><span class="nb">set</span> <span class="n">another</span>
<span class="n">locale</span> <span class="ow">or</span> <span class="n">PYTHONCOERCECLOCALE</span><span class="o">=</span><span class="mi">0</span> <span class="n">to</span> <span class="n">disable</span> <span class="n">this</span> <span class="n">locale</span> <span class="n">coercion</span> <span class="n">behaviour</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>(Note: this warning ended up being silenced by default. See the
Implementation Note above for more details)</p>
<p>As long as the current platform provides at least one of the candidate UTF-8
based environments, this locale coercion will mean that the standard
Python binary <em>and</em> locale-aware extensions should once again “just work”
in the three main failure cases we’re aware of (missing locale
settings, SSH forwarding of unknown locales via <code class="docutils literal notranslate"><span class="pre">LANG</span></code> or <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code>, and
developers explicitly requesting <code class="docutils literal notranslate"><span class="pre">LANG=C</span></code>).</p>
<p>The one case where failures may still occur is when <code class="docutils literal notranslate"><span class="pre">stderr</span></code> is specifically
being checked for no output, which can be resolved either by configuring
a locale other than the C locale, or else by using a mechanism other than
“there was no output on stderr” to check for subprocess errors (e.g. checking
process return codes).</p>
<p>If none of the candidate locales are successfully configured, or the <code class="docutils literal notranslate"><span class="pre">LC_ALL</span></code>,
locale override is defined in the current process environment, then
initialization will continue in the C locale and the Unicode compatibility
warning described in the next section will be emitted just as it would for
any other application.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">PYTHONCOERCECLOCALE=0</span></code> is explicitly set, initialization will continue in
the C locale and the Unicode compatibility warning described in the next
section will be automatically suppressed.</p>
<p>The interpreter will always check for the <code class="docutils literal notranslate"><span class="pre">PYTHONCOERCECLOCALE</span></code> environment
variable at startup (even when running under the <code class="docutils literal notranslate"><span class="pre">-E</span></code> or <code class="docutils literal notranslate"><span class="pre">-I</span></code> switches),
as the locale coercion check necessarily takes place before any command line
argument processing. For consistency, the runtime check to determine whether
or not to suppress the locale compatibility warning will be similarly
independent of these settings.</p>
</section>
<section id="legacy-c-locale-warning-during-runtime-initialization">
<h3><a class="toc-backref" href="#id31">Legacy C locale warning during runtime initialization</a><a class="headerlink" href="#legacy-c-locale-warning-during-runtime-initialization" title="Permalink to this headline">¶</a></h3>
<p>By the time that <code class="docutils literal notranslate"><span class="pre">Py_Initialize</span></code> is called, arbitrary locale-dependent
operations may have taken place in the current process. This means that
by the time it is called, it is <em>too late</em> to reliably switch to a different
locale - doing so would introduce inconsistencies in decoded text, even in the
context of the standalone Python interpreter binary.</p>
<p>Accordingly, when <code class="docutils literal notranslate"><span class="pre">Py_Initialize</span></code> is called and CPython detects that the
configured locale is still the default <code class="docutils literal notranslate"><span class="pre">C</span></code> locale and
<code class="docutils literal notranslate"><span class="pre">PYTHONCOERCECLOCALE=0</span></code> is not set, the following warning will be issued:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Python</span> <span class="n">runtime</span> <span class="n">initialized</span> <span class="k">with</span> <span class="n">LC_CTYPE</span><span class="o">=</span><span class="n">C</span> <span class="p">(</span><span class="n">a</span> <span class="n">locale</span> <span class="k">with</span> <span class="n">default</span> <span class="n">ASCII</span>
<span class="n">encoding</span><span class="p">),</span> <span class="n">which</span> <span class="n">may</span> <span class="n">cause</span> <span class="n">Unicode</span> <span class="n">compatibility</span> <span class="n">problems</span><span class="o">.</span> <span class="n">Using</span> <span class="n">C</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span>
<span class="n">C</span><span class="o">.</span><span class="n">utf8</span><span class="p">,</span> <span class="ow">or</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="p">(</span><span class="k">if</span> <span class="n">available</span><span class="p">)</span> <span class="k">as</span> <span class="n">alternative</span> <span class="n">Unicode</span><span class="o">-</span><span class="n">compatible</span>
<span class="n">locales</span> <span class="ow">is</span> <span class="n">recommended</span><span class="o">.</span>
</pre></div>
</div>
<p>(Note: this warning ended up being silenced by default. See the
Implementation Note above for more details)</p>
<p>In this case, no actual change will be made to the locale settings.</p>
<p>Instead, the warning informs both system and application integrators that
they’re running Python 3 in a configuration that we don’t expect to work
properly.</p>
<p>The second sentence providing recommendations may eventually be conditionally
compiled based on the operating system (e.g. recommending <code class="docutils literal notranslate"><span class="pre">LC_CTYPE=UTF-8</span></code>
on *BSD systems), but the initial implementation will just use the common
generic message shown above.</p>
</section>
<section id="new-build-time-configuration-options">
<h3><a class="toc-backref" href="#id32">New build-time configuration options</a><a class="headerlink" href="#new-build-time-configuration-options" title="Permalink to this headline">¶</a></h3>
<p>While both of the above behaviours would be enabled by default, they would
also have new associated configuration options and preprocessor definitions
for the benefit of redistributors that want to override those default settings.</p>
<p>The locale coercion behaviour would be controlled by the flag
<code class="docutils literal notranslate"><span class="pre">--with[out]-c-locale-coercion</span></code>, which would set the <code class="docutils literal notranslate"><span class="pre">PY_COERCE_C_LOCALE</span></code>
preprocessor definition.</p>
<p>The locale warning behaviour would be controlled by the flag
<code class="docutils literal notranslate"><span class="pre">--with[out]-c-locale-warning</span></code>, which would set the <code class="docutils literal notranslate"><span class="pre">PY_WARN_ON_C_LOCALE</span></code>
preprocessor definition.</p>
<p>(Note: this compile time warning option ended up being replaced by a runtime
<code class="docutils literal notranslate"><span class="pre">PYTHONCOERCECLOCALE=warn</span></code> option. See the Implementation Note above for
more details)</p>
<p>On platforms which don’t use the <code class="docutils literal notranslate"><span class="pre">autotools</span></code> based build system (i.e.
Windows) these preprocessor variables would always be undefined.</p>
</section>
<section id="changes-to-the-default-error-handling-on-the-standard-streams">
<h3><a class="toc-backref" href="#id33">Changes to the default error handling on the standard streams</a><a class="headerlink" href="#changes-to-the-default-error-handling-on-the-standard-streams" title="Permalink to this headline">¶</a></h3>
<p>Since Python 3.5, CPython has defaulted to using <code class="docutils literal notranslate"><span class="pre">surrogateescape</span></code> on the
standard streams (<code class="docutils literal notranslate"><span class="pre">sys.stdin</span></code>, <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code>) when it detects that the
current locale is <code class="docutils literal notranslate"><span class="pre">C</span></code> and no specific error handled has been set using
either the <code class="docutils literal notranslate"><span class="pre">PYTHONIOENCODING</span></code> environment variable or the
<code class="docutils literal notranslate"><span class="pre">Py_setStandardStreamEncoding</span></code> API. For other locales, the default error
handler for the standard streams is <code class="docutils literal notranslate"><span class="pre">strict</span></code>.</p>
<p>In order to preserve this behaviour without introducing any behavioural
discrepancies between locale coercion and explicitly configuring a locale, the
coercion target locales (<code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code>, <code class="docutils literal notranslate"><span class="pre">C.utf8</span></code>, and <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code>) will be added
to the list of locales that use <code class="docutils literal notranslate"><span class="pre">surrogateescape</span></code> as their default error
handler for the standard streams.</p>
<p>No changes are proposed to the default error handler for <code class="docutils literal notranslate"><span class="pre">sys.stderr</span></code>: that
will continue to be <code class="docutils literal notranslate"><span class="pre">backslashreplace</span></code>.</p>
</section>
<section id="changes-to-locale-settings-on-android">
<h3><a class="toc-backref" href="#id34">Changes to locale settings on Android</a><a class="headerlink" href="#changes-to-locale-settings-on-android" title="Permalink to this headline">¶</a></h3>
<p>Independently of the other changes in this PEP, CPython on Android systems
will be updated to call <code class="docutils literal notranslate"><span class="pre">setlocale(LC_ALL,</span> <span class="pre">&quot;C.UTF-8&quot;)</span></code> where it currently
calls <code class="docutils literal notranslate"><span class="pre">setlocale(LC_ALL,</span> <span class="pre">&quot;&quot;)</span></code> and <code class="docutils literal notranslate"><span class="pre">setlocale(LC_CTYPE,</span> <span class="pre">&quot;C.UTF-8&quot;)</span></code> where
it currently calls <code class="docutils literal notranslate"><span class="pre">setlocale(LC_CTYPE,</span> <span class="pre">&quot;&quot;)</span></code>.</p>
<p>This Android-specific behaviour is being introduced due to the following
Android-specific details:</p>
<ul class="simple">
<li><p>on Android, passing <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">setlocale</span></code> is equivalent to passing <code class="docutils literal notranslate"><span class="pre">&quot;C&quot;</span></code></p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code> locale is always available</p></li>
</ul>
</section>
</section>
<section id="platform-support-changes">
<h2><a class="toc-backref" href="#id35">Platform Support Changes</a><a class="headerlink" href="#platform-support-changes" title="Permalink to this headline">¶</a></h2>
<p>A new “Legacy C Locale” section will be added to <a class="reference external" href="pep-0011.html">PEP 11</a> that states:</p>
<ul class="simple">
<li><p>as of CPython 3.7, *nix platforms are expected to provide at least one of
<code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code> (full locale), <code class="docutils literal notranslate"><span class="pre">C.utf8</span></code> (full locale) or <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> (
<code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code>-only locale) as an alternative to the legacy <code class="docutils literal notranslate"><span class="pre">C</span></code> locale.
Any Unicode related integration problems that occur only in the legacy <code class="docutils literal notranslate"><span class="pre">C</span></code>
locale and cannot be reproduced in an appropriately configured non-ASCII
locale will be closed as “won’t fix”.</p></li>
</ul>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#id36">Rationale</a><a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<section id="improving-the-handling-of-the-c-locale">
<h3><a class="toc-backref" href="#id37">Improving the handling of the C locale</a><a class="headerlink" href="#improving-the-handling-of-the-c-locale" title="Permalink to this headline">¶</a></h3>
<p>It has been clear for some time that the C locale’s default encoding of
<code class="docutils literal notranslate"><span class="pre">ASCII</span></code> is entirely the wrong choice for development of modern networked
services. Newer languages like Rust and Go have eschewed that default entirely,
and instead made it a deployment requirement that systems be configured to use
UTF-8 as the text encoding for operating system interfaces. Similarly, Node.js
assumes UTF-8 by default (a behaviour inherited from the V8 JavaScript engine)
and requires custom build settings to indicate it should use the system
locale settings for locale-aware operations. Both the JVM and the .NET CLR
use UTF-16-LE as their primary encoding for passing text between applications
and the application runtime (i.e. the JVM/CLR, not the host operating system).</p>
<p>The challenge for CPython has been the fact that in addition to being used for
network service development, it is also extensively used as an embedded
scripting language in larger applications, and as a desktop application
development language, where it is more important to be consistent with other
locale-aware components sharing the same process, as well as with the user’s
desktop locale settings, than it is with the emergent conventions of modern
network service development.</p>
<p>The core premise of this PEP is that for <em>all</em> of these use cases, the
assumption of ASCII implied by the default “C” locale is the wrong choice,
and furthermore that the following assumptions are valid:</p>
<ul class="simple">
<li><p>in desktop application use cases, the process locale will <em>already</em> be
configured appropriately, and if it isn’t, then that is an operating system
or embedding application level problem that needs to be reported to and
resolved by the operating system provider or application developer</p></li>
<li><p>in network service development use cases (especially those based on Linux
containers), the process locale may not be configured <em>at all</em>, and if it
isn’t, then the expectation is that components will impose their own default
encoding the way Rust, Go and Node.js do, rather than trusting the legacy C
default encoding of ASCII the way CPython currently does</p></li>
</ul>
</section>
<section id="defaulting-to-surrogateescape-error-handling-on-the-standard-io-streams">
<h3><a class="toc-backref" href="#id38">Defaulting to “surrogateescape” error handling on the standard IO streams</a><a class="headerlink" href="#defaulting-to-surrogateescape-error-handling-on-the-standard-io-streams" title="Permalink to this headline">¶</a></h3>
<p>By coercing the locale away from the legacy C default and its assumption of
ASCII as the preferred text encoding, this PEP also disables the implicit use
of the “surrogateescape” error handler on the standard IO streams that was
introduced in Python 3.5 ([<a class="reference internal" href="#id15">15</a>]), as well as the automatic use of
<code class="docutils literal notranslate"><span class="pre">surrogateescape</span></code> when operating in <a class="reference external" href="pep-0540.html">PEP 540</a>’s proposed UTF-8 mode.</p>
<p>Rather than introducing yet another configuration option to adjust that
behaviour, this PEP instead proposes to extend the “surrogateescape” default
for <code class="docutils literal notranslate"><span class="pre">stdin</span></code> and <code class="docutils literal notranslate"><span class="pre">stderr</span></code> error handling to also apply to the three
potential coercion target locales.</p>
<p>The aim of this behaviour is to attempt to ensure that operating system
provided text values are typically able to be transparently passed through a
Python 3 application even if it is incorrect in assuming that that text has
been encoded as UTF-8.</p>
<p>In particular, GB 18030 [<a class="reference internal" href="#id12">12</a>] is a Chinese national text encoding standard
that handles all Unicode code points, that is formally incompatible with both
ASCII and UTF-8, but will nevertheless often tolerate processing as surrogate
escaped data - the points where GB 18030 reuses ASCII byte values in an
incompatible way are likely to be invalid in UTF-8, and will therefore be
escaped and opaque to string processing operations that split on or search for
the relevant ASCII code points. Operations that don’t involve splitting on or
searching for particular ASCII or Unicode code point values are almost
certain to work correctly.</p>
<p>Similarly, Shift-JIS [<a class="reference internal" href="#id13">13</a>] and ISO-2022-JP [<a class="reference internal" href="#id14">14</a>] remain in widespread use in
Japan, and are incompatible with both ASCII and UTF-8, but will tolerate text
processing operations that don’t involve splitting on or searching for
particular ASCII or Unicode code point values.</p>
<p>As an example, consider two files, one encoded with UTF-8 (the default encoding
for <code class="docutils literal notranslate"><span class="pre">en_AU.UTF-8</span></code>), and one encoded with GB-18030 (the default encoding for
<code class="docutils literal notranslate"><span class="pre">zh_CN.gb18030</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 -c &#39;open(&quot;utf8.txt&quot;, &quot;wb&quot;).write(&quot;ℙƴ☂ℌøἤ\n&quot;.encode(&quot;utf-8&quot;))&#39;
$ python3 -c &#39;open(&quot;gb18030.txt&quot;, &quot;wb&quot;).write(&quot;ℙƴ☂ℌøἤ\n&quot;.encode(&quot;gb18030&quot;))&#39;
</pre></div>
</div>
<p>On disk, we can see that these are two very different files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 -c &#39;print(&quot;UTF-8:  &quot;, open(&quot;utf8.txt&quot;, &quot;rb&quot;).read().strip()); \
              print(&quot;GB18030:&quot;, open(&quot;gb18030.txt&quot;, &quot;rb&quot;).read().strip())&#39;
UTF-8:   b&#39;\xe2\x84\x99\xc6\xb4\xe2\x98\x82\xe2\x84\x8c\xc3\xb8\xe1\xbc\xa4\n&#39;
GB18030: b&#39;\x816\xbd6\x810\x9d0\x817\xa29\x816\xbc4\x810\x8b3\x816\x8d6\n&#39;
</pre></div>
</div>
<p>That nevertheless can both be rendered correctly to the terminal as long as
they’re decoded prior to printing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 -c &#39;print(&quot;UTF-8:  &quot;, open(&quot;utf8.txt&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;).read().strip()); \
              print(&quot;GB18030:&quot;, open(&quot;gb18030.txt&quot;, &quot;r&quot;, encoding=&quot;gb18030&quot;).read().strip())&#39;
UTF-8:   ℙƴ☂ℌøἤ
GB18030: ℙƴ☂ℌøἤ
</pre></div>
</div>
<p>By contrast, if we just pass along the raw bytes, as <code class="docutils literal notranslate"><span class="pre">cat</span></code> and similar C/C++
utilities will tend to do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ LANG=en_AU.UTF-8 cat utf8.txt gb18030.txt
ℙƴ☂ℌøἤ
�6�6�0�0�7�9�6�4�0�3�6�6
</pre></div>
</div>
<p>Even setting a specifically Chinese locale won’t help in getting the
GB-18030 encoded file rendered correctly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ LANG=zh_CN.gb18030 cat utf8.txt gb18030.txt
ℙƴ☂ℌøἤ
�6�6�0�0�7�9�6�4�0�3�6�6
</pre></div>
</div>
<p>The problem is that the <em>terminal</em> encoding setting remains UTF-8, regardless
of the nominal locale. A GB18030 terminal can be emulated using the <code class="docutils literal notranslate"><span class="pre">iconv</span></code>
utility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat utf8.txt gb18030.txt | iconv -f GB18030 -t UTF-8
鈩櫰粹槀鈩屆羔激
ℙƴ☂ℌøἤ
</pre></div>
</div>
<p>This reverses the problem, such that the GB18030 file is rendered correctly,
but the UTF-8 file has been converted to unrelated hanzi characters, rather than
the expected rendering of “Python” as non-ASCII characters.</p>
<p>With the emulated GB18030 terminal encoding, assuming UTF-8 in Python results
in <em>both</em> files being displayed incorrectly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 -c &#39;print(&quot;UTF-8:  &quot;, open(&quot;utf8.txt&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;).read().strip()); \
              print(&quot;GB18030:&quot;, open(&quot;gb18030.txt&quot;, &quot;r&quot;, encoding=&quot;gb18030&quot;).read().strip())&#39; \
  | iconv -f GB18030 -t UTF-8
UTF-8:   鈩櫰粹槀鈩屆羔激
GB18030: 鈩櫰粹槀鈩屆羔激
</pre></div>
</div>
<p>However, setting the locale correctly means that the emulated GB18030 terminal
now displays both files as originally intended:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ LANG=zh_CN.gb18030 \
  python3 -c &#39;print(&quot;UTF-8:  &quot;, open(&quot;utf8.txt&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;).read().strip()); \
              print(&quot;GB18030:&quot;, open(&quot;gb18030.txt&quot;, &quot;r&quot;, encoding=&quot;gb18030&quot;).read().strip())&#39; \
  | iconv -f GB18030 -t UTF-8
UTF-8:   ℙƴ☂ℌøἤ
GB18030: ℙƴ☂ℌøἤ
</pre></div>
</div>
<p>The rationale for retaining <code class="docutils literal notranslate"><span class="pre">surrogateescape</span></code> as the default IO encoding is
that it will preserve the following helpful behaviour in the <code class="docutils literal notranslate"><span class="pre">C</span></code> locale:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat gb18030.txt \
  | LANG=C python3 -c &quot;import sys; print(sys.stdin.read())&quot; \
  | iconv -f GB18030 -t UTF-8
ℙƴ☂ℌøἤ
</pre></div>
</div>
<p>Rather than reverting to the exception currently seen when a UTF-8 based locale is
explicitly configured:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat gb18030.txt \
  | python3 -c &quot;import sys; print(sys.stdin.read())&quot; \
  | iconv -f GB18030 -t UTF-8
Traceback (most recent call last):
File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
File &quot;/usr/lib64/python3.5/codecs.py&quot;, line 321, in decode
    (result, consumed) = self._buffer_decode(data, self.errors, final)
UnicodeDecodeError: &#39;utf-8&#39; codec can&#39;t decode byte 0x81 in position 0: invalid start byte
</pre></div>
</div>
<p>As an added benefit, environments explicitly configured to use one of the
coercion target locales will implicitly gain the encoding transparency behaviour
currently enabled by default in the <code class="docutils literal notranslate"><span class="pre">C</span></code> locale.</p>
</section>
<section id="avoiding-setting-pythonioencoding-during-utf-8-locale-coercion">
<h3><a class="toc-backref" href="#id39">Avoiding setting PYTHONIOENCODING during UTF-8 locale coercion</a><a class="headerlink" href="#avoiding-setting-pythonioencoding-during-utf-8-locale-coercion" title="Permalink to this headline">¶</a></h3>
<p>Rather than changing the default handling of the standard streams during
interpreter initialization, earlier versions of this PEP proposed setting
<code class="docutils literal notranslate"><span class="pre">PYTHONIOENCODING</span></code> to <code class="docutils literal notranslate"><span class="pre">utf-8:surrogateescape</span></code>. This turned out to create
a significant compatibility problem: since the <code class="docutils literal notranslate"><span class="pre">surrogateescape</span></code> handler
only exists in Python 3.1+, running Python 2.7 processes in subprocesses could
potentially break in a confusing way with that configuration.</p>
<p>The current design means that earlier Python versions will instead retain their
default <code class="docutils literal notranslate"><span class="pre">strict</span></code> error handling on the standard streams, while Python 3.7+
will consistently use the more permissive <code class="docutils literal notranslate"><span class="pre">surrogateescape</span></code> handler even
when these locales are explicitly configured (rather than being reached through
locale coercion).</p>
</section>
<section id="dropping-official-support-for-ascii-based-text-handling-in-the-legacy-c-locale">
<h3><a class="toc-backref" href="#id40">Dropping official support for ASCII based text handling in the legacy C locale</a><a class="headerlink" href="#dropping-official-support-for-ascii-based-text-handling-in-the-legacy-c-locale" title="Permalink to this headline">¶</a></h3>
<p>We’ve been trying to get strict bytes/text separation to work reliably in the
legacy C locale for over a decade at this point. Not only haven’t we been able
to get it to work, neither has anyone else - the only viable alternatives
identified have been to pass the bytes along verbatim without eagerly decoding
them to text (C/C++, Python 2.x, Ruby, etc), or else to largely ignore the
nominal C/C++ locale encoding and assume the use of either UTF-8 (<a class="reference external" href="pep-0540.html">PEP 540</a>,
Rust, Go, Node.js, etc) or UTF-16-LE (JVM, .NET CLR).</p>
<p>While this PEP ensures that developers that genuinely need to do so can still
opt-in to running their Python code in the legacy C locale (by setting
<code class="docutils literal notranslate"><span class="pre">LC_ALL=C</span></code>, <code class="docutils literal notranslate"><span class="pre">PYTHONCOERCECLOCALE=0</span></code>, or running a custom build that sets
<code class="docutils literal notranslate"><span class="pre">--without-c-locale-coercion</span></code>), it also makes it clear that we <em>don’t</em>
expect Python 3’s Unicode handling to be completely reliable in that
configuration, and the recommended alternative is to use a more appropriate
locale setting (potentially in combination with <a class="reference external" href="pep-0540.html">PEP 540</a>’s UTF-8 mode, if that
is available).</p>
</section>
<section id="providing-implicit-locale-coercion-only-when-running-standalone">
<h3><a class="toc-backref" href="#id41">Providing implicit locale coercion only when running standalone</a><a class="headerlink" href="#providing-implicit-locale-coercion-only-when-running-standalone" title="Permalink to this headline">¶</a></h3>
<p>The major downside of the proposed design in this PEP is that it introduces a
potential discrepancy between the behaviour of the CPython runtime when it is
run as a standalone application and when it is run as an embedded component
inside a larger system (e.g. <code class="docutils literal notranslate"><span class="pre">mod_wsgi</span></code> running inside Apache <code class="docutils literal notranslate"><span class="pre">httpd</span></code>).</p>
<p>Over the course of Python 3.x development, multiple attempts have been made
to improve the handling of incorrect locale settings at the point where the
Python interpreter is initialised. The problem that emerged is that this is
ultimately <em>too late</em> in the interpreter startup process - data such as command
line arguments and the contents of environment variables may have already been
retrieved from the operating system and processed under the incorrect ASCII
text encoding assumption well before <code class="docutils literal notranslate"><span class="pre">Py_Initialize</span></code> is called.</p>
<p>The problems created by those inconsistencies were then even harder to diagnose
and debug than those created by believing the operating system’s claim that
ASCII was a suitable encoding to use for operating system interfaces. This was
the case even for the default CPython binary, let alone larger C/C++
applications that embed CPython as a scripting engine.</p>
<p>The approach proposed in this PEP handles that problem by moving the locale
coercion as early as possible in the interpreter startup sequence when running
standalone: it takes place directly in the C-level <code class="docutils literal notranslate"><span class="pre">main()</span></code> function, even
before calling in to the <code class="docutils literal notranslate"><span class="pre">Py_Main()</span></code> library function that implements the
features of the CPython interpreter CLI.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Py_Initialize</span></code> API then only gains an explicit warning (emitted on
<code class="docutils literal notranslate"><span class="pre">stderr</span></code>) when it detects use of the <code class="docutils literal notranslate"><span class="pre">C</span></code> locale, and relies on the
embedding application to specify something more reasonable.</p>
<p>That said, the reference implementation for this PEP adds most of the
functionality to the shared library, with the CLI being updated to
unconditionally call two new private APIs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">_Py_LegacyLocaleDetected</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">_Py_CoerceLegacyLocale</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These are similar to other “pre-configuration” APIs intended for embedding
applications: they’re designed to be called <em>before</em> <code class="docutils literal notranslate"><span class="pre">Py_Initialize</span></code>, and
hence change the way the interpreter gets initialized.</p>
<p>If these were made public (either as part of this PEP or in a subsequent RFE),
then it would be straightforward for other embedding applications to recreate
the same behaviour as is proposed for the CPython CLI.</p>
</section>
<section id="allowing-restoration-of-the-legacy-behaviour">
<h3><a class="toc-backref" href="#id42">Allowing restoration of the legacy behaviour</a><a class="headerlink" href="#allowing-restoration-of-the-legacy-behaviour" title="Permalink to this headline">¶</a></h3>
<p>The CPython command line interpreter is often used to investigate faults that
occur in other applications that embed CPython, and those applications may still
be using the C locale even after this PEP is implemented.</p>
<p>Providing a simple on/off switch for the locale coercion behaviour makes it
much easier to reproduce the behaviour of such applications for debugging
purposes, as well as making it easier to reproduce the behaviour of older 3.x
runtimes even when running a version with this change applied.</p>
</section>
<section id="querying-lc-ctype-for-c-locale-detection">
<h3><a class="toc-backref" href="#id43">Querying LC_CTYPE for C locale detection</a><a class="headerlink" href="#querying-lc-ctype-for-c-locale-detection" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> is the actual locale category that CPython relies on to drive the
implicit decoding of environment variables, command line arguments, and other
text values received from the operating system.</p>
<p>As such, it makes sense to check it specifically when attempting to determine
whether or not the current locale configuration is likely to cause Unicode
handling problems.</p>
</section>
<section id="explicitly-setting-lc-ctype-for-utf-8-locale-coercion">
<h3><a class="toc-backref" href="#id44">Explicitly setting LC_CTYPE for UTF-8 locale coercion</a><a class="headerlink" href="#explicitly-setting-lc-ctype-for-utf-8-locale-coercion" title="Permalink to this headline">¶</a></h3>
<p>Python is often used as a glue language, integrating other C/C++ ABI compatible
components in the current process, and components written in arbitrary
languages in subprocesses.</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> to <code class="docutils literal notranslate"><span class="pre">C.UTF-8</span></code> is important to handle cases where the
problem has arisen from a setting like <code class="docutils literal notranslate"><span class="pre">LC_CTYPE=UTF-8</span></code> being provided on a
system where no <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> locale is defined (e.g. when a Mac OS X ssh client is
configured to forward locale settings, and the user logs into a Linux server).</p>
<p>This should be sufficient to ensure that when the locale coercion is activated,
the switch to the UTF-8 based locale will be applied consistently across the
current process and any subprocesses that inherit the current environment.</p>
</section>
<section id="avoiding-setting-lang-for-utf-8-locale-coercion">
<h3><a class="toc-backref" href="#id45">Avoiding setting LANG for UTF-8 locale coercion</a><a class="headerlink" href="#avoiding-setting-lang-for-utf-8-locale-coercion" title="Permalink to this headline">¶</a></h3>
<p>Earlier versions of this PEP proposed setting the <code class="docutils literal notranslate"><span class="pre">LANG</span></code> category independent
default locale, in addition to setting <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code>.</p>
<p>This was later removed on the grounds that setting only <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> is
sufficient to handle all of the problematic scenarios that the PEP aimed
to resolve, while setting <code class="docutils literal notranslate"><span class="pre">LANG</span></code> as well would break cases where <code class="docutils literal notranslate"><span class="pre">LANG</span></code>
was set correctly, and the locale problems were solely due to an incorrect
<code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> setting ([<a class="reference internal" href="#id22">22</a>]).</p>
<p>For example, consider a Python application that called the Linux <code class="docutils literal notranslate"><span class="pre">date</span></code>
utility in a subprocess rather than doing its own date formatting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ LANG=ja_JP.UTF-8 LC_CTYPE=C date
2017年  5月 23日 火曜日 17:31:03 JST

$ LANG=ja_JP.UTF-8 LC_CTYPE=C.UTF-8 date  # Coercing only LC_CTYPE
2017年  5月 23日 火曜日 17:32:58 JST

$ LANG=C.UTF-8 LC_CTYPE=C.UTF-8 date  # Coercing both of LC_CTYPE and LANG
Tue May 23 17:31:10 JST 2017
</pre></div>
</div>
<p>With only <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> updated in the Python process, the subprocess would
continue to behave as expected. However, if <code class="docutils literal notranslate"><span class="pre">LANG</span></code> was updated as well,
that would effectively override the <code class="docutils literal notranslate"><span class="pre">LC_TIME</span></code> setting and use the wrong
date formatting conventions.</p>
</section>
<section id="avoiding-setting-lc-all-for-utf-8-locale-coercion">
<h3><a class="toc-backref" href="#id46">Avoiding setting LC_ALL for UTF-8 locale coercion</a><a class="headerlink" href="#avoiding-setting-lc-all-for-utf-8-locale-coercion" title="Permalink to this headline">¶</a></h3>
<p>Earlier versions of this PEP proposed setting the <code class="docutils literal notranslate"><span class="pre">LC_ALL</span></code> locale override,
in addition to setting <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code>.</p>
<p>This was changed after it was determined that just setting <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> and
<code class="docutils literal notranslate"><span class="pre">LANG</span></code> should be sufficient to handle all the scenarios the PEP aims to
cover, as it avoids causing any problems in cases like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ LANG=C LC_MONETARY=ja_JP.utf8 ./python -c \
  &quot;from locale import setlocale, LC_ALL, currency; setlocale(LC_ALL, &#39;&#39;); print(currency(1e6))&quot;
￥1000000
</pre></div>
</div>
</section>
<section id="skipping-locale-coercion-if-lc-all-is-set-in-the-current-environment">
<h3><a class="toc-backref" href="#id47">Skipping locale coercion if LC_ALL is set in the current environment</a><a class="headerlink" href="#skipping-locale-coercion-if-lc-all-is-set-in-the-current-environment" title="Permalink to this headline">¶</a></h3>
<p>With locale coercion now only setting <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code> and <code class="docutils literal notranslate"><span class="pre">LANG</span></code>, it will have
no effect if <code class="docutils literal notranslate"><span class="pre">LC_ALL</span></code> is also set. To avoid emitting a spurious locale
coercion notice in that case, coercion is instead skipped entirely.</p>
</section>
<section id="considering-locale-coercion-independently-of-utf-8-mode">
<h3><a class="toc-backref" href="#id48">Considering locale coercion independently of “UTF-8 mode”</a><a class="headerlink" href="#considering-locale-coercion-independently-of-utf-8-mode" title="Permalink to this headline">¶</a></h3>
<p>With both this PEP’s locale coercion and <a class="reference external" href="pep-0540.html">PEP 540</a>’s UTF-8 mode under
consideration for Python 3.7, it makes sense to ask whether or not we can
limit ourselves to only doing one or the other, rather than making both
changes.</p>
<p>The UTF-8 mode proposed in <a class="reference external" href="pep-0540.html">PEP 540</a> has two major limitations that make it a
potential complement to this PEP rather than a potential replacement.</p>
<p>First, unlike this PEP, <a class="reference external" href="pep-0540.html">PEP 540</a>’s UTF-8 mode makes it possible to change default
behaviours that are not currently configurable at all. While that’s exactly
what makes the proposal interesting, it’s also what makes it an entirely
unproven approach. By contrast, the approach proposed in this PEP builds
directly atop existing configuration settings for the C locale system (
<code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code>, <code class="docutils literal notranslate"><span class="pre">LANG</span></code>) and Python’s standard streams (<code class="docutils literal notranslate"><span class="pre">PYTHONIOENCODING</span></code>)
that have already been in use for years to handle the kinds of compatibility
problems discussed in this PEP.</p>
<p>Secondly, one of the things we know based on that experience is that the
proposed locale coercion can resolve problems not only in CPython itself,
but also in extension modules that interact with the standard streams, like
GNU readline. As an example, consider the following interactive session
from a <a class="reference external" href="pep-0538.html">PEP 538</a> enabled CPython build, where each line after the first is
executed by doing “up-arrow, left-arrow x4, delete, enter”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ LANG=C ./python
Python 3.7.0a0 (heads/pep538-coerce-c-locale:188e780, May  7 2017, 00:21:13)
[GCC 6.3.1 20161221 (Red Hat 6.3.1-1)] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; print(&quot;ℙƴ☂ℌøἤ&quot;)
ℙƴ☂ℌøἤ
&gt;&gt;&gt; print(&quot;ℙƴ☂ℌἤ&quot;)
ℙƴ☂ℌἤ
&gt;&gt;&gt; print(&quot;ℙƴ☂ἤ&quot;)
ℙƴ☂ἤ
&gt;&gt;&gt; print(&quot;ℙƴἤ&quot;)
ℙƴἤ
&gt;&gt;&gt; print(&quot;ℙἤ&quot;)
ℙἤ
&gt;&gt;&gt; print(&quot;ἤ&quot;)
ἤ
&gt;&gt;&gt;
</pre></div>
</div>
<p>This is exactly what we’d expect from a well-behaved command history editor.</p>
<p>By contrast, the following is what currently happens on an older release if
you only change the Python level stream encoding settings without updating the
locale settings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ LANG=C PYTHONIOENCODING=utf-8:surrogateescape python3
Python 3.5.3 (default, Apr 24 2017, 13:32:13)
[GCC 6.3.1 20161221 (Red Hat 6.3.1-1)] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; print(&quot;ℙƴ☂ℌøἤ&quot;)
ℙƴ☂ℌøἤ
&gt;&gt;&gt; print(&quot;ℙƴ☂ℌ�&quot;)
 File &quot;&lt;stdin&gt;&quot;, line 0

   ^
SyntaxError: &#39;utf-8&#39; codec can&#39;t decode bytes in position 20-21:
invalid continuation byte
</pre></div>
</div>
<p>That particular misbehaviour is coming from GNU readline, <em>not</em> CPython -
because the command history editing wasn’t UTF-8 aware, it corrupted the history
buffer and fed such nonsense to stdin that even the surrogateescape error
handler was bypassed. While <a class="reference external" href="pep-0540.html">PEP 540</a>’s UTF-8 mode could technically be updated
to also reconfigure readline, that’s just <em>one</em> extension module that might
be interacting with the standard streams without going through the CPython
C API, and any change made by CPython would only apply when readline is running
directly as part of Python 3.7 rather than in a separate subprocess.</p>
<p>However, if we actually change the configured locale, GNU readline starts
behaving itself, without requiring any changes to the embedding application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ LANG=C.UTF-8 python3
Python 3.5.3 (default, Apr 24 2017, 13:32:13)
[GCC 6.3.1 20161221 (Red Hat 6.3.1-1)] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; print(&quot;ℙƴ☂ℌøἤ&quot;)
ℙƴ☂ℌøἤ
&gt;&gt;&gt; print(&quot;ℙƴ☂ℌἤ&quot;)
ℙƴ☂ℌἤ
&gt;&gt;&gt; print(&quot;ℙƴ☂ἤ&quot;)
ℙƴ☂ἤ
&gt;&gt;&gt; print(&quot;ℙƴἤ&quot;)
ℙƴἤ
&gt;&gt;&gt; print(&quot;ℙἤ&quot;)
ℙἤ
&gt;&gt;&gt; print(&quot;ἤ&quot;)
ἤ
&gt;&gt;&gt;
$ LC_CTYPE=C.UTF-8 python3
Python 3.5.3 (default, Apr 24 2017, 13:32:13)
[GCC 6.3.1 20161221 (Red Hat 6.3.1-1)] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; print(&quot;ℙƴ☂ℌøἤ&quot;)
ℙƴ☂ℌøἤ
&gt;&gt;&gt; print(&quot;ℙƴ☂ℌἤ&quot;)
ℙƴ☂ℌἤ
&gt;&gt;&gt; print(&quot;ℙƴ☂ἤ&quot;)
ℙƴ☂ἤ
&gt;&gt;&gt; print(&quot;ℙƴἤ&quot;)
ℙƴἤ
&gt;&gt;&gt; print(&quot;ℙἤ&quot;)
ℙἤ
&gt;&gt;&gt; print(&quot;ἤ&quot;)
ἤ
&gt;&gt;&gt;
</pre></div>
</div>
</section>
<section id="enabling-c-locale-coercion-and-warnings-on-mac-os-x-ios-and-android">
<h3><a class="toc-backref" href="#id49">Enabling C locale coercion and warnings on Mac OS X, iOS and Android</a><a class="headerlink" href="#enabling-c-locale-coercion-and-warnings-on-mac-os-x-ios-and-android" title="Permalink to this headline">¶</a></h3>
<p>On Mac OS X, iOS, and Android, CPython already assumes the use of UTF-8 for
system interfaces, and we expect most other locale-aware components to do the
same.</p>
<p>Accordingly, this PEP originally proposed to disable locale coercion and
warnings at build time for these platforms, on the assumption that it would
be entirely redundant.</p>
<p>However, that assumption turned out to be incorrect, as subsequent
investigations showed that if you explicitly configure <code class="docutils literal notranslate"><span class="pre">LANG=C</span></code> on
these platforms, extension modules like GNU readline will misbehave in much the
same way as they do on other *nix systems. [<a class="reference internal" href="#id21">21</a>]</p>
<p>In addition, Mac OS X is also frequently used as a development and testing
platform for Python software intended for deployment to other *nix environments
(such as Linux or Android), and Linux is similarly often used as a development
and testing platform for mobile and Mac OS X applications.</p>
<p>Accordingly, this PEP enables the locale coercion and warning features by
default on all platforms that use CPython’s <code class="docutils literal notranslate"><span class="pre">autotools</span></code> based build toolchain
(i.e. everywhere other than Windows).</p>
</section>
</section>
<section id="implementation">
<h2><a class="toc-backref" href="#id50">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>The reference implementation is being developed in the
<code class="docutils literal notranslate"><span class="pre">pep538-coerce-c-locale</span></code> feature branch [<a class="reference internal" href="#id18">18</a>] in Nick Coghlan’s fork of the
CPython repository on GitHub. A work-in-progress PR is available at [<a class="reference internal" href="#id20">20</a>].</p>
<p>This reference implementation covers not only the enhancement request in
issue 28180 [<a class="reference internal" href="#id1">1</a>], but also the Android compatibility fixes needed to resolve
issue 28997 [<a class="reference internal" href="#id16">16</a>].</p>
</section>
<section id="backporting-to-earlier-python-3-releases">
<h2><a class="toc-backref" href="#id51">Backporting to earlier Python 3 releases</a><a class="headerlink" href="#backporting-to-earlier-python-3-releases" title="Permalink to this headline">¶</a></h2>
<section id="backporting-to-python-3-6-x">
<h3><a class="toc-backref" href="#id52">Backporting to Python 3.6.x</a><a class="headerlink" href="#backporting-to-python-3-6-x" title="Permalink to this headline">¶</a></h3>
<p>If this PEP is accepted for Python 3.7, redistributors backporting the change
specifically to their initial Python 3.6.x release will be both allowed and
encouraged. However, such backports should only be undertaken either in
conjunction with the changes needed to also provide a suitable locale by
default, or else specifically for platforms where such a locale is already
consistently available.</p>
<p>At least the Fedora project is planning to pursue this approach for the
upcoming Fedora 26 release [<a class="reference internal" href="#id19">19</a>].</p>
</section>
<section id="backporting-to-other-3-x-releases">
<h3><a class="toc-backref" href="#id53">Backporting to other 3.x releases</a><a class="headerlink" href="#backporting-to-other-3-x-releases" title="Permalink to this headline">¶</a></h3>
<p>While the proposed behavioural change is seen primarily as a bug fix addressing
Python 3’s current misbehaviour in the default ASCII-based C locale, it still
represents a reasonably significant change in the way CPython interacts with
the C locale system. As such, while some redistributors may still choose to
backport it to even earlier Python 3.x releases based on the needs and
interests of their particular user base, this wouldn’t be encouraged as a
general practice.</p>
<p>However, configuring Python 3 <em>environments</em> (such as base container
images) to use these configuration settings by default is both allowed
and recommended.</p>
</section>
</section>
<section id="acknowledgements">
<h2><a class="toc-backref" href="#id54">Acknowledgements</a><a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>The locale coercion approach proposed in this PEP is inspired directly by
Armin Ronacher’s handling of this problem in the <code class="docutils literal notranslate"><span class="pre">click</span></code> command line
utility development framework [<a class="reference internal" href="#id2">2</a>]:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ LANG=C python3 -c &#39;import click; cli = click.command()(lambda:None); cli()&#39;
Traceback (most recent call last):
  ...
RuntimeError: Click will abort further execution because Python 3 was
configured to use ASCII as encoding for the environment.  Either run this
under Python 2 or consult http://click.pocoo.org/python3/ for mitigation
steps.

This system supports the C.UTF-8 locale which is recommended.
You might be able to resolve your issue by exporting the
following environment variables:

    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
</pre></div>
</div>
<p>The change was originally proposed as a downstream patch for Fedora’s
system Python 3.6 package [<a class="reference internal" href="#id3">3</a>], and then reformulated as a PEP for Python 3.7
with a section allowing for backports to earlier versions by redistributors.
In parallel with the development of the upstream patch, Charalampos Stratakis
has been working on the Fedora 26 backport and providing feedback on the
practical viability of the proposed changes.</p>
<p>The initial draft was posted to the Python Linux SIG for discussion [<a class="reference internal" href="#id10">10</a>] and
then amended based on both that discussion and Victor Stinner’s work in
<a class="reference external" href="pep-0540.html">PEP 540</a> [<a class="reference internal" href="#id11">11</a>].</p>
<p>The “ℙƴ☂ℌøἤ” string used in the Unicode handling examples throughout this PEP
is taken from Ned Batchelder’s excellent “Pragmatic Unicode” presentation [<a class="reference internal" href="#id9">9</a>].</p>
<p>Stephen Turnbull has long provided valuable insight into the text encoding
handling challenges he regularly encounters at the University of Tsukuba
(筑波大学).</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id55">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id1"><span class="brackets">1</span></dt>
<dd><p>CPython: sys.getfilesystemencoding() should default to utf-8
(<a class="reference external" href="http://bugs.python.org/issue28180">http://bugs.python.org/issue28180</a>)</p>
</dd>
<dt class="label" id="id2"><span class="brackets">2</span></dt>
<dd><p>Locale configuration required for click applications under Python 3
(<a class="reference external" href="http://click.pocoo.org/5/python3/#python-3-surrogate-handling">http://click.pocoo.org/5/python3/#python-3-surrogate-handling</a>)</p>
</dd>
<dt class="label" id="id3"><span class="brackets">3</span></dt>
<dd><p>Fedora: force C.UTF-8 when Python 3 is run under the C locale
(<a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1404918">https://bugzilla.redhat.com/show_bug.cgi?id=1404918</a>)</p>
</dd>
<dt class="label" id="id4"><span class="brackets">4</span></dt>
<dd><p>GNU C: How Programs Set the Locale
( <a class="reference external" href="https://www.gnu.org/software/libc/manual/html_node/Setting-the-Locale.html">https://www.gnu.org/software/libc/manual/html_node/Setting-the-Locale.html</a>)</p>
</dd>
<dt class="label" id="id5"><span class="brackets">5</span></dt>
<dd><p>GNU C: Locale Categories
(<a class="reference external" href="https://www.gnu.org/software/libc/manual/html_node/Locale-Categories.html">https://www.gnu.org/software/libc/manual/html_node/Locale-Categories.html</a>)</p>
</dd>
<dt class="label" id="id6"><span class="brackets">6</span></dt>
<dd><p>glibc C.UTF-8 locale proposal
(<a class="reference external" href="https://sourceware.org/glibc/wiki/Proposals/C.UTF-8">https://sourceware.org/glibc/wiki/Proposals/C.UTF-8</a>)</p>
</dd>
<dt class="label" id="id7"><span class="brackets">7</span></dt>
<dd><p>GNOME Flatpak
(<a class="reference external" href="http://flatpak.org/">http://flatpak.org/</a>)</p>
</dd>
<dt class="label" id="id8"><span class="brackets">8</span></dt>
<dd><p>Ubuntu Snappy
(<a class="reference external" href="https://www.ubuntu.com/desktop/snappy">https://www.ubuntu.com/desktop/snappy</a>)</p>
</dd>
<dt class="label" id="id9"><span class="brackets">9</span></dt>
<dd><p>Pragmatic Unicode
(<a class="reference external" href="http://nedbatchelder.com/text/unipain.html">http://nedbatchelder.com/text/unipain.html</a>)</p>
</dd>
<dt class="label" id="id10"><span class="brackets">10</span></dt>
<dd><p>linux-sig discussion of initial PEP draft
(<a class="reference external" href="https://mail.python.org/pipermail/linux-sig/2017-January/000014.html">https://mail.python.org/pipermail/linux-sig/2017-January/000014.html</a>)</p>
</dd>
<dt class="label" id="id11"><span class="brackets">11</span></dt>
<dd><p>Feedback notes from linux-sig discussion and <a class="reference external" href="pep-0540.html">PEP 540</a>
(<a class="reference external" href="https://github.com/python/peps/issues/171">https://github.com/python/peps/issues/171</a>)</p>
</dd>
<dt class="label" id="id12"><span class="brackets">12</span></dt>
<dd><p>GB 18030
(<a class="reference external" href="https://en.wikipedia.org/wiki/GB_18030">https://en.wikipedia.org/wiki/GB_18030</a>)</p>
</dd>
<dt class="label" id="id13"><span class="brackets">13</span></dt>
<dd><p>Shift-JIS
(<a class="reference external" href="https://en.wikipedia.org/wiki/Shift_JIS">https://en.wikipedia.org/wiki/Shift_JIS</a>)</p>
</dd>
<dt class="label" id="id14"><span class="brackets">14</span></dt>
<dd><p>ISO-2022
(<a class="reference external" href="https://en.wikipedia.org/wiki/ISO/IEC_2022">https://en.wikipedia.org/wiki/ISO/IEC_2022</a>)</p>
</dd>
<dt class="label" id="id15"><span class="brackets">15</span></dt>
<dd><p>Use “surrogateescape” error handler for sys.stdin and sys.stdout on UNIX for the C locale
(<a class="reference external" href="https://bugs.python.org/issue19977">https://bugs.python.org/issue19977</a>)</p>
</dd>
<dt class="label" id="id16"><span class="brackets">16</span></dt>
<dd><p>test_readline.test_nonascii fails on Android
(<a class="reference external" href="http://bugs.python.org/issue28997">http://bugs.python.org/issue28997</a>)</p>
</dd>
<dt class="label" id="id17"><span class="brackets">17</span></dt>
<dd><p>UTF-8 locale discussion on “locale.getdefaultlocale() fails on Mac OS X with default language set to English”
(<a class="reference external" href="http://bugs.python.org/issue18378#msg215215">http://bugs.python.org/issue18378#msg215215</a>)</p>
</dd>
<dt class="label" id="id18"><span class="brackets">18</span></dt>
<dd><p>GitHub branch diff for <code class="docutils literal notranslate"><span class="pre">ncoghlan:pep538-coerce-c-locale</span></code>
(<a class="reference external" href="https://github.com/python/cpython/compare/master...ncoghlan:pep538-coerce-c-locale">https://github.com/python/cpython/compare/master…ncoghlan:pep538-coerce-c-locale</a>)</p>
</dd>
<dt class="label" id="id19"><span class="brackets">19</span></dt>
<dd><p>Fedora 26 change proposal for locale coercion backport
(<a class="reference external" href="https://fedoraproject.org/wiki/Changes/python3_c.utf-8_locale">https://fedoraproject.org/wiki/Changes/python3_c.utf-8_locale</a>)</p>
</dd>
<dt class="label" id="id20"><span class="brackets">20</span></dt>
<dd><p>GitHub pull request for the reference implementation
(<a class="reference external" href="https://github.com/python/cpython/pull/659">https://github.com/python/cpython/pull/659</a>)</p>
</dd>
<dt class="label" id="id21"><span class="brackets">21</span></dt>
<dd><p>GNU readline misbehaviour on Mac OS X with <code class="docutils literal notranslate"><span class="pre">LANG=C</span></code>
(<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-May/147897.html">https://mail.python.org/pipermail/python-dev/2017-May/147897.html</a>)</p>
</dd>
<dt class="label" id="id22"><span class="brackets">22</span></dt>
<dd><p>Potential problems when setting LANG in addition to setting LC_CTYPE
(<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-May/147968.html">https://mail.python.org/pipermail/python-dev/2017-May/147968.html</a>)</p>
</dd>
</dl>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#id56">Copyright</a><a class="headerlink" href="#copyright" title="Permalink to this headline">¶</a></h2>
<p>This document has been placed in the public domain under the terms of the
CC0 1.0 license: <a class="reference external" href="https://creativecommons.org/publicdomain/zero/1.0/">https://creativecommons.org/publicdomain/zero/1.0/</a></p>
</section>
</section>
<span>Source: <a class="reference external" href="https://github.com/python/peps/blob/master/pep-0538.txt">https://github.com/python/peps/blob/master/pep-0538.txt</a></span><div class="zero-height line"><br /></div>
<span>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/master/pep-0538.txt">2021-06-28T11:16:08Z</a></span>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../contents/">PEPs</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">PEP Table of Contents (needed for Sphinx):</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pep-0000/">PEP 0 – Index of Python Enhancement Proposals (PEPs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0001/">PEP 1 – PEP Purpose and Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0002/">PEP 2 – Procedure for Adding New Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0003/">PEP 3 – Guidelines for Handling Bug Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0004/">PEP 4 – Deprecation of Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0005/">PEP 5 – Guidelines for Language Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0006/">PEP 6 – Bug Fix Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0007/">PEP 7 – Style Guide for C Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0008/">PEP 8 – Style Guide for Python Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0009/">PEP 9 – Sample Plaintext PEP Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0010/">PEP 10 – Voting Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0011/">PEP 11 – Removing support for little used platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0012/">PEP 12 – Sample reStructuredText PEP Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0013/">PEP 13 – Python Language Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0020/">PEP 20 – The Zen of Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0042/">PEP 42 – Feature Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0100/">PEP 100 – Python Unicode Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0101/">PEP 101 – Doing Python Releases 101</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0102/">PEP 102 – Doing Python Micro Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0103/">PEP 103 – Collecting information about git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0160/">PEP 160 – Python 1.6 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0200/">PEP 200 – Python 2.0 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0201/">PEP 201 – Lockstep Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0202/">PEP 202 – List Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0203/">PEP 203 – Augmented Assignments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0204/">PEP 204 – Range Literals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0205/">PEP 205 – Weak References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0206/">PEP 206 – Python Advanced Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0207/">PEP 207 – Rich Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0208/">PEP 208 – Reworking the Coercion Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0209/">PEP 209 – Multi-dimensional Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0210/">PEP 210 – Decoupling the Interpreter Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0211/">PEP 211 – Adding A New Outer Product Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0212/">PEP 212 – Loop Counter Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0213/">PEP 213 – Attribute Access Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0214/">PEP 214 – Extended Print Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0215/">PEP 215 – String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0216/">PEP 216 – Docstring Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0217/">PEP 217 – Display Hook for Interactive Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0218/">PEP 218 – Adding a Built-In Set Object Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0219/">PEP 219 – Stackless Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0220/">PEP 220 – Coroutines, Generators, Continuations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0221/">PEP 221 – Import As</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0222/">PEP 222 – Web Library Enhancements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0223/">PEP 223 – Change the Meaning of ``\x`` Escapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0224/">PEP 224 – Attribute Docstrings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0225/">PEP 225 – Elementwise/Objectwise Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0226/">PEP 226 – Python 2.1 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0227/">PEP 227 – Statically Nested Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0228/">PEP 228 – Reworking Python’s Numeric Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0229/">PEP 229 – Using Distutils to Build Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0230/">PEP 230 – Warning Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0231/">PEP 231 – __findattr__()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0232/">PEP 232 – Function Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0233/">PEP 233 – Python Online Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0234/">PEP 234 – Iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0235/">PEP 235 – Import on Case-Insensitive Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0236/">PEP 236 – Back to the __future__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0237/">PEP 237 – Unifying Long Integers and Integers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0238/">PEP 238 – Changing the Division Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0239/">PEP 239 – Adding a Rational Type to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0240/">PEP 240 – Adding a Rational Literal to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0241/">PEP 241 – Metadata for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0242/">PEP 242 – Numeric Kinds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0243/">PEP 243 – Module Repository Upload Mechanism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0244/">PEP 244 – The ``directive`` statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0245/">PEP 245 – Python Interface Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0246/">PEP 246 – Object Adaptation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0247/">PEP 247 – API for Cryptographic Hash Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0248/">PEP 248 – Python Database API Specification v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0249/">PEP 249 – Python Database API Specification v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0250/">PEP 250 – Using site-packages on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0251/">PEP 251 – Python 2.2 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0252/">PEP 252 – Making Types Look More Like Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0253/">PEP 253 – Subtyping Built-in Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0254/">PEP 254 – Making Classes Look More Like Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0255/">PEP 255 – Simple Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0256/">PEP 256 – Docstring Processing System Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0257/">PEP 257 – Docstring Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0258/">PEP 258 – Docutils Design Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0259/">PEP 259 – Omit printing newline after newline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0260/">PEP 260 – Simplify xrange()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0261/">PEP 261 – Support for “wide” Unicode characters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0262/">PEP 262 – A Database of Installed Python Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0263/">PEP 263 – Defining Python Source Code Encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0264/">PEP 264 – Future statements in simulated shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0265/">PEP 265 – Sorting Dictionaries by Value</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0266/">PEP 266 – Optimizing Global Variable/Attribute Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0267/">PEP 267 – Optimized Access to Module Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0268/">PEP 268 – Extended HTTP functionality and WebDAV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0269/">PEP 269 – Pgen Module for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0270/">PEP 270 – uniq method for list objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0271/">PEP 271 – Prefixing sys.path by command line option</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0272/">PEP 272 – API for Block Encryption Algorithms v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0273/">PEP 273 – Import Modules from Zip Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0274/">PEP 274 – Dict Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0275/">PEP 275 – Switching on Multiple Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0276/">PEP 276 – Simple Iterator for ints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0277/">PEP 277 – Unicode file name support for Windows NT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0278/">PEP 278 – Universal Newline Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0279/">PEP 279 – The enumerate() built-in function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0280/">PEP 280 – Optimizing access to globals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0281/">PEP 281 – Loop Counter Iteration with range and xrange</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0282/">PEP 282 – A Logging System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0283/">PEP 283 – Python 2.3 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0284/">PEP 284 – Integer for-loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0285/">PEP 285 – Adding a bool type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0286/">PEP 286 – Enhanced Argument Tuples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0287/">PEP 287 – reStructuredText Docstring Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0288/">PEP 288 – Generators Attributes and Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0289/">PEP 289 – Generator Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0290/">PEP 290 – Code Migration and Modernization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0291/">PEP 291 – Backward Compatibility for the Python 2 Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0292/">PEP 292 – Simpler String Substitutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0293/">PEP 293 – Codec Error Handling Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0294/">PEP 294 – Type Names in the types Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0295/">PEP 295 – Interpretation of multiline string constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0296/">PEP 296 – Adding a bytes Object Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0297/">PEP 297 – Support for System Upgrades</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0298/">PEP 298 – The Locked Buffer Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0299/">PEP 299 – Special __main__() function in modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0301/">PEP 301 – Package Index and Metadata for Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0302/">PEP 302 – New Import Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0303/">PEP 303 – Extend divmod() for Multiple Divisors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0304/">PEP 304 – Controlling Generation of Bytecode Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0305/">PEP 305 – CSV File API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0306/">PEP 306 – How to Change Python’s Grammar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0307/">PEP 307 – Extensions to the pickle protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0308/">PEP 308 – Conditional Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0309/">PEP 309 – Partial Function Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0310/">PEP 310 – Reliable Acquisition/Release Pairs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0311/">PEP 311 – Simplified Global Interpreter Lock Acquisition for Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0312/">PEP 312 – Simple Implicit Lambda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0313/">PEP 313 – Adding Roman Numeral Literals to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0314/">PEP 314 – Metadata for Python Software Packages v1.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0315/">PEP 315 – Enhanced While Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0316/">PEP 316 – Programming by Contract for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0317/">PEP 317 – Eliminate Implicit Exception Instantiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0318/">PEP 318 – Decorators for Functions and Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0319/">PEP 319 – Python Synchronize/Asynchronize Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0320/">PEP 320 – Python 2.4 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0321/">PEP 321 – Date/Time Parsing and Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0322/">PEP 322 – Reverse Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0323/">PEP 323 – Copyable Iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0324/">PEP 324 – subprocess - New process module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0325/">PEP 325 – Resource-Release Support for Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0326/">PEP 326 – A Case for Top and Bottom Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0327/">PEP 327 – Decimal Data Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0328/">PEP 328 – Imports: Multi-Line and Absolute/Relative</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0329/">PEP 329 – Treating Builtins as Constants in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0330/">PEP 330 – Python Bytecode Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0331/">PEP 331 – Locale-Independent Float/String Conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0332/">PEP 332 – Byte vectors and String/Unicode Unification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0333/">PEP 333 – Python Web Server Gateway Interface v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0334/">PEP 334 – Simple Coroutines via SuspendIteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0335/">PEP 335 – Overloadable Boolean Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0336/">PEP 336 – Make None Callable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0337/">PEP 337 – Logging Usage in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0338/">PEP 338 – Executing modules as scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0339/">PEP 339 – Design of the CPython Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0340/">PEP 340 – Anonymous Block Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0341/">PEP 341 – Unifying try-except and try-finally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0342/">PEP 342 – Coroutines via Enhanced Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0343/">PEP 343 – The “with” Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0344/">PEP 344 – Exception Chaining and Embedded Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0345/">PEP 345 – Metadata for Python Software Packages 1.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0346/">PEP 346 – User Defined (“``with``”) Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0347/">PEP 347 – Migrating the Python CVS to Subversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0348/">PEP 348 – Exception Reorganization for Python 3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0349/">PEP 349 – Allow str() to return unicode strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0350/">PEP 350 – Codetags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0351/">PEP 351 – The freeze protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0352/">PEP 352 – Required Superclass for Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0353/">PEP 353 – Using ssize_t as the index type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0354/">PEP 354 – Enumerations in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0355/">PEP 355 – Path - Object oriented filesystem paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0356/">PEP 356 – Python 2.5 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0357/">PEP 357 – Allowing Any Object to be Used for Slicing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0358/">PEP 358 – The “bytes” Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0359/">PEP 359 – The “make” Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0360/">PEP 360 – Externally Maintained Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0361/">PEP 361 – Python 2.6 and 3.0 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0362/">PEP 362 – Function Signature Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0363/">PEP 363 – Syntax For Dynamic Attribute Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0364/">PEP 364 – Transitioning to the Py3K Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0365/">PEP 365 – Adding the pkg_resources module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0366/">PEP 366 – Main module explicit relative imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0367/">PEP 367 – New Super</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0368/">PEP 368 – Standard image protocol and class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0369/">PEP 369 – Post import hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0370/">PEP 370 – Per user site-packages directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0371/">PEP 371 – Addition of the multiprocessing package to the standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0372/">PEP 372 – Adding an ordered dictionary to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0373/">PEP 373 – Python 2.7 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0374/">PEP 374 – Choosing a distributed VCS for the Python project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0375/">PEP 375 – Python 3.1 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0376/">PEP 376 – Database of Installed Python Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0377/">PEP 377 – Allow __enter__() methods to skip the statement body</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0378/">PEP 378 – Format Specifier for Thousands Separator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0379/">PEP 379 – Adding an Assignment Expression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0380/">PEP 380 – Syntax for Delegating to a Subgenerator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0381/">PEP 381 – Mirroring infrastructure for PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0382/">PEP 382 – Namespace Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0383/">PEP 383 – Non-decodable Bytes in System Character Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0384/">PEP 384 – Defining a Stable ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0385/">PEP 385 – Migrating from Subversion to Mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0386/">PEP 386 – Changing the version comparison module in Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0387/">PEP 387 – Backwards Compatibility Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0389/">PEP 389 – argparse - New Command Line Parsing Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0390/">PEP 390 – Static metadata for Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0391/">PEP 391 – Dictionary-Based Configuration For Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0392/">PEP 392 – Python 3.2 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0393/">PEP 393 – Flexible String Representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0394/">PEP 394 – The “python” Command on Unix-Like Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0395/">PEP 395 – Qualified Names for Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0396/">PEP 396 – Module Version Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0397/">PEP 397 – Python launcher for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0398/">PEP 398 – Python 3.3 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0399/">PEP 399 – Pure Python/C Accelerator Module Compatibility Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0400/">PEP 400 – Deprecate codecs.StreamReader and codecs.StreamWriter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0401/">PEP 401 – BDFL Retirement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0402/">PEP 402 – Simplified Package Layout and Partitioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0403/">PEP 403 – General purpose decorator clause (aka “&#64;in” clause)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0404/">PEP 404 – Python 2.8 Un-release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0405/">PEP 405 – Python Virtual Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0406/">PEP 406 – Improved Encapsulation of Import State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0407/">PEP 407 – New release cycle and introducing long-term support versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0408/">PEP 408 – Standard library __preview__ package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0409/">PEP 409 – Suppressing exception context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0410/">PEP 410 – Use decimal.Decimal type for timestamps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0411/">PEP 411 – Provisional packages in the Python standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0412/">PEP 412 – Key-Sharing Dictionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0413/">PEP 413 – Faster evolution of the Python Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0414/">PEP 414 – Explicit Unicode Literal for Python 3.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0415/">PEP 415 – Implement context suppression with exception attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0416/">PEP 416 – Add a frozendict builtin type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0417/">PEP 417 – Including mock in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0418/">PEP 418 – Add monotonic time, performance counter, and process time functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0419/">PEP 419 – Protecting cleanup statements from interruptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0420/">PEP 420 – Implicit Namespace Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0421/">PEP 421 – Adding sys.implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0422/">PEP 422 – Simpler customisation of class creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0423/">PEP 423 – Naming conventions and recipes related to packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0424/">PEP 424 – A method for exposing a length hint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0425/">PEP 425 – Compatibility Tags for Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0426/">PEP 426 – Metadata for Python Software Packages 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0427/">PEP 427 – The Wheel Binary Package Format 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0428/">PEP 428 – The pathlib module – object-oriented filesystem paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0429/">PEP 429 – Python 3.4 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0430/">PEP 430 – Migrating to Python 3 as the default online documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0431/">PEP 431 – Time zone support improvements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0432/">PEP 432 – Restructuring the CPython startup sequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0433/">PEP 433 – Easier suppression of file descriptor inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0434/">PEP 434 – IDLE Enhancement Exception for All Branches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0435/">PEP 435 – Adding an Enum type to the Python standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0436/">PEP 436 – The Argument Clinic DSL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0437/">PEP 437 – A DSL for specifying signatures, annotations and argument converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0438/">PEP 438 – Transitioning to release-file hosting on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0439/">PEP 439 – Inclusion of implicit pip bootstrap in Python installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0440/">PEP 440 – Version Identification and Dependency Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0441/">PEP 441 – Improving Python ZIP Application Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0442/">PEP 442 – Safe object finalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0443/">PEP 443 – Single-dispatch generic functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0444/">PEP 444 – Python Web3 Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0445/">PEP 445 – Add new APIs to customize Python memory allocators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0446/">PEP 446 – Make newly created file descriptors non-inheritable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0447/">PEP 447 – Add __getdescriptor__ method to metaclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0448/">PEP 448 – Additional Unpacking Generalizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0449/">PEP 449 – Removal of the PyPI Mirror Auto Discovery and Naming Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0450/">PEP 450 – Adding A Statistics Module To The Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0451/">PEP 451 – A ModuleSpec Type for the Import System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0452/">PEP 452 – API for Cryptographic Hash Functions v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0453/">PEP 453 – Explicit bootstrapping of pip in Python installations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0454/">PEP 454 – Add a new tracemalloc module to trace Python memory allocations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0455/">PEP 455 – Adding a key-transforming dictionary to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0456/">PEP 456 – Secure and interchangeable hash algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0457/">PEP 457 – Notation For Positional-Only Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0458/">PEP 458 – Secure PyPI downloads with signed repository metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0459/">PEP 459 – Standard Metadata Extensions for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0460/">PEP 460 – Add binary interpolation and formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0461/">PEP 461 – Adding % formatting to bytes and bytearray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0462/">PEP 462 – Core development workflow automation for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0463/">PEP 463 – Exception-catching expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0464/">PEP 464 – Removal of the PyPI Mirror Authenticity API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0465/">PEP 465 – A dedicated infix operator for matrix multiplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0466/">PEP 466 – Network Security Enhancements for Python 2.7.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0467/">PEP 467 – Minor API improvements for binary sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0468/">PEP 468 – Preserving the order of \*\*kwargs in a function.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0469/">PEP 469 – Migration of dict iteration code to Python 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0470/">PEP 470 – Removing External Hosting Support on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0471/">PEP 471 – os.scandir() function – a better and faster directory iterator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0472/">PEP 472 – Support for indexing with keyword arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0473/">PEP 473 – Adding structured data to built-in exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0474/">PEP 474 – Creating forge.python.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0475/">PEP 475 – Retry system calls failing with EINTR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0476/">PEP 476 – Enabling certificate verification by default for stdlib http clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0477/">PEP 477 – Backport ensurepip (PEP 453) to Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0478/">PEP 478 – Python 3.5 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0479/">PEP 479 – Change StopIteration handling inside generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0480/">PEP 480 – Surviving a Compromise of PyPI: End-to-end signing of packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0481/">PEP 481 – Migrate CPython to Git, Github, and Phabricator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0482/">PEP 482 – Literature Overview for Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0483/">PEP 483 – The Theory of Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0484/">PEP 484 – Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0485/">PEP 485 – A Function for testing approximate equality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0486/">PEP 486 – Make the Python Launcher aware of virtual environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0487/">PEP 487 – Simpler customisation of class creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0488/">PEP 488 – Elimination of PYO files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0489/">PEP 489 – Multi-phase extension module initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0490/">PEP 490 – Chain exceptions at C level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0491/">PEP 491 – The Wheel Binary Package Format 1.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0492/">PEP 492 – Coroutines with async and await syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0493/">PEP 493 – HTTPS verification migration tools for Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0494/">PEP 494 – Python 3.6 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0495/">PEP 495 – Local Time Disambiguation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0496/">PEP 496 – Environment Markers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0497/">PEP 497 – A standard mechanism for backward compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0498/">PEP 498 – Literal String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0499/">PEP 499 – ``python -m foo`` should bind ``sys.modules[‘foo’]`` in addition to ``sys.modules[‘__main__’]``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0500/">PEP 500 – A protocol for delegating datetime methods to their
tzinfo implementations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0501/">PEP 501 – General purpose string interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0502/">PEP 502 – String Interpolation - Extended Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0503/">PEP 503 – Simple Repository API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0504/">PEP 504 – Using the System RNG by default</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0505/">PEP 505 – None-aware operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0506/">PEP 506 – Adding A Secrets Module To The Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0507/">PEP 507 – Migrate CPython to Git and GitLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0508/">PEP 508 – Dependency specification for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0509/">PEP 509 – Add a private version to dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0510/">PEP 510 – Specialize functions with guards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0511/">PEP 511 – API for code transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0512/">PEP 512 – Migrating from hg.python.org to GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0513/">PEP 513 – A Platform Tag for Portable Linux Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0514/">PEP 514 – Python registration in the Windows registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0515/">PEP 515 – Underscores in Numeric Literals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0516/">PEP 516 – Build system abstraction for pip/conda etc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0517/">PEP 517 – A build-system independent format for source trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0518/">PEP 518 – Specifying Minimum Build System Requirements for Python Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0519/">PEP 519 – Adding a file system path protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0520/">PEP 520 – Preserving Class Attribute Definition Order</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0521/">PEP 521 – Managing global context via ‘with’ blocks in generators and coroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0522/">PEP 522 – Allow BlockingIOError in security sensitive APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0523/">PEP 523 – Adding a frame evaluation API to CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0524/">PEP 524 – Make os.urandom() blocking on Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0525/">PEP 525 – Asynchronous Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0526/">PEP 526 – Syntax for Variable Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0527/">PEP 527 – Removing Un(der)used file types/extensions on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0528/">PEP 528 – Change Windows console encoding to UTF-8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0529/">PEP 529 – Change Windows filesystem encoding to UTF-8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0530/">PEP 530 – Asynchronous Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0531/">PEP 531 – Existence checking operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0532/">PEP 532 – A circuit breaking protocol and binary operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0533/">PEP 533 – Deterministic cleanup for iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0534/">PEP 534 – Improved Errors for Missing Standard Library Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0535/">PEP 535 – Rich comparison chaining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0536/">PEP 536 – Final Grammar for Literal String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0537/">PEP 537 – Python 3.7 Release Schedule</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PEP 538 – Coercing the legacy C locale to a UTF-8 based locale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0539/">PEP 539 – A New C-API for Thread-Local Storage in CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0540/">PEP 540 – Add a new UTF-8 Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0541/">PEP 541 – Package Index Name Retention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0542/">PEP 542 – Dot Notation Assignment In Function Header</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0543/">PEP 543 – A Unified TLS API for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0544/">PEP 544 – Protocols: Structural subtyping (static duck typing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0545/">PEP 545 – Python Documentation Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0546/">PEP 546 – Backport ssl.MemoryBIO and ssl.SSLObject to Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0547/">PEP 547 – Running extension modules using the -m option</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0548/">PEP 548 – More Flexible Loop Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0549/">PEP 549 – Instance Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0550/">PEP 550 – Execution Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0551/">PEP 551 – Security transparency in the Python runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0552/">PEP 552 – Deterministic pycs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0553/">PEP 553 – Built-in breakpoint()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0554/">PEP 554 – Multiple Interpreters in the Stdlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0555/">PEP 555 – Context-local variables (contextvars)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0556/">PEP 556 – Threaded garbage collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0557/">PEP 557 – Data Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0558/">PEP 558 – Defined semantics for locals()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0559/">PEP 559 – Built-in noop()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0560/">PEP 560 – Core support for typing module and generic types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0561/">PEP 561 – Distributing and Packaging Type Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0562/">PEP 562 – Module __getattr__ and __dir__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0563/">PEP 563 – Postponed Evaluation of Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0564/">PEP 564 – Add new time functions with nanosecond resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0565/">PEP 565 – Show DeprecationWarning in __main__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0566/">PEP 566 – Metadata for Python Software Packages 2.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0567/">PEP 567 – Context Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0568/">PEP 568 – Generator-sensitivity for Context Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0569/">PEP 569 – Python 3.8 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0570/">PEP 570 – Python Positional-Only Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0571/">PEP 571 – The manylinux2010 Platform Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0572/">PEP 572 – Assignment Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0573/">PEP 573 – Module State Access from C Extension Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0574/">PEP 574 – Pickle protocol 5 with out-of-band data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0575/">PEP 575 – Unifying function/method classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0576/">PEP 576 – Rationalize Built-in function classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0577/">PEP 577 – Augmented Assignment Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0578/">PEP 578 – Python Runtime Audit Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0579/">PEP 579 – Refactoring C functions and methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0580/">PEP 580 – The C call protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0581/">PEP 581 – Using GitHub Issues for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0582/">PEP 582 – Python local packages directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0583/">PEP 583 – A Concurrency Memory Model for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0584/">PEP 584 – Add Union Operators To dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0585/">PEP 585 – Type Hinting Generics In Standard Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0586/">PEP 586 – Literal Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0587/">PEP 587 – Python Initialization Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0588/">PEP 588 – GitHub Issues Migration Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0589/">PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0590/">PEP 590 – Vectorcall: a fast calling protocol for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0591/">PEP 591 – Adding a final qualifier to typing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0592/">PEP 592 – Adding “Yank” Support to the Simple API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0593/">PEP 593 – Flexible function and variable annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0594/">PEP 594 – Removing dead batteries from the standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0595/">PEP 595 – Improving bugs.python.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0596/">PEP 596 – Python 3.9 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0597/">PEP 597 – Add optional EncodingWarning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0598/">PEP 598 – Introducing incremental feature releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0599/">PEP 599 – The manylinux2014 Platform Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0600/">PEP 600 – Future ‘manylinux’ Platform Tags for Portable Linux Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0601/">PEP 601 – Forbid return/break/continue breaking out of finally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0602/">PEP 602 – Annual Release Cycle for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0603/">PEP 603 – Adding a frozenmap type to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0604/">PEP 604 – Allow writing union types as ``X | Y``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0605/">PEP 605 – A rolling feature release stream for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0606/">PEP 606 – Python Compatibility Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0607/">PEP 607 – Reducing CPython’s Feature Delivery Latency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0608/">PEP 608 – Coordinated Python release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0609/">PEP 609 – PyPA Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0610/">PEP 610 – Recording the Direct URL Origin of installed distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0611/">PEP 611 – The one million limit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0612/">PEP 612 – Parameter Specification Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0613/">PEP 613 – Explicit Type Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0614/">PEP 614 – Relaxing Grammar Restrictions On Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0615/">PEP 615 – Support for the IANA Time Zone Database in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0616/">PEP 616 – String methods to remove prefixes and suffixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0617/">PEP 617 – New PEG parser for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0618/">PEP 618 – Add Optional Length-Checking To zip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0619/">PEP 619 – Python 3.10 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0620/">PEP 620 – Hide implementation details from the C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0621/">PEP 621 – Storing project metadata in pyproject.toml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0622/">PEP 622 – Structural Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0623/">PEP 623 – Remove wstr from Unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0624/">PEP 624 – Remove Py_UNICODE encoder APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0625/">PEP 625 – File name of a Source Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0626/">PEP 626 – Precise line numbers for debugging and other tools.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0627/">PEP 627 – Recording installed projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0628/">PEP 628 – Add ``math.tau``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0629/">PEP 629 – Versioning PyPI’s Simple API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0630/">PEP 630 – Isolating Extension Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0631/">PEP 631 – Dependency specification in pyproject.toml based on PEP 508</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0632/">PEP 632 – Deprecate distutils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0633/">PEP 633 – Dependency specification in pyproject.toml using an exploded TOML table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0634/">PEP 634 – Structural Pattern Matching: Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0635/">PEP 635 – Structural Pattern Matching: Motivation and Rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0636/">PEP 636 – Structural Pattern Matching: Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0637/">PEP 637 – Support for indexing with keyword arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0638/">PEP 638 – Syntactic Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0639/">PEP 639 – Metadata for Python Software Packages 2.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0640/">PEP 640 – Unused variable syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0641/">PEP 641 – Using an underscore in the version portion of Python 3.10 compatibility tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0642/">PEP 642 – Explicit Pattern Syntax for Structural Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0643/">PEP 643 – Metadata for Package Source Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0644/">PEP 644 – Require OpenSSL 1.1.1 or newer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0645/">PEP 645 – Allow writing optional types as ``x?``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0646/">PEP 646 – Variadic Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0647/">PEP 647 – User-Defined Type Guards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0648/">PEP 648 – Extensible customizations of the interpreter at startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0649/">PEP 649 – Deferred Evaluation Of Annotations Using Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0650/">PEP 650 – Specifying Installer Requirements for Python Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0651/">PEP 651 – Robust Stack Overflow Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0652/">PEP 652 – Maintaining the Stable ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0653/">PEP 653 – Precise Semantics for Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0654/">PEP 654 – Exception Groups and except*</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0655/">PEP 655 – Marking individual TypedDict items as required or potentially-missing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0656/">PEP 656 – Platform Tag for Linux Distributions Using Musl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0657/">PEP 657 – Include Fine Grained Error Locations in Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0658/">PEP 658 – Serve Distribution Metadata in the Simple Repository API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0659/">PEP 659 – Specializing Adaptive Interpreter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0660/">PEP 660 – Editable installs for pyproject.toml based builds (wheel based)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0661/">PEP 661 – Sentinel Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0662/">PEP 662 – Editable installs via virtual wheels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0666/">PEP 666 – Reject Foolish Indentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0754/">PEP 754 – IEEE 754 Floating Point Special Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0801/">PEP 801 – Reserved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3000/">PEP 3000 – Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3001/">PEP 3001 – Procedure for reviewing and improving standard library modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3002/">PEP 3002 – Procedure for Backwards-Incompatible Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3003/">PEP 3003 – Python Language Moratorium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3099/">PEP 3099 – Things that will Not Change in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3100/">PEP 3100 – Miscellaneous Python 3.0 Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3101/">PEP 3101 – Advanced String Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3102/">PEP 3102 – Keyword-Only Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3103/">PEP 3103 – A Switch/Case Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3104/">PEP 3104 – Access to Names in Outer Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3105/">PEP 3105 – Make print a function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3106/">PEP 3106 – Revamping dict.keys(), .values() and .items()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3107/">PEP 3107 – Function Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3108/">PEP 3108 – Standard Library Reorganization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3109/">PEP 3109 – Raising Exceptions in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3110/">PEP 3110 – Catching Exceptions in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3111/">PEP 3111 – Simple input built-in in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3112/">PEP 3112 – Bytes literals in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3113/">PEP 3113 – Removal of Tuple Parameter Unpacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3114/">PEP 3114 – Renaming iterator.next() to iterator.__next__()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3115/">PEP 3115 – Metaclasses in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3116/">PEP 3116 – New I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3117/">PEP 3117 – Postfix type declarations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3118/">PEP 3118 – Revising the buffer protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3119/">PEP 3119 – Introducing Abstract Base Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3120/">PEP 3120 – Using UTF-8 as the default source encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3121/">PEP 3121 – Extension Module Initialization and Finalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3122/">PEP 3122 – Delineation of the main module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3123/">PEP 3123 – Making PyObject_HEAD conform to standard C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3124/">PEP 3124 – Overloading, Generic Functions, Interfaces, and Adaptation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3125/">PEP 3125 – Remove Backslash Continuation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3126/">PEP 3126 – Remove Implicit String Concatenation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3127/">PEP 3127 – Integer Literal Support and Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3128/">PEP 3128 – BList: A Faster List-like Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3129/">PEP 3129 – Class Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3130/">PEP 3130 – Access to Current Module/Class/Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3131/">PEP 3131 – Supporting Non-ASCII Identifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3132/">PEP 3132 – Extended Iterable Unpacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3133/">PEP 3133 – Introducing Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3134/">PEP 3134 – Exception Chaining and Embedded Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3135/">PEP 3135 – New Super</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3136/">PEP 3136 – Labeled break and continue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3137/">PEP 3137 – Immutable Bytes and Mutable Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3138/">PEP 3138 – String representation in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3139/">PEP 3139 – Cleaning out sys and the “interpreter” module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3140/">PEP 3140 – str(container) should call str(item), not repr(item)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3141/">PEP 3141 – A Type Hierarchy for Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3142/">PEP 3142 – Add a “while” clause to generator expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3143/">PEP 3143 – Standard daemon process library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3144/">PEP 3144 – IP Address Manipulation Library for the Python Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3145/">PEP 3145 – Asynchronous I/O For subprocess.Popen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3146/">PEP 3146 – Merging Unladen Swallow into CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3147/">PEP 3147 – PYC Repository Directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3148/">PEP 3148 – futures - execute computations asynchronously</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3149/">PEP 3149 – ABI version tagged .so files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3150/">PEP 3150 – Statement local namespaces (aka “given” clause)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3151/">PEP 3151 – Reworking the OS and IO exception hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3152/">PEP 3152 – Cofunctions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3153/">PEP 3153 – Asynchronous IO support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3154/">PEP 3154 – Pickle protocol version 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3155/">PEP 3155 – Qualified name for classes and functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3156/">PEP 3156 – Asynchronous IO Support Rebooted: the “asyncio” Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3333/">PEP 3333 – Python Web Server Gateway Interface v1.0.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8000/">PEP 8000 – Python Language Governance Proposal Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8001/">PEP 8001 – Python Governance Voting Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8002/">PEP 8002 – Open Source Governance Survey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8010/">PEP 8010 – The Technical Leader Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8011/">PEP 8011 – Python Governance Model Lead by Trio of Pythonistas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8012/">PEP 8012 – The Community Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8013/">PEP 8013 – The External Council Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8014/">PEP 8014 – The Commons Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8015/">PEP 8015 – Organization of the Python community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8016/">PEP 8016 – The Steering Council Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8100/">PEP 8100 – January 2019 steering council election</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8101/">PEP 8101 – 2020 Term steering council election</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8102/">PEP 8102 – 2021 Term steering council election</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../contents/">Documentation overview</a><ul>
      <li>Previous: <a href="../pep-0537/" title="previous chapter">PEP 537 – Python 3.7 Release Schedule</a></li>
      <li>Next: <a href="../pep-0539/" title="next chapter">PEP 539 – A New C-API for Thread-Local Storage in CPython</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/pep-0538.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>