
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PEP 642 – Explicit Pattern Syntax for Structural Pattern Matching &#8212; peps.python.org</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="PEP 643 – Metadata for Package Source Distributions" href="../pep-0643/" />
    <link rel="prev" title="PEP 641 – Using an underscore in the version portion of Python 3.10 compatibility tags" href="../pep-0641/" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pep-642-explicit-pattern-syntax-for-structural-pattern-matching">
<h1 class="page-title">PEP 642 – Explicit Pattern Syntax for Structural Pattern Matching<a class="headerlink" href="#pep-642-explicit-pattern-syntax-for-structural-pattern-matching" title="Permalink to this headline">¶</a></h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd"><p>642</p>
</dd>
<dt class="field-even">Title</dt>
<dd class="field-even"><p>Explicit Pattern Syntax for Structural Pattern Matching</p>
</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Nick Coghlan &lt;<a class="reference external" href="mailto:ncoghlan&#37;&#52;&#48;gmail&#46;com?subject=PEP%20-1">ncoghlan&#32;&#97;t&#32;gmail.com</a>&gt;</p>
</dd>
<dt class="field-even">BDFL-Delegate</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Discussions-To</dt>
<dd class="field-odd"><p>Python-Dev &lt;<a class="reference external" href="mailto:python-dev&#37;&#52;&#48;python&#46;org">python-dev<span>&#64;</span>python<span>&#46;</span>org</a>&gt;</p>
</dd>
<dt class="field-even">Status</dt>
<dd class="field-even"><p>Draft</p>
</dd>
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>Standards Track</p>
</dd>
<dt class="field-even">Requires</dt>
<dd class="field-even"><p><a class="reference external" href="pep-0634.html">634</a></p>
</dd>
<dt class="field-odd">Created</dt>
<dd class="field-odd"><p>26-Sep-2020</p>
</dd>
<dt class="field-even">Python-Version</dt>
<dd class="field-even"><p>3.10</p>
</dd>
<dt class="field-odd">Post-History</dt>
<dd class="field-odd"><p>31-Oct-2020, 8-Nov-2020, 3-Jan-2021</p>
</dd>
<dt class="field-even">Resolution</dt>
<dd class="field-even"><p></p></dd>
</dl>
<hr class="docutils" />
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#abstract" id="id15">Abstract</a></p></li>
<li><p><a class="reference internal" href="#relationship-with-other-peps" id="id16">Relationship with other PEPs</a></p></li>
<li><p><a class="reference internal" href="#motivation" id="id17">Motivation</a></p></li>
<li><p><a class="reference internal" href="#specification" id="id18">Specification</a></p>
<ul>
<li><p><a class="reference internal" href="#the-match-statement" id="id19">The Match Statement</a></p>
<ul>
<li><p><a class="reference internal" href="#match-semantics" id="id20">Match Semantics</a></p></li>
<li><p><a class="reference internal" href="#guards" id="id21">Guards</a></p></li>
<li><p><a class="reference internal" href="#irrefutable-case-blocks" id="id22">Irrefutable case blocks</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#patterns" id="id23">Patterns</a></p>
<ul>
<li><p><a class="reference internal" href="#as-patterns" id="id24">AS Patterns</a></p></li>
<li><p><a class="reference internal" href="#or-patterns" id="id25">OR Patterns</a></p></li>
<li><p><a class="reference internal" href="#value-constraints" id="id26">Value constraints</a></p></li>
<li><p><a class="reference internal" href="#wildcard-pattern" id="id27">Wildcard Pattern</a></p></li>
<li><p><a class="reference internal" href="#group-patterns" id="id28">Group Patterns</a></p></li>
<li><p><a class="reference internal" href="#structural-constraints" id="id29">Structural constraints</a></p></li>
<li><p><a class="reference internal" href="#sequence-constraints" id="id30">Sequence constraints</a></p></li>
<li><p><a class="reference internal" href="#mapping-constraints" id="id31">Mapping constraints</a></p></li>
<li><p><a class="reference internal" href="#instance-attribute-constraints" id="id32">Instance attribute constraints</a></p></li>
<li><p><a class="reference internal" href="#class-defined-constraints" id="id33">Class defined constraints</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#design-discussion" id="id34">Design Discussion</a></p>
<ul>
<li><p><a class="reference internal" href="#requiring-explicit-qualification-of-simple-names-in-match-patterns" id="id35">Requiring explicit qualification of simple names in match patterns</a></p></li>
<li><p><a class="reference internal" href="#resisting-the-temptation-to-guess" id="id36">Resisting the temptation to guess</a></p></li>
<li><p><a class="reference internal" href="#interaction-with-caching-of-attribute-lookups-in-local-variables" id="id37">Interaction with caching of attribute lookups in local variables</a></p></li>
<li><p><a class="reference internal" href="#using-existing-comparison-operators-as-the-value-constraint-prefix" id="id38">Using existing comparison operators as the value constraint prefix</a></p></li>
<li><p><a class="reference internal" href="#using-as-the-wildcard-pattern-marker" id="id39">Using <code class="docutils literal notranslate"><span class="pre">__</span></code> as the wildcard pattern marker</a></p></li>
<li><p><a class="reference internal" href="#representing-patterns-explicitly-in-the-abstract-syntax-tree" id="id40">Representing patterns explicitly in the Abstract Syntax Tree</a></p></li>
<li><p><a class="reference internal" href="#changes-to-sequence-patterns" id="id41">Changes to sequence patterns</a></p></li>
<li><p><a class="reference internal" href="#changes-to-mapping-patterns" id="id42">Changes to mapping patterns</a></p></li>
<li><p><a class="reference internal" href="#changes-to-class-patterns" id="id43">Changes to class patterns</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#deferred-ideas" id="id44">Deferred Ideas</a></p>
<ul>
<li><p><a class="reference internal" href="#inferred-value-constraints" id="id45">Inferred value constraints</a></p></li>
<li><p><a class="reference internal" href="#making-some-required-parentheses-optional" id="id46">Making some required parentheses optional</a></p></li>
<li><p><a class="reference internal" href="#accepting-complex-literals-as-closed-expressions" id="id47">Accepting complex literals as closed expressions</a></p></li>
<li><p><a class="reference internal" href="#allowing-negated-constraints-in-match-patterns" id="id48">Allowing negated constraints in match patterns</a></p></li>
<li><p><a class="reference internal" href="#allowing-membership-checks-in-match-patterns" id="id49">Allowing membership checks in match patterns</a></p></li>
<li><p><a class="reference internal" href="#inferring-a-default-type-for-instance-attribute-constraints" id="id50">Inferring a default type for instance attribute constraints</a></p></li>
<li><p><a class="reference internal" href="#avoiding-special-cases-in-sequence-patterns" id="id51">Avoiding special cases in sequence patterns</a></p></li>
<li><p><a class="reference internal" href="#expression-syntax-to-retrieve-multiple-attributes-from-an-instance" id="id52">Expression syntax to retrieve multiple attributes from an instance</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id53">Expression syntax to retrieve multiple attributes from an instance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#rejected-ideas" id="id54">Rejected Ideas</a></p>
<ul>
<li><p><a class="reference internal" href="#restricting-permitted-expressions-in-value-constraints-and-mapping-pattern-keys" id="id55">Restricting permitted expressions in value constraints and mapping pattern keys</a></p></li>
<li><p><a class="reference internal" href="#requiring-the-use-of-constraint-prefix-markers-for-mapping-pattern-keys" id="id56">Requiring the use of constraint prefix markers for mapping pattern keys</a></p></li>
<li><p><a class="reference internal" href="#allowing-the-key-value-separator-to-be-omitted-for-mapping-value-constraints" id="id57">Allowing the key/value separator to be omitted for mapping value constraints</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reference-implementation" id="id58">Reference Implementation</a></p></li>
<li><p><a class="reference internal" href="#acknowledgments" id="id59">Acknowledgments</a></p></li>
<li><p><a class="reference internal" href="#references" id="id60">References</a></p></li>
<li><p><a class="reference internal" href="#appendix-a-full-grammar" id="id61">Appendix A – Full Grammar</a></p></li>
<li><p><a class="reference internal" href="#appendix-b-summary-of-abstract-syntax-tree-changes" id="id62">Appendix B: Summary of Abstract Syntax Tree changes</a></p></li>
<li><p><a class="reference internal" href="#appendix-c-summary-of-changes-relative-to-pep-634" id="id63">Appendix C: Summary of changes relative to PEP 634</a></p></li>
<li><p><a class="reference internal" href="#appendix-d-history-of-changes-to-this-proposal" id="id64">Appendix D: History of changes to this proposal</a></p></li>
<li><p><a class="reference internal" href="#copyright" id="id65">Copyright</a></p></li>
</ul>
</div>
<section id="abstract">
<h2><a class="toc-backref" href="#id15">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>This PEP covers an alternative syntax proposal for <a class="reference external" href="pep-0634.html">PEP 634</a>’s structural pattern
matching that requires explicit prefixes on all capture patterns and value
constraints. It also proposes a new dedicated syntax for instance attribute
patterns that aligns more closely with the proposed mapping pattern syntax.</p>
<p>While the result is necessarily more verbose than the proposed syntax in
<a class="reference external" href="pep-0634.html">PEP 634</a>, it is still significantly less verbose than the status quo.</p>
<p>As an example, the following match statement would extract “host” and “port”
details from a 2 item sequence, a mapping with “host” and “port” keys, any
object with “host” and “port” attributes, or a “host:port” string, treating
the “port” as optional in the latter three cases:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">port</span> <span class="o">=</span> <span class="n">DEFAULT_PORT</span>
<span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">[</span><span class="k">as</span> <span class="n">host</span><span class="p">,</span> <span class="k">as</span> <span class="n">port</span><span class="p">]:</span>
        <span class="k">pass</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;host&quot;</span> <span class="k">as</span> <span class="n">host</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span> <span class="k">as</span> <span class="n">port</span><span class="p">}:</span>
        <span class="k">pass</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;host&quot;</span> <span class="k">as</span> <span class="n">host</span><span class="p">}:</span>
        <span class="k">pass</span>
    <span class="n">case</span> <span class="nb">object</span><span class="p">{</span><span class="o">.</span><span class="n">host</span> <span class="k">as</span> <span class="n">host</span><span class="p">,</span> <span class="o">.</span><span class="n">port</span> <span class="k">as</span> <span class="n">port</span><span class="p">}:</span>
        <span class="k">pass</span>
    <span class="n">case</span> <span class="nb">object</span><span class="p">{</span><span class="o">.</span><span class="n">host</span> <span class="k">as</span> <span class="n">host</span><span class="p">}:</span>
        <span class="k">pass</span>
    <span class="n">case</span> <span class="nb">str</span><span class="p">{}</span> <span class="k">as</span> <span class="n">addr</span><span class="p">:</span>
        <span class="n">host</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">optional_port</span> <span class="o">=</span> <span class="n">addr</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">optional_port</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">optional_port</span>
    <span class="n">case</span> <span class="n">__</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown address format: </span><span class="si">{</span><span class="n">m</span><span class="si">!r:</span><span class="s2">.200</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
</pre></div>
</div>
<p>At a high level, this PEP proposes to categorise the different available pattern
types as follows:</p>
<ul class="simple">
<li><p>wildcard pattern: <code class="docutils literal notranslate"><span class="pre">__</span></code></p></li>
<li><p>group patterns: <code class="docutils literal notranslate"><span class="pre">(PTRN)</span></code></p></li>
<li><dl class="simple">
<dt>value constraint patterns:</dt><dd><ul>
<li><p>equality constraints: <code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">EXPR</span></code></p></li>
<li><p>identity contraints: <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">EXPR</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>structural constraint patterns:</dt><dd><ul>
<li><p>sequence constraint patterns: <code class="docutils literal notranslate"><span class="pre">[PTRN,</span> <span class="pre">as</span> <span class="pre">NAME,</span> <span class="pre">PTRN</span> <span class="pre">as</span> <span class="pre">NAME]</span></code></p></li>
<li><p>mapping constraint patterns: <code class="docutils literal notranslate"><span class="pre">{EXPR:</span> <span class="pre">PTRN,</span> <span class="pre">EXPR</span> <span class="pre">as</span> <span class="pre">NAME}</span></code></p></li>
<li><p>instance attribute constraint patterns:
<code class="docutils literal notranslate"><span class="pre">CLS{.NAME,</span> <span class="pre">.NAME:</span> <span class="pre">PTRN,</span> <span class="pre">.NAME</span> <span class="pre">==</span> <span class="pre">EXPR,</span> <span class="pre">.NAME</span> <span class="pre">as</span> <span class="pre">NAME}</span></code></p></li>
<li><p>class defined constraint patterns:
<code class="docutils literal notranslate"><span class="pre">CLS(PTRN,</span> <span class="pre">PTRN,</span> <span class="pre">**{.NAME,</span> <span class="pre">.NAME:</span> <span class="pre">PTRN,</span> <span class="pre">.NAME</span> <span class="pre">==</span> <span class="pre">EXPR,</span> <span class="pre">.NAME</span> <span class="pre">as</span> <span class="pre">NAME})</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>OR patterns: <code class="docutils literal notranslate"><span class="pre">PTRN</span> <span class="pre">|</span> <span class="pre">PTRN</span> <span class="pre">|</span> <span class="pre">PTRN</span></code></p></li>
<li><p>AS patterns: <code class="docutils literal notranslate"><span class="pre">PTRN</span> <span class="pre">as</span> <span class="pre">NAME</span></code> (omitting the pattern implies <code class="docutils literal notranslate"><span class="pre">__</span></code>)</p></li>
</ul>
<p>The intent of this approach is to:</p>
<ul class="simple">
<li><p>allow an initial form of pattern matching to be developed and released without
needing to decide up front on the best default options for handling bare names,
attribute lookups, and literal values</p></li>
<li><p>ensure that pattern matching is defined explicitly at the Abstract Syntax Tree
level, allowing the specifications of the semantics and the surface syntax for
pattern matching to be clearly separated</p></li>
<li><p>define a clear and concise “ducktyping” syntax that could potentially be
adopted in ordinary expressions as a way to more easily retrieve a tuple
containing multiple attributes from the same object</p></li>
</ul>
<p>Relative to <a class="reference external" href="pep-0634.html">PEP 634</a>, the proposal also deliberately eliminates any syntax that
“binds to the right” without using the <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword (using capture patterns
in <a class="reference external" href="pep-0634.html">PEP 634</a>’s mapping patterns and class patterns) or binds to both the left and
the right in the same pattern (using <a class="reference external" href="pep-0634.html">PEP 634</a>’s capture patterns with AS patterns)</p>
</section>
<section id="relationship-with-other-peps">
<h2><a class="toc-backref" href="#id16">Relationship with other PEPs</a><a class="headerlink" href="#relationship-with-other-peps" title="Permalink to this headline">¶</a></h2>
<p>This PEP both depends on and competes with <a class="reference external" href="pep-0634.html">PEP 634</a> - the PEP author agrees that
match statements would be a sufficiently valuable addition to the language to
be worth the additional complexity that they add to the learning process, but
disagrees with the idea that “simple name vs literal or attribute lookup”
really offers an adequate syntactic distinction between name binding and value
lookup operations in match patterns (at least for Python).</p>
<p>This PEP agrees with the spirit of <a class="reference external" href="pep-0640.html">PEP 640</a> (that the chosen wildcard pattern to
skip a name binding should be supported everywhere, not just in match patterns),
but is now proposing a different spelling for the wildcard syntax (<code class="docutils literal notranslate"><span class="pre">__</span></code> rather
than <code class="docutils literal notranslate"><span class="pre">?</span></code>). As such, it competes with <a class="reference external" href="pep-0640.html">PEP 640</a> as written, but would complement
a proposal to deprecate the use of <code class="docutils literal notranslate"><span class="pre">__</span></code> as an ordinary identifier and instead
turn it into a general purpose wildcard marker that always skips making a new
local variable binding.</p>
<p>While it has not yet been put forward as a PEP, Mark Shannon has a pre-PEP draft
[<a class="reference internal" href="#id13">8</a>] expressing several concerns about the runtime semantics of the pattern
matching proposal in <a class="reference external" href="pep-0634.html">PEP 634</a>. This PEP is somewhat complementary to that one, as
even though this PEP is mostly about surface syntax changes rather than major
semantic changes, it does propose that the Abstract Syntax Tree definition be
made more explicit to better separate the details of the surface syntax from the
semantics of the code generation step. There is one specific idea in that pre-PEP
draft that this PEP explicitly rejects: the idea that the different kinds of
matching are mutually exclusive. It’s entirely possible for the same value to
match different kinds of structural pattern, and which one takes precedence will
intentionally be governed by the order of the cases in the match statement.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#id17">Motivation</a><a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>The original <a class="reference external" href="pep-0622.html">PEP 622</a> (which was later split into <a class="reference external" href="pep-0634.html">PEP 634</a>, <a class="reference external" href="pep-0635.html">PEP 635</a>, and <a class="reference external" href="pep-0636.html">PEP 636</a>)
incorporated an unstated but essential assumption in its syntax design: that
neither ordinary expressions <em>nor</em> the existing assignment target syntax provide
an adequate foundation for the syntax used in match patterns.</p>
<p>While the PEP didn’t explicitly state this assumption, one of the PEP authors
explained it clearly on python-dev [<a class="reference internal" href="#id6">1</a>]:</p>
<blockquote>
<div><p>The actual problem that I see is that we have different cultures/intuitions
fundamentally clashing here.  In particular, so many programmers welcome
pattern matching as an “extended switch statement” and find it therefore
strange that names are binding and not expressions for comparison.  Others
argue that it is at odds with current assignment statements, say, and
question why dotted names are _/not/_ binding.  What all groups seem to
have in common, though, is that they refer to _/their/_ understanding and
interpretation of the new match statement as ‘consistent’ or ‘intuitive’
— naturally pointing out where we as PEP authors went wrong with our
design.</p>
<p>But here is the catch: at least in the Python world, pattern matching as
proposed by this PEP is an unprecedented and new way of approaching a common
problem.  It is not simply an extension of something already there.  Even
worse: while designing the PEP we found that no matter from which angle you
approach it, you will run into issues of seeming ‘inconsistencies’ (which is
to say that pattern matching cannot be reduced to a ‘linear’ extension of
existing features in a meaningful way): there is always something that goes
fundamentally beyond what is already there in Python.  That’s why I argue
that arguments based on what is ‘intuitive’ or ‘consistent’ just do not
make sense _/in this case/_.</p>
</div></blockquote>
<p>The first iteration of this PEP was then born out of an attempt to show that the
second assertion was not accurate, and that match patterns could be treated
as a variation on assignment targets without leading to inherent contradictions.
(An earlier PR submitted to list this option in the “Rejected Ideas” section
of the original <a class="reference external" href="pep-0622.html">PEP 622</a> had previously been declined [<a class="reference internal" href="#id7">2</a>]).</p>
<p>However, the review process for this PEP strongly suggested that not only did
the contradictions that Tobias mentioned in his email exist, but they were also
concerning enough to cast doubts on the syntax proposal presented in <a class="reference external" href="pep-0634.html">PEP 634</a>.
Accordingly, this PEP was changed to go even further than <a class="reference external" href="pep-0634.html">PEP 634</a>, and largely
abandon alignment between the sequence matching syntax and the existing iterable
unpacking syntax (effectively answering “Not really, as least as far as the
exact syntax is concerned” to the first question raised in the DLS’20 paper
[<a class="reference internal" href="#id14">9</a>]: “Can we extend a feature like iterable unpacking to work for more general
object and data layouts?”).</p>
<p>This resulted in a complete reversal of the goals of the PEP: rather than
attempting to emphasise the similarities between assignment and pattern matching,
the PEP now attempts to make sure that assignment target syntax isn’t being
reused <em>at all</em>, reducing the likelihood of incorrect inferences being drawn
about the new construct based on experience with existing ones.</p>
<p>Finally, before completing the 3rd iteration of the proposal (which dropped
inferred patterns entirely), the PEP author spent quite a bit of time reflecting
on the following entries in <a class="reference external" href="pep-0020.html">PEP 20</a>:</p>
<ul class="simple">
<li><p>Explicit is better than implicit.</p></li>
<li><p>Special cases aren’t special enough to break the rules.</p></li>
<li><p>In the face of ambiguity, refuse the temptation to guess.</p></li>
</ul>
<p>If we start with an explicit syntax, we can always add syntactic shortcuts later
(e.g. consider the recent proposals to add shortcuts for <code class="docutils literal notranslate"><span class="pre">Union</span></code> and
<code class="docutils literal notranslate"><span class="pre">Optional</span></code> type hints only after years of experience with the original more
verbose forms), while if we start out with only the abbreviated forms,
then we don’t have any real way to revisit those decisions in a future release.</p>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#id18">Specification</a><a class="headerlink" href="#specification" title="Permalink to this headline">¶</a></h2>
<p>This PEP retains the overall <code class="docutils literal notranslate"><span class="pre">match</span></code>/<code class="docutils literal notranslate"><span class="pre">case</span></code> statement structure and semantics
from <a class="reference external" href="pep-0634.html">PEP 634</a>, but proposes multiple changes that mean that user intent is
explicitly specified in the concrete syntax rather than needing to be inferred
from the pattern matching context.</p>
<p>In the proposed Abstract Syntax Tree, the semantics are also always explicit,
with no inference required.</p>
<section id="the-match-statement">
<h3><a class="toc-backref" href="#id19">The Match Statement</a><a class="headerlink" href="#the-match-statement" title="Permalink to this headline">¶</a></h3>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>match_stmt: &quot;match&quot; subject_expr &#39;:&#39; NEWLINE INDENT case_block+ DEDENT
subject_expr:
    | star_named_expression &#39;,&#39; star_named_expressions?
    | named_expression
case_block: &quot;case&quot; (guarded_pattern | open_pattern) &#39;:&#39; block

guarded_pattern: closed_pattern &#39;if&#39; named_expression

open_pattern:
    | as_pattern
    | or_pattern

closed_pattern:
    | wildcard_pattern
    | group_pattern
    | structural_constraint
</pre></div>
</div>
<p>Abstract syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Match(expr subject, match_case* cases)
match_case = (pattern pattern, expr? guard, stmt* body)
</pre></div>
</div>
<p>The rules <code class="docutils literal notranslate"><span class="pre">star_named_expression</span></code>, <code class="docutils literal notranslate"><span class="pre">star_named_expressions</span></code>,
<code class="docutils literal notranslate"><span class="pre">named_expression</span></code> and <code class="docutils literal notranslate"><span class="pre">block</span></code> are part of the <a class="reference external" href="https://docs.python.org/3.10/reference/grammar.html">standard Python
grammar</a>.</p>
<p>Open patterns are patterns which consist of multiple tokens, and aren’t
necessarily terminated by a closing delimiter (for example, <code class="docutils literal notranslate"><span class="pre">__</span> <span class="pre">as</span> <span class="pre">x</span></code>,
<code class="docutils literal notranslate"><span class="pre">int()</span> <span class="pre">|</span> <span class="pre">bool()</span></code>). To avoid ambiguity for human readers, their usage is
restricted to top level patterns and to group patterns (which are patterns
surrounded by parentheses).</p>
<p>Closed patterns are patterns which either consist of a single token
(i.e. <code class="docutils literal notranslate"><span class="pre">__</span></code>), or else have a closing delimeter as a required part of their
syntax (e.g. <code class="docutils literal notranslate"><span class="pre">[as</span> <span class="pre">x,</span> <span class="pre">as</span> <span class="pre">y]</span></code>, <code class="docutils literal notranslate"><span class="pre">object{.x</span> <span class="pre">as</span> <span class="pre">x,</span> <span class="pre">.y</span> <span class="pre">as</span> <span class="pre">y}</span></code>).</p>
<p>As in <a class="reference external" href="pep-0634.html">PEP 634</a>, the <code class="docutils literal notranslate"><span class="pre">match</span></code> and <code class="docutils literal notranslate"><span class="pre">case</span></code> keywords are soft keywords, i.e. they
are not reserved words in other grammatical contexts (including at the
start of a line if there is no colon where expected).  This means
that they are recognized as keywords when part of a match
statement or case block only, and are allowed to be used in all
other contexts as variable or argument names.</p>
<p>Unlike <a class="reference external" href="pep-0634.html">PEP 634</a>, patterns are explicitly defined as a new kind of node in the
abstract syntax tree - even when surface syntax is shared with existing
expression nodes, a distinct abstract node is emitted by the parser.</p>
<p>For context, <code class="docutils literal notranslate"><span class="pre">match_stmt</span></code> is a new alternative for
<code class="docutils literal notranslate"><span class="pre">compound_statement</span></code> in the surface syntax and <code class="docutils literal notranslate"><span class="pre">Match</span></code> is a new
alternative for <code class="docutils literal notranslate"><span class="pre">stmt</span></code> in the abstract syntax.</p>
<section id="match-semantics">
<h4><a class="toc-backref" href="#id20">Match Semantics</a><a class="headerlink" href="#match-semantics" title="Permalink to this headline">¶</a></h4>
<p>This PEP largely retains the overall pattern matching semantics proposed in
<a class="reference external" href="pep-0634.html">PEP 634</a>.</p>
<p>The proposed syntax for patterns changes significantly, and is discussed in
detail below.</p>
<p>There are also some proposed changes to the semantics of class defined
constraints (class patterns in <a class="reference external" href="pep-0634.html">PEP 634</a>) to eliminate the need to special case
any builtin types (instead, the introduction of dedicated syntax for instance
attribute constraints allows the behaviour needed by those builtin types to be
specified as applying to any type that sets <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p>
</section>
<section id="guards">
<span id="id1"></span><h4><a class="toc-backref" href="#id21">Guards</a><a class="headerlink" href="#guards" title="Permalink to this headline">¶</a></h4>
<p>This PEP retains the guard clause semantics proposed in <a class="reference external" href="pep-0634.html">PEP 634</a>.</p>
<p>However, the syntax is changed slightly to require that when a guard clause
is present, the case pattern must be a <em>closed</em> pattern.</p>
<p>This makes it clearer to the reader where the pattern ends and the guard clause
begins. (This is mainly a potential problem with OR patterns, where the guard
clause looks kind of like the start of a conditional expression in the final
pattern. Actually doing that isn’t legal syntax, so there’s no ambiguity as far
as the compiler is concerned, but the distinction may not be as clear to a human
reader)</p>
</section>
<section id="irrefutable-case-blocks">
<h4><a class="toc-backref" href="#id22">Irrefutable case blocks</a><a class="headerlink" href="#irrefutable-case-blocks" title="Permalink to this headline">¶</a></h4>
<p>The definition of irrefutable case blocks changes slightly in this PEP relative
to <a class="reference external" href="pep-0634.html">PEP 634</a>, as capture patterns no longer exist as a separate concept from
AS patterns.</p>
<p>Aside from that caveat, the handling of irrefutable cases is the same as in
<a class="reference external" href="pep-0634.html">PEP 634</a>:</p>
<ul class="simple">
<li><p>wildcard patterns are irrefutable</p></li>
<li><p>AS patterns whose left-hand side is irrefutable</p></li>
<li><p>OR patterns containing at least one irrefutable pattern</p></li>
<li><p>parenthesized irrefutable patterns</p></li>
<li><p>a case block is considered irrefutable if it has no guard and its
pattern is irrefutable.</p></li>
<li><p>a match statement may have at most one irrefutable case block, and it
must be last.</p></li>
</ul>
</section>
</section>
<section id="patterns">
<span id="id2"></span><h3><a class="toc-backref" href="#id23">Patterns</a><a class="headerlink" href="#patterns" title="Permalink to this headline">¶</a></h3>
<p>The top-level surface syntax for patterns is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">open_pattern</span><span class="p">:</span> <span class="c1"># Pattern may use multiple tokens with no closing delimiter</span>
    <span class="o">|</span> <span class="n">as_pattern</span>
    <span class="o">|</span> <span class="n">or_pattern</span>

<span class="n">as_pattern</span><span class="p">:</span> <span class="p">[</span><span class="n">closed_pattern</span><span class="p">]</span> <span class="n">pattern_as_clause</span>

<span class="n">or_pattern</span><span class="p">:</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">simple_pattern</span><span class="o">+</span>

<span class="n">simple_pattern</span><span class="p">:</span> <span class="c1"># Subnode where &quot;as&quot; and &quot;or&quot; patterns must be parenthesised</span>
    <span class="o">|</span> <span class="n">closed_pattern</span>
    <span class="o">|</span> <span class="n">value_constraint</span>

<span class="n">closed_pattern</span><span class="p">:</span> <span class="c1"># Require a single token or a closing delimiter in pattern</span>
    <span class="o">|</span> <span class="n">wildcard_pattern</span>
    <span class="o">|</span> <span class="n">group_pattern</span>
    <span class="o">|</span> <span class="n">structural_constraint</span>
</pre></div>
</div>
<p>As described above, the usage of open patterns is limited to top level case
clauses and when parenthesised in a group pattern.</p>
<p>The abstract syntax for patterns explicitly indicates which elements are
subpatterns and which elements are subexpressions or identifiers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pattern = MatchAlways
     | MatchValue(matchop op, expr value)
     | MatchSequence(pattern* patterns)
     | MatchMapping(expr* keys, pattern* patterns)
     | MatchAttrs(expr cls, identifier* attrs, pattern* patterns)
     | MatchClass(expr cls, pattern* patterns, identifier* extra_attrs, pattern* extra_patterns)

     | MatchRestOfSequence(identifier? target)
     -- A NULL entry in the MatchMapping key list handles capturing extra mapping keys

     | MatchAs(pattern? pattern, identifier target)
     | MatchOr(pattern* patterns)
</pre></div>
</div>
<section id="as-patterns">
<h4><a class="toc-backref" href="#id24">AS Patterns</a><a class="headerlink" href="#as-patterns" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>as_pattern: [closed_pattern] pattern_as_clause
pattern_as_clause: &#39;as&#39; pattern_capture_target
pattern_capture_target: !&quot;__&quot; NAME !(&#39;.&#39; | &#39;(&#39; | &#39;=&#39;)
</pre></div>
</div>
<p>(Note: the name on the right may not be <code class="docutils literal notranslate"><span class="pre">__</span></code>.)</p>
<p>Abstract syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MatchAs(pattern? pattern, identifier target)
</pre></div>
</div>
<p>An AS pattern matches the closed pattern on the left of the <code class="docutils literal notranslate"><span class="pre">as</span></code>
keyword against the subject.  If this fails, the AS pattern fails.
Otherwise, the AS pattern binds the subject to the name on the right
of the <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword and succeeds.</p>
<p>If no pattern to match is given, the wildcard pattern (<code class="docutils literal notranslate"><span class="pre">__</span></code>) is implied.</p>
<p>To avoid confusion with the <a class="reference internal" href="#id4">wildcard pattern</a>, the double underscore (<code class="docutils literal notranslate"><span class="pre">__</span></code>)
is not permitted as a capture target (this is what <code class="docutils literal notranslate"><span class="pre">!&quot;__&quot;</span></code> expresses).</p>
<p>A capture pattern always succeeds.  It binds the subject value to the
name using the scoping rules for name binding established for named expressions
in <a class="reference external" href="pep-0572.html">PEP 572</a>.  (Summary: the name becomes a local
variable in the closest containing function scope unless there’s an
applicable <code class="docutils literal notranslate"><span class="pre">nonlocal</span></code> or <code class="docutils literal notranslate"><span class="pre">global</span></code> statement.)</p>
<p>In a given pattern, a given name may be bound only once.  This
disallows for example <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">[as</span> <span class="pre">x,</span> <span class="pre">as</span> <span class="pre">x]:</span> <span class="pre">...</span></code> but allows
<code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">[as</span> <span class="pre">x]</span> <span class="pre">|</span> <span class="pre">(as</span> <span class="pre">x)</span></code>:</p>
<p>As an open pattern, the usage of AS patterns is limited to top level case
clauses and when parenthesised in a group pattern. However, several of the
structural constraints allow the use of <code class="docutils literal notranslate"><span class="pre">pattern_as_clause</span></code> in relevant
locations to bind extracted elements of the matched subject to local variables.
These are mostly represented in the abstract syntax tree as <code class="docutils literal notranslate"><span class="pre">MatchAs</span></code> nodes,
aside from the dedicated <code class="docutils literal notranslate"><span class="pre">MatchRestOfSequence</span></code> node in sequence patterns.</p>
</section>
<section id="or-patterns">
<h4><a class="toc-backref" href="#id25">OR Patterns</a><a class="headerlink" href="#or-patterns" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">or_pattern</span><span class="p">:</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">simple_pattern</span><span class="o">+</span>

<span class="n">simple_pattern</span><span class="p">:</span> <span class="c1"># Subnode where &quot;as&quot; and &quot;or&quot; patterns must be parenthesised</span>
    <span class="o">|</span> <span class="n">closed_pattern</span>
    <span class="o">|</span> <span class="n">value_constraint</span>
</pre></div>
</div>
<p>Abstract syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MatchOr</span><span class="p">(</span><span class="n">pattern</span><span class="o">*</span> <span class="n">patterns</span><span class="p">)</span>
</pre></div>
</div>
<p>When two or more patterns are separated by vertical bars (<code class="docutils literal notranslate"><span class="pre">|</span></code>),
this is called an OR pattern. (A single simple pattern is just that)</p>
<p>Only the final subpattern may be irrefutable.</p>
<p>Each subpattern must bind the same set of names.</p>
<p>An OR pattern matches each of its subpatterns in turn to the subject,
until one succeeds.  The OR pattern is then deemed to succeed.
If none of the subpatterns succeed the OR pattern fails.</p>
<p>Subpatterns are mostly required to be closed patterns, but the parentheses may
be omitted for value constraints.</p>
</section>
<section id="value-constraints">
<span id="id3"></span><h4><a class="toc-backref" href="#id26">Value constraints</a><a class="headerlink" href="#value-constraints" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value_constraint</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">eq_constraint</span>
    <span class="o">|</span> <span class="n">id_constraint</span>

<span class="n">eq_constraint</span><span class="p">:</span> <span class="s1">&#39;==&#39;</span> <span class="n">closed_expr</span>
<span class="n">id_constraint</span><span class="p">:</span> <span class="s1">&#39;is&#39;</span> <span class="n">closed_expr</span>

<span class="n">closed_expr</span><span class="p">:</span> <span class="c1"># Require a single token or a closing delimiter in expression</span>
    <span class="o">|</span> <span class="n">primary</span>
    <span class="o">|</span> <span class="n">closed_factor</span>

<span class="n">closed_factor</span><span class="p">:</span> <span class="c1"># &quot;factor&quot; is the main grammar node for these unary ops</span>
    <span class="o">|</span> <span class="s1">&#39;+&#39;</span> <span class="n">primary</span>
    <span class="o">|</span> <span class="s1">&#39;-&#39;</span> <span class="n">primary</span>
    <span class="o">|</span> <span class="s1">&#39;~&#39;</span> <span class="n">primary</span>
</pre></div>
</div>
<p>Abstract syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MatchValue</span><span class="p">(</span><span class="n">matchop</span> <span class="n">op</span><span class="p">,</span> <span class="n">expr</span> <span class="n">value</span><span class="p">)</span>
<span class="n">matchop</span> <span class="o">=</span> <span class="n">EqCheck</span> <span class="o">|</span> <span class="n">IdCheck</span>
</pre></div>
</div>
<p>The rule <code class="docutils literal notranslate"><span class="pre">primary</span></code> is defined in the standard Python grammar, and only
allows expressions that either consist of a single token, or else are required
to end with a closing delimiter.</p>
<p>Value constraints replace <a class="reference external" href="pep-0634.html">PEP 634</a>’s literal patterns and value patterns.</p>
<p>Equality constraints are written as <code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">EXPR</span></code>, while identity constraints are
written as <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">EXPR</span></code>.</p>
<p>An equality constraint succeeds if the subject value compares equal to the
value given on the right, while an identity constraint succeeds only if they are
the exact same object.</p>
<p>The expressions to be compared against are largely restricted to either
single tokens (e.g. names, strings, numbers, builtin constants), or else to
expressions that are required to end with a closing delimiter.</p>
<p>The use of the high precedence unary operators is also permitted, as the risk of
perceived ambiguity is low, and being able to specify negative numbers without
parentheses is desirable.</p>
<p>When the same constraint expression occurs multiple times in the same match
statement, the interpreter may cache the first value calculated and reuse it,
rather than repeat the expression evaluation. (As for <a class="reference external" href="pep-0634.html">PEP 634</a> value patterns,
this cache is strictly tied to a given execution of a given match statement.)</p>
<p>Unlike literal patterns in <a class="reference external" href="pep-0634.html">PEP 634</a>, this PEP requires that complex
literals be parenthesised to be accepted by the parser. See the Deferred
Ideas section for discussion on that point.</p>
<p>If this PEP were to be adopted in preference to <a class="reference external" href="pep-0634.html">PEP 634</a>, then all literal and
value patterns would instead be written more explicitly as value constraints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Literal patterns</span>
<span class="n">match</span> <span class="n">number</span><span class="p">:</span>
    <span class="n">case</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Just one&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A couple&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;One less than nothing&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Good luck with that...&quot;</span><span class="p">)</span>

<span class="c1"># Additional literal patterns</span>
<span class="n">match</span> <span class="n">value</span><span class="p">:</span>
    <span class="n">case</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True or 1&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False or 0&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;Hello&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text &#39;Hello&#39;&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;World!&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Binary &#39;World!&#39;&quot;</span><span class="p">)</span>

<span class="c1"># Matching by identity rather than equality</span>
<span class="n">SENTINEL</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
<span class="n">match</span> <span class="n">value</span><span class="p">:</span>
    <span class="n">case</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True, not 1&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False, not 0&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;None, following PEP 8 comparison guidelines&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="ow">is</span> <span class="o">...</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;May be useful when writing __getitem__ methods?&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="ow">is</span> <span class="n">SENTINEL</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matches the sentinel by identity, not just value&quot;</span><span class="p">)</span>

<span class="c1"># Matching against variables and attributes</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="k">class</span> <span class="nc">Sides</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">SPAM</span> <span class="o">=</span> <span class="s2">&quot;Spam&quot;</span>
    <span class="n">EGGS</span> <span class="o">=</span> <span class="s2">&quot;eggs&quot;</span>
    <span class="o">...</span>

<span class="n">preferred_side</span> <span class="o">=</span> <span class="n">Sides</span><span class="o">.</span><span class="n">EGGS</span>
<span class="n">match</span> <span class="n">entree</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">case</span> <span class="o">==</span> <span class="n">Sides</span><span class="o">.</span><span class="n">SPAM</span><span class="p">:</span>  <span class="c1"># Compares entree[-1] == Sides.SPAM.</span>
        <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;Have you got anything without Spam?&quot;</span>
    <span class="n">case</span> <span class="o">==</span> <span class="n">preferred_side</span><span class="p">:</span>  <span class="c1"># Compares entree[-1] == preferred_side</span>
        <span class="n">response</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Oh, I love </span><span class="si">{</span><span class="n">preferred_side</span><span class="si">}</span><span class="s2">!&quot;</span>
    <span class="n">case</span> <span class="k">as</span> <span class="n">side</span><span class="p">:</span>  <span class="c1"># Assigns side = entree[-1].</span>
        <span class="n">response</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Well, could I have their Spam instead of the </span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s2"> then?&quot;</span>
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">preferred_side</span></code> example: using an explicit prefix marker on
constraint expressions removes the restriction to only working with attributes
or literals for value lookups.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">(1-1j)</span></code> example illustrates the use of parentheses to turn any
subexpression into a closed one.</p>
</section>
<section id="wildcard-pattern">
<span id="id4"></span><h4><a class="toc-backref" href="#id27">Wildcard Pattern</a><a class="headerlink" href="#wildcard-pattern" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wildcard_pattern</span><span class="p">:</span> <span class="s2">&quot;__&quot;</span>
</pre></div>
</div>
<p>Abstract syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MatchAlways</span>
</pre></div>
</div>
<p>A wildcard pattern always succeeds.  As in <a class="reference external" href="pep-0634.html">PEP 634</a>, it binds no name.</p>
<p>Where <a class="reference external" href="pep-0634.html">PEP 634</a> chooses the single underscore as its wildcard pattern for
consistency with other languages, this PEP chooses the double underscore as that
has a clearer path towards potentially being made consistent across the entire
language, whereas that path is blocked for <code class="docutils literal notranslate"><span class="pre">&quot;_&quot;</span></code> by i18n related use cases.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">sequence</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">[</span><span class="n">__</span><span class="p">]:</span>               <span class="c1"># any sequence with a single element</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">case</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="o">*</span><span class="n">__</span><span class="p">,</span> <span class="n">end</span><span class="p">]:</span>  <span class="c1"># a sequence with at least two elements</span>
        <span class="k">return</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span>
    <span class="n">case</span> <span class="n">__</span><span class="p">:</span>                 <span class="c1"># anything</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="group-patterns">
<h4><a class="toc-backref" href="#id28">Group Patterns</a><a class="headerlink" href="#group-patterns" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">group_pattern</span><span class="p">:</span> <span class="s1">&#39;(&#39;</span> <span class="n">open_pattern</span> <span class="s1">&#39;)&#39;</span>
</pre></div>
</div>
<p>For the syntax of <code class="docutils literal notranslate"><span class="pre">open_pattern</span></code>, see Patterns above.</p>
<p>A parenthesized pattern has no additional syntax and is not represented in the
abstract syntax tree.  It allows users to add parentheses around patterns to
emphasize the intended grouping, and to allow nesting of open patterns when the
grammar requires a closed pattern.</p>
<p>Unlike <a class="reference external" href="pep-0634.html">PEP 634</a>, there is no potential ambiguity with sequence patterns, as
this PEP requires that all sequence patterns be written with square brackets.</p>
</section>
<section id="structural-constraints">
<h4><a class="toc-backref" href="#id29">Structural constraints</a><a class="headerlink" href="#structural-constraints" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structural_constraint</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">sequence_constraint</span>
    <span class="o">|</span> <span class="n">mapping_constraint</span>
    <span class="o">|</span> <span class="n">attrs_constraint</span>
    <span class="o">|</span> <span class="n">class_constraint</span>
</pre></div>
</div>
<p>Note: the separate “structural constraint” subcategory isn’t used in the
abstract syntax tree, it’s merely used as a convenient grouping node in the
surface syntax definition.</p>
<p>Structural constraints are patterns used to both make assertions about complex
objects and to extract values from them.</p>
<p>These patterns may all bind multiple values, either through the use of nested
AS patterns, or else through the use of <code class="docutils literal notranslate"><span class="pre">pattern_as_clause</span></code> elements included
in the definition of the pattern.</p>
</section>
<section id="sequence-constraints">
<h4><a class="toc-backref" href="#id30">Sequence constraints</a><a class="headerlink" href="#sequence-constraints" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sequence_constraint: &#39;[&#39; [sequence_constraint_elements] &#39;]&#39;
sequence_constraint_elements: &#39;,&#39;.sequence_constraint_element+ &#39;,&#39;?
sequence_constraint_element:
    | star_pattern
    | simple_pattern
    | pattern_as_clause
star_pattern: &#39;*&#39; (pattern_as_clause | wildcard_pattern)

simple_pattern: # Subnode where &quot;as&quot; and &quot;or&quot; patterns must be parenthesised
    | closed_pattern
    | value_constraint

pattern_as_clause: &#39;as&#39; pattern_capture_target
</pre></div>
</div>
<p>Abstract syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MatchSequence(pattern* patterns)

MatchRestOfSequence(identifier? target)
</pre></div>
</div>
<p>Sequence constraints allow items within a sequence to be checked and
optionally extracted.</p>
<p>A sequence pattern fails if the subject value is not an instance of
<code class="docutils literal notranslate"><span class="pre">collections.abc.Sequence</span></code>.  It also fails if the subject value is
an instance of <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code> or <code class="docutils literal notranslate"><span class="pre">bytearray</span></code> (see Deferred Ideas for
a discussion on potentially removing the need for this special casing).</p>
<p>A sequence pattern may contain at most one star subpattern.  The star
subpattern may occur in any position and is represented in the AST using the
<code class="docutils literal notranslate"><span class="pre">MatchRestOfSequence</span></code> node.</p>
<p>If no star subpattern is present, the sequence pattern is a fixed-length
sequence pattern; otherwise it is a variable-length sequence pattern.</p>
<p>A fixed-length sequence pattern fails if the length of the subject
sequence is not equal to the number of subpatterns.</p>
<p>A variable-length sequence pattern fails if the length of the subject
sequence is less than the number of non-star subpatterns.</p>
<p>The length of the subject sequence is obtained using the builtin
<code class="docutils literal notranslate"><span class="pre">len()</span></code> function (i.e., via the <code class="docutils literal notranslate"><span class="pre">__len__</span></code> protocol).  However, the
interpreter may cache this value in a similar manner as described for
value constraint expressions.</p>
<p>A fixed-length sequence pattern matches the subpatterns to
corresponding items of the subject sequence, from left to right.
Matching stops (with a failure) as soon as a subpattern fails.  If all
subpatterns succeed in matching their corresponding item, the sequence
pattern succeeds.</p>
<p>A variable-length sequence pattern first matches the leading non-star
subpatterns to the corresponding items of the subject sequence, as for
a fixed-length sequence.  If this succeeds, the star subpattern
matches a list formed of the remaining subject items, with items
removed from the end corresponding to the non-star subpatterns
following the star subpattern.  The remaining non-star subpatterns are
then matched to the corresponding subject items, as for a fixed-length
sequence.</p>
<p>Subpatterns are mostly required to be closed patterns, but the parentheses may
be omitted for value constraints. Sequence elements may also be captured
unconditionally without parentheses.</p>
<p>Note: where <a class="reference external" href="pep-0634.html">PEP 634</a> allows all the same syntactic flexibility as iterable
unpacking in assignment statements, this PEP restricts sequence patterns
specifically to the square bracket form. Given that the open and parenthesised
forms are far more popular than square brackets for iterable unpacking, this
helps emphasise that iterable unpacking and sequence matching are <em>not</em> the
same operation. It also avoids the parenthesised form’s ambiguity problem
between single element sequence patterns and group patterns.</p>
</section>
<section id="mapping-constraints">
<h4><a class="toc-backref" href="#id31">Mapping constraints</a><a class="headerlink" href="#mapping-constraints" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mapping_constraint: &#39;{&#39; [mapping_constraint_elements] &#39;}&#39;
mapping_constraint_elements: &#39;,&#39;.key_value_constraint+ &#39;,&#39;?
key_value_constraint:
    | closed_expr pattern_as_clause
    | closed_expr &#39;:&#39; simple_pattern
    | double_star_capture
double_star_capture: &#39;**&#39; pattern_as_clause
</pre></div>
</div>
<p>(Note that <code class="docutils literal notranslate"><span class="pre">**__</span></code> is deliberately disallowed by this syntax, as additional
mapping entries are ignored by default)</p>
<p>closed_expr is defined above, under value constraints.</p>
<p>Abstract syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MatchMapping</span><span class="p">(</span><span class="n">expr</span><span class="o">*</span> <span class="n">keys</span><span class="p">,</span> <span class="n">pattern</span><span class="o">*</span> <span class="n">patterns</span><span class="p">)</span>
</pre></div>
</div>
<p>Mapping constraints allow keys and values within a sequence to be checked and
values to optionally be extracted.</p>
<p>A mapping pattern fails if the subject value is not an instance of
<code class="docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code>.</p>
<p>A mapping pattern succeeds if every key given in the mapping pattern
is present in the subject mapping, and the pattern for
each key matches the corresponding item of the subject mapping.</p>
<p>The presence of keys is checked using the two argument form of the <code class="docutils literal notranslate"><span class="pre">get</span></code>
method and a unique sentinel value, which offers the following benefits:</p>
<ul class="simple">
<li><p>no exceptions need to be created in the lookup process</p></li>
<li><p>mappings that implement <code class="docutils literal notranslate"><span class="pre">__missing__</span></code> (such as <code class="docutils literal notranslate"><span class="pre">collections.defaultdict</span></code>)
only match on keys that they already contain, they don’t implicitly add keys</p></li>
</ul>
<p>A mapping pattern may not contain duplicate key values. If duplicate keys are
detected when checking the mapping pattern, the pattern is considered invalid,
and a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> is raised. While it would theoretically be possible to
checked for duplicated constant keys at compile time, no such check is currently
defined or implemented.</p>
<p>(Note: This semantic description is derived from the <a class="reference external" href="pep-0634.html">PEP 634</a> reference
implementation, which differs from the <a class="reference external" href="pep-0634.html">PEP 634</a> specification text at time of
writing. The implementation seems reasonable, so amending the PEP text seems
like the best way to resolve the discrepancy)</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">'**'</span> <span class="pre">as</span> <span class="pre">NAME</span></code> double star pattern is present, that name is bound to a
<code class="docutils literal notranslate"><span class="pre">dict</span></code> containing any remaining key-value pairs from the subject mapping
(the dict will be empty if there are no additional key-value pairs).</p>
<p>A mapping pattern may contain at most one double star pattern,
and it must be last.</p>
<p>Value subpatterns are mostly required to be closed patterns, but the parentheses
may be omitted for value constraints (the <code class="docutils literal notranslate"><span class="pre">:</span></code> key/value separator is still
required to ensure the entry doesn’t look like an ordinary comparison operation).</p>
<p>Mapping values may also be captured unconditionally using the <code class="docutils literal notranslate"><span class="pre">KEY</span> <span class="pre">as</span> <span class="pre">NAME</span></code>
form, without either parentheses or the <code class="docutils literal notranslate"><span class="pre">:</span></code> key/value separator.</p>
</section>
<section id="instance-attribute-constraints">
<h4><a class="toc-backref" href="#id32">Instance attribute constraints</a><a class="headerlink" href="#instance-attribute-constraints" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>attrs_constraint:
    | name_or_attr &#39;{&#39; [attrs_constraint_elements] &#39;}&#39;
attrs_constraint_elements: &#39;,&#39;.attr_value_pattern+ &#39;,&#39;?
attr_value_pattern:
    | &#39;.&#39; NAME pattern_as_clause
    | &#39;.&#39; NAME value_constraint
    | &#39;.&#39; NAME &#39;:&#39; simple_pattern
    | &#39;.&#39; NAME
</pre></div>
</div>
<p>Abstract syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MatchAttrs</span><span class="p">(</span><span class="n">expr</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="o">*</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">pattern</span><span class="o">*</span> <span class="n">patterns</span><span class="p">)</span>
</pre></div>
</div>
<p>Instance attribute constraints allow an instance’s type to be checked and
attributes to optionally be extracted.</p>
<p>An instance attribute constraint may not repeat the same attribute name multiple
times. Attempting to do so will result in a syntax error.</p>
<p>An instance attribute pattern fails if the subject is not an instance of
<code class="docutils literal notranslate"><span class="pre">name_or_attr</span></code>. This is tested using <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">name_or_attr</span></code> is not an instance of the builtin <code class="docutils literal notranslate"><span class="pre">type</span></code>,
<code class="docutils literal notranslate"><span class="pre">TypeError</span></code> is raised.</p>
<p>If no attribute subpatterns are present, the constraint succeeds if the
<code class="docutils literal notranslate"><span class="pre">isinstance()</span></code> check succeeds. Otherwise:</p>
<blockquote>
<div><ul class="simple">
<li><p>Each given attribute name is looked up as an attribute on the subject.</p>
<ul>
<li><p>If this raises an exception other than <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>,
the exception bubbles up.</p></li>
<li><p>If this raises <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code> the constraint fails.</p></li>
<li><p>Otherwise, the subpattern associated with the keyword is matched
against the attribute value. If no subpattern is specified, the wildcard
pattern is assumed. If this fails, the constraint fails.
If it succeeds, the match proceeds to the next attribute.</p></li>
</ul>
</li>
<li><p>If all attribute subpatterns succeed, the constraint as a whole succeeds.</p></li>
</ul>
</div></blockquote>
<p>Instance attribute constraints allow ducktyping checks to be implemented by
using <code class="docutils literal notranslate"><span class="pre">object</span></code> as the required instance type (e.g.
<code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">object{.host</span> <span class="pre">as</span> <span class="pre">host,</span> <span class="pre">.port</span> <span class="pre">as</span> <span class="pre">port}:</span></code>).</p>
<p>The syntax being proposed here could potentially also be used as the basis for
a new syntax for retrieving multiple attributes from an object instance in one
assignment statement (e.g. <code class="docutils literal notranslate"><span class="pre">host,</span> <span class="pre">port</span> <span class="pre">=</span> <span class="pre">addr{.host,</span> <span class="pre">.port}</span></code>). See the
Deferred Ideas section for further discussion of this point.</p>
</section>
<section id="class-defined-constraints">
<h4><a class="toc-backref" href="#id33">Class defined constraints</a><a class="headerlink" href="#class-defined-constraints" title="Permalink to this headline">¶</a></h4>
<p>Surface syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class_constraint:
    | name_or_attr &#39;(&#39; &#39;)&#39;
    | name_or_attr &#39;(&#39; positional_patterns &#39;,&#39;? &#39;)&#39;
    | name_or_attr &#39;(&#39; class_constraint_attrs &#39;)&#39;
    | name_or_attr &#39;(&#39; positional_patterns &#39;,&#39; class_constraint_attrs] &#39;)&#39;
positional_patterns: &#39;,&#39;.positional_pattern+
positional_pattern:
    | simple_pattern
    | pattern_as_clause
class_constraint_attrs:
    | &#39;**&#39; &#39;{&#39; [attrs_constraint_elements] &#39;}&#39;
</pre></div>
</div>
<p>Abstract syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MatchClass</span><span class="p">(</span><span class="n">expr</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">pattern</span><span class="o">*</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">identifier</span><span class="o">*</span> <span class="n">extra_attrs</span><span class="p">,</span> <span class="n">pattern</span><span class="o">*</span> <span class="n">extra_patterns</span><span class="p">)</span>
</pre></div>
</div>
<p>Class defined constraints allow a sequence of common attributes to be
specified on a class and checked positionally, rather than needing to specify
the attribute names in every related match pattern.</p>
<p>As for instance attribute patterns:</p>
<ul class="simple">
<li><p>a class defined pattern fails if the subject is not an instance of
<code class="docutils literal notranslate"><span class="pre">name_or_attr</span></code>. This is tested using <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code>.</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">name_or_attr</span></code> is not an instance of the builtin <code class="docutils literal notranslate"><span class="pre">type</span></code>,
<code class="docutils literal notranslate"><span class="pre">TypeError</span></code> is raised.</p></li>
</ul>
<p>Regardless of whether or not any arguments are present, the subject is checked
for a <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> attribute using the equivalent of
<code class="docutils literal notranslate"><span class="pre">getattr(cls,</span> <span class="pre">&quot;__match_args__&quot;,</span> <span class="pre">_SENTINEL))</span></code>.</p>
<p>If this raises an exception the exception bubbles up.</p>
<p>If the returned value is not a list, tuple, or <code class="docutils literal notranslate"><span class="pre">None</span></code>, the conversion fails
and <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> is raised at runtime.</p>
<p>This means that only types that actually define <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> will be
usable in class defined patterns. Types that don’t define <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code>
will still be usable in instance attribute patterns.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then only a single positional subpattern is
permitted. Attempting to specify additional attribute patterns either
positionally or using the double star syntax will cause <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> to be
raised at runtime.</p>
<p>This positional subpattern is then matched against the entire subject, allowing
a type check to be combined with another match pattern (e.g. checking both
the type and contents of a container, or the type and value of a number).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> is a list or tuple, then the class defined constraint is
converted to an instance attributes constraint as follows:</p>
<ul class="simple">
<li><p>if only the double star attribute constraints subpattern is present, matching
proceeds as if for the equivalent instance attributes constraint.</p></li>
<li><p>if there are more positional subpatterns than the length of
<code class="docutils literal notranslate"><span class="pre">__match_args__`</span></code> (as obtained using <code class="docutils literal notranslate"><span class="pre">len()</span></code>), <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> is raised.</p></li>
<li><p>Otherwise, positional pattern <code class="docutils literal notranslate"><span class="pre">i</span></code> is converted to an attribute pattern
using <code class="docutils literal notranslate"><span class="pre">__match_args__[i]</span></code> as the attribute name.</p></li>
<li><p>if any element in <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> is not a string, <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> is raised.</p></li>
<li><p>once the positional patterns have been converted to attribute patterns, then
they are combined with any attribute constraints given in the double star
attribute constraints subpattern, and matching proceeds as if for the
equivalent instance attributes constraint.</p></li>
</ul>
<p>Note: the <code class="docutils literal notranslate"><span class="pre">__match_args__</span> <span class="pre">is</span> <span class="pre">None</span></code> handling in this PEP replaces the special
casing of <code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">bytearray</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, <code class="docutils literal notranslate"><span class="pre">dict</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>,
<code class="docutils literal notranslate"><span class="pre">frozenset</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">set</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code>, and <code class="docutils literal notranslate"><span class="pre">tuple</span></code> in <a class="reference external" href="pep-0634.html">PEP 634</a>.
However, the optimised fast path for those types is retained in the
implementation.</p>
</section>
</section>
</section>
<section id="design-discussion">
<h2><a class="toc-backref" href="#id34">Design Discussion</a><a class="headerlink" href="#design-discussion" title="Permalink to this headline">¶</a></h2>
<section id="requiring-explicit-qualification-of-simple-names-in-match-patterns">
<h3><a class="toc-backref" href="#id35">Requiring explicit qualification of simple names in match patterns</a><a class="headerlink" href="#requiring-explicit-qualification-of-simple-names-in-match-patterns" title="Permalink to this headline">¶</a></h3>
<p>The first iteration of this PEP accepted the basic premise of <a class="reference external" href="pep-0634.html">PEP 634</a> that
iterable unpacking syntax would provide a good foundation for defining a new
syntax for pattern matching.</p>
<p>During the review process, however, two major and one minor ambiguity problems
were highlighted that arise directly from that core assumption:</p>
<ul class="simple">
<li><p>most problematically, when binding simple names by default is extended to
<a class="reference external" href="pep-0634.html">PEP 634</a>’s proposed class pattern syntax, the <code class="docutils literal notranslate"><span class="pre">ATTR=TARGET_NAME</span></code> construct
binds to the right without using the <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword, and uses the normal
assignment-to-the-left sigil (<code class="docutils literal notranslate"><span class="pre">=</span></code>) to do it!</p></li>
<li><p>when binding simple names by default is extended to <a class="reference external" href="pep-0634.html">PEP 634</a>’s proposed mapping
pattern syntax, the <code class="docutils literal notranslate"><span class="pre">KEY:</span> <span class="pre">TARGET_NAME</span></code> construct binds to the right without
using the <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword</p></li>
<li><p>using a <a class="reference external" href="pep-0634.html">PEP 634</a> capture pattern together with an AS pattern
(<code class="docutils literal notranslate"><span class="pre">TARGET_NAME_1</span> <span class="pre">as</span> <span class="pre">TARGET_NAME_2</span></code>) gives an odd “binds to both the left and
right” behaviour</p></li>
</ul>
<p>The third revision of this PEP accounted for this problem by abandoning the
alignment with iterable unpacking syntax, and instead requiring that all uses
of bare simple names for anything other than a variable lookup be qualified by
a preceding sigil or keyword:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">as</span> <span class="pre">NAME</span></code>: local variable binding</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.NAME</span></code>: attribute lookup</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">NAME</span></code>: variable lookup</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">NAME</span></code>: variable lookup</p></li>
<li><p>any other usage: variable lookup</p></li>
</ul>
<p>The key benefit of this approach is that it makes interpretation of simple names
in patterns a local activity: a leading <code class="docutils literal notranslate"><span class="pre">as</span></code> indicates a name binding, a
leading <code class="docutils literal notranslate"><span class="pre">.</span></code> indicates an attribute lookup, and anything else is a variable
lookup (regardless of whether we’re reading a subpattern or a subexpression).</p>
<p>With the syntax now proposed in this PEP, the problematic cases identified above
no longer read poorly:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.ATTR</span> <span class="pre">as</span> <span class="pre">TARGET_NAME</span></code> is more obviously a binding than <code class="docutils literal notranslate"><span class="pre">ATTR=TARGET_NAME</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">KEY</span> <span class="pre">as</span> <span class="pre">TARGET_NAME</span></code> is more obviously a binding than <code class="docutils literal notranslate"><span class="pre">KEY:</span> <span class="pre">TARGET_NAME</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(as</span> <span class="pre">TARGET_NAME_1)</span> <span class="pre">as</span> <span class="pre">TARGET_NAME_2</span></code> is more obviously two bindings than
<code class="docutils literal notranslate"><span class="pre">TARGET_NAME_1</span> <span class="pre">as</span> <span class="pre">TARGET_NAME_2</span></code></p></li>
</ul>
</section>
<section id="resisting-the-temptation-to-guess">
<h3><a class="toc-backref" href="#id36">Resisting the temptation to guess</a><a class="headerlink" href="#resisting-the-temptation-to-guess" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="pep-0635.html">PEP 635</a> looks at the way pattern matching is used in other languages, and
attempts to use that information to make plausible predictions about the way
pattern matching will be used in Python:</p>
<ul class="simple">
<li><p>wanting to extract values to local names will <em>probably</em> be more common than
wanting to match against values stored in local names</p></li>
<li><p>wanting comparison by equality will <em>probably</em> be more common than wanting
comparison by identity</p></li>
<li><p>users will <em>probably</em> be able to at least remember that bare names bind values
and attribute references look up values, even if they can’t figure that out
for themselves without reading the documentation or having someone tell them</p></li>
</ul>
<p>To be clear, I think these predictions actually <em>are</em> plausible. However, I also
don’t think we need to guess about this up front: I think we can start out with
a more explicit syntax that requires users to state their intent using a prefix
marker (either <code class="docutils literal notranslate"><span class="pre">as</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, or <code class="docutils literal notranslate"><span class="pre">is</span></code>), and then reassess the situation in a
few years based on how pattern matching is actually being used <em>in Python</em>.</p>
<p>At that point, we’ll be able to choose amongst at least the following options:</p>
<ul class="simple">
<li><p>deciding the explicit syntax is concise enough, and not changing anything</p></li>
<li><p>adding inferred identity constraints for one or more of <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">...</span></code>,
<code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p>adding inferred equality constraints for other literals (potentially including
complex literals)</p></li>
<li><p>adding inferred equality constraints for attribute lookups</p></li>
<li><p>adding either inferred equality constraints or inferred capture patterns for
bare names</p></li>
</ul>
<p>All of those ideas could be considered independently on their own merits, rather
than being a potential barrier to introducing pattern matching in the first
place.</p>
<p>If any of these syntactic shortcuts were to eventually be introduced, they’d
also be straightforward to explain in terms of the underlying more explicit
syntax (the leading <code class="docutils literal notranslate"><span class="pre">as</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, or <code class="docutils literal notranslate"><span class="pre">is</span></code> would just be getting inferred
by the parser, without the user needing to provide it explicitly). At the
implementation level, only the parser should need to be change, as the existing
AST nodes could be reused.</p>
</section>
<section id="interaction-with-caching-of-attribute-lookups-in-local-variables">
<h3><a class="toc-backref" href="#id37">Interaction with caching of attribute lookups in local variables</a><a class="headerlink" href="#interaction-with-caching-of-attribute-lookups-in-local-variables" title="Permalink to this headline">¶</a></h3>
<p>One of the major changes between this PEP and <a class="reference external" href="pep-0634.html">PEP 634</a> is to use <code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">EXPR</span></code>
for equality constraint lookups, rather than only offering <code class="docutils literal notranslate"><span class="pre">NAME.ATTR</span></code>. The
original motivation for this was to avoid the semantic conflict with regular
assignment targets, where <code class="docutils literal notranslate"><span class="pre">NAME.ATTR</span></code> is already used in assignment statements
to set attributes, so if <code class="docutils literal notranslate"><span class="pre">NAME.ATTR</span></code> were the <em>only</em> syntax for symbolic value
matching, then we’re pre-emptively ruling out any future attempts to allow
matching against single patterns using the existing assignment statement syntax.
The current motivation is more about the general desire to avoid guessing about
user’s intent, and instead requiring them to state it explicitly in the syntax.</p>
<p>However, even within match statements themselves, the <code class="docutils literal notranslate"><span class="pre">name.attr</span></code> syntax for
value patterns has an undesirable interaction with local variable assignment,
where routine refactorings that would be semantically neutral for any other
Python statement introduce a major semantic change when applied to a <a class="reference external" href="pep-0634.html">PEP 634</a>
style match statement.</p>
<p>Consider the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">:</span>
    <span class="o">...</span> <span class="c1"># Some code that adjusts &quot;value&quot;</span>
</pre></div>
</div>
<p>The attribute lookup can be safely lifted out of the loop and only performed
once:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">:</span>
<span class="k">while</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">_limit</span><span class="p">:</span>
    <span class="o">...</span> <span class="c1"># Some code that adjusts &quot;value&quot;</span>
</pre></div>
</div>
<p>With the marker prefix based syntax proposal in this PEP, value constraints
would be similarly tolerant of match patterns being refactored to use a local
variable instead of an attribute lookup, with the following two statements
being functionally equivalent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">}:</span>
        <span class="o">...</span> <span class="c1"># Handle the case where &#39;expr[&quot;key&quot;] == self.target&#39;</span>
    <span class="n">case</span> <span class="n">__</span><span class="p">:</span>
        <span class="o">...</span> <span class="c1"># Handle the non-matching case</span>

<span class="n">_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
<span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="o">==</span> <span class="n">_target</span><span class="p">}:</span>
        <span class="o">...</span> <span class="c1"># Handle the case where &#39;expr[&quot;key&quot;] == self.target&#39;</span>
    <span class="n">case</span> <span class="n">__</span><span class="p">:</span>
        <span class="o">...</span> <span class="c1"># Handle the non-matching case</span>
</pre></div>
</div>
<p>By contrast, when using <a class="reference external" href="pep-0634.html">PEP 634</a>’s value and capture pattern syntaxes that omit
the marker prefix, the following two statements wouldn’t be equivalent at all:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># PEP 634&#39;s value pattern syntax</span>
<span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">}:</span>
        <span class="o">...</span> <span class="c1"># Handle the case where &#39;expr[&quot;key&quot;] == self.target&#39;</span>
    <span class="n">case</span> <span class="n">_</span><span class="p">:</span>
        <span class="o">...</span> <span class="c1"># Handle the non-matching case</span>

<span class="c1"># PEP 634&#39;s capture pattern syntax</span>
<span class="n">_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
<span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">_target</span><span class="p">}:</span>
        <span class="o">...</span> <span class="c1"># Matches any mapping with &quot;key&quot;, binding its value to _target</span>
    <span class="n">case</span> <span class="n">_</span><span class="p">:</span>
        <span class="o">...</span> <span class="c1"># Handle the non-matching case</span>
</pre></div>
</div>
<p>This PEP ensures the original semantics are retained under this style of
simplistic refactoring: use <code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">name</span></code> to force interpretation of the result
as a value constraint, use <code class="docutils literal notranslate"><span class="pre">as</span> <span class="pre">name</span></code> for a name binding.</p>
<p><a class="reference external" href="pep-0634.html">PEP 634</a>’s proposal to offer only the shorthand syntax, with no explicitly
prefixed form, means that the primary answer on offer is “Well, don’t do that,
then, only compare against attributes in namespaces, don’t compare against
simple names”.</p>
<p><a class="reference external" href="pep-0622.html">PEP 622</a>’s walrus pattern syntax had another odd interaction where it might not
bind the same object as the exact same walrus expression in the body of the
case clause, but <a class="reference external" href="pep-0634.html">PEP 634</a> fixed that discrepancy by replacing walrus patterns
with AS patterns (where the fact that the value bound to the name on the RHS
might not be the same value as returned by the LHS is a standard feature common
to all uses of the “as” keyword).</p>
</section>
<section id="using-existing-comparison-operators-as-the-value-constraint-prefix">
<h3><a class="toc-backref" href="#id38">Using existing comparison operators as the value constraint prefix</a><a class="headerlink" href="#using-existing-comparison-operators-as-the-value-constraint-prefix" title="Permalink to this headline">¶</a></h3>
<p>If the benefit of a dedicated value constraint prefix is accepted, then the
next question is to ask exactly what that prefix should be.</p>
<p>The initially published version of this PEP proposed using the previously
unused <code class="docutils literal notranslate"><span class="pre">?</span></code> symbol as the prefix for equality constraints, and <code class="docutils literal notranslate"><span class="pre">?is</span></code> as the
prefix for identity constraints. When reviewing the PEP, Steven D’Aprano
presented a compelling counterproposal [<a class="reference internal" href="#id10">5</a>] to use the existing comparison
operators (<code class="docutils literal notranslate"><span class="pre">==</span></code> and <code class="docutils literal notranslate"><span class="pre">is</span></code>) instead.</p>
<p>There were a few concerns with <code class="docutils literal notranslate"><span class="pre">==</span></code> as a prefix that kept it from being
chosen as the prefix in the initial iteration of the PEP:</p>
<ul class="simple">
<li><p>for common use cases, it’s even more visually noisy than <code class="docutils literal notranslate"><span class="pre">?</span></code>, as a lot of
folks with <a class="reference external" href="pep-0008.html">PEP 8</a> trained aesthetic sensibilities are going to want to put
a space between it and the following expression, effectively making it a 3
character prefix instead of 1</p></li>
<li><p>when used in a mapping pattern, there needs to be a space between the <code class="docutils literal notranslate"><span class="pre">:</span></code>
key/value separator and the <code class="docutils literal notranslate"><span class="pre">==</span></code> prefix, or the tokeniser will split them
up incorrectly (getting <code class="docutils literal notranslate"><span class="pre">:=</span></code> and <code class="docutils literal notranslate"><span class="pre">=</span></code> instead of <code class="docutils literal notranslate"><span class="pre">:</span></code> and <code class="docutils literal notranslate"><span class="pre">==</span></code>)</p></li>
<li><p>when used in an OR pattern, there needs to be a space between the <code class="docutils literal notranslate"><span class="pre">|</span></code>
pattern separator and the <code class="docutils literal notranslate"><span class="pre">==</span></code> prefix, or the tokeniser will split them
up incorrectly (getting <code class="docutils literal notranslate"><span class="pre">|=</span></code> and <code class="docutils literal notranslate"><span class="pre">=</span></code> instead of <code class="docutils literal notranslate"><span class="pre">|</span></code> and <code class="docutils literal notranslate"><span class="pre">==</span></code>)</p></li>
<li><p>if used in a <a class="reference external" href="pep-0634.html">PEP 634</a> style class pattern, there needs to be a space between
the <code class="docutils literal notranslate"><span class="pre">=</span></code> keyword separator and the <code class="docutils literal notranslate"><span class="pre">==</span></code> prefix, or the tokeniser will split
them up incorrectly (getting <code class="docutils literal notranslate"><span class="pre">==</span></code> and <code class="docutils literal notranslate"><span class="pre">=</span></code> instead of <code class="docutils literal notranslate"><span class="pre">=</span></code> and <code class="docutils literal notranslate"><span class="pre">==</span></code>)</p></li>
</ul>
<p>Rather than introducing a completely new symbol, Steven’s proposed resolution to
this verbosity problem was to retain the ability to omit the prefix marker in
syntactically unambiguous cases.</p>
<p>While the idea of omitting the prefix marker was accepted for the second
revision of the proposal, it was dropped again in the third revision due to
ambiguity concerns. Instead, the following points apply:</p>
<ul class="simple">
<li><p>for class patterns, other syntax changes allow equality constraints to be
written as <code class="docutils literal notranslate"><span class="pre">.ATTR</span> <span class="pre">==</span> <span class="pre">EXPR</span></code>, and identity constraints to be written as
<code class="docutils literal notranslate"><span class="pre">.ATTR</span> <span class="pre">is</span> <span class="pre">EXPR</span></code>, both of which are quite easy to read</p></li>
<li><p>for mapping patterns, the extra syntactic noise is just tolerated (at least
for now)</p></li>
<li><p>for OR patterns, the extra syntactic noise is just tolerated (at least
for now). However, <a class="reference internal" href="#membership-constraints">membership constraints</a> may offer a future path to
reducing the need to combine OR patterns with equality constraints (instead,
the values to be checked against would be collected as a set, list, or tuple).</p></li>
</ul>
<p>Given that perspective, <a class="reference external" href="pep-0635.html">PEP 635</a>’s arguments against using <code class="docutils literal notranslate"><span class="pre">?</span></code> as part of the
pattern matching syntax held for this proposal as well, and so the PEP was
amended accordingly.</p>
</section>
<section id="using-as-the-wildcard-pattern-marker">
<h3><a class="toc-backref" href="#id39">Using <code class="docutils literal notranslate"><span class="pre">__</span></code> as the wildcard pattern marker</a><a class="headerlink" href="#using-as-the-wildcard-pattern-marker" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="pep-0635.html">PEP 635</a> makes a solid case that introducing <code class="docutils literal notranslate"><span class="pre">?</span></code> <em>solely</em> as a wildcard pattern
marker would be a bad idea. With the syntax for value constraints changed
to use existing comparison operations rather than <code class="docutils literal notranslate"><span class="pre">?</span></code> and <code class="docutils literal notranslate"><span class="pre">?is</span></code>, that
argument holds for this PEP as well.</p>
<p>However, as noted by Thomas Wouters in [<a class="reference internal" href="#id11">6</a>], <a class="reference external" href="pep-0634.html">PEP 634</a>’s choice of <code class="docutils literal notranslate"><span class="pre">_</span></code> remains
problematic as it would likely mean that match patterns would have a <em>permanent</em>
difference from all other parts of Python - the use of <code class="docutils literal notranslate"><span class="pre">_</span></code> in software
internationalisation and at the interactive prompt means that there isn’t really
a plausible path towards using it as a general purpose “skipped binding” marker.</p>
<p><code class="docutils literal notranslate"><span class="pre">__</span></code> is an alternative “this value is not needed” marker drawn from a Stack
Overflow answer [<a class="reference internal" href="#id12">7</a>] (originally posted by the author of this PEP) on the
various meanings of <code class="docutils literal notranslate"><span class="pre">_</span></code> in existing Python code.</p>
<p>This PEP also proposes adopting an implementation technique that limits
the scope of the associated special casing of <code class="docutils literal notranslate"><span class="pre">__</span></code> to the parser: defining a
new AST node type (<code class="docutils literal notranslate"><span class="pre">MatchAlways</span></code>) specifically for wildcard markers, rather
than passing it through to the AST as a <code class="docutils literal notranslate"><span class="pre">Name</span></code> node.</p>
<p>Within the parser, <code class="docutils literal notranslate"><span class="pre">__</span></code> still means either a regular name or a wildcard
marker in a match pattern depending on where you were in the parse tree, but
within the rest of the compiler, <code class="docutils literal notranslate"><span class="pre">Name(&quot;__&quot;)</span></code> is still a normal variable name,
while <code class="docutils literal notranslate"><span class="pre">MatchAlways()</span></code> is always a wildcard marker in a match pattern.</p>
<p>Unlike <code class="docutils literal notranslate"><span class="pre">_</span></code>, the lack of other use cases for <code class="docutils literal notranslate"><span class="pre">__</span></code> means that there would be
a plausible path towards restoring identifier handling consistency with the rest
of the language by making <code class="docutils literal notranslate"><span class="pre">__</span></code> mean “skip this name binding” everywhere in
Python:</p>
<ul class="simple">
<li><p>in the interpreter itself, deprecate loading variables with the name <code class="docutils literal notranslate"><span class="pre">__</span></code>.
This would make reading from <code class="docutils literal notranslate"><span class="pre">__</span></code> emit a deprecation warning, while writing
to it would initially be unchanged. To avoid slowing down all name loads, this
could be handled by having the compiler emit additional code for the
deprecated name, rather than using a runtime check in the standard name
loading opcodes.</p></li>
<li><p>after a suitable number of releases, change the parser to emit
a new <code class="docutils literal notranslate"><span class="pre">SkippedBinding</span></code> AST node for all uses of <code class="docutils literal notranslate"><span class="pre">__</span></code> as an assignment
target, and update the rest of the compiler accordingly</p></li>
<li><p>consider making <code class="docutils literal notranslate"><span class="pre">__</span></code> a true hard keyword rather than a soft keyword</p></li>
</ul>
<p>This deprecation path couldn’t be followed for <code class="docutils literal notranslate"><span class="pre">_</span></code>, as there’s no way for the
interpreter to distinguish between attempts to read back <code class="docutils literal notranslate"><span class="pre">_</span></code> when nominally
used as a “don’t care” marker, and legitimate reads of <code class="docutils literal notranslate"><span class="pre">_</span></code> as either an
i18n text translation function or as the last statement result at the
interactive prompt.</p>
<p>Names starting with double-underscores are also already reserved for use by the
language, whether that is for compile time constants (i.e. <code class="docutils literal notranslate"><span class="pre">__debug__</span></code>),
special methods, or class attribute name mangling, so using <code class="docutils literal notranslate"><span class="pre">__</span></code> here would
be consistent with that existing approach.</p>
</section>
<section id="representing-patterns-explicitly-in-the-abstract-syntax-tree">
<h3><a class="toc-backref" href="#id40">Representing patterns explicitly in the Abstract Syntax Tree</a><a class="headerlink" href="#representing-patterns-explicitly-in-the-abstract-syntax-tree" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="pep-0634.html">PEP 634</a> doesn’t explicitly discuss how match statements should be represented
in the Abstract Syntax Tree, instead leaving that detail to be defined as part
of the implementation.</p>
<p>As a result, while the reference implementation of <a class="reference external" href="pep-0634.html">PEP 634</a> definitely works (and
formed the basis of the reference implementation of this PEP), it does contain
a significant design flaw: despite the notes in <a class="reference external" href="pep-0635.html">PEP 635</a> that patterns should be
considered as distinct from expressions, the reference implementation goes ahead
and represents them in the AST as expression nodes.</p>
<p>The result is an AST that isn’t very abstract at all: nodes that should be
compiled completely differently (because they’re patterns rather than
expressions) are represented the same way, and the type system of the
implementation language (e.g. C for CPython) can’t offer any assistance in
keeping track of which subnodes should be ordinary expressions and which should
be subpatterns.</p>
<p>Rather than continuing with that approach, this PEP has instead defined a new
explicit “pattern” node in the AST, which allows the patterns and their
permitted subnodes to be defined explicitly in the AST itself, making the code
implementing the new feature clearer, and allowing the C compiler to provide
more assistance in keeping track of when the code generator is dealing with
patterns or expressions.</p>
<p>This change in implementation approach is actually orthogonal to the surface
syntax changes proposed in this PEP, so it could still be adopted even if the
rest of the PEP were to be rejected.</p>
</section>
<section id="changes-to-sequence-patterns">
<h3><a class="toc-backref" href="#id41">Changes to sequence patterns</a><a class="headerlink" href="#changes-to-sequence-patterns" title="Permalink to this headline">¶</a></h3>
<p>This PEP makes one notable change to sequence patterns relative to <a class="reference external" href="pep-0634.html">PEP 634</a>:</p>
<ul class="simple">
<li><p>only the square bracket form of sequence pattern is supported. Neither open
(no delimeters) nor tuple style (parentheses as delimiters) sequence patterns
are supported.</p></li>
</ul>
<p>Relative to <a class="reference external" href="pep-0634.html">PEP 634</a>, sequence patterns are also significantly affected by the
change to require explicit qualification of capture patterns and value
constraints, as it means <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">[a,</span> <span class="pre">b,</span> <span class="pre">c]:</span></code> must instead be written as
<code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">[as</span> <span class="pre">a,</span> <span class="pre">as</span> <span class="pre">b,</span> <span class="pre">as</span> <span class="pre">c]:</span></code> and <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">[0,</span> <span class="pre">1]:</span></code> must instead be written as
<code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">[==</span> <span class="pre">0,</span> <span class="pre">==</span> <span class="pre">1]:</span></code>.</p>
<p>With the syntax for sequence patterns no longer being derived directly from the
syntax for iterable unpacking, it no longer made sense to keep the syntactic
flexibility that had been included in the original syntax proposal purely for
consistency with iterable unpacking.</p>
<p>Allowing open and tuple style sequence patterns didn’t increase expressivity,
only ambiguity of intent (especially relative to group paterns), and encouraged
readers down the path of viewing pattern matching syntax as intrinsically linked
to assignment target syntax (which the <a class="reference external" href="pep-0634.html">PEP 634</a> authors have stated multiple
times is not a desirable path to have readers take, and a view the author of
this PEP now shares, despite disagreeing with it originally).</p>
</section>
<section id="changes-to-mapping-patterns">
<h3><a class="toc-backref" href="#id42">Changes to mapping patterns</a><a class="headerlink" href="#changes-to-mapping-patterns" title="Permalink to this headline">¶</a></h3>
<p>This PEP makes two notable changes to mapping patterns relative to <a class="reference external" href="pep-0634.html">PEP 634</a>:</p>
<ul class="simple">
<li><p>value capturing is written as <code class="docutils literal notranslate"><span class="pre">KEY</span> <span class="pre">as</span> <span class="pre">NAME</span></code> rather than as <code class="docutils literal notranslate"><span class="pre">KEY:</span> <span class="pre">NAME</span></code></p></li>
<li><p>a wider range of keys are permitted: any “closed expression”, rather than
only literals and attribute references</p></li>
</ul>
<p>As discussed above, the first change is part of ensuring that all binding
operations with the target name to the right of a subexpression or pattern
use the <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword.</p>
<p>The second change is mostly a matter of simplifying the parser and code
generator code by reusing the existing expression handling machinery. The
restriction to closed expressions is designed to help reduce ambiguity as to
where the key expression ends and the match pattern begins. This mostly allows
a superset of what <a class="reference external" href="pep-0634.html">PEP 634</a> allows, except that complex literals must be written
in parentheses (at least for now).</p>
<p>Adapting <a class="reference external" href="pep-0635.html">PEP 635</a>’s mapping pattern examples to the syntax proposed in this PEP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">json_pet</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="o">==</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span> <span class="k">as</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span> <span class="k">as</span> <span class="n">pattern</span><span class="p">}:</span>
        <span class="k">return</span> <span class="n">Cat</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="o">==</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span> <span class="k">as</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;breed&quot;</span> <span class="k">as</span> <span class="n">breed</span><span class="p">}:</span>
        <span class="k">return</span> <span class="n">Dog</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">breed</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">__</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not a suitable pet&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">change_red_to_blue</span><span class="p">(</span><span class="n">json_obj</span><span class="p">):</span>
    <span class="n">match</span> <span class="n">json_obj</span><span class="p">:</span>
        <span class="n">case</span> <span class="p">{</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">==</span> <span class="s1">&#39;red&#39;</span> <span class="o">|</span> <span class="o">==</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span> <span class="p">}:</span>
            <span class="n">json_obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
        <span class="n">case</span> <span class="p">{</span> <span class="s1">&#39;children&#39;</span> <span class="k">as</span> <span class="n">children</span> <span class="p">}:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="n">change_red_to_blue</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</pre></div>
</div>
<p>For reference, the equivalent <a class="reference external" href="pep-0634.html">PEP 634</a> syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">json_pet</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="n">pattern</span><span class="p">}:</span>
        <span class="k">return</span> <span class="n">Cat</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="n">case</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;breed&quot;</span><span class="p">:</span> <span class="n">breed</span><span class="p">}:</span>
        <span class="k">return</span> <span class="n">Dog</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">breed</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not a suitable pet&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">change_red_to_blue</span><span class="p">(</span><span class="n">json_obj</span><span class="p">):</span>
    <span class="n">match</span> <span class="n">json_obj</span><span class="p">:</span>
        <span class="n">case</span> <span class="p">{</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;red&#39;</span> <span class="o">|</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">)</span> <span class="p">}:</span>
            <span class="n">json_obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
        <span class="n">case</span> <span class="p">{</span> <span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="n">children</span> <span class="p">}:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="n">change_red_to_blue</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="changes-to-class-patterns">
<h3><a class="toc-backref" href="#id43">Changes to class patterns</a><a class="headerlink" href="#changes-to-class-patterns" title="Permalink to this headline">¶</a></h3>
<p>This PEP makes several notable changes to class patterns relative to <a class="reference external" href="pep-0634.html">PEP 634</a>:</p>
<ul class="simple">
<li><p>the syntactic alignment with class instantiation is abandoned as being
actively misleading and unhelpful. Instead, a new dedicated syntax for
checking additional attributes is introduced that draws inspiration from
mapping patterns rather than class instantiation</p></li>
<li><p>a new dedicated syntax for simple ducktyping that will work for any class
is introduced</p></li>
<li><p>the special casing of various builtin and standard library types is
supplemented by a general check for the existence of a <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code>
attribute with the value of <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
</ul>
<p>As discussed above, the first change has two purposes:</p>
<ul class="simple">
<li><p>it’s part of ensuring that all binding operations with the target name to the
right of a subexpression or pattern use the <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword. Using <code class="docutils literal notranslate"><span class="pre">=</span></code> to
assign to the right is particularly problematic.</p></li>
<li><p>it’s part of ensuring that all uses of simple names in patterns have a prefix
that indicates their purpose (in this case, a leading <code class="docutils literal notranslate"><span class="pre">.</span></code> to indicate an
attribute lookup)</p></li>
</ul>
<p>The syntactic alignment with class instantion was also judged to be unhelpful
in general, as class patterns are about matching patterns against attributes,
while class instantiation is about matching call arguments to parameters in
class constructors, which may not bear much resemblance to the resulting
instance attributes at all.</p>
<p>The second change is intended to make it easier to use pattern matching for the
“ducktyping” style checks that are already common in Python.</p>
<p>The concrete syntax proposal for these patterns then arose from viewing
instances as mappings of attribute names to values, and combining the attribute
lookup syntax (<code class="docutils literal notranslate"><span class="pre">.ATTR</span></code>), with the mapping pattern syntax <code class="docutils literal notranslate"><span class="pre">{KEY:</span> <span class="pre">PATTERN}</span></code>
to give <code class="docutils literal notranslate"><span class="pre">cls{.ATTR:</span> <span class="pre">PATTERN}</span></code>.</p>
<p>Allowing <code class="docutils literal notranslate"><span class="pre">cls{.ATTR}</span></code> to mean the same thing as <code class="docutils literal notranslate"><span class="pre">cls{.ATTR:</span> <span class="pre">__}</span></code> was a
matter of considering the leading <code class="docutils literal notranslate"><span class="pre">.</span></code> sufficient to render the name usage
unambiguous (it’s clearly an attribute reference, whereas matching against a variable
key in a mapping pattern would be arguably ambiguous)</p>
<p>The final change just supplements a CPython-internal-only check in the <a class="reference external" href="pep-0634.html">PEP 634</a>
reference implementation by making it the default behaviour that classes get if
they don’t define <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> (the optimised fast path for the builtin
and standard library types named in <a class="reference external" href="pep-0634.html">PEP 634</a> is retained).</p>
<p>Adapting the class matching example
<a class="reference external" href="https://github.com/gvanrossum/patma/blob/master/examples/expr.py#L231">linked from PEP 635</a>
shows that for purely positional class matching, the main impact comes from the
changes to value constraints and name binding, not from the class matching
changes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="n">BinaryOp</span><span class="p">(</span><span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="k">as</span> <span class="n">left</span><span class="p">,</span> <span class="k">as</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">+</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">BinaryOp</span><span class="p">(</span><span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="k">as</span> <span class="n">left</span><span class="p">,</span> <span class="k">as</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">-</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">BinaryOp</span><span class="p">(</span><span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="k">as</span> <span class="n">left</span><span class="p">,</span> <span class="k">as</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">*</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">BinaryOp</span><span class="p">(</span><span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">as</span> <span class="n">left</span><span class="p">,</span> <span class="k">as</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">/</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">UnaryOp</span><span class="p">(</span><span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="k">as</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">UnaryOp</span><span class="p">(</span><span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="k">as</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">eval_expr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">VarExpr</span><span class="p">(</span><span class="k">as</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown value of: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="nb">float</span><span class="p">()</span> <span class="o">|</span> <span class="nb">int</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">expr</span>
    <span class="n">case</span> <span class="n">__</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid expression value: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For reference, the equivalent <a class="reference external" href="pep-0634.html">PEP 634</a> syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="n">BinaryOp</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">+</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">BinaryOp</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">-</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">BinaryOp</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">*</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">BinaryOp</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">/</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">UnaryOp</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">eval_expr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">UnaryOp</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">eval_expr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">case</span> <span class="n">VarExpr</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown value of: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">case</span> <span class="nb">float</span><span class="p">()</span> <span class="o">|</span> <span class="nb">int</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">expr</span>
    <span class="n">case</span> <span class="n">_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid expression value: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The changes to the class pattern syntax itself are more relevant when
checking for named attributes and extracting their values without relying on
<code class="docutils literal notranslate"><span class="pre">__match_args__</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="nb">object</span><span class="p">{</span><span class="o">.</span><span class="n">host</span> <span class="k">as</span> <span class="n">host</span><span class="p">,</span> <span class="o">.</span><span class="n">port</span> <span class="k">as</span> <span class="n">port</span><span class="p">}:</span>
        <span class="k">pass</span>
    <span class="n">case</span> <span class="nb">object</span><span class="p">{</span><span class="o">.</span><span class="n">host</span> <span class="k">as</span> <span class="n">host</span><span class="p">}:</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Compare this to the <a class="reference external" href="pep-0634.html">PEP 634</a> equivalent, where it really isn’t clear which names
are referring to attributes of the match subject and which names are referring
to local variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="nb">object</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="n">case</span> <span class="nb">object</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>In this specific case, that ambiguity doesn’t matter (since the attribute and
variable names are the same), but in the general case, knowing which is which
will be critical to reasoning correctly about the code being read.</p>
</section>
</section>
<section id="deferred-ideas">
<h2><a class="toc-backref" href="#id44">Deferred Ideas</a><a class="headerlink" href="#deferred-ideas" title="Permalink to this headline">¶</a></h2>
<section id="inferred-value-constraints">
<h3><a class="toc-backref" href="#id45">Inferred value constraints</a><a class="headerlink" href="#inferred-value-constraints" title="Permalink to this headline">¶</a></h3>
<p>As discussed above, this PEP doesn’t rule out the possibility of adding
inferred equality and identity constraints in the future.</p>
<p>These could be particularly valuable for literals, as it is quite likely that
many “magic” strings and numbers with self-evident meanings will be written
directly into match patterns, rather than being stored in named variables.
(Think constants like <code class="docutils literal notranslate"><span class="pre">None</span></code>, or obviously special numbers like <code class="docutils literal notranslate"><span class="pre">0</span></code> and
<code class="docutils literal notranslate"><span class="pre">1</span></code>, or strings where their contents are as descriptive as any variable name,
rather than cryptic checks against opaque numbers like <code class="docutils literal notranslate"><span class="pre">739452</span></code>)</p>
</section>
<section id="making-some-required-parentheses-optional">
<h3><a class="toc-backref" href="#id46">Making some required parentheses optional</a><a class="headerlink" href="#making-some-required-parentheses-optional" title="Permalink to this headline">¶</a></h3>
<p>The PEP currently errs heavily on the side of requiring parentheses in the face
of potential ambiguity.</p>
<p>However, there are a number of cases where it at least arguably goes too far,
mostly involving AS patterns with an explicit pattern.</p>
<p>In any position that requires a closed pattern, AS patterns may end up starting
with doubled parentheses, as the nested pattern is also required to be a closed
pattern: <code class="docutils literal notranslate"><span class="pre">((OPEN</span> <span class="pre">PTRN)</span> <span class="pre">as</span> <span class="pre">NAME)</span></code></p>
<p>Due to the requirement that the subpattern be closed, it should be reasonable
in many of these cases (e.g. sequence pattern subpatterns) to accept
<code class="docutils literal notranslate"><span class="pre">CLOSED_PTRN</span> <span class="pre">as</span> <span class="pre">NAME</span></code> directly.</p>
<p>Further consideration of this point has been deferred, as making required
parentheses optional is a backwards compatible change, and hence relaxing the
restrictions later can be considered on a case-by-case basis.</p>
</section>
<section id="accepting-complex-literals-as-closed-expressions">
<h3><a class="toc-backref" href="#id47">Accepting complex literals as closed expressions</a><a class="headerlink" href="#accepting-complex-literals-as-closed-expressions" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="pep-0634.html">PEP 634</a>’s reference implementation includes a lot of special casing of binary
operations in both the parser and the rest of the compiler in order to accept
complex literals without accepting arbitrary binary numeric operations on
literal values.</p>
<p>Ideally, this problem would be dealt with at the parser layer, with the parser
directly emitting a Constant AST node prepopulated with a complex number. If
that was the way things worked, then complex literals could be accepted through
a similar mechanism to any other literal.</p>
<p>This isn’t how complex literals are handled, however. Instead, they’re passed
through to the AST as regular <code class="docutils literal notranslate"><span class="pre">BinOp</span></code> nodes, and then the constant folding
pass on the AST resolves them down to <code class="docutils literal notranslate"><span class="pre">Constant</span></code> nodes with a complex value.</p>
<p>For the parser to resolve complex literals directly, the compiler would need to
be able to tell the tokenizer to generate a distinct token type for
imaginary numbers (e.g. <code class="docutils literal notranslate"><span class="pre">INUMBER</span></code>), which would then allow the parser to
handle <code class="docutils literal notranslate"><span class="pre">NUMBER</span> <span class="pre">+</span> <span class="pre">INUMBER</span></code> and <code class="docutils literal notranslate"><span class="pre">NUMBER</span> <span class="pre">-</span> <span class="pre">INUMBER</span></code> separately from other
binary operations.</p>
<p>Alternatively, a new <code class="docutils literal notranslate"><span class="pre">ComplexNumber</span></code> AST node type could be defined, which
would allow the parser to notify the subsequent compiler stages that a
particular node should specifically be a complex literal, rather than an
arbitrary binary operation. Then the parser could accept <code class="docutils literal notranslate"><span class="pre">NUMBER</span> <span class="pre">+</span> <span class="pre">NUMBER</span></code>
and <code class="docutils literal notranslate"><span class="pre">NUMBER</span> <span class="pre">-</span> <span class="pre">NUMBER</span></code> for that node, while letting the AST validation for
<code class="docutils literal notranslate"><span class="pre">ComplexNumber</span></code> take care of ensuring that the real and imaginary parts of
the literal were real and imaginary numbers as expected.</p>
<p>For now, this PEP has postponed dealing with this question, and instead just
requires that complex literals be parenthesised in order to be used in value
constraints and as mapping pattern keys.</p>
</section>
<section id="allowing-negated-constraints-in-match-patterns">
<h3><a class="toc-backref" href="#id48">Allowing negated constraints in match patterns</a><a class="headerlink" href="#allowing-negated-constraints-in-match-patterns" title="Permalink to this headline">¶</a></h3>
<p>With the syntax proposed in this PEP, it isn’t permitted to write <code class="docutils literal notranslate"><span class="pre">!=</span> <span class="pre">expr</span></code>
or <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span> <span class="pre">expr</span></code> as a match pattern.</p>
<p>Both of these forms have clear potential interpretations as a negated equality
constraint (i.e. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">!=</span> <span class="pre">expr</span></code>) and a negated identity constraint
(i.e. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">expr</span></code>).</p>
<p>However, it’s far from clear either form would come up often enough to justify
the dedicated syntax, so the possible extension has been deferred pending further
community experience with match statements.</p>
</section>
<section id="allowing-membership-checks-in-match-patterns">
<span id="membership-constraints"></span><h3><a class="toc-backref" href="#id49">Allowing membership checks in match patterns</a><a class="headerlink" href="#allowing-membership-checks-in-match-patterns" title="Permalink to this headline">¶</a></h3>
<p>The syntax used for equality and identity constraints would be straightforward
to extend to membership checks: <code class="docutils literal notranslate"><span class="pre">in</span> <span class="pre">container</span></code>.</p>
<p>One downside of the proposals in both this PEP and <a class="reference external" href="pep-0634.html">PEP 634</a> is that checking
for multiple values in the same case doesn’t look like any existing container
membership check in Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># PEP 634&#39;s literal patterns</span>
<span class="n">match</span> <span class="n">value</span><span class="p">:</span>
    <span class="n">case</span> <span class="mi">0</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">3</span><span class="p">:</span>
        <span class="o">...</span>

<span class="c1"># This PEP&#39;s equality constraints</span>
<span class="n">match</span> <span class="n">value</span><span class="p">:</span>
    <span class="n">case</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">|</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">|</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">|</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Allowing inferred equality contraints under this PEP would only make it look
like the <a class="reference external" href="pep-0634.html">PEP 634</a> example, it still wouldn’t look like the equivalent <code class="docutils literal notranslate"><span class="pre">if</span></code>
statement header (<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">{0,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3}:</span></code>).</p>
<p>Membership constraints would provide a more explicit, but still concise, way
to check if the match subject was present in a container, and it would look
the same as an ordinary containment check:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">value</span><span class="p">:</span>
    <span class="n">case</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}:</span>
        <span class="o">...</span>
    <span class="n">case</span> <span class="ow">in</span> <span class="p">{</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="n">three</span><span class="p">,</span> <span class="n">four</span><span class="p">}:</span>
        <span class="o">...</span>
    <span class="n">case</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="c1"># It would accept any container, not just literal sets</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Such a feature would also be readily extensible to allow all kinds of case
clauses without any further syntax updates, simply by defining <code class="docutils literal notranslate"><span class="pre">__contains__</span></code>
appropriately on a custom class definition.</p>
<p>However, while this does seem like a useful extension, and a good way to resolve
this PEP’s verbosity problem when combining multiple equality checks in an
OR pattern, it isn’t essential to making match statements a valuable addition
to the language, so it seems more appropriate to defer it to a separate proposal,
rather than including it here.</p>
</section>
<section id="inferring-a-default-type-for-instance-attribute-constraints">
<h3><a class="toc-backref" href="#id50">Inferring a default type for instance attribute constraints</a><a class="headerlink" href="#inferring-a-default-type-for-instance-attribute-constraints" title="Permalink to this headline">¶</a></h3>
<p>The dedicated syntax for instance attribute constraints means that <code class="docutils literal notranslate"><span class="pre">object</span></code>
could be omitted from <code class="docutils literal notranslate"><span class="pre">object{.ATTR}</span></code> to give <code class="docutils literal notranslate"><span class="pre">{.ATTR}</span></code> without introducing
any syntactic ambiguity (if no class was given, <code class="docutils literal notranslate"><span class="pre">object</span></code> would be implied,
just as it is for the base class list in class definitions).</p>
<p>However, it’s far from clear saving six characters is worth making it harder to
visually distinguish mapping patterns from instance attribute patterns, so
allowing this has been deferred as a topic for possible future consideration.</p>
</section>
<section id="avoiding-special-cases-in-sequence-patterns">
<h3><a class="toc-backref" href="#id51">Avoiding special cases in sequence patterns</a><a class="headerlink" href="#avoiding-special-cases-in-sequence-patterns" title="Permalink to this headline">¶</a></h3>
<p>Sequence patterns in both this PEP and <a class="reference external" href="pep-0634.html">PEP 634</a> currently special case <code class="docutils literal notranslate"><span class="pre">str</span></code>,
<code class="docutils literal notranslate"><span class="pre">bytes</span></code>, and <code class="docutils literal notranslate"><span class="pre">bytearray</span></code> as specifically <em>never</em> matching a sequence
pattern.</p>
<p>This special casing could potentially be removed if we were to define a new
<code class="docutils literal notranslate"><span class="pre">collections.abc.AtomicSequence</span></code> abstract base class for types like these,
where they’re conceptually a single item, but still implement the sequence
protocol to allow random access to their component parts.</p>
</section>
<section id="expression-syntax-to-retrieve-multiple-attributes-from-an-instance">
<h3><a class="toc-backref" href="#id52">Expression syntax to retrieve multiple attributes from an instance</a><a class="headerlink" href="#expression-syntax-to-retrieve-multiple-attributes-from-an-instance" title="Permalink to this headline">¶</a></h3>
<p>The instance attribute pattern syntax has been designed such that it could
be used as the basis for a general purpose syntax for retrieving multiple
attributes from an object in a single expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">obj</span><span class="p">{</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="o">.</span><span class="n">port</span><span class="p">}</span>
</pre></div>
</div>
<p>Similar to slice syntax only being allowed inside bracket subscrpts, the
<code class="docutils literal notranslate"><span class="pre">.attr</span></code> syntax for naming attributes would only be allowed inside brace
subscripts.</p>
<p>This idea isn’t required for pattern matching to be useful, so it isn’t part of
this PEP. However, it’s mentioned as a possible path towards making pattern
matching feel more integrated into the rest of the language, rather than
existing forever in its own completely separated world.</p>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id53">Expression syntax to retrieve multiple attributes from an instance</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>If the brace subscript syntax were to be accepted for instance attribute
pattern matching, and then subsequently extended to offer general purpose
extraction of multiple attributes, then it could be extended even further to
allow for retrieval of multiple items from containers based on the syntax
used for mapping pattern matching:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">obj</span><span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">}</span>
<span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">obj</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p>Again, this idea isn’t required for pattern matching to be useful, so it isn’t
part of this PEP. As with retrieving multiple attributes, however, it is
included as an example of the proposed pattern matching syntax inspiring ideas
for making object deconstruction easier in general.</p>
</section>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#id54">Rejected Ideas</a><a class="headerlink" href="#rejected-ideas" title="Permalink to this headline">¶</a></h2>
<section id="restricting-permitted-expressions-in-value-constraints-and-mapping-pattern-keys">
<h3><a class="toc-backref" href="#id55">Restricting permitted expressions in value constraints and mapping pattern keys</a><a class="headerlink" href="#restricting-permitted-expressions-in-value-constraints-and-mapping-pattern-keys" title="Permalink to this headline">¶</a></h3>
<p>While it’s entirely technically possible to restrict the kinds of expressions
permitted in value constraints and mapping pattern keys to just attribute
lookups and constant literals (as <a class="reference external" href="pep-0634.html">PEP 634</a> does), there isn’t any clear runtime
value in doing so, so this PEP proposes allowing any kind of primary expression
(primary expressions are an existing node type in the grammar that includes
things like literals, names, attribute lookups, function calls, container
subscripts, parenthesised groups, etc), as well as high precedence unary
operations (<code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">~</span></code>) on primary expressions.</p>
<p>While <a class="reference external" href="pep-0635.html">PEP 635</a> does emphasise several times that literal patterns and value
patterns are not full expressions, it doesn’t ever articulate a concrete benefit
that is obtained from that restriction (just a theoretical appeal to it being
useful to separate static checks from dynamic checks, which a code style
tool could still enforce, even if the compiler itself is more permissive).</p>
<p>The last time we imposed such a restriction was for decorator expressions and
the primary outcome of that was that users had to put up with years of awkward
syntactic workarounds (like nesting arbitrary expressions inside function calls
that just returned their argument) to express the behaviour they wanted before
the language definition was finally updated to allow arbitrary expressions and
let users make their own decisions about readability.</p>
<p>The situation in <a class="reference external" href="pep-0634.html">PEP 634</a> that bears a resemblance to the situation with decorator
expressions is that arbitrary expressions are technically supported in value
patterns, they just require awkward workarounds where either all the values to
match need to be specified in a helper class that is placed before the match
statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Allowing arbitrary match targets with PEP 634&#39;s value pattern syntax</span>
<span class="k">class</span> <span class="nc">mt</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
<span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">mt</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
        <span class="o">...</span> <span class="c1"># Handle the case where &#39;expr[1] == func()&#39;</span>
</pre></div>
</div>
<p>Or else they need to be written as a combination of a capture pattern and a
guard expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Allowing arbitrary match targets with PEP 634&#39;s guard expressions</span>
<span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_matched</span><span class="p">)</span> <span class="k">if</span> <span class="n">_matched</span> <span class="o">==</span> <span class="n">func</span><span class="p">():</span>
        <span class="o">...</span> <span class="c1"># Handle the case where &#39;expr[1] == func()&#39;</span>
</pre></div>
</div>
<p>This PEP proposes skipping requiring any such workarounds, and instead
supporting arbitrary value constraints from the start:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="n">expr</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">(</span><span class="n">__</span><span class="p">,</span> <span class="o">==</span> <span class="n">func</span><span class="p">()):</span>
        <span class="o">...</span> <span class="c1"># Handle the case where &#39;expr == func()&#39;</span>
</pre></div>
</div>
<p>Whether actually writing that kind of code is a good idea would be a topic for
style guides and code linters, not the language compiler.</p>
<p>In particular, if static analysers can’t follow certain kinds of dynamic checks,
then they can limit the permitted expressions at analysis time, rather than the
compiler restricting them at compile time.</p>
<p>There are also some kinds of expressions that are almost certain to give
nonsensical results (e.g. <code class="docutils literal notranslate"><span class="pre">yield</span></code>, <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code>, <code class="docutils literal notranslate"><span class="pre">await</span></code>) due to the
pattern caching rule, where the number of times the constraint expression
actually gets evaluated will be implementation dependent. Even here, the PEP
takes the view of letting users write nonsense if they really want to.</p>
<p>Aside from the recenty updated decorator expressions, another situation where
Python’s formal syntax offers full freedom of expression that is almost never
used in practice is in <code class="docutils literal notranslate"><span class="pre">except</span></code> clauses: the exceptions to match against
almost always take the form of a simple name, a dotted name, or a tuple of
those, but the language grammar permits arbitrary expressions at that point.
This is a good indication that Python’s user base can be trusted to
take responsibility for finding readable ways to use permissive language
features, by avoiding writing hard to read constructs even when they’re
permitted by the compiler.</p>
<p>This permissiveness comes with a real concrete benefit on the implementation
side: dozens of lines of match statement specific code in the compiler is
replaced by simple calls to the existing code for compiling expressions
(including in the AST validation pass, the AST optimization pass, the symbol
table analysis pass, and the code generation pass). This implementation
benefit would accrue not just to CPython, but to every other Python
implementation looking to add match statement support.</p>
</section>
<section id="requiring-the-use-of-constraint-prefix-markers-for-mapping-pattern-keys">
<h3><a class="toc-backref" href="#id56">Requiring the use of constraint prefix markers for mapping pattern keys</a><a class="headerlink" href="#requiring-the-use-of-constraint-prefix-markers-for-mapping-pattern-keys" title="Permalink to this headline">¶</a></h3>
<p>The initial (unpublished) draft of this proposal suggested requiring mapping
pattern keys be value constraints, just as <a class="reference external" href="pep-0634.html">PEP 634</a> requires that they be valid
literal or value patterns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">constants</span>

<span class="n">match</span> <span class="n">config</span><span class="p">:</span>
    <span class="n">case</span> <span class="p">{</span><span class="o">==</span> <span class="s2">&quot;route&quot;</span><span class="p">:</span> <span class="n">route</span><span class="p">}:</span>
        <span class="n">process_route</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
    <span class="n">case</span> <span class="p">{</span><span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_PORT</span><span class="p">:</span> <span class="n">sub_config</span><span class="p">,</span> <span class="o">**</span><span class="n">rest</span><span class="p">}:</span>
        <span class="n">process_config</span><span class="p">(</span><span class="n">sub_config</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
</pre></div>
</div>
<p>However, the extra characters were syntactically noisy and unlike its use in
value constraints (where it distinguishes them from non-pattern expressions),
the prefix doesn’t provide any additional information here that isn’t already
conveyed by the expression’s position as a key within a mapping pattern.</p>
<p>Accordingly, the proposal was simplified to omit the marker prefix from mapping
pattern keys.</p>
<p>This omission also aligns with the fact that containers may incorporate both
identity and equality checks into their lookup process - they don’t purely
rely on equality checks, as would be incorrectly implied by the use of the
equality constraint prefix.</p>
</section>
<section id="allowing-the-key-value-separator-to-be-omitted-for-mapping-value-constraints">
<h3><a class="toc-backref" href="#id57">Allowing the key/value separator to be omitted for mapping value constraints</a><a class="headerlink" href="#allowing-the-key-value-separator-to-be-omitted-for-mapping-value-constraints" title="Permalink to this headline">¶</a></h3>
<p>Instance attribute patterns allow the <code class="docutils literal notranslate"><span class="pre">:</span></code> separator to be omitted when
writing attribute value constraints like <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">object{.attr</span> <span class="pre">==</span> <span class="pre">expr}</span></code>.</p>
<p>Offering a similar shorthand for mapping value constraints was considered, but
permitting it allows thoroughly baffling constructs like <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">{0</span> <span class="pre">==</span> <span class="pre">0}:</span></code>
where the compiler knows this is the key <code class="docutils literal notranslate"><span class="pre">0</span></code> with the value constraint
<code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">0</span></code>, but a human reader sees the tautological comparison operation
<code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">==</span> <span class="pre">0</span></code>. With the key/value separator included, the intent is more obvious to
a human reader as well: <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">{0:</span> <span class="pre">==</span> <span class="pre">0}:</span></code></p>
</section>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#id58">Reference Implementation</a><a class="headerlink" href="#reference-implementation" title="Permalink to this headline">¶</a></h2>
<p>A draft reference implementation for this PEP [<a class="reference internal" href="#id8">3</a>] has been derived from Brandt
Bucher’s reference implementation for <a class="reference external" href="pep-0634.html">PEP 634</a> [<a class="reference internal" href="#id9">4</a>].</p>
<p>Relative to the text of this PEP, the draft reference implementation has not
yet complemented the special casing of several builtin and standard library
types in <code class="docutils literal notranslate"><span class="pre">MATCH_CLASS</span></code> with the more general check for <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code>
being set to <code class="docutils literal notranslate"><span class="pre">None</span></code>. Class defined patterns also currently still accept
classes that don’t define <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code>.</p>
<p>All other modified patterns have been updated to follow this PEP rather than
<a class="reference external" href="pep-0634.html">PEP 634</a>.</p>
<p>Unparsing for match patterns has not yet been migrated to the updated v3 AST.</p>
<p>The AST validator for match patterns has not yet been implemented.</p>
<p>The AST validator in general has not yet been reviewed to ensure that it is
checking that only expression nodes are being passed in where expression nodes
are expected.</p>
<p>The examples in this PEP have not yet been converted to test cases, so could
plausibly contain typos and other errors.</p>
<p>Several of the old <a class="reference external" href="pep-0634.html">PEP 634</a> tests are still to be converted to new SyntaxError
tests.</p>
<p>The documentation has not yet been updated.</p>
</section>
<section id="acknowledgments">
<h2><a class="toc-backref" href="#id59">Acknowledgments</a><a class="headerlink" href="#acknowledgments" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="pep-0622.html">PEP 622</a> and <a class="reference external" href="pep-0634.html">PEP 634</a>/635/636 authors, as the proposal in this PEP is merely
an attempt to improve the readability of an already well-constructed idea by
proposing that starting with a more explicit syntax and potentially introducing
syntactic shortcuts for particularly common operations later is a better option
than attempting to <em>only</em> define the shortcut version. For areas of the
specification where the two PEPs are the same (or at least very similar), the
text describing the intended behaviour in this PEP is often derived directly
from the <a class="reference external" href="pep-0634.html">PEP 634</a> text.</p>
<p>Steven D’Aprano, who made a compelling case that the key goals of this PEP could
be achieved by using existing comparison tokens to tell the ability to override
the compiler when our guesses as to “what most users will want most of the time”
are inevitably incorrect for at least some users some of the time, and retaining
some of <a class="reference external" href="pep-0634.html">PEP 634</a>’s syntactic sugar (with a slightly different semantic definition)
to obtain the same level of brevity as <a class="reference external" href="pep-0634.html">PEP 634</a> in most situations. (Paul
Sokolosvsky also independently suggested using <code class="docutils literal notranslate"><span class="pre">==</span></code> instead of <code class="docutils literal notranslate"><span class="pre">?</span></code> as a
more easily understood prefix for equality constraints).</p>
<p>Thomas Wouters, whose publication of <a class="reference external" href="pep-0640.html">PEP 640</a> and public review of the structured
pattern matching proposals persuaded the author of this PEP to continue
advocating for a wildcard pattern syntax that a future PEP could plausibly turn
into a hard keyword that always skips binding a reference in any location a
simple name is expected, rather than continuing indefinitely as the match
pattern specific soft keyword that is proposed here.</p>
<p>Joao Bueno and Jim Jewett for nudging the PEP author to take a closer look at
the proposed syntax for subelement capturing within class patterns and mapping
patterns (particularly the problems with “capturing to the right”). This
review is what prompted the significant changes between v2 and v3 of the
proposal.</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id60">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id6"><span class="brackets">1</span></dt>
<dd><p>Post explaining the syntactic novelties in <a class="reference external" href="pep-0622.html">PEP 622</a>
<a class="reference external" href="https://mail.python.org/archives/list/python-dev&#64;python.org/message/2VRPDW4EE243QT3QNNCO7XFZYZGIY6N3/">https://mail.python.org/archives/list/python-dev&#64;python.org/message/2VRPDW4EE243QT3QNNCO7XFZYZGIY6N3/</a>&gt;</p>
</dd>
<dt class="label" id="id7"><span class="brackets">2</span></dt>
<dd><p>Declined pull request proposing to list this as a Rejected Idea in <a class="reference external" href="pep-0622.html">PEP 622</a>
<a class="reference external" href="https://github.com/python/peps/pull/1564">https://github.com/python/peps/pull/1564</a></p>
</dd>
<dt class="label" id="id8"><span class="brackets">3</span></dt>
<dd><p>In-progress reference implementation for this PEP
<a class="reference external" href="https://github.com/ncoghlan/cpython/tree/pep-642-constraint-patterns">https://github.com/ncoghlan/cpython/tree/pep-642-constraint-patterns</a></p>
</dd>
<dt class="label" id="id9"><span class="brackets">4</span></dt>
<dd><p><a class="reference external" href="pep-0634.html">PEP 634</a> reference implementation
<a class="reference external" href="https://github.com/python/cpython/pull/22917">https://github.com/python/cpython/pull/22917</a></p>
</dd>
<dt class="label" id="id10"><span class="brackets">5</span></dt>
<dd><p>Steven D’Aprano’s cogent criticism of the first published iteration of this PEP
<a class="reference external" href="https://mail.python.org/archives/list/python-dev&#64;python.org/message/BTHFWG6MWLHALOD6CHTUFPHAR65YN6BP/">https://mail.python.org/archives/list/python-dev&#64;python.org/message/BTHFWG6MWLHALOD6CHTUFPHAR65YN6BP/</a></p>
</dd>
<dt class="label" id="id11"><span class="brackets">6</span></dt>
<dd><p>Thomas Wouter’s initial review of the structured pattern matching proposals
<a class="reference external" href="https://mail.python.org/archives/list/python-dev&#64;python.org/thread/4SBR3J5IQUYE752KR7C6432HNBSYKC5X/">https://mail.python.org/archives/list/python-dev&#64;python.org/thread/4SBR3J5IQUYE752KR7C6432HNBSYKC5X/</a></p>
</dd>
<dt class="label" id="id12"><span class="brackets">7</span></dt>
<dd><p>Stack Overflow answer regarding the use cases for <code class="docutils literal notranslate"><span class="pre">_</span></code> as an identifier
<a class="reference external" href="https://stackoverflow.com/questions/5893163/what-is-the-purpose-of-the-single-underscore-variable-in-python/5893946#5893946">https://stackoverflow.com/questions/5893163/what-is-the-purpose-of-the-single-underscore-variable-in-python/5893946#5893946</a></p>
</dd>
<dt class="label" id="id13"><span class="brackets">8</span></dt>
<dd><p>Pre-publication draft of “Precise Semantics for Pattern Matching”
<a class="reference external" href="https://github.com/markshannon/pattern-matching/blob/master/precise_semantics.rst">https://github.com/markshannon/pattern-matching/blob/master/precise_semantics.rst</a></p>
</dd>
<dt class="label" id="id14"><span class="brackets">9</span></dt>
<dd><p>Kohn et al., Dynamic Pattern Matching with Python
<a class="reference external" href="https://gvanrossum.github.io/docs/PyPatternMatching.pdf">https://gvanrossum.github.io/docs/PyPatternMatching.pdf</a></p>
</dd>
</dl>
</section>
<section id="appendix-a-full-grammar">
<span id="appendix-a"></span><h2><a class="toc-backref" href="#id61">Appendix A – Full Grammar</a><a class="headerlink" href="#appendix-a-full-grammar" title="Permalink to this headline">¶</a></h2>
<p>Here is the full modified grammar for <code class="docutils literal notranslate"><span class="pre">match_stmt</span></code>, replacing Appendix A
in <a class="reference external" href="pep-0634.html">PEP 634</a>.</p>
<p>Notation used beyond standard EBNF is as per <a class="reference external" href="pep-0534.html">PEP 534</a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'KWD'</span></code> denotes a hard keyword</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;KWD&quot;</span></code> denotes a soft keyword</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SEP.RULE+</span></code> is shorthand for <code class="docutils literal notranslate"><span class="pre">RULE</span> <span class="pre">(SEP</span> <span class="pre">RULE)*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!RULE</span></code> is a negative lookahead assertion</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>match_stmt: &quot;match&quot; subject_expr &#39;:&#39; NEWLINE INDENT case_block+ DEDENT
subject_expr:
    | star_named_expression &#39;,&#39; [star_named_expressions]
    | named_expression
case_block: &quot;case&quot; (guarded_pattern | open_pattern) &#39;:&#39; block

guarded_pattern: closed_pattern &#39;if&#39; named_expression
open_pattern: # Pattern may use multiple tokens with no closing delimiter
    | as_pattern
    | or_pattern

as_pattern: [closed_pattern] pattern_as_clause
as_pattern_with_inferred_wildcard: pattern_as_clause
pattern_as_clause: &#39;as&#39; pattern_capture_target
pattern_capture_target: !&quot;__&quot; NAME !(&#39;.&#39; | &#39;(&#39; | &#39;=&#39;)

or_pattern: &#39;|&#39;.simple_pattern+

simple_pattern: # Subnode where &quot;as&quot; and &quot;or&quot; patterns must be parenthesised
    | closed_pattern
    | value_constraint

value_constraint:
    | eq_constraint
    | id_constraint

eq_constraint: &#39;==&#39; closed_expr
id_constraint: &#39;is&#39; closed_expr

closed_expr: # Require a single token or a closing delimiter in expression
    | primary
    | closed_factor

closed_factor: # &quot;factor&quot; is the main grammar node for these unary ops
    | &#39;+&#39; primary
    | &#39;-&#39; primary
    | &#39;~&#39; primary

closed_pattern: # Require a single token or a closing delimiter in pattern
    | wildcard_pattern
    | group_pattern
    | structural_constraint

wildcard_pattern: &quot;__&quot;

group_pattern: &#39;(&#39; open_pattern &#39;)&#39;

structural_constraint:
    | sequence_constraint
    | mapping_constraint
    | attrs_constraint
    | class_constraint

sequence_constraint: &#39;[&#39; [sequence_constraint_elements] &#39;]&#39;
sequence_constraint_elements: &#39;,&#39;.sequence_constraint_element+ &#39;,&#39;?
sequence_constraint_element:
    | star_pattern
    | simple_pattern
    | as_pattern_with_inferred_wildcard
star_pattern: &#39;*&#39; (pattern_as_clause | wildcard_pattern)

mapping_constraint: &#39;{&#39; [mapping_constraint_elements] &#39;}&#39;
mapping_constraint_elements: &#39;,&#39;.key_value_constraint+ &#39;,&#39;?
key_value_constraint:
    | closed_expr pattern_as_clause
    | closed_expr &#39;:&#39; simple_pattern
    | double_star_capture
double_star_capture: &#39;**&#39; pattern_as_clause

attrs_constraint:
    | name_or_attr &#39;{&#39; [attrs_constraint_elements] &#39;}&#39;
name_or_attr: attr | NAME
attr: name_or_attr &#39;.&#39; NAME
attrs_constraint_elements: &#39;,&#39;.attr_value_constraint+ &#39;,&#39;?
attr_value_constraint:
    | &#39;.&#39; NAME pattern_as_clause
    | &#39;.&#39; NAME value_constraint
    | &#39;.&#39; NAME &#39;:&#39; simple_pattern
    | &#39;.&#39; NAME

class_constraint:
    | name_or_attr &#39;(&#39; &#39;)&#39;
    | name_or_attr &#39;(&#39; positional_patterns &#39;,&#39;? &#39;)&#39;
    | name_or_attr &#39;(&#39; class_constraint_attrs &#39;)&#39;
    | name_or_attr &#39;(&#39; positional_patterns &#39;,&#39; class_constraint_attrs] &#39;)&#39;
positional_patterns: &#39;,&#39;.positional_pattern+
positional_pattern:
    | simple_pattern
    | as_pattern_with_inferred_wildcard
class_constraint_attrs:
    | &#39;**&#39; &#39;{&#39; [attrs_constraint_elements] &#39;}&#39;
</pre></div>
</div>
</section>
<section id="appendix-b-summary-of-abstract-syntax-tree-changes">
<span id="appendix-b"></span><h2><a class="toc-backref" href="#id62">Appendix B: Summary of Abstract Syntax Tree changes</a><a class="headerlink" href="#appendix-b-summary-of-abstract-syntax-tree-changes" title="Permalink to this headline">¶</a></h2>
<p>The following new nodes are added to the AST by this PEP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>stmt = ...
      | ...
      | Match(expr subject, match_case* cases)
      | ...
      ...

match_case = (pattern pattern, expr? guard, stmt* body)

pattern = MatchAlways
     | MatchValue(matchop op, expr value)
     | MatchSequence(pattern* patterns)
     | MatchMapping(expr* keys, pattern* patterns)
     | MatchAttrs(expr cls, identifier* attrs, pattern* patterns)
     | MatchClass(expr cls, pattern* patterns, identifier* extra_attrs, pattern* extra_patterns)

     | MatchRestOfSequence(identifier? target)
     -- A NULL entry in the MatchMapping key list handles capturing extra mapping keys

     | MatchAs(pattern? pattern, identifier target)
     | MatchOr(pattern* patterns)

      attributes (int lineno, int col_offset, int? end_lineno, int? end_col_offset)

matchop = EqCheck | IdCheck
</pre></div>
</div>
</section>
<section id="appendix-c-summary-of-changes-relative-to-pep-634">
<span id="appendix-c"></span><h2>Appendix C: Summary of changes relative to <a class="reference external" href="pep-0634.html">PEP 634</a><a class="headerlink" href="#appendix-c-summary-of-changes-relative-to-pep-634" title="Permalink to this headline">¶</a></h2>
<p>The overall <code class="docutils literal notranslate"><span class="pre">match</span></code>/<code class="docutils literal notranslate"><span class="pre">case</span></code> statement syntax and the guard expression syntax
remain the same as they are in <a class="reference external" href="pep-0634.html">PEP 634</a>.</p>
<p>Relative to <a class="reference external" href="pep-0634.html">PEP 634</a> this PEP makes the following key changes:</p>
<ul class="simple">
<li><p>a new <code class="docutils literal notranslate"><span class="pre">pattern</span></code> type is defined in the AST, rather than reusing the <code class="docutils literal notranslate"><span class="pre">expr</span></code>
type for patterns</p></li>
<li><p>the new <code class="docutils literal notranslate"><span class="pre">MatchAs</span></code> and <code class="docutils literal notranslate"><span class="pre">MatchOr</span></code> AST nodes are moved from the <code class="docutils literal notranslate"><span class="pre">expr</span></code>
type to the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> type</p></li>
<li><p>the wildcard pattern changes from <code class="docutils literal notranslate"><span class="pre">_</span></code> (single underscore) to <code class="docutils literal notranslate"><span class="pre">__</span></code> (double
underscore), and gains a dedicated <code class="docutils literal notranslate"><span class="pre">MatchAlways</span></code> node in the AST</p></li>
<li><p>due to ambiguity of intent, value patterns and literal patterns are removed</p></li>
<li><p>a new expression category is introduced: “closed expressions”</p></li>
<li><p>closed expressions are either primary expressions, or a closed expression
preceded by one of the high precedence unary operators (<code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">~</span></code>)</p></li>
<li><p>a new pattern type is introduced: “value constraint patterns”</p></li>
<li><p>value constraints have a dedicated <code class="docutils literal notranslate"><span class="pre">MatchValue</span></code> AST node rather than
allowing a combination of <code class="docutils literal notranslate"><span class="pre">Constant</span></code> (literals), <code class="docutils literal notranslate"><span class="pre">UnaryOp</span></code>
(negative numbers), <code class="docutils literal notranslate"><span class="pre">BinOp</span></code> (complex numbers), and <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> (attribute
lookups)</p></li>
<li><p>value constraint patterns are either equality constraints or identity constraints</p></li>
<li><p>equality constraints use <code class="docutils literal notranslate"><span class="pre">==</span></code> as a prefix marker on an otherwise
arbitrary closed expression: <code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">EXPR</span></code></p></li>
<li><p>identity constraints use <code class="docutils literal notranslate"><span class="pre">is</span></code> as a prefix marker on an otherwise
arbitrary closed expression: <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">EXPR</span></code></p></li>
<li><p>due to ambiguity of intent, capture patterns are removed. All capture operations
use the <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword (even in sequence matching) and are represented in the
AST as either <code class="docutils literal notranslate"><span class="pre">MatchAs</span></code> or <code class="docutils literal notranslate"><span class="pre">MatchRestOfSequence</span></code> nodes.</p></li>
<li><p>to reduce verbosity in AS patterns, <code class="docutils literal notranslate"><span class="pre">as</span> <span class="pre">NAME</span></code> is permitted, with the same
meaning as <code class="docutils literal notranslate"><span class="pre">__</span> <span class="pre">as</span> <span class="pre">NAME</span></code></p></li>
<li><p>sequence patterns change to <em>require</em> the use of square brackets, rather than
offering the same syntactic flexibility as assignment targets (assignment
statements allow iterable unpacking to be indicated by any use of a tuple
separated target, with or without surrounding parentheses or square brackets)</p></li>
<li><p>sequence patterns gain a dedicated <code class="docutils literal notranslate"><span class="pre">MatchSequence</span></code> AST node rather than
reusing <code class="docutils literal notranslate"><span class="pre">List</span></code></p></li>
<li><p>mapping patterns change to allow arbitrary closed expressions as keys</p></li>
<li><p>mapping patterns gain a dedicated <code class="docutils literal notranslate"><span class="pre">MatchMapping</span></code> AST node rather than
reusing <code class="docutils literal notranslate"><span class="pre">Dict</span></code></p></li>
<li><p>to reduce verbosity in mapping patterns, <code class="docutils literal notranslate"><span class="pre">KEY</span> <span class="pre">:</span> <span class="pre">__</span> <span class="pre">as</span> <span class="pre">NAME</span></code> may be shortened
to <code class="docutils literal notranslate"><span class="pre">KEY</span> <span class="pre">as</span> <span class="pre">NAME</span></code></p></li>
<li><p>class patterns no longer use individual keyword argument syntax for attribute
matching. Instead they use double-star syntax, along with a variant on mapping
pattern syntax with a dot prefix on the attribute names</p></li>
<li><p>class patterns gain a dedicated <code class="docutils literal notranslate"><span class="pre">MatchClass</span></code> AST node rather than
reusing <code class="docutils literal notranslate"><span class="pre">Call</span></code></p></li>
<li><p>to reduce verbosity, class attribute matching allows <code class="docutils literal notranslate"><span class="pre">:</span></code> to be omitted when
the pattern to be matched starts with <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">is</span></code>, or <code class="docutils literal notranslate"><span class="pre">as</span></code></p></li>
<li><p>class patterns treat any class that sets <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> as
accepting a single positional pattern that is matched against the entire
object (avoiding the special casing required in <a class="reference external" href="pep-0634.html">PEP 634</a>)</p></li>
<li><p>class patterns raise <code class="docutils literal notranslate"><span class="pre">TypeError`</span> <span class="pre">when</span> <span class="pre">used</span> <span class="pre">with</span> <span class="pre">an</span> <span class="pre">object</span> <span class="pre">that</span> <span class="pre">does</span> <span class="pre">not</span>
<span class="pre">define</span> <span class="pre">``__match_args__</span></code></p></li>
<li><p>dedicated syntax for ducktyping is added, such that <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">cls{...}:</span></code> is
roughly equivalent to <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">cls(**{...}):</span></code>, but skips the check for the
existence of <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code>. This pattern also has a dedicated AST node,
<code class="docutils literal notranslate"><span class="pre">MatchAttrs</span></code></p></li>
</ul>
<p>Note that postponing literal patterns also makes it possible to postpone the
question of whether we need an “INUMBER” token in the tokeniser for imaginary
literals. Without it, the parser can’t distinguish complex literals from other
binary addition and subtraction operations on constants, so proposals like
<a class="reference external" href="pep-0634.html">PEP 634</a> have to do work in later compilation steps to check for correct usage.</p>
</section>
<section id="appendix-d-history-of-changes-to-this-proposal">
<span id="appendix-d"></span><h2><a class="toc-backref" href="#id64">Appendix D: History of changes to this proposal</a><a class="headerlink" href="#appendix-d-history-of-changes-to-this-proposal" title="Permalink to this headline">¶</a></h2>
<p>The first published iteration of this proposal mostly followed <a class="reference external" href="pep-0634.html">PEP 634</a>, but
suggested using <code class="docutils literal notranslate"><span class="pre">?EXPR</span></code> for equality constraints and <code class="docutils literal notranslate"><span class="pre">?is</span> <span class="pre">EXPR</span></code> for
identity constraints rather than <a class="reference external" href="pep-0634.html">PEP 634</a>’s value patterns and literal patterns.</p>
<p>The second published iteration mostly adopted a counter-proposal from Steven
D’Aprano that kept the <a class="reference external" href="pep-0634.html">PEP 634</a> style inferred constraints in many situations,
but also allowed the use of <code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">EXPR</span></code> for explicit equality constraints, and
<code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">EXPR</span></code> for explicit identity constraints.</p>
<p>The third published (and current) iteration dropped inferred patterns entirely,
in an attempt to resolve the concerns with the fact that the patterns
<code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">{key:</span> <span class="pre">NAME}:</span></code> and <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">cls(attr=NAME):</span></code> would both bind <code class="docutils literal notranslate"><span class="pre">NAME</span></code>
despite it appearing to the right of another subexpression without using the
<code class="docutils literal notranslate"><span class="pre">as</span></code> keyword. The revised proposal also eliminates the possibility of writing
<code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">TARGET1</span> <span class="pre">as</span> <span class="pre">TARGET2:</span></code>, which would bind to both of the given names. Of
those changes, the most concerning was <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">cls(attr=TARGET_NAME):</span></code>, since it
involved the use of <code class="docutils literal notranslate"><span class="pre">=</span></code> with the binding target on the right, the exact
opposite of what happens in assignment statements, function calls, and
function signature declarations.</p>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#id65">Copyright</a><a class="headerlink" href="#copyright" title="Permalink to this headline">¶</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<span>Source: <a class="reference external" href="https://github.com/python/peps/blob/master/pep-0642.rst">https://github.com/python/peps/blob/master/pep-0642.rst</a></span><div class="zero-height line"><br /></div>
<span>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/master/pep-0642.rst">2021-06-28T11:16:08Z</a></span>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../contents/">PEPs</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">PEP Table of Contents (needed for Sphinx):</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pep-0000/">PEP 0 – Index of Python Enhancement Proposals (PEPs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0001/">PEP 1 – PEP Purpose and Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0002/">PEP 2 – Procedure for Adding New Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0003/">PEP 3 – Guidelines for Handling Bug Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0004/">PEP 4 – Deprecation of Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0005/">PEP 5 – Guidelines for Language Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0006/">PEP 6 – Bug Fix Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0007/">PEP 7 – Style Guide for C Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0008/">PEP 8 – Style Guide for Python Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0009/">PEP 9 – Sample Plaintext PEP Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0010/">PEP 10 – Voting Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0011/">PEP 11 – Removing support for little used platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0012/">PEP 12 – Sample reStructuredText PEP Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0013/">PEP 13 – Python Language Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0020/">PEP 20 – The Zen of Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0042/">PEP 42 – Feature Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0100/">PEP 100 – Python Unicode Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0101/">PEP 101 – Doing Python Releases 101</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0102/">PEP 102 – Doing Python Micro Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0103/">PEP 103 – Collecting information about git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0160/">PEP 160 – Python 1.6 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0200/">PEP 200 – Python 2.0 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0201/">PEP 201 – Lockstep Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0202/">PEP 202 – List Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0203/">PEP 203 – Augmented Assignments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0204/">PEP 204 – Range Literals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0205/">PEP 205 – Weak References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0206/">PEP 206 – Python Advanced Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0207/">PEP 207 – Rich Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0208/">PEP 208 – Reworking the Coercion Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0209/">PEP 209 – Multi-dimensional Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0210/">PEP 210 – Decoupling the Interpreter Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0211/">PEP 211 – Adding A New Outer Product Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0212/">PEP 212 – Loop Counter Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0213/">PEP 213 – Attribute Access Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0214/">PEP 214 – Extended Print Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0215/">PEP 215 – String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0216/">PEP 216 – Docstring Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0217/">PEP 217 – Display Hook for Interactive Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0218/">PEP 218 – Adding a Built-In Set Object Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0219/">PEP 219 – Stackless Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0220/">PEP 220 – Coroutines, Generators, Continuations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0221/">PEP 221 – Import As</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0222/">PEP 222 – Web Library Enhancements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0223/">PEP 223 – Change the Meaning of ``\x`` Escapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0224/">PEP 224 – Attribute Docstrings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0225/">PEP 225 – Elementwise/Objectwise Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0226/">PEP 226 – Python 2.1 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0227/">PEP 227 – Statically Nested Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0228/">PEP 228 – Reworking Python’s Numeric Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0229/">PEP 229 – Using Distutils to Build Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0230/">PEP 230 – Warning Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0231/">PEP 231 – __findattr__()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0232/">PEP 232 – Function Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0233/">PEP 233 – Python Online Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0234/">PEP 234 – Iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0235/">PEP 235 – Import on Case-Insensitive Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0236/">PEP 236 – Back to the __future__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0237/">PEP 237 – Unifying Long Integers and Integers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0238/">PEP 238 – Changing the Division Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0239/">PEP 239 – Adding a Rational Type to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0240/">PEP 240 – Adding a Rational Literal to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0241/">PEP 241 – Metadata for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0242/">PEP 242 – Numeric Kinds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0243/">PEP 243 – Module Repository Upload Mechanism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0244/">PEP 244 – The ``directive`` statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0245/">PEP 245 – Python Interface Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0246/">PEP 246 – Object Adaptation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0247/">PEP 247 – API for Cryptographic Hash Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0248/">PEP 248 – Python Database API Specification v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0249/">PEP 249 – Python Database API Specification v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0250/">PEP 250 – Using site-packages on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0251/">PEP 251 – Python 2.2 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0252/">PEP 252 – Making Types Look More Like Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0253/">PEP 253 – Subtyping Built-in Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0254/">PEP 254 – Making Classes Look More Like Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0255/">PEP 255 – Simple Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0256/">PEP 256 – Docstring Processing System Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0257/">PEP 257 – Docstring Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0258/">PEP 258 – Docutils Design Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0259/">PEP 259 – Omit printing newline after newline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0260/">PEP 260 – Simplify xrange()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0261/">PEP 261 – Support for “wide” Unicode characters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0262/">PEP 262 – A Database of Installed Python Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0263/">PEP 263 – Defining Python Source Code Encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0264/">PEP 264 – Future statements in simulated shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0265/">PEP 265 – Sorting Dictionaries by Value</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0266/">PEP 266 – Optimizing Global Variable/Attribute Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0267/">PEP 267 – Optimized Access to Module Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0268/">PEP 268 – Extended HTTP functionality and WebDAV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0269/">PEP 269 – Pgen Module for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0270/">PEP 270 – uniq method for list objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0271/">PEP 271 – Prefixing sys.path by command line option</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0272/">PEP 272 – API for Block Encryption Algorithms v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0273/">PEP 273 – Import Modules from Zip Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0274/">PEP 274 – Dict Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0275/">PEP 275 – Switching on Multiple Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0276/">PEP 276 – Simple Iterator for ints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0277/">PEP 277 – Unicode file name support for Windows NT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0278/">PEP 278 – Universal Newline Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0279/">PEP 279 – The enumerate() built-in function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0280/">PEP 280 – Optimizing access to globals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0281/">PEP 281 – Loop Counter Iteration with range and xrange</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0282/">PEP 282 – A Logging System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0283/">PEP 283 – Python 2.3 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0284/">PEP 284 – Integer for-loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0285/">PEP 285 – Adding a bool type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0286/">PEP 286 – Enhanced Argument Tuples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0287/">PEP 287 – reStructuredText Docstring Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0288/">PEP 288 – Generators Attributes and Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0289/">PEP 289 – Generator Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0290/">PEP 290 – Code Migration and Modernization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0291/">PEP 291 – Backward Compatibility for the Python 2 Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0292/">PEP 292 – Simpler String Substitutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0293/">PEP 293 – Codec Error Handling Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0294/">PEP 294 – Type Names in the types Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0295/">PEP 295 – Interpretation of multiline string constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0296/">PEP 296 – Adding a bytes Object Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0297/">PEP 297 – Support for System Upgrades</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0298/">PEP 298 – The Locked Buffer Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0299/">PEP 299 – Special __main__() function in modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0301/">PEP 301 – Package Index and Metadata for Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0302/">PEP 302 – New Import Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0303/">PEP 303 – Extend divmod() for Multiple Divisors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0304/">PEP 304 – Controlling Generation of Bytecode Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0305/">PEP 305 – CSV File API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0306/">PEP 306 – How to Change Python’s Grammar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0307/">PEP 307 – Extensions to the pickle protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0308/">PEP 308 – Conditional Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0309/">PEP 309 – Partial Function Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0310/">PEP 310 – Reliable Acquisition/Release Pairs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0311/">PEP 311 – Simplified Global Interpreter Lock Acquisition for Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0312/">PEP 312 – Simple Implicit Lambda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0313/">PEP 313 – Adding Roman Numeral Literals to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0314/">PEP 314 – Metadata for Python Software Packages v1.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0315/">PEP 315 – Enhanced While Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0316/">PEP 316 – Programming by Contract for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0317/">PEP 317 – Eliminate Implicit Exception Instantiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0318/">PEP 318 – Decorators for Functions and Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0319/">PEP 319 – Python Synchronize/Asynchronize Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0320/">PEP 320 – Python 2.4 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0321/">PEP 321 – Date/Time Parsing and Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0322/">PEP 322 – Reverse Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0323/">PEP 323 – Copyable Iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0324/">PEP 324 – subprocess - New process module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0325/">PEP 325 – Resource-Release Support for Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0326/">PEP 326 – A Case for Top and Bottom Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0327/">PEP 327 – Decimal Data Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0328/">PEP 328 – Imports: Multi-Line and Absolute/Relative</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0329/">PEP 329 – Treating Builtins as Constants in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0330/">PEP 330 – Python Bytecode Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0331/">PEP 331 – Locale-Independent Float/String Conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0332/">PEP 332 – Byte vectors and String/Unicode Unification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0333/">PEP 333 – Python Web Server Gateway Interface v1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0334/">PEP 334 – Simple Coroutines via SuspendIteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0335/">PEP 335 – Overloadable Boolean Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0336/">PEP 336 – Make None Callable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0337/">PEP 337 – Logging Usage in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0338/">PEP 338 – Executing modules as scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0339/">PEP 339 – Design of the CPython Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0340/">PEP 340 – Anonymous Block Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0341/">PEP 341 – Unifying try-except and try-finally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0342/">PEP 342 – Coroutines via Enhanced Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0343/">PEP 343 – The “with” Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0344/">PEP 344 – Exception Chaining and Embedded Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0345/">PEP 345 – Metadata for Python Software Packages 1.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0346/">PEP 346 – User Defined (“``with``”) Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0347/">PEP 347 – Migrating the Python CVS to Subversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0348/">PEP 348 – Exception Reorganization for Python 3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0349/">PEP 349 – Allow str() to return unicode strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0350/">PEP 350 – Codetags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0351/">PEP 351 – The freeze protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0352/">PEP 352 – Required Superclass for Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0353/">PEP 353 – Using ssize_t as the index type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0354/">PEP 354 – Enumerations in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0355/">PEP 355 – Path - Object oriented filesystem paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0356/">PEP 356 – Python 2.5 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0357/">PEP 357 – Allowing Any Object to be Used for Slicing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0358/">PEP 358 – The “bytes” Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0359/">PEP 359 – The “make” Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0360/">PEP 360 – Externally Maintained Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0361/">PEP 361 – Python 2.6 and 3.0 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0362/">PEP 362 – Function Signature Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0363/">PEP 363 – Syntax For Dynamic Attribute Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0364/">PEP 364 – Transitioning to the Py3K Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0365/">PEP 365 – Adding the pkg_resources module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0366/">PEP 366 – Main module explicit relative imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0367/">PEP 367 – New Super</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0368/">PEP 368 – Standard image protocol and class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0369/">PEP 369 – Post import hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0370/">PEP 370 – Per user site-packages directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0371/">PEP 371 – Addition of the multiprocessing package to the standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0372/">PEP 372 – Adding an ordered dictionary to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0373/">PEP 373 – Python 2.7 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0374/">PEP 374 – Choosing a distributed VCS for the Python project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0375/">PEP 375 – Python 3.1 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0376/">PEP 376 – Database of Installed Python Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0377/">PEP 377 – Allow __enter__() methods to skip the statement body</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0378/">PEP 378 – Format Specifier for Thousands Separator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0379/">PEP 379 – Adding an Assignment Expression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0380/">PEP 380 – Syntax for Delegating to a Subgenerator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0381/">PEP 381 – Mirroring infrastructure for PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0382/">PEP 382 – Namespace Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0383/">PEP 383 – Non-decodable Bytes in System Character Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0384/">PEP 384 – Defining a Stable ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0385/">PEP 385 – Migrating from Subversion to Mercurial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0386/">PEP 386 – Changing the version comparison module in Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0387/">PEP 387 – Backwards Compatibility Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0389/">PEP 389 – argparse - New Command Line Parsing Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0390/">PEP 390 – Static metadata for Distutils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0391/">PEP 391 – Dictionary-Based Configuration For Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0392/">PEP 392 – Python 3.2 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0393/">PEP 393 – Flexible String Representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0394/">PEP 394 – The “python” Command on Unix-Like Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0395/">PEP 395 – Qualified Names for Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0396/">PEP 396 – Module Version Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0397/">PEP 397 – Python launcher for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0398/">PEP 398 – Python 3.3 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0399/">PEP 399 – Pure Python/C Accelerator Module Compatibility Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0400/">PEP 400 – Deprecate codecs.StreamReader and codecs.StreamWriter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0401/">PEP 401 – BDFL Retirement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0402/">PEP 402 – Simplified Package Layout and Partitioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0403/">PEP 403 – General purpose decorator clause (aka “&#64;in” clause)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0404/">PEP 404 – Python 2.8 Un-release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0405/">PEP 405 – Python Virtual Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0406/">PEP 406 – Improved Encapsulation of Import State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0407/">PEP 407 – New release cycle and introducing long-term support versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0408/">PEP 408 – Standard library __preview__ package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0409/">PEP 409 – Suppressing exception context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0410/">PEP 410 – Use decimal.Decimal type for timestamps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0411/">PEP 411 – Provisional packages in the Python standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0412/">PEP 412 – Key-Sharing Dictionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0413/">PEP 413 – Faster evolution of the Python Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0414/">PEP 414 – Explicit Unicode Literal for Python 3.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0415/">PEP 415 – Implement context suppression with exception attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0416/">PEP 416 – Add a frozendict builtin type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0417/">PEP 417 – Including mock in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0418/">PEP 418 – Add monotonic time, performance counter, and process time functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0419/">PEP 419 – Protecting cleanup statements from interruptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0420/">PEP 420 – Implicit Namespace Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0421/">PEP 421 – Adding sys.implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0422/">PEP 422 – Simpler customisation of class creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0423/">PEP 423 – Naming conventions and recipes related to packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0424/">PEP 424 – A method for exposing a length hint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0425/">PEP 425 – Compatibility Tags for Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0426/">PEP 426 – Metadata for Python Software Packages 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0427/">PEP 427 – The Wheel Binary Package Format 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0428/">PEP 428 – The pathlib module – object-oriented filesystem paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0429/">PEP 429 – Python 3.4 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0430/">PEP 430 – Migrating to Python 3 as the default online documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0431/">PEP 431 – Time zone support improvements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0432/">PEP 432 – Restructuring the CPython startup sequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0433/">PEP 433 – Easier suppression of file descriptor inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0434/">PEP 434 – IDLE Enhancement Exception for All Branches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0435/">PEP 435 – Adding an Enum type to the Python standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0436/">PEP 436 – The Argument Clinic DSL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0437/">PEP 437 – A DSL for specifying signatures, annotations and argument converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0438/">PEP 438 – Transitioning to release-file hosting on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0439/">PEP 439 – Inclusion of implicit pip bootstrap in Python installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0440/">PEP 440 – Version Identification and Dependency Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0441/">PEP 441 – Improving Python ZIP Application Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0442/">PEP 442 – Safe object finalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0443/">PEP 443 – Single-dispatch generic functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0444/">PEP 444 – Python Web3 Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0445/">PEP 445 – Add new APIs to customize Python memory allocators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0446/">PEP 446 – Make newly created file descriptors non-inheritable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0447/">PEP 447 – Add __getdescriptor__ method to metaclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0448/">PEP 448 – Additional Unpacking Generalizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0449/">PEP 449 – Removal of the PyPI Mirror Auto Discovery and Naming Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0450/">PEP 450 – Adding A Statistics Module To The Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0451/">PEP 451 – A ModuleSpec Type for the Import System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0452/">PEP 452 – API for Cryptographic Hash Functions v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0453/">PEP 453 – Explicit bootstrapping of pip in Python installations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0454/">PEP 454 – Add a new tracemalloc module to trace Python memory allocations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0455/">PEP 455 – Adding a key-transforming dictionary to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0456/">PEP 456 – Secure and interchangeable hash algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0457/">PEP 457 – Notation For Positional-Only Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0458/">PEP 458 – Secure PyPI downloads with signed repository metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0459/">PEP 459 – Standard Metadata Extensions for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0460/">PEP 460 – Add binary interpolation and formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0461/">PEP 461 – Adding % formatting to bytes and bytearray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0462/">PEP 462 – Core development workflow automation for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0463/">PEP 463 – Exception-catching expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0464/">PEP 464 – Removal of the PyPI Mirror Authenticity API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0465/">PEP 465 – A dedicated infix operator for matrix multiplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0466/">PEP 466 – Network Security Enhancements for Python 2.7.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0467/">PEP 467 – Minor API improvements for binary sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0468/">PEP 468 – Preserving the order of \*\*kwargs in a function.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0469/">PEP 469 – Migration of dict iteration code to Python 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0470/">PEP 470 – Removing External Hosting Support on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0471/">PEP 471 – os.scandir() function – a better and faster directory iterator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0472/">PEP 472 – Support for indexing with keyword arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0473/">PEP 473 – Adding structured data to built-in exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0474/">PEP 474 – Creating forge.python.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0475/">PEP 475 – Retry system calls failing with EINTR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0476/">PEP 476 – Enabling certificate verification by default for stdlib http clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0477/">PEP 477 – Backport ensurepip (PEP 453) to Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0478/">PEP 478 – Python 3.5 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0479/">PEP 479 – Change StopIteration handling inside generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0480/">PEP 480 – Surviving a Compromise of PyPI: End-to-end signing of packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0481/">PEP 481 – Migrate CPython to Git, Github, and Phabricator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0482/">PEP 482 – Literature Overview for Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0483/">PEP 483 – The Theory of Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0484/">PEP 484 – Type Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0485/">PEP 485 – A Function for testing approximate equality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0486/">PEP 486 – Make the Python Launcher aware of virtual environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0487/">PEP 487 – Simpler customisation of class creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0488/">PEP 488 – Elimination of PYO files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0489/">PEP 489 – Multi-phase extension module initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0490/">PEP 490 – Chain exceptions at C level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0491/">PEP 491 – The Wheel Binary Package Format 1.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0492/">PEP 492 – Coroutines with async and await syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0493/">PEP 493 – HTTPS verification migration tools for Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0494/">PEP 494 – Python 3.6 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0495/">PEP 495 – Local Time Disambiguation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0496/">PEP 496 – Environment Markers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0497/">PEP 497 – A standard mechanism for backward compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0498/">PEP 498 – Literal String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0499/">PEP 499 – ``python -m foo`` should bind ``sys.modules[‘foo’]`` in addition to ``sys.modules[‘__main__’]``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0500/">PEP 500 – A protocol for delegating datetime methods to their
tzinfo implementations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0501/">PEP 501 – General purpose string interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0502/">PEP 502 – String Interpolation - Extended Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0503/">PEP 503 – Simple Repository API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0504/">PEP 504 – Using the System RNG by default</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0505/">PEP 505 – None-aware operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0506/">PEP 506 – Adding A Secrets Module To The Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0507/">PEP 507 – Migrate CPython to Git and GitLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0508/">PEP 508 – Dependency specification for Python Software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0509/">PEP 509 – Add a private version to dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0510/">PEP 510 – Specialize functions with guards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0511/">PEP 511 – API for code transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0512/">PEP 512 – Migrating from hg.python.org to GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0513/">PEP 513 – A Platform Tag for Portable Linux Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0514/">PEP 514 – Python registration in the Windows registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0515/">PEP 515 – Underscores in Numeric Literals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0516/">PEP 516 – Build system abstraction for pip/conda etc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0517/">PEP 517 – A build-system independent format for source trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0518/">PEP 518 – Specifying Minimum Build System Requirements for Python Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0519/">PEP 519 – Adding a file system path protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0520/">PEP 520 – Preserving Class Attribute Definition Order</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0521/">PEP 521 – Managing global context via ‘with’ blocks in generators and coroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0522/">PEP 522 – Allow BlockingIOError in security sensitive APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0523/">PEP 523 – Adding a frame evaluation API to CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0524/">PEP 524 – Make os.urandom() blocking on Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0525/">PEP 525 – Asynchronous Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0526/">PEP 526 – Syntax for Variable Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0527/">PEP 527 – Removing Un(der)used file types/extensions on PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0528/">PEP 528 – Change Windows console encoding to UTF-8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0529/">PEP 529 – Change Windows filesystem encoding to UTF-8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0530/">PEP 530 – Asynchronous Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0531/">PEP 531 – Existence checking operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0532/">PEP 532 – A circuit breaking protocol and binary operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0533/">PEP 533 – Deterministic cleanup for iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0534/">PEP 534 – Improved Errors for Missing Standard Library Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0535/">PEP 535 – Rich comparison chaining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0536/">PEP 536 – Final Grammar for Literal String Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0537/">PEP 537 – Python 3.7 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0538/">PEP 538 – Coercing the legacy C locale to a UTF-8 based locale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0539/">PEP 539 – A New C-API for Thread-Local Storage in CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0540/">PEP 540 – Add a new UTF-8 Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0541/">PEP 541 – Package Index Name Retention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0542/">PEP 542 – Dot Notation Assignment In Function Header</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0543/">PEP 543 – A Unified TLS API for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0544/">PEP 544 – Protocols: Structural subtyping (static duck typing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0545/">PEP 545 – Python Documentation Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0546/">PEP 546 – Backport ssl.MemoryBIO and ssl.SSLObject to Python 2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0547/">PEP 547 – Running extension modules using the -m option</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0548/">PEP 548 – More Flexible Loop Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0549/">PEP 549 – Instance Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0550/">PEP 550 – Execution Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0551/">PEP 551 – Security transparency in the Python runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0552/">PEP 552 – Deterministic pycs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0553/">PEP 553 – Built-in breakpoint()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0554/">PEP 554 – Multiple Interpreters in the Stdlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0555/">PEP 555 – Context-local variables (contextvars)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0556/">PEP 556 – Threaded garbage collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0557/">PEP 557 – Data Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0558/">PEP 558 – Defined semantics for locals()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0559/">PEP 559 – Built-in noop()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0560/">PEP 560 – Core support for typing module and generic types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0561/">PEP 561 – Distributing and Packaging Type Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0562/">PEP 562 – Module __getattr__ and __dir__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0563/">PEP 563 – Postponed Evaluation of Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0564/">PEP 564 – Add new time functions with nanosecond resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0565/">PEP 565 – Show DeprecationWarning in __main__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0566/">PEP 566 – Metadata for Python Software Packages 2.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0567/">PEP 567 – Context Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0568/">PEP 568 – Generator-sensitivity for Context Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0569/">PEP 569 – Python 3.8 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0570/">PEP 570 – Python Positional-Only Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0571/">PEP 571 – The manylinux2010 Platform Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0572/">PEP 572 – Assignment Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0573/">PEP 573 – Module State Access from C Extension Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0574/">PEP 574 – Pickle protocol 5 with out-of-band data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0575/">PEP 575 – Unifying function/method classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0576/">PEP 576 – Rationalize Built-in function classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0577/">PEP 577 – Augmented Assignment Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0578/">PEP 578 – Python Runtime Audit Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0579/">PEP 579 – Refactoring C functions and methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0580/">PEP 580 – The C call protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0581/">PEP 581 – Using GitHub Issues for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0582/">PEP 582 – Python local packages directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0583/">PEP 583 – A Concurrency Memory Model for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0584/">PEP 584 – Add Union Operators To dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0585/">PEP 585 – Type Hinting Generics In Standard Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0586/">PEP 586 – Literal Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0587/">PEP 587 – Python Initialization Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0588/">PEP 588 – GitHub Issues Migration Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0589/">PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0590/">PEP 590 – Vectorcall: a fast calling protocol for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0591/">PEP 591 – Adding a final qualifier to typing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0592/">PEP 592 – Adding “Yank” Support to the Simple API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0593/">PEP 593 – Flexible function and variable annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0594/">PEP 594 – Removing dead batteries from the standard library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0595/">PEP 595 – Improving bugs.python.org</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0596/">PEP 596 – Python 3.9 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0597/">PEP 597 – Add optional EncodingWarning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0598/">PEP 598 – Introducing incremental feature releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0599/">PEP 599 – The manylinux2014 Platform Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0600/">PEP 600 – Future ‘manylinux’ Platform Tags for Portable Linux Built Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0601/">PEP 601 – Forbid return/break/continue breaking out of finally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0602/">PEP 602 – Annual Release Cycle for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0603/">PEP 603 – Adding a frozenmap type to collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0604/">PEP 604 – Allow writing union types as ``X | Y``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0605/">PEP 605 – A rolling feature release stream for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0606/">PEP 606 – Python Compatibility Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0607/">PEP 607 – Reducing CPython’s Feature Delivery Latency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0608/">PEP 608 – Coordinated Python release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0609/">PEP 609 – PyPA Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0610/">PEP 610 – Recording the Direct URL Origin of installed distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0611/">PEP 611 – The one million limit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0612/">PEP 612 – Parameter Specification Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0613/">PEP 613 – Explicit Type Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0614/">PEP 614 – Relaxing Grammar Restrictions On Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0615/">PEP 615 – Support for the IANA Time Zone Database in the Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0616/">PEP 616 – String methods to remove prefixes and suffixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0617/">PEP 617 – New PEG parser for CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0618/">PEP 618 – Add Optional Length-Checking To zip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0619/">PEP 619 – Python 3.10 Release Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0620/">PEP 620 – Hide implementation details from the C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0621/">PEP 621 – Storing project metadata in pyproject.toml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0622/">PEP 622 – Structural Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0623/">PEP 623 – Remove wstr from Unicode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0624/">PEP 624 – Remove Py_UNICODE encoder APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0625/">PEP 625 – File name of a Source Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0626/">PEP 626 – Precise line numbers for debugging and other tools.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0627/">PEP 627 – Recording installed projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0628/">PEP 628 – Add ``math.tau``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0629/">PEP 629 – Versioning PyPI’s Simple API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0630/">PEP 630 – Isolating Extension Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0631/">PEP 631 – Dependency specification in pyproject.toml based on PEP 508</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0632/">PEP 632 – Deprecate distutils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0633/">PEP 633 – Dependency specification in pyproject.toml using an exploded TOML table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0634/">PEP 634 – Structural Pattern Matching: Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0635/">PEP 635 – Structural Pattern Matching: Motivation and Rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0636/">PEP 636 – Structural Pattern Matching: Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0637/">PEP 637 – Support for indexing with keyword arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0638/">PEP 638 – Syntactic Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0639/">PEP 639 – Metadata for Python Software Packages 2.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0640/">PEP 640 – Unused variable syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0641/">PEP 641 – Using an underscore in the version portion of Python 3.10 compatibility tags</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PEP 642 – Explicit Pattern Syntax for Structural Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0643/">PEP 643 – Metadata for Package Source Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0644/">PEP 644 – Require OpenSSL 1.1.1 or newer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0645/">PEP 645 – Allow writing optional types as ``x?``</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0646/">PEP 646 – Variadic Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0647/">PEP 647 – User-Defined Type Guards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0648/">PEP 648 – Extensible customizations of the interpreter at startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0649/">PEP 649 – Deferred Evaluation Of Annotations Using Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0650/">PEP 650 – Specifying Installer Requirements for Python Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0651/">PEP 651 – Robust Stack Overflow Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0652/">PEP 652 – Maintaining the Stable ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0653/">PEP 653 – Precise Semantics for Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0654/">PEP 654 – Exception Groups and except*</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0655/">PEP 655 – Marking individual TypedDict items as required or potentially-missing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0656/">PEP 656 – Platform Tag for Linux Distributions Using Musl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0657/">PEP 657 – Include Fine Grained Error Locations in Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0658/">PEP 658 – Serve Distribution Metadata in the Simple Repository API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0659/">PEP 659 – Specializing Adaptive Interpreter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0660/">PEP 660 – Editable installs for pyproject.toml based builds (wheel based)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0661/">PEP 661 – Sentinel Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0662/">PEP 662 – Editable installs via virtual wheels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0666/">PEP 666 – Reject Foolish Indentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0754/">PEP 754 – IEEE 754 Floating Point Special Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-0801/">PEP 801 – Reserved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3000/">PEP 3000 – Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3001/">PEP 3001 – Procedure for reviewing and improving standard library modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3002/">PEP 3002 – Procedure for Backwards-Incompatible Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3003/">PEP 3003 – Python Language Moratorium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3099/">PEP 3099 – Things that will Not Change in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3100/">PEP 3100 – Miscellaneous Python 3.0 Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3101/">PEP 3101 – Advanced String Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3102/">PEP 3102 – Keyword-Only Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3103/">PEP 3103 – A Switch/Case Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3104/">PEP 3104 – Access to Names in Outer Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3105/">PEP 3105 – Make print a function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3106/">PEP 3106 – Revamping dict.keys(), .values() and .items()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3107/">PEP 3107 – Function Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3108/">PEP 3108 – Standard Library Reorganization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3109/">PEP 3109 – Raising Exceptions in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3110/">PEP 3110 – Catching Exceptions in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3111/">PEP 3111 – Simple input built-in in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3112/">PEP 3112 – Bytes literals in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3113/">PEP 3113 – Removal of Tuple Parameter Unpacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3114/">PEP 3114 – Renaming iterator.next() to iterator.__next__()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3115/">PEP 3115 – Metaclasses in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3116/">PEP 3116 – New I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3117/">PEP 3117 – Postfix type declarations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3118/">PEP 3118 – Revising the buffer protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3119/">PEP 3119 – Introducing Abstract Base Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3120/">PEP 3120 – Using UTF-8 as the default source encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3121/">PEP 3121 – Extension Module Initialization and Finalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3122/">PEP 3122 – Delineation of the main module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3123/">PEP 3123 – Making PyObject_HEAD conform to standard C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3124/">PEP 3124 – Overloading, Generic Functions, Interfaces, and Adaptation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3125/">PEP 3125 – Remove Backslash Continuation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3126/">PEP 3126 – Remove Implicit String Concatenation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3127/">PEP 3127 – Integer Literal Support and Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3128/">PEP 3128 – BList: A Faster List-like Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3129/">PEP 3129 – Class Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3130/">PEP 3130 – Access to Current Module/Class/Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3131/">PEP 3131 – Supporting Non-ASCII Identifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3132/">PEP 3132 – Extended Iterable Unpacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3133/">PEP 3133 – Introducing Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3134/">PEP 3134 – Exception Chaining and Embedded Tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3135/">PEP 3135 – New Super</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3136/">PEP 3136 – Labeled break and continue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3137/">PEP 3137 – Immutable Bytes and Mutable Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3138/">PEP 3138 – String representation in Python 3000</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3139/">PEP 3139 – Cleaning out sys and the “interpreter” module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3140/">PEP 3140 – str(container) should call str(item), not repr(item)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3141/">PEP 3141 – A Type Hierarchy for Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3142/">PEP 3142 – Add a “while” clause to generator expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3143/">PEP 3143 – Standard daemon process library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3144/">PEP 3144 – IP Address Manipulation Library for the Python Standard Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3145/">PEP 3145 – Asynchronous I/O For subprocess.Popen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3146/">PEP 3146 – Merging Unladen Swallow into CPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3147/">PEP 3147 – PYC Repository Directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3148/">PEP 3148 – futures - execute computations asynchronously</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3149/">PEP 3149 – ABI version tagged .so files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3150/">PEP 3150 – Statement local namespaces (aka “given” clause)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3151/">PEP 3151 – Reworking the OS and IO exception hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3152/">PEP 3152 – Cofunctions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3153/">PEP 3153 – Asynchronous IO support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3154/">PEP 3154 – Pickle protocol version 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3155/">PEP 3155 – Qualified name for classes and functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3156/">PEP 3156 – Asynchronous IO Support Rebooted: the “asyncio” Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-3333/">PEP 3333 – Python Web Server Gateway Interface v1.0.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8000/">PEP 8000 – Python Language Governance Proposal Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8001/">PEP 8001 – Python Governance Voting Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8002/">PEP 8002 – Open Source Governance Survey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8010/">PEP 8010 – The Technical Leader Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8011/">PEP 8011 – Python Governance Model Lead by Trio of Pythonistas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8012/">PEP 8012 – The Community Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8013/">PEP 8013 – The External Council Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8014/">PEP 8014 – The Commons Governance Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8015/">PEP 8015 – Organization of the Python community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8016/">PEP 8016 – The Steering Council Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8100/">PEP 8100 – January 2019 steering council election</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8101/">PEP 8101 – 2020 Term steering council election</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pep-8102/">PEP 8102 – 2021 Term steering council election</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../contents/">Documentation overview</a><ul>
      <li>Previous: <a href="../pep-0641/" title="previous chapter">PEP 641 – Using an underscore in the version portion of Python 3.10 compatibility tags</a></li>
      <li>Next: <a href="../pep-0643/" title="next chapter">PEP 643 – Metadata for Package Source Distributions</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/pep-0642.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>